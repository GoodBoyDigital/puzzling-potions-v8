var by=Object.defineProperty;var yy=(s,t,e)=>t in s?by(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var A=(s,t,e)=>(yy(s,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerpolicy&&(n.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?n.credentials="include":r.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(r){if(r.ep)return;r.ep=!0;const n=e(r);fetch(r.href,n)}})();class mp{constructor(){this.entries={},this.size=0}add(t){let e=this.entries[t];return this.entries[t]=!0,e?!1:(this.size++,!0)}addAll(t){let e=this.size;for(var i=0,r=t.length;i<r;i++)this.add(t[i]);return e!=this.size}contains(t){return this.entries[t]}clear(){this.entries={},this.size=0}}class tt{constructor(t=0,e=0,i=0,r=0){this.r=t,this.g=e,this.b=i,this.a=r}set(t,e,i,r){return this.r=t,this.g=e,this.b=i,this.a=r,this.clamp()}setFromColor(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}setFromString(t){return t=t.charAt(0)=="#"?t.substr(1):t,this.r=parseInt(t.substr(0,2),16)/255,this.g=parseInt(t.substr(2,2),16)/255,this.b=parseInt(t.substr(4,2),16)/255,this.a=t.length!=8?1:parseInt(t.substr(6,2),16)/255,this}add(t,e,i,r){return this.r+=t,this.g+=e,this.b+=i,this.a+=r,this.clamp()}clamp(){return this.r<0?this.r=0:this.r>1&&(this.r=1),this.g<0?this.g=0:this.g>1&&(this.g=1),this.b<0?this.b=0:this.b>1&&(this.b=1),this.a<0?this.a=0:this.a>1&&(this.a=1),this}static rgba8888ToColor(t,e){t.r=((e&4278190080)>>>24)/255,t.g=((e&16711680)>>>16)/255,t.b=((e&65280)>>>8)/255,t.a=(e&255)/255}static rgb888ToColor(t,e){t.r=((e&16711680)>>>16)/255,t.g=((e&65280)>>>8)/255,t.b=(e&255)/255}static fromString(t){return new tt().setFromString(t)}}tt.WHITE=new tt(1,1,1,1);tt.RED=new tt(1,0,0,1);tt.GREEN=new tt(0,1,0,1);tt.BLUE=new tt(0,0,1,1);tt.MAGENTA=new tt(1,0,1,1);class D{static clamp(t,e,i){return t<e?e:t>i?i:t}static cosDeg(t){return Math.cos(t*D.degRad)}static sinDeg(t){return Math.sin(t*D.degRad)}static signum(t){return t>0?1:t<0?-1:0}static toInt(t){return t>0?Math.floor(t):Math.ceil(t)}static cbrt(t){let e=Math.pow(Math.abs(t),.3333333333333333);return t<0?-e:e}static randomTriangular(t,e){return D.randomTriangularWith(t,e,(t+e)*.5)}static randomTriangularWith(t,e,i){let r=Math.random(),n=e-t;return r<=(i-t)/n?t+Math.sqrt(r*n*(i-t)):e-Math.sqrt((1-r)*n*(e-i))}static isPowerOfTwo(t){return t&&(t&t-1)===0}}D.PI=3.1415927;D.PI2=D.PI*2;D.radiansToDegrees=180/D.PI;D.radDeg=D.radiansToDegrees;D.degreesToRadians=D.PI/180;D.degRad=D.degreesToRadians;class Y{static arrayCopy(t,e,i,r,n){for(let a=e,o=r;a<e+n;a++,o++)i[o]=t[a]}static arrayFill(t,e,i,r){for(let n=e;n<i;n++)t[n]=r}static setArraySize(t,e,i=0){let r=t.length;if(r==e)return t;if(t.length=e,r<e)for(let n=r;n<e;n++)t[n]=i;return t}static ensureArrayCapacity(t,e,i=0){return t.length>=e?t:Y.setArraySize(t,e,i)}static newArray(t,e){let i=new Array(t);for(let r=0;r<t;r++)i[r]=e;return i}static newFloatArray(t){if(Y.SUPPORTS_TYPED_ARRAYS)return new Float32Array(t);{let e=new Array(t);for(let i=0;i<e.length;i++)e[i]=0;return e}}static newShortArray(t){if(Y.SUPPORTS_TYPED_ARRAYS)return new Int16Array(t);{let e=new Array(t);for(let i=0;i<e.length;i++)e[i]=0;return e}}static toFloatArray(t){return Y.SUPPORTS_TYPED_ARRAYS?new Float32Array(t):t}static toSinglePrecision(t){return Y.SUPPORTS_TYPED_ARRAYS?Math.fround(t):t}static webkit602BugfixHelper(t,e){}static contains(t,e,i=!0){for(var r=0;r<t.length;r++)if(t[r]==e)return!0;return!1}static enumValue(t,e){return t[e[0].toUpperCase()+e.slice(1)]}}Y.SUPPORTS_TYPED_ARRAYS=typeof Float32Array<"u";let xl=class{constructor(t){this.items=new Array,this.instantiator=t}obtain(){return this.items.length>0?this.items.pop():this.instantiator()}free(t){t.reset&&t.reset(),this.items.push(t)}freeAll(t){for(let e=0;e<t.length;e++)this.free(t[e])}clear(){this.items.length=0}};class Ja{constructor(t=0,e=0){this.x=t,this.y=e}set(t,e){return this.x=t,this.y=e,this}length(){let t=this.x,e=this.y;return Math.sqrt(t*t+e*e)}normalize(){let t=this.length();return t!=0&&(this.x/=t,this.y/=t),this}}class gp{constructor(t){if(!t)throw new Error("name cannot be null.");this.name=t}}class ti extends gp{constructor(t){super(t),this.id=ti.nextID++,this.bones=null,this.vertices=[],this.worldVerticesLength=0,this.timelineAttachment=this}computeWorldVertices(t,e,i,r,n,a){i=n+(i>>1)*a;let o=t.bone.skeleton,h=t.deform,l=this.vertices,c=this.bones;if(!c){h.length>0&&(l=h);let p=t.bone,m=p.worldX,g=p.worldY,x=p.a,y=p.b,b=p.c,v=p.d;for(let _=e,w=n;w<i;_+=2,w+=a){let T=l[_],S=l[_+1];r[w]=T*x+S*y+m,r[w+1]=T*b+S*v+g}return}let u=0,d=0;for(let p=0;p<e;p+=2){let m=c[u];u+=m+1,d+=m}let f=o.bones;if(h.length==0)for(let p=n,m=d*3;p<i;p+=a){let g=0,x=0,y=c[u++];for(y+=u;u<y;u++,m+=3){let b=f[c[u]],v=l[m],_=l[m+1],w=l[m+2];g+=(v*b.a+_*b.b+b.worldX)*w,x+=(v*b.c+_*b.d+b.worldY)*w}r[p]=g,r[p+1]=x}else{let p=h;for(let m=n,g=d*3,x=d<<1;m<i;m+=a){let y=0,b=0,v=c[u++];for(v+=u;u<v;u++,g+=3,x+=2){let _=f[c[u]],w=l[g]+p[x],T=l[g+1]+p[x+1],S=l[g+2];y+=(w*_.a+T*_.b+_.worldX)*S,b+=(w*_.c+T*_.d+_.worldY)*S}r[m]=y,r[m+1]=b}}}copyTo(t){this.bones?(t.bones=new Array(this.bones.length),Y.arrayCopy(this.bones,0,t.bones,0,this.bones.length)):t.bones=null,this.vertices&&(t.vertices=Y.newFloatArray(this.vertices.length),Y.arrayCopy(this.vertices,0,t.vertices,0,this.vertices.length)),t.worldVerticesLength=this.worldVerticesLength,t.timelineAttachment=this.timelineAttachment}}ti.nextID=0;let Br=class{constructor(t){this.id=Br.nextID(),this.start=0,this.digits=0,this.setupIndex=0,this.regions=new Array(t)}copy(){let t=new Br(this.regions.length);return Y.arrayCopy(this.regions,0,t.regions,0,this.regions.length),t.start=this.start,t.digits=this.digits,t.setupIndex=this.setupIndex,t}apply(t,e){let i=t.sequenceIndex;i==-1&&(i=this.setupIndex),i>=this.regions.length&&(i=this.regions.length-1);let r=this.regions[i];e.region!=r&&(e.region=r,e.updateRegion())}getPath(t,e){let i=t,r=(this.start+e).toString();for(let n=this.digits-r.length;n>0;n--)i+="0";return i+=r,i}static nextID(){return Br._nextID++}};Br._nextID=0;var le;(function(s){s[s.hold=0]="hold",s[s.once=1]="once",s[s.loop=2]="loop",s[s.pingpong=3]="pingpong",s[s.onceReverse=4]="onceReverse",s[s.loopReverse=5]="loopReverse",s[s.pingpongReverse=6]="pingpongReverse"})(le||(le={}));const bp=[le.hold,le.once,le.loop,le.pingpong,le.onceReverse,le.loopReverse,le.pingpongReverse];let Cc=class{constructor(t,e,i){if(this.timelines=[],this.timelineIds=new mp,!t)throw new Error("name cannot be null.");this.name=t,this.setTimelines(e),this.duration=i}setTimelines(t){if(!t)throw new Error("timelines cannot be null.");this.timelines=t,this.timelineIds.clear();for(var e=0;e<t.length;e++)this.timelineIds.addAll(t[e].getPropertyIds())}hasTimeline(t){for(let e=0;e<t.length;e++)if(this.timelineIds.contains(t[e]))return!0;return!1}apply(t,e,i,r,n,a,o,h){if(!t)throw new Error("skeleton cannot be null.");r&&this.duration!=0&&(i%=this.duration,e>0&&(e%=this.duration));let l=this.timelines;for(let c=0,u=l.length;c<u;c++)l[c].apply(t,e,i,n,a,o,h)}};var U;(function(s){s[s.setup=0]="setup",s[s.first=1]="first",s[s.replace=2]="replace",s[s.add=3]="add"})(U||(U={}));var we;(function(s){s[s.mixIn=0]="mixIn",s[s.mixOut=1]="mixOut"})(we||(we={}));const vt={rotate:0,x:1,y:2,scaleX:3,scaleY:4,shearX:5,shearY:6,rgb:7,alpha:8,rgb2:9,attachment:10,deform:11,event:12,drawOrder:13,ikConstraint:14,transformConstraint:15,pathConstraintPosition:16,pathConstraintSpacing:17,pathConstraintMix:18,sequence:19};let Yt=class{constructor(t,e){this.propertyIds=e,this.frames=Y.newFloatArray(t*this.getFrameEntries())}getPropertyIds(){return this.propertyIds}getFrameEntries(){return 1}getFrameCount(){return this.frames.length/this.getFrameEntries()}getDuration(){return this.frames[this.frames.length-this.getFrameEntries()]}static search1(t,e){let i=t.length;for(let r=1;r<i;r++)if(t[r]>e)return r-1;return i-1}static search(t,e,i){let r=t.length;for(let n=i;n<r;n+=i)if(t[n]>e)return n-i;return r-i}};class Gi extends Yt{constructor(t,e,i){super(t,i),this.curves=Y.newFloatArray(t+e*18),this.curves[t-1]=1}setLinear(t){this.curves[t]=0}setStepped(t){this.curves[t]=1}shrink(t){let e=this.getFrameCount()+t*18;if(this.curves.length>e){let i=Y.newFloatArray(e);Y.arrayCopy(this.curves,0,i,0,e),this.curves=i}}setBezier(t,e,i,r,n,a,o,h,l,c,u){let d=this.curves,f=this.getFrameCount()+t*18;i==0&&(d[e]=2+f);let p=(r-a*2+h)*.03,m=(n-o*2+l)*.03,g=((a-h)*3-r+c)*.006,x=((o-l)*3-n+u)*.006,y=p*2+g,b=m*2+x,v=(a-r)*.3+p+g*.16666667,_=(o-n)*.3+m+x*.16666667,w=r+v,T=n+_;for(let S=f+18;f<S;f+=2)d[f]=w,d[f+1]=T,v+=y,_+=b,y+=g,b+=x,w+=v,T+=_}getBezierValue(t,e,i,r){let n=this.curves;if(n[r]>t){let l=this.frames[e],c=this.frames[e+i];return c+(t-l)/(n[r]-l)*(n[r+1]-c)}let a=r+18;for(r+=2;r<a;r+=2)if(n[r]>=t){let l=n[r-2],c=n[r-1];return c+(t-l)/(n[r]-l)*(n[r+1]-c)}e+=this.getFrameEntries();let o=n[a-2],h=n[a-1];return h+(t-o)/(this.frames[e]-o)*(this.frames[e+i]-h)}}class Vi extends Gi{constructor(t,e,i){super(t,e,[i])}getFrameEntries(){return 2}setFrame(t,e,i){t<<=1,this.frames[t]=e,this.frames[t+1]=i}getCurveValue(t){let e=this.frames,i=e.length-2;for(let n=2;n<=i;n+=2)if(e[n]>t){i=n-2;break}let r=this.curves[i>>1];switch(r){case 0:let n=e[i],a=e[i+1];return a+(t-n)/(e[i+2]-n)*(e[i+2+1]-a);case 1:return e[i+1]}return this.getBezierValue(t,i,1,r-2)}}class Ac extends Gi{constructor(t,e,i,r){super(t,e,[i,r])}getFrameEntries(){return 3}setFrame(t,e,i,r){t*=3,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=r}}class Qa extends Vi{constructor(t,e,i){super(t,e,vt.rotate+"|"+i),this.boneIndex=0,this.boneIndex=i}apply(t,e,i,r,n,a,o){let h=t.bones[this.boneIndex];if(!h.active)return;let l=this.frames;if(i<l[0]){switch(a){case U.setup:h.rotation=h.data.rotation;return;case U.first:h.rotation+=(h.data.rotation-h.rotation)*n}return}let c=this.getCurveValue(i);switch(a){case U.setup:h.rotation=h.data.rotation+c*n;break;case U.first:case U.replace:c+=h.data.rotation-h.rotation;case U.add:h.rotation+=c*n}}}class yp extends Ac{constructor(t,e,i){super(t,e,vt.x+"|"+i,vt.y+"|"+i),this.boneIndex=0,this.boneIndex=i}apply(t,e,i,r,n,a,o){let h=t.bones[this.boneIndex];if(!h.active)return;let l=this.frames;if(i<l[0]){switch(a){case U.setup:h.x=h.data.x,h.y=h.data.y;return;case U.first:h.x+=(h.data.x-h.x)*n,h.y+=(h.data.y-h.y)*n}return}let c=0,u=0,d=Yt.search(l,i,3),f=this.curves[d/3];switch(f){case 0:let p=l[d];c=l[d+1],u=l[d+2];let m=(i-p)/(l[d+3]-p);c+=(l[d+3+1]-c)*m,u+=(l[d+3+2]-u)*m;break;case 1:c=l[d+1],u=l[d+2];break;default:c=this.getBezierValue(i,d,1,f-2),u=this.getBezierValue(i,d,2,f+18-2)}switch(a){case U.setup:h.x=h.data.x+c*n,h.y=h.data.y+u*n;break;case U.first:case U.replace:h.x+=(h.data.x+c-h.x)*n,h.y+=(h.data.y+u-h.y)*n;break;case U.add:h.x+=c*n,h.y+=u*n}}}class xp extends Vi{constructor(t,e,i){super(t,e,vt.x+"|"+i),this.boneIndex=0,this.boneIndex=i}apply(t,e,i,r,n,a,o){let h=t.bones[this.boneIndex];if(!h.active)return;let l=this.frames;if(i<l[0]){switch(a){case U.setup:h.x=h.data.x;return;case U.first:h.x+=(h.data.x-h.x)*n}return}let c=this.getCurveValue(i);switch(a){case U.setup:h.x=h.data.x+c*n;break;case U.first:case U.replace:h.x+=(h.data.x+c-h.x)*n;break;case U.add:h.x+=c*n}}}class vp extends Vi{constructor(t,e,i){super(t,e,vt.y+"|"+i),this.boneIndex=0,this.boneIndex=i}apply(t,e,i,r,n,a,o){let h=t.bones[this.boneIndex];if(!h.active)return;let l=this.frames;if(i<l[0]){switch(a){case U.setup:h.y=h.data.y;return;case U.first:h.y+=(h.data.y-h.y)*n}return}let c=this.getCurveValue(i);switch(a){case U.setup:h.y=h.data.y+c*n;break;case U.first:case U.replace:h.y+=(h.data.y+c-h.y)*n;break;case U.add:h.y+=c*n}}}class _p extends Ac{constructor(t,e,i){super(t,e,vt.scaleX+"|"+i,vt.scaleY+"|"+i),this.boneIndex=0,this.boneIndex=i}apply(t,e,i,r,n,a,o){let h=t.bones[this.boneIndex];if(!h.active)return;let l=this.frames;if(i<l[0]){switch(a){case U.setup:h.scaleX=h.data.scaleX,h.scaleY=h.data.scaleY;return;case U.first:h.scaleX+=(h.data.scaleX-h.scaleX)*n,h.scaleY+=(h.data.scaleY-h.scaleY)*n}return}let c,u,d=Yt.search(l,i,3),f=this.curves[d/3];switch(f){case 0:let p=l[d];c=l[d+1],u=l[d+2];let m=(i-p)/(l[d+3]-p);c+=(l[d+3+1]-c)*m,u+=(l[d+3+2]-u)*m;break;case 1:c=l[d+1],u=l[d+2];break;default:c=this.getBezierValue(i,d,1,f-2),u=this.getBezierValue(i,d,2,f+18-2)}if(c*=h.data.scaleX,u*=h.data.scaleY,n==1)a==U.add?(h.scaleX+=c-h.data.scaleX,h.scaleY+=u-h.data.scaleY):(h.scaleX=c,h.scaleY=u);else{let p=0,m=0;if(o==we.mixOut)switch(a){case U.setup:p=h.data.scaleX,m=h.data.scaleY,h.scaleX=p+(Math.abs(c)*D.signum(p)-p)*n,h.scaleY=m+(Math.abs(u)*D.signum(m)-m)*n;break;case U.first:case U.replace:p=h.scaleX,m=h.scaleY,h.scaleX=p+(Math.abs(c)*D.signum(p)-p)*n,h.scaleY=m+(Math.abs(u)*D.signum(m)-m)*n;break;case U.add:h.scaleX+=(c-h.data.scaleX)*n,h.scaleY+=(u-h.data.scaleY)*n}else switch(a){case U.setup:p=Math.abs(h.data.scaleX)*D.signum(c),m=Math.abs(h.data.scaleY)*D.signum(u),h.scaleX=p+(c-p)*n,h.scaleY=m+(u-m)*n;break;case U.first:case U.replace:p=Math.abs(h.scaleX)*D.signum(c),m=Math.abs(h.scaleY)*D.signum(u),h.scaleX=p+(c-p)*n,h.scaleY=m+(u-m)*n;break;case U.add:h.scaleX+=(c-h.data.scaleX)*n,h.scaleY+=(u-h.data.scaleY)*n}}}}class wp extends Vi{constructor(t,e,i){super(t,e,vt.scaleX+"|"+i),this.boneIndex=0,this.boneIndex=i}apply(t,e,i,r,n,a,o){let h=t.bones[this.boneIndex];if(!h.active)return;let l=this.frames;if(i<l[0]){switch(a){case U.setup:h.scaleX=h.data.scaleX;return;case U.first:h.scaleX+=(h.data.scaleX-h.scaleX)*n}return}let c=this.getCurveValue(i)*h.data.scaleX;if(n==1)a==U.add?h.scaleX+=c-h.data.scaleX:h.scaleX=c;else{let u=0;if(o==we.mixOut)switch(a){case U.setup:u=h.data.scaleX,h.scaleX=u+(Math.abs(c)*D.signum(u)-u)*n;break;case U.first:case U.replace:u=h.scaleX,h.scaleX=u+(Math.abs(c)*D.signum(u)-u)*n;break;case U.add:h.scaleX+=(c-h.data.scaleX)*n}else switch(a){case U.setup:u=Math.abs(h.data.scaleX)*D.signum(c),h.scaleX=u+(c-u)*n;break;case U.first:case U.replace:u=Math.abs(h.scaleX)*D.signum(c),h.scaleX=u+(c-u)*n;break;case U.add:h.scaleX+=(c-h.data.scaleX)*n}}}}class Tp extends Vi{constructor(t,e,i){super(t,e,vt.scaleY+"|"+i),this.boneIndex=0,this.boneIndex=i}apply(t,e,i,r,n,a,o){let h=t.bones[this.boneIndex];if(!h.active)return;let l=this.frames;if(i<l[0]){switch(a){case U.setup:h.scaleY=h.data.scaleY;return;case U.first:h.scaleY+=(h.data.scaleY-h.scaleY)*n}return}let c=this.getCurveValue(i)*h.data.scaleY;if(n==1)a==U.add?h.scaleY+=c-h.data.scaleY:h.scaleY=c;else{let u=0;if(o==we.mixOut)switch(a){case U.setup:u=h.data.scaleY,h.scaleY=u+(Math.abs(c)*D.signum(u)-u)*n;break;case U.first:case U.replace:u=h.scaleY,h.scaleY=u+(Math.abs(c)*D.signum(u)-u)*n;break;case U.add:h.scaleY+=(c-h.data.scaleY)*n}else switch(a){case U.setup:u=Math.abs(h.data.scaleY)*D.signum(c),h.scaleY=u+(c-u)*n;break;case U.first:case U.replace:u=Math.abs(h.scaleY)*D.signum(c),h.scaleY=u+(c-u)*n;break;case U.add:h.scaleY+=(c-h.data.scaleY)*n}}}}class Sp extends Ac{constructor(t,e,i){super(t,e,vt.shearX+"|"+i,vt.shearY+"|"+i),this.boneIndex=0,this.boneIndex=i}apply(t,e,i,r,n,a,o){let h=t.bones[this.boneIndex];if(!h.active)return;let l=this.frames;if(i<l[0]){switch(a){case U.setup:h.shearX=h.data.shearX,h.shearY=h.data.shearY;return;case U.first:h.shearX+=(h.data.shearX-h.shearX)*n,h.shearY+=(h.data.shearY-h.shearY)*n}return}let c=0,u=0,d=Yt.search(l,i,3),f=this.curves[d/3];switch(f){case 0:let p=l[d];c=l[d+1],u=l[d+2];let m=(i-p)/(l[d+3]-p);c+=(l[d+3+1]-c)*m,u+=(l[d+3+2]-u)*m;break;case 1:c=l[d+1],u=l[d+2];break;default:c=this.getBezierValue(i,d,1,f-2),u=this.getBezierValue(i,d,2,f+18-2)}switch(a){case U.setup:h.shearX=h.data.shearX+c*n,h.shearY=h.data.shearY+u*n;break;case U.first:case U.replace:h.shearX+=(h.data.shearX+c-h.shearX)*n,h.shearY+=(h.data.shearY+u-h.shearY)*n;break;case U.add:h.shearX+=c*n,h.shearY+=u*n}}}class Cp extends Vi{constructor(t,e,i){super(t,e,vt.shearX+"|"+i),this.boneIndex=0,this.boneIndex=i}apply(t,e,i,r,n,a,o){let h=t.bones[this.boneIndex];if(!h.active)return;let l=this.frames;if(i<l[0]){switch(a){case U.setup:h.shearX=h.data.shearX;return;case U.first:h.shearX+=(h.data.shearX-h.shearX)*n}return}let c=this.getCurveValue(i);switch(a){case U.setup:h.shearX=h.data.shearX+c*n;break;case U.first:case U.replace:h.shearX+=(h.data.shearX+c-h.shearX)*n;break;case U.add:h.shearX+=c*n}}}class Ap extends Vi{constructor(t,e,i){super(t,e,vt.shearY+"|"+i),this.boneIndex=0,this.boneIndex=i}apply(t,e,i,r,n,a,o){let h=t.bones[this.boneIndex];if(!h.active)return;let l=this.frames;if(i<l[0]){switch(a){case U.setup:h.shearY=h.data.shearY;return;case U.first:h.shearY+=(h.data.shearY-h.shearY)*n}return}let c=this.getCurveValue(i);switch(a){case U.setup:h.shearY=h.data.shearY+c*n;break;case U.first:case U.replace:h.shearY+=(h.data.shearY+c-h.shearY)*n;break;case U.add:h.shearY+=c*n}}}class Ep extends Gi{constructor(t,e,i){super(t,e,[vt.rgb+"|"+i,vt.alpha+"|"+i]),this.slotIndex=0,this.slotIndex=i}getFrameEntries(){return 5}setFrame(t,e,i,r,n,a){t*=5,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=r,this.frames[t+3]=n,this.frames[t+4]=a}apply(t,e,i,r,n,a,o){let h=t.slots[this.slotIndex];if(!h.bone.active)return;let l=this.frames,c=h.color;if(i<l[0]){let x=h.data.color;switch(a){case U.setup:c.setFromColor(x);return;case U.first:c.add((x.r-c.r)*n,(x.g-c.g)*n,(x.b-c.b)*n,(x.a-c.a)*n)}return}let u=0,d=0,f=0,p=0,m=Yt.search(l,i,5),g=this.curves[m/5];switch(g){case 0:let x=l[m];u=l[m+1],d=l[m+2],f=l[m+3],p=l[m+4];let y=(i-x)/(l[m+5]-x);u+=(l[m+5+1]-u)*y,d+=(l[m+5+2]-d)*y,f+=(l[m+5+3]-f)*y,p+=(l[m+5+4]-p)*y;break;case 1:u=l[m+1],d=l[m+2],f=l[m+3],p=l[m+4];break;default:u=this.getBezierValue(i,m,1,g-2),d=this.getBezierValue(i,m,2,g+18-2),f=this.getBezierValue(i,m,3,g+18*2-2),p=this.getBezierValue(i,m,4,g+18*3-2)}n==1?c.set(u,d,f,p):(a==U.setup&&c.setFromColor(h.data.color),c.add((u-c.r)*n,(d-c.g)*n,(f-c.b)*n,(p-c.a)*n))}}class Pp extends Gi{constructor(t,e,i){super(t,e,[vt.rgb+"|"+i]),this.slotIndex=0,this.slotIndex=i}getFrameEntries(){return 4}setFrame(t,e,i,r,n){t<<=2,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=r,this.frames[t+3]=n}apply(t,e,i,r,n,a,o){let h=t.slots[this.slotIndex];if(!h.bone.active)return;let l=this.frames,c=h.color;if(i<l[0]){let g=h.data.color;switch(a){case U.setup:c.r=g.r,c.g=g.g,c.b=g.b;return;case U.first:c.r+=(g.r-c.r)*n,c.g+=(g.g-c.g)*n,c.b+=(g.b-c.b)*n}return}let u=0,d=0,f=0,p=Yt.search(l,i,4),m=this.curves[p>>2];switch(m){case 0:let g=l[p];u=l[p+1],d=l[p+2],f=l[p+3];let x=(i-g)/(l[p+4]-g);u+=(l[p+4+1]-u)*x,d+=(l[p+4+2]-d)*x,f+=(l[p+4+3]-f)*x;break;case 1:u=l[p+1],d=l[p+2],f=l[p+3];break;default:u=this.getBezierValue(i,p,1,m-2),d=this.getBezierValue(i,p,2,m+18-2),f=this.getBezierValue(i,p,3,m+18*2-2)}if(n==1)c.r=u,c.g=d,c.b=f;else{if(a==U.setup){let g=h.data.color;c.r=g.r,c.g=g.g,c.b=g.b}c.r+=(u-c.r)*n,c.g+=(d-c.g)*n,c.b+=(f-c.b)*n}}}class Mp extends Vi{constructor(t,e,i){super(t,e,vt.alpha+"|"+i),this.slotIndex=0,this.slotIndex=i}apply(t,e,i,r,n,a,o){let h=t.slots[this.slotIndex];if(!h.bone.active)return;let l=h.color;if(i<this.frames[0]){let u=h.data.color;switch(a){case U.setup:l.a=u.a;return;case U.first:l.a+=(u.a-l.a)*n}return}let c=this.getCurveValue(i);n==1?l.a=c:(a==U.setup&&(l.a=h.data.color.a),l.a+=(c-l.a)*n)}}class kp extends Gi{constructor(t,e,i){super(t,e,[vt.rgb+"|"+i,vt.alpha+"|"+i,vt.rgb2+"|"+i]),this.slotIndex=0,this.slotIndex=i}getFrameEntries(){return 8}setFrame(t,e,i,r,n,a,o,h,l){t<<=3,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=r,this.frames[t+3]=n,this.frames[t+4]=a,this.frames[t+5]=o,this.frames[t+6]=h,this.frames[t+7]=l}apply(t,e,i,r,n,a,o){let h=t.slots[this.slotIndex];if(!h.bone.active)return;let l=this.frames,c=h.color,u=h.darkColor;if(i<l[0]){let _=h.data.color,w=h.data.darkColor;switch(a){case U.setup:c.setFromColor(_),u.r=w.r,u.g=w.g,u.b=w.b;return;case U.first:c.add((_.r-c.r)*n,(_.g-c.g)*n,(_.b-c.b)*n,(_.a-c.a)*n),u.r+=(w.r-u.r)*n,u.g+=(w.g-u.g)*n,u.b+=(w.b-u.b)*n}return}let d=0,f=0,p=0,m=0,g=0,x=0,y=0,b=Yt.search(l,i,8),v=this.curves[b>>3];switch(v){case 0:let _=l[b];d=l[b+1],f=l[b+2],p=l[b+3],m=l[b+4],g=l[b+5],x=l[b+6],y=l[b+7];let w=(i-_)/(l[b+8]-_);d+=(l[b+8+1]-d)*w,f+=(l[b+8+2]-f)*w,p+=(l[b+8+3]-p)*w,m+=(l[b+8+4]-m)*w,g+=(l[b+8+5]-g)*w,x+=(l[b+8+6]-x)*w,y+=(l[b+8+7]-y)*w;break;case 1:d=l[b+1],f=l[b+2],p=l[b+3],m=l[b+4],g=l[b+5],x=l[b+6],y=l[b+7];break;default:d=this.getBezierValue(i,b,1,v-2),f=this.getBezierValue(i,b,2,v+18-2),p=this.getBezierValue(i,b,3,v+18*2-2),m=this.getBezierValue(i,b,4,v+18*3-2),g=this.getBezierValue(i,b,5,v+18*4-2),x=this.getBezierValue(i,b,6,v+18*5-2),y=this.getBezierValue(i,b,7,v+18*6-2)}if(n==1)c.set(d,f,p,m),u.r=g,u.g=x,u.b=y;else{if(a==U.setup){c.setFromColor(h.data.color);let _=h.data.darkColor;u.r=_.r,u.g=_.g,u.b=_.b}c.add((d-c.r)*n,(f-c.g)*n,(p-c.b)*n,(m-c.a)*n),u.r+=(g-u.r)*n,u.g+=(x-u.g)*n,u.b+=(y-u.b)*n}}}class Rp extends Gi{constructor(t,e,i){super(t,e,[vt.rgb+"|"+i,vt.rgb2+"|"+i]),this.slotIndex=0,this.slotIndex=i}getFrameEntries(){return 7}setFrame(t,e,i,r,n,a,o,h){t*=7,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=r,this.frames[t+3]=n,this.frames[t+4]=a,this.frames[t+5]=o,this.frames[t+6]=h}apply(t,e,i,r,n,a,o){let h=t.slots[this.slotIndex];if(!h.bone.active)return;let l=this.frames,c=h.color,u=h.darkColor;if(i<l[0]){let v=h.data.color,_=h.data.darkColor;switch(a){case U.setup:c.r=v.r,c.g=v.g,c.b=v.b,u.r=_.r,u.g=_.g,u.b=_.b;return;case U.first:c.r+=(v.r-c.r)*n,c.g+=(v.g-c.g)*n,c.b+=(v.b-c.b)*n,u.r+=(_.r-u.r)*n,u.g+=(_.g-u.g)*n,u.b+=(_.b-u.b)*n}return}let d=0,f=0,p=0,m=0,g=0,x=0,y=Yt.search(l,i,7),b=this.curves[y/7];switch(b){case 0:let v=l[y];d=l[y+1],f=l[y+2],p=l[y+3],m=l[y+4],g=l[y+5],x=l[y+6];let _=(i-v)/(l[y+7]-v);d+=(l[y+7+1]-d)*_,f+=(l[y+7+2]-f)*_,p+=(l[y+7+3]-p)*_,m+=(l[y+7+4]-m)*_,g+=(l[y+7+5]-g)*_,x+=(l[y+7+6]-x)*_;break;case 1:d=l[y+1],f=l[y+2],p=l[y+3],m=l[y+4],g=l[y+5],x=l[y+6];break;default:d=this.getBezierValue(i,y,1,b-2),f=this.getBezierValue(i,y,2,b+18-2),p=this.getBezierValue(i,y,3,b+18*2-2),m=this.getBezierValue(i,y,4,b+18*3-2),g=this.getBezierValue(i,y,5,b+18*4-2),x=this.getBezierValue(i,y,6,b+18*5-2)}if(n==1)c.r=d,c.g=f,c.b=p,u.r=m,u.g=g,u.b=x;else{if(a==U.setup){let v=h.data.color,_=h.data.darkColor;c.r=v.r,c.g=v.g,c.b=v.b,u.r=_.r,u.g=_.g,u.b=_.b}c.r+=(d-c.r)*n,c.g+=(f-c.g)*n,c.b+=(p-c.b)*n,u.r+=(m-u.r)*n,u.g+=(g-u.g)*n,u.b+=(x-u.b)*n}}}class Sr extends Yt{constructor(t,e){super(t,[vt.attachment+"|"+e]),this.slotIndex=0,this.slotIndex=e,this.attachmentNames=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e,i){this.frames[t]=e,this.attachmentNames[t]=i}apply(t,e,i,r,n,a,o){let h=t.slots[this.slotIndex];if(h.bone.active){if(o==we.mixOut){a==U.setup&&this.setAttachment(t,h,h.data.attachmentName);return}if(i<this.frames[0]){(a==U.setup||a==U.first)&&this.setAttachment(t,h,h.data.attachmentName);return}this.setAttachment(t,h,this.attachmentNames[Yt.search1(this.frames,i)])}}setAttachment(t,e,i){e.setAttachment(i?t.getAttachment(this.slotIndex,i):null)}}class Bp extends Gi{constructor(t,e,i,r){super(t,e,[vt.deform+"|"+i+"|"+r.id]),this.slotIndex=0,this.slotIndex=i,this.attachment=r,this.vertices=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e,i){this.frames[t]=e,this.vertices[t]=i}setBezier(t,e,i,r,n,a,o,h,l,c,u){let d=this.curves,f=this.getFrameCount()+t*18;i==0&&(d[e]=2+f);let p=(r-a*2+h)*.03,m=l*.03-o*.06,g=((a-h)*3-r+c)*.006,x=(o-l+.33333333)*.018,y=p*2+g,b=m*2+x,v=(a-r)*.3+p+g*.16666667,_=o*.3+m+x*.16666667,w=r+v,T=_;for(let S=f+18;f<S;f+=2)d[f]=w,d[f+1]=T,v+=y,_+=b,y+=g,b+=x,w+=v,T+=_}getCurvePercent(t,e){let i=this.curves,r=i[e];switch(r){case 0:let h=this.frames[e];return(t-h)/(this.frames[e+this.getFrameEntries()]-h);case 1:return 0}if(r-=2,i[r]>t){let h=this.frames[e];return i[r+1]*(t-h)/(i[r]-h)}let n=r+18;for(r+=2;r<n;r+=2)if(i[r]>=t){let h=i[r-2],l=i[r-1];return l+(t-h)/(i[r]-h)*(i[r+1]-l)}let a=i[n-2],o=i[n-1];return o+(1-o)*(t-a)/(this.frames[e+this.getFrameEntries()]-a)}apply(t,e,i,r,n,a,o){let h=t.slots[this.slotIndex];if(!h.bone.active)return;let l=h.getAttachment();if(!l||!(l instanceof ti)||l.timelineAttachment!=this.attachment)return;let c=h.deform;c.length==0&&(a=U.setup);let u=this.vertices,d=u[0].length,f=this.frames;if(i<f[0]){switch(a){case U.setup:c.length=0;return;case U.first:if(n==1){c.length=0;return}c.length=d;let b=l;if(b.bones){n=1-n;for(var p=0;p<d;p++)c[p]*=n}else{let v=b.vertices;for(var p=0;p<d;p++)c[p]+=(v[p]-c[p])*n}}return}if(c.length=d,i>=f[f.length-1]){let b=u[f.length-1];if(n==1)if(a==U.add){let v=l;if(v.bones)for(let _=0;_<d;_++)c[_]+=b[_];else{let _=v.vertices;for(let w=0;w<d;w++)c[w]+=b[w]-_[w]}}else Y.arrayCopy(b,0,c,0,d);else switch(a){case U.setup:{let _=l;if(_.bones)for(let w=0;w<d;w++)c[w]=b[w]*n;else{let w=_.vertices;for(let T=0;T<d;T++){let S=w[T];c[T]=S+(b[T]-S)*n}}break}case U.first:case U.replace:for(let _=0;_<d;_++)c[_]+=(b[_]-c[_])*n;break;case U.add:let v=l;if(v.bones)for(let _=0;_<d;_++)c[_]+=b[_]*n;else{let _=v.vertices;for(let w=0;w<d;w++)c[w]+=(b[w]-_[w])*n}}return}let m=Yt.search1(f,i),g=this.getCurvePercent(i,m),x=u[m],y=u[m+1];if(n==1)if(a==U.add){let b=l;if(b.bones)for(let v=0;v<d;v++){let _=x[v];c[v]+=_+(y[v]-_)*g}else{let v=b.vertices;for(let _=0;_<d;_++){let w=x[_];c[_]+=w+(y[_]-w)*g-v[_]}}}else for(let b=0;b<d;b++){let v=x[b];c[b]=v+(y[b]-v)*g}else switch(a){case U.setup:{let v=l;if(v.bones)for(let _=0;_<d;_++){let w=x[_];c[_]=(w+(y[_]-w)*g)*n}else{let _=v.vertices;for(let w=0;w<d;w++){let T=x[w],S=_[w];c[w]=S+(T+(y[w]-T)*g-S)*n}}break}case U.first:case U.replace:for(let v=0;v<d;v++){let _=x[v];c[v]+=(_+(y[v]-_)*g-c[v])*n}break;case U.add:let b=l;if(b.bones)for(let v=0;v<d;v++){let _=x[v];c[v]+=(_+(y[v]-_)*g)*n}else{let v=b.vertices;for(let _=0;_<d;_++){let w=x[_];c[_]+=(w+(y[_]-w)*g-v[_])*n}}}}}class an extends Yt{constructor(t){super(t,an.propertyIds),this.events=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e){this.frames[t]=e.time,this.events[t]=e}apply(t,e,i,r,n,a,o){if(!r)return;let h=this.frames,l=this.frames.length;if(e>i)this.apply(t,e,Number.MAX_VALUE,r,n,a,o),e=-1;else if(e>=h[l-1])return;if(i<h[0])return;let c=0;if(e<h[0])c=0;else{c=Yt.search1(h,e)+1;let u=h[c];for(;c>0&&h[c-1]==u;)c--}for(;c<l&&i>=h[c];c++)r.push(this.events[c])}}an.propertyIds=[""+vt.event];class vs extends Yt{constructor(t){super(t,vs.propertyIds),this.drawOrders=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e,i){this.frames[t]=e,this.drawOrders[t]=i}apply(t,e,i,r,n,a,o){if(o==we.mixOut){a==U.setup&&Y.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length);return}if(i<this.frames[0]){(a==U.setup||a==U.first)&&Y.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length);return}let h=Yt.search1(this.frames,i),l=this.drawOrders[h];if(!l)Y.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length);else{let c=t.drawOrder,u=t.slots;for(let d=0,f=l.length;d<f;d++)c[d]=u[l[d]]}}}vs.propertyIds=[""+vt.drawOrder];class Ip extends Gi{constructor(t,e,i){super(t,e,[vt.ikConstraint+"|"+i]),this.ikConstraintIndex=0,this.ikConstraintIndex=i}getFrameEntries(){return 6}setFrame(t,e,i,r,n,a,o){t*=6,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=r,this.frames[t+3]=n,this.frames[t+4]=a?1:0,this.frames[t+5]=o?1:0}apply(t,e,i,r,n,a,o){let h=t.ikConstraints[this.ikConstraintIndex];if(!h.active)return;let l=this.frames;if(i<l[0]){switch(a){case U.setup:h.mix=h.data.mix,h.softness=h.data.softness,h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,h.stretch=h.data.stretch;return;case U.first:h.mix+=(h.data.mix-h.mix)*n,h.softness+=(h.data.softness-h.softness)*n,h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,h.stretch=h.data.stretch}return}let c=0,u=0,d=Yt.search(l,i,6),f=this.curves[d/6];switch(f){case 0:let p=l[d];c=l[d+1],u=l[d+2];let m=(i-p)/(l[d+6]-p);c+=(l[d+6+1]-c)*m,u+=(l[d+6+2]-u)*m;break;case 1:c=l[d+1],u=l[d+2];break;default:c=this.getBezierValue(i,d,1,f-2),u=this.getBezierValue(i,d,2,f+18-2)}a==U.setup?(h.mix=h.data.mix+(c-h.data.mix)*n,h.softness=h.data.softness+(u-h.data.softness)*n,o==we.mixOut?(h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,h.stretch=h.data.stretch):(h.bendDirection=l[d+3],h.compress=l[d+4]!=0,h.stretch=l[d+5]!=0)):(h.mix+=(c-h.mix)*n,h.softness+=(u-h.softness)*n,o==we.mixIn&&(h.bendDirection=l[d+3],h.compress=l[d+4]!=0,h.stretch=l[d+5]!=0))}}class Fp extends Gi{constructor(t,e,i){super(t,e,[vt.transformConstraint+"|"+i]),this.transformConstraintIndex=0,this.transformConstraintIndex=i}getFrameEntries(){return 7}setFrame(t,e,i,r,n,a,o,h){let l=this.frames;t*=7,l[t]=e,l[t+1]=i,l[t+2]=r,l[t+3]=n,l[t+4]=a,l[t+5]=o,l[t+6]=h}apply(t,e,i,r,n,a,o){let h=t.transformConstraints[this.transformConstraintIndex];if(!h.active)return;let l=this.frames;if(i<l[0]){let y=h.data;switch(a){case U.setup:h.mixRotate=y.mixRotate,h.mixX=y.mixX,h.mixY=y.mixY,h.mixScaleX=y.mixScaleX,h.mixScaleY=y.mixScaleY,h.mixShearY=y.mixShearY;return;case U.first:h.mixRotate+=(y.mixRotate-h.mixRotate)*n,h.mixX+=(y.mixX-h.mixX)*n,h.mixY+=(y.mixY-h.mixY)*n,h.mixScaleX+=(y.mixScaleX-h.mixScaleX)*n,h.mixScaleY+=(y.mixScaleY-h.mixScaleY)*n,h.mixShearY+=(y.mixShearY-h.mixShearY)*n}return}let c,u,d,f,p,m,g=Yt.search(l,i,7),x=this.curves[g/7];switch(x){case 0:let y=l[g];c=l[g+1],u=l[g+2],d=l[g+3],f=l[g+4],p=l[g+5],m=l[g+6];let b=(i-y)/(l[g+7]-y);c+=(l[g+7+1]-c)*b,u+=(l[g+7+2]-u)*b,d+=(l[g+7+3]-d)*b,f+=(l[g+7+4]-f)*b,p+=(l[g+7+5]-p)*b,m+=(l[g+7+6]-m)*b;break;case 1:c=l[g+1],u=l[g+2],d=l[g+3],f=l[g+4],p=l[g+5],m=l[g+6];break;default:c=this.getBezierValue(i,g,1,x-2),u=this.getBezierValue(i,g,2,x+18-2),d=this.getBezierValue(i,g,3,x+18*2-2),f=this.getBezierValue(i,g,4,x+18*3-2),p=this.getBezierValue(i,g,5,x+18*4-2),m=this.getBezierValue(i,g,6,x+18*5-2)}if(a==U.setup){let y=h.data;h.mixRotate=y.mixRotate+(c-y.mixRotate)*n,h.mixX=y.mixX+(u-y.mixX)*n,h.mixY=y.mixY+(d-y.mixY)*n,h.mixScaleX=y.mixScaleX+(f-y.mixScaleX)*n,h.mixScaleY=y.mixScaleY+(p-y.mixScaleY)*n,h.mixShearY=y.mixShearY+(m-y.mixShearY)*n}else h.mixRotate+=(c-h.mixRotate)*n,h.mixX+=(u-h.mixX)*n,h.mixY+=(d-h.mixY)*n,h.mixScaleX+=(f-h.mixScaleX)*n,h.mixScaleY+=(p-h.mixScaleY)*n,h.mixShearY+=(m-h.mixShearY)*n}}class Up extends Vi{constructor(t,e,i){super(t,e,vt.pathConstraintPosition+"|"+i),this.pathConstraintIndex=0,this.pathConstraintIndex=i}apply(t,e,i,r,n,a,o){let h=t.pathConstraints[this.pathConstraintIndex];if(!h.active)return;let l=this.frames;if(i<l[0]){switch(a){case U.setup:h.position=h.data.position;return;case U.first:h.position+=(h.data.position-h.position)*n}return}let c=this.getCurveValue(i);a==U.setup?h.position=h.data.position+(c-h.data.position)*n:h.position+=(c-h.position)*n}}class Lp extends Vi{constructor(t,e,i){super(t,e,vt.pathConstraintSpacing+"|"+i),this.pathConstraintIndex=0,this.pathConstraintIndex=i}apply(t,e,i,r,n,a,o){let h=t.pathConstraints[this.pathConstraintIndex];if(!h.active)return;let l=this.frames;if(i<l[0]){switch(a){case U.setup:h.spacing=h.data.spacing;return;case U.first:h.spacing+=(h.data.spacing-h.spacing)*n}return}let c=this.getCurveValue(i);a==U.setup?h.spacing=h.data.spacing+(c-h.data.spacing)*n:h.spacing+=(c-h.spacing)*n}}class Op extends Gi{constructor(t,e,i){super(t,e,[vt.pathConstraintMix+"|"+i]),this.pathConstraintIndex=0,this.pathConstraintIndex=i}getFrameEntries(){return 4}setFrame(t,e,i,r,n){let a=this.frames;t<<=2,a[t]=e,a[t+1]=i,a[t+2]=r,a[t+3]=n}apply(t,e,i,r,n,a,o){let h=t.pathConstraints[this.pathConstraintIndex];if(!h.active)return;let l=this.frames;if(i<l[0]){switch(a){case U.setup:h.mixRotate=h.data.mixRotate,h.mixX=h.data.mixX,h.mixY=h.data.mixY;return;case U.first:h.mixRotate+=(h.data.mixRotate-h.mixRotate)*n,h.mixX+=(h.data.mixX-h.mixX)*n,h.mixY+=(h.data.mixY-h.mixY)*n}return}let c,u,d,f=Yt.search(l,i,4),p=this.curves[f>>2];switch(p){case 0:let m=l[f];c=l[f+1],u=l[f+2],d=l[f+3];let g=(i-m)/(l[f+4]-m);c+=(l[f+4+1]-c)*g,u+=(l[f+4+2]-u)*g,d+=(l[f+4+3]-d)*g;break;case 1:c=l[f+1],u=l[f+2],d=l[f+3];break;default:c=this.getBezierValue(i,f,1,p-2),u=this.getBezierValue(i,f,2,p+18-2),d=this.getBezierValue(i,f,3,p+18*2-2)}if(a==U.setup){let m=h.data;h.mixRotate=m.mixRotate+(c-m.mixRotate)*n,h.mixX=m.mixX+(u-m.mixX)*n,h.mixY=m.mixY+(d-m.mixY)*n}else h.mixRotate+=(c-h.mixRotate)*n,h.mixX+=(u-h.mixX)*n,h.mixY+=(d-h.mixY)*n}}class Le extends Yt{constructor(t,e,i){super(t,[vt.sequence+"|"+e+"|"+i.sequence.id]),this.slotIndex=e,this.attachment=i}getFrameEntries(){return Le.ENTRIES}getSlotIndex(){return this.slotIndex}getAttachment(){return this.attachment}setFrame(t,e,i,r,n){let a=this.frames;t*=Le.ENTRIES,a[t]=e,a[t+Le.MODE]=i|r<<4,a[t+Le.DELAY]=n}apply(t,e,i,r,n,a,o){let h=t.slots[this.slotIndex];if(!h.bone.active)return;let l=h.attachment,c=this.attachment;if(l!=c&&(!(l instanceof ti)||l.timelineAttachment!=c))return;let u=this.frames;if(i<u[0]){(a==U.setup||a==U.first)&&(h.sequenceIndex=-1);return}let d=Yt.search(u,i,Le.ENTRIES),f=u[d],p=u[d+Le.MODE],m=u[d+Le.DELAY];if(!this.attachment.sequence)return;let g=p>>4,x=this.attachment.sequence.regions.length,y=bp[p&15];if(y!=le.hold)switch(g+=(i-f)/m+1e-5|0,y){case le.once:g=Math.min(x-1,g);break;case le.loop:g%=x;break;case le.pingpong:{let b=(x<<1)-2;g=b==0?0:g%b,g>=x&&(g=b-g);break}case le.onceReverse:g=Math.max(x-1-g,0);break;case le.loopReverse:g=x-1-g%x;break;case le.pingpongReverse:{let b=(x<<1)-2;g=b==0?0:(g+x-1)%b,g>=x&&(g=b-g)}}h.sequenceIndex=g}}Le.ENTRIES=3;Le.MODE=1;Le.DELAY=2;class Ir{static emptyAnimation(){return Ir._emptyAnimation}constructor(t){this.tracks=new Array,this.timeScale=1,this.unkeyedState=0,this.events=new Array,this.listeners=new Array,this.queue=new vy(this),this.propertyIDs=new mp,this.animationsChanged=!1,this.trackEntryPool=new xl(()=>new xy),this.data=t}update(t){t*=this.timeScale;let e=this.tracks;for(let i=0,r=e.length;i<r;i++){let n=e[i];if(!n)continue;n.animationLast=n.nextAnimationLast,n.trackLast=n.nextTrackLast;let a=t*n.timeScale;if(n.delay>0){if(n.delay-=a,n.delay>0)continue;a=-n.delay,n.delay=0}let o=n.next;if(o){let h=n.trackLast-o.delay;if(h>=0){for(o.delay=0,o.trackTime+=n.timeScale==0?0:(h/n.timeScale+t)*o.timeScale,n.trackTime+=a,this.setCurrent(i,o,!0);o.mixingFrom;)o.mixTime+=t,o=o.mixingFrom;continue}}else if(n.trackLast>=n.trackEnd&&!n.mixingFrom){e[i]=null,this.queue.end(n),this.clearNext(n);continue}if(n.mixingFrom&&this.updateMixingFrom(n,t)){let h=n.mixingFrom;for(n.mixingFrom=null,h&&(h.mixingTo=null);h;)this.queue.end(h),h=h.mixingFrom}n.trackTime+=a}this.queue.drain()}updateMixingFrom(t,e){let i=t.mixingFrom;if(!i)return!0;let r=this.updateMixingFrom(i,e);return i.animationLast=i.nextAnimationLast,i.trackLast=i.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?((i.totalAlpha==0||t.mixDuration==0)&&(t.mixingFrom=i.mixingFrom,i.mixingFrom&&(i.mixingFrom.mixingTo=t),t.interruptAlpha=i.interruptAlpha,this.queue.end(i)),r):(i.trackTime+=e*i.timeScale,t.mixTime+=e,!1)}apply(t){if(!t)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();let e=this.events,i=this.tracks,r=!1;for(let d=0,f=i.length;d<f;d++){let p=i[d];if(!p||p.delay>0)continue;r=!0;let m=d==0?U.first:p.mixBlend,g=p.alpha;p.mixingFrom?g*=this.applyMixingFrom(p,t,m):p.trackTime>=p.trackEnd&&!p.next&&(g=0);let x=p.animationLast,y=p.getAnimationTime(),b=y,v=e;p.reverse&&(b=p.animation.duration-b,v=null);let _=p.animation.timelines,w=_.length;if(d==0&&g==1||m==U.add)for(let T=0;T<w;T++){var n=_[T];n instanceof Sr?this.applyAttachmentTimeline(n,t,b,m,!0):n.apply(t,x,b,v,g,m,we.mixIn)}else{let T=p.timelineMode,S=p.shortestRotation,C=!S&&p.timelinesRotation.length!=w<<1;C&&(p.timelinesRotation.length=w<<1);for(let E=0;E<w;E++){let M=_[E],N=T[E]==ah?m:U.setup;!S&&M instanceof Qa?this.applyRotateTimeline(M,t,b,g,N,p.timelinesRotation,E<<1,C):M instanceof Sr?this.applyAttachmentTimeline(M,t,b,m,!0):M.apply(t,x,b,v,g,N,we.mixIn)}}this.queueEvents(p,y),e.length=0,p.nextAnimationLast=y,p.nextTrackLast=p.trackTime}for(var a=this.unkeyedState+Pu,o=t.slots,h=0,l=t.slots.length;h<l;h++){var c=o[h];if(c.attachmentState==a){var u=c.data.attachmentName;c.setAttachment(u?t.getAttachment(c.data.index,u):null)}}return this.unkeyedState+=2,this.queue.drain(),r}applyMixingFrom(t,e,i){let r=t.mixingFrom;r.mixingFrom&&this.applyMixingFrom(r,e,i);let n=0;t.mixDuration==0?(n=1,i==U.first&&(i=U.setup)):(n=t.mixTime/t.mixDuration,n>1&&(n=1),i!=U.first&&(i=r.mixBlend));let a=n<r.attachmentThreshold,o=n<r.drawOrderThreshold,h=r.animation.timelines,l=h.length,c=r.alpha*t.interruptAlpha,u=c*(1-n),d=r.animationLast,f=r.getAnimationTime(),p=f,m=null;if(r.reverse?p=r.animation.duration-p:n<r.eventThreshold&&(m=this.events),i==U.add)for(let g=0;g<l;g++)h[g].apply(e,d,p,m,u,i,we.mixOut);else{let g=r.timelineMode,x=r.timelineHoldMix,y=r.shortestRotation,b=!y&&r.timelinesRotation.length!=l<<1;b&&(r.timelinesRotation.length=l<<1),r.totalAlpha=0;for(let v=0;v<l;v++){let _=h[v],w=we.mixOut,T,S=0;switch(g[v]){case ah:if(!o&&_ instanceof vs)continue;T=i,S=u;break;case Au:T=U.setup,S=u;break;case Eu:T=i,S=c;break;case oh:T=U.setup,S=c;break;default:T=U.setup;let C=x[v];S=c*Math.max(0,1-C.mixTime/C.mixDuration);break}r.totalAlpha+=S,!y&&_ instanceof Qa?this.applyRotateTimeline(_,e,p,S,T,r.timelinesRotation,v<<1,b):_ instanceof Sr?this.applyAttachmentTimeline(_,e,p,T,a):(o&&_ instanceof vs&&T==U.setup&&(w=we.mixIn),_.apply(e,d,p,m,S,T,w))}}return t.mixDuration>0&&this.queueEvents(r,f),this.events.length=0,r.nextAnimationLast=f,r.nextTrackLast=r.trackTime,n}applyAttachmentTimeline(t,e,i,r,n){var a=e.slots[t.slotIndex];a.bone.active&&(i<t.frames[0]?(r==U.setup||r==U.first)&&this.setAttachment(e,a,a.data.attachmentName,n):this.setAttachment(e,a,t.attachmentNames[Yt.search1(t.frames,i)],n),a.attachmentState<=this.unkeyedState&&(a.attachmentState=this.unkeyedState+Pu))}setAttachment(t,e,i,r){e.setAttachment(i?t.getAttachment(e.data.index,i):null),r&&(e.attachmentState=this.unkeyedState+wy)}applyRotateTimeline(t,e,i,r,n,a,o,h){if(h&&(a[o]=0),r==1){t.apply(e,0,i,null,1,n,we.mixIn);return}let l=e.bones[t.boneIndex];if(!l.active)return;let c=t.frames,u=0,d=0;if(i<c[0])switch(n){case U.setup:l.rotation=l.data.rotation;default:return;case U.first:u=l.rotation,d=l.data.rotation}else u=n==U.setup?l.data.rotation:l.rotation,d=l.data.rotation+t.getCurveValue(i);let f=0,p=d-u;if(p-=(16384-(16384.499999999996-p/360|0))*360,p==0)f=a[o];else{let m=0,g=0;h?(m=0,g=p):(m=a[o],g=a[o+1]);let x=m-m%360;f=p+x;let y=p>=0,b=m>=0;Math.abs(g)<=90&&D.signum(g)!=D.signum(p)&&(Math.abs(m-x)>180?(f+=360*D.signum(m),b=y):x!=0?f-=360*D.signum(m):b=y),b!=y&&(f+=360*D.signum(m)),a[o]=f}a[o+1]=p,l.rotation=u+f*r}queueEvents(t,e){let i=t.animationStart,r=t.animationEnd,n=r-i,a=t.trackLast%n,o=this.events,h=0,l=o.length;for(;h<l;h++){let u=o[h];if(u.time<a)break;u.time>r||this.queue.event(t,u)}let c=!1;for(t.loop?c=n==0||a>t.trackTime%n:c=e>=r&&t.animationLast<r,c&&this.queue.complete(t);h<l;h++){let u=o[h];u.time<i||this.queue.event(t,u)}}clearTracks(){let t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let e=0,i=this.tracks.length;e<i;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()}clearTrack(t){if(t>=this.tracks.length)return;let e=this.tracks[t];if(!e)return;this.queue.end(e),this.clearNext(e);let i=e;for(;;){let r=i.mixingFrom;if(!r)break;this.queue.end(r),i.mixingFrom=null,i.mixingTo=null,i=r}this.tracks[e.trackIndex]=null,this.queue.drain()}setCurrent(t,e,i){let r=this.expandToIndex(t);this.tracks[t]=e,e.previous=null,r&&(i&&this.queue.interrupt(r),e.mixingFrom=r,r.mixingTo=e,e.mixTime=0,r.mixingFrom&&r.mixDuration>0&&(e.interruptAlpha*=Math.min(1,r.mixTime/r.mixDuration)),r.timelinesRotation.length=0),this.queue.start(e)}setAnimation(t,e,i=!1){let r=this.data.skeletonData.findAnimation(e);if(!r)throw new Error("Animation not found: "+e);return this.setAnimationWith(t,r,i)}setAnimationWith(t,e,i=!1){if(!e)throw new Error("animation cannot be null.");let r=!0,n=this.expandToIndex(t);n&&(n.nextTrackLast==-1?(this.tracks[t]=n.mixingFrom,this.queue.interrupt(n),this.queue.end(n),this.clearNext(n),n=n.mixingFrom,r=!1):this.clearNext(n));let a=this.trackEntry(t,e,i,n);return this.setCurrent(t,a,r),this.queue.drain(),a}addAnimation(t,e,i=!1,r=0){let n=this.data.skeletonData.findAnimation(e);if(!n)throw new Error("Animation not found: "+e);return this.addAnimationWith(t,n,i,r)}addAnimationWith(t,e,i=!1,r=0){if(!e)throw new Error("animation cannot be null.");let n=this.expandToIndex(t);if(n)for(;n.next;)n=n.next;let a=this.trackEntry(t,e,i,n);return n?(n.next=a,a.previous=n,r<=0&&(r+=n.getTrackComplete()-a.mixDuration)):(this.setCurrent(t,a,!0),this.queue.drain()),a.delay=r,a}setEmptyAnimation(t,e=0){let i=this.setAnimationWith(t,Ir.emptyAnimation(),!1);return i.mixDuration=e,i.trackEnd=e,i}addEmptyAnimation(t,e=0,i=0){let r=this.addAnimationWith(t,Ir.emptyAnimation(),!1,i);return i<=0&&(r.delay+=r.mixDuration-e),r.mixDuration=e,r.trackEnd=e,r}setEmptyAnimations(t=0){let e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let i=0,r=this.tracks.length;i<r;i++){let n=this.tracks[i];n&&this.setEmptyAnimation(n.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()}expandToIndex(t){return t<this.tracks.length?this.tracks[t]:(Y.ensureArrayCapacity(this.tracks,t+1,null),this.tracks.length=t+1,null)}trackEntry(t,e,i,r){let n=this.trackEntryPool.obtain();return n.reset(),n.trackIndex=t,n.animation=e,n.loop=i,n.holdPrevious=!1,n.reverse=!1,n.shortestRotation=!1,n.eventThreshold=0,n.attachmentThreshold=0,n.drawOrderThreshold=0,n.animationStart=0,n.animationEnd=e.duration,n.animationLast=-1,n.nextAnimationLast=-1,n.delay=0,n.trackTime=0,n.trackLast=-1,n.nextTrackLast=-1,n.trackEnd=Number.MAX_VALUE,n.timeScale=1,n.alpha=1,n.mixTime=0,n.mixDuration=r?this.data.getMix(r.animation,e):0,n.interruptAlpha=1,n.totalAlpha=0,n.mixBlend=U.replace,n}clearNext(t){let e=t.next;for(;e;)this.queue.dispose(e),e=e.next;t.next=null}_animationsChanged(){this.animationsChanged=!1,this.propertyIDs.clear();let t=this.tracks;for(let e=0,i=t.length;e<i;e++){let r=t[e];if(r){for(;r.mixingFrom;)r=r.mixingFrom;do(!r.mixingTo||r.mixBlend!=U.add)&&this.computeHold(r),r=r.mixingTo;while(r)}}}computeHold(t){let e=t.mixingTo,i=t.animation.timelines,r=t.animation.timelines.length,n=t.timelineMode;n.length=r;let a=t.timelineHoldMix;a.length=0;let o=this.propertyIDs;if(e&&e.holdPrevious){for(let h=0;h<r;h++)n[h]=o.addAll(i[h].getPropertyIds())?oh:Eu;return}t:for(let h=0;h<r;h++){let l=i[h],c=l.getPropertyIds();if(!o.addAll(c))n[h]=ah;else if(!e||l instanceof Sr||l instanceof vs||l instanceof an||!e.animation.hasTimeline(c))n[h]=Au;else{for(let u=e.mixingTo;u;u=u.mixingTo)if(!u.animation.hasTimeline(c)){if(t.mixDuration>0){n[h]=_y,a[h]=u;continue t}break}n[h]=oh}}}getCurrent(t){return t>=this.tracks.length?null:this.tracks[t]}addListener(t){if(!t)throw new Error("listener cannot be null.");this.listeners.push(t)}removeListener(t){let e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)}clearListeners(){this.listeners.length=0}clearListenerNotifications(){this.queue.clear()}}Ir._emptyAnimation=new Cc("<empty>",[],0);class xy{constructor(){this.animation=null,this.previous=null,this.next=null,this.mixingFrom=null,this.mixingTo=null,this.listener=null,this.trackIndex=0,this.loop=!1,this.holdPrevious=!1,this.reverse=!1,this.shortestRotation=!1,this.eventThreshold=0,this.attachmentThreshold=0,this.drawOrderThreshold=0,this.animationStart=0,this.animationEnd=0,this.animationLast=0,this.nextAnimationLast=0,this.delay=0,this.trackTime=0,this.trackLast=0,this.nextTrackLast=0,this.trackEnd=0,this.timeScale=0,this.alpha=0,this.mixTime=0,this.mixDuration=0,this.interruptAlpha=0,this.totalAlpha=0,this.mixBlend=U.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}reset(){this.next=null,this.previous=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0}getAnimationTime(){if(this.loop){let t=this.animationEnd-this.animationStart;return t==0?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)}setAnimationLast(t){this.animationLast=t,this.nextAnimationLast=t}isComplete(){return this.trackTime>=this.animationEnd-this.animationStart}resetRotationDirections(){this.timelinesRotation.length=0}getTrackComplete(){let t=this.animationEnd-this.animationStart;if(t!=0){if(this.loop)return t*(1+(this.trackTime/t|0));if(this.trackTime<t)return t}return this.trackTime}}class vy{constructor(t){this.objects=[],this.drainDisabled=!1,this.animState=t}start(t){this.objects.push(Se.start),this.objects.push(t),this.animState.animationsChanged=!0}interrupt(t){this.objects.push(Se.interrupt),this.objects.push(t)}end(t){this.objects.push(Se.end),this.objects.push(t),this.animState.animationsChanged=!0}dispose(t){this.objects.push(Se.dispose),this.objects.push(t)}complete(t){this.objects.push(Se.complete),this.objects.push(t)}event(t,e){this.objects.push(Se.event),this.objects.push(t),this.objects.push(e)}drain(){if(this.drainDisabled)return;this.drainDisabled=!0;let t=this.objects,e=this.animState.listeners;for(let i=0;i<t.length;i+=2){let r=t[i],n=t[i+1];switch(r){case Se.start:n.listener&&n.listener.start&&n.listener.start(n);for(let o=0;o<e.length;o++){let h=e[o];h.start&&h.start(n)}break;case Se.interrupt:n.listener&&n.listener.interrupt&&n.listener.interrupt(n);for(let o=0;o<e.length;o++){let h=e[o];h.interrupt&&h.interrupt(n)}break;case Se.end:n.listener&&n.listener.end&&n.listener.end(n);for(let o=0;o<e.length;o++){let h=e[o];h.end&&h.end(n)}case Se.dispose:n.listener&&n.listener.dispose&&n.listener.dispose(n);for(let o=0;o<e.length;o++){let h=e[o];h.dispose&&h.dispose(n)}this.animState.trackEntryPool.free(n);break;case Se.complete:n.listener&&n.listener.complete&&n.listener.complete(n);for(let o=0;o<e.length;o++){let h=e[o];h.complete&&h.complete(n)}break;case Se.event:let a=t[i+++2];n.listener&&n.listener.event&&n.listener.event(n,a);for(let o=0;o<e.length;o++){let h=e[o];h.event&&h.event(n,a)}break}}this.clear(),this.drainDisabled=!1}clear(){this.objects.length=0}}var Se;(function(s){s[s.start=0]="start",s[s.interrupt=1]="interrupt",s[s.end=2]="end",s[s.dispose=3]="dispose",s[s.complete=4]="complete",s[s.event=5]="event"})(Se||(Se={}));const ah=0,Au=1,Eu=2,oh=3,_y=4,Pu=1,wy=2;class Ty{constructor(t){if(this.animationToMixTime={},this.defaultMix=0,!t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}setMix(t,e,i){let r=this.skeletonData.findAnimation(t);if(!r)throw new Error("Animation not found: "+t);let n=this.skeletonData.findAnimation(e);if(!n)throw new Error("Animation not found: "+e);this.setMixWith(r,n,i)}setMixWith(t,e,i){if(!t)throw new Error("from cannot be null.");if(!e)throw new Error("to cannot be null.");let r=t.name+"."+e.name;this.animationToMixTime[r]=i}getMix(t,e){let i=t.name+"."+e.name,r=this.animationToMixTime[i];return r===void 0?this.defaultMix:r}}class Ec extends ti{constructor(t){super(t),this.color=new tt(1,1,1,1)}copy(){let t=new Ec(this.name);return this.copyTo(t),t.color.setFromColor(this.color),t}}class ko extends ti{constructor(t){super(t),this.endSlot=null,this.color=new tt(.2275,.2275,.8078,1)}copy(){let t=new ko(this.name);return this.copyTo(t),t.endSlot=this.endSlot,t.color.setFromColor(this.color),t}}let Sy=class{constructor(t){this._image=t}getImage(){return this._image}};var Ye;(function(s){s[s.Nearest=9728]="Nearest",s[s.Linear=9729]="Linear",s[s.MipMap=9987]="MipMap",s[s.MipMapNearestNearest=9984]="MipMapNearestNearest",s[s.MipMapLinearNearest=9985]="MipMapLinearNearest",s[s.MipMapNearestLinear=9986]="MipMapNearestLinear",s[s.MipMapLinearLinear=9987]="MipMapLinearLinear"})(Ye||(Ye={}));var Qi;(function(s){s[s.MirroredRepeat=33648]="MirroredRepeat",s[s.ClampToEdge=33071]="ClampToEdge",s[s.Repeat=10497]="Repeat"})(Qi||(Qi={}));class Cy{constructor(){this.u=0,this.v=0,this.u2=0,this.v2=0,this.width=0,this.height=0,this.degrees=0,this.offsetX=0,this.offsetY=0,this.originalWidth=0,this.originalHeight=0}}class Ay{constructor(t){this.pages=new Array,this.regions=new Array;let e=new Ey(t),i=new Array(4),r={};r.size=c=>{c.width=parseInt(i[1]),c.height=parseInt(i[2])},r.format=()=>{},r.filter=c=>{c.minFilter=Y.enumValue(Ye,i[1]),c.magFilter=Y.enumValue(Ye,i[2])},r.repeat=c=>{i[1].indexOf("x")!=-1&&(c.uWrap=Qi.Repeat),i[1].indexOf("y")!=-1&&(c.vWrap=Qi.Repeat)},r.pma=c=>{c.pma=i[1]=="true"};var n={};n.xy=c=>{c.x=parseInt(i[1]),c.y=parseInt(i[2])},n.size=c=>{c.width=parseInt(i[1]),c.height=parseInt(i[2])},n.bounds=c=>{c.x=parseInt(i[1]),c.y=parseInt(i[2]),c.width=parseInt(i[3]),c.height=parseInt(i[4])},n.offset=c=>{c.offsetX=parseInt(i[1]),c.offsetY=parseInt(i[2])},n.orig=c=>{c.originalWidth=parseInt(i[1]),c.originalHeight=parseInt(i[2])},n.offsets=c=>{c.offsetX=parseInt(i[1]),c.offsetY=parseInt(i[2]),c.originalWidth=parseInt(i[3]),c.originalHeight=parseInt(i[4])},n.rotate=c=>{let u=i[1];u=="true"?c.degrees=90:u!="false"&&(c.degrees=parseInt(u))},n.index=c=>{c.index=parseInt(i[1])};let a=e.readLine();for(;a&&a.trim().length==0;)a=e.readLine();for(;!(!a||a.trim().length==0||e.readEntry(i,a)==0);)a=e.readLine();let o=null,h=null,l=null;for(;a!==null;)if(a.trim().length==0)o=null,a=e.readLine();else if(o){let c=new Np(o,a);for(;;){let u=e.readEntry(i,a=e.readLine());if(u==0)break;let d=n[i[0]];if(d)d(c);else{h||(h=[]),l||(l=[]),h.push(i[0]);let f=[];for(let p=0;p<u;p++)f.push(parseInt(i[p+1]));l.push(f)}}c.originalWidth==0&&c.originalHeight==0&&(c.originalWidth=c.width,c.originalHeight=c.height),h&&h.length>0&&l&&l.length>0&&(c.names=h,c.values=l,h=null,l=null),c.u=c.x/o.width,c.v=c.y/o.height,c.degrees==90?(c.u2=(c.x+c.height)/o.width,c.v2=(c.y+c.width)/o.height):(c.u2=(c.x+c.width)/o.width,c.v2=(c.y+c.height)/o.height),this.regions.push(c)}else{for(o=new Py(a.trim());e.readEntry(i,a=e.readLine())!=0;){let c=r[i[0]];c&&c(o)}this.pages.push(o)}}findRegion(t){for(let e=0;e<this.regions.length;e++)if(this.regions[e].name==t)return this.regions[e];return null}setTextures(t,e=""){for(let i of this.pages)i.setTexture(t.get(e+i.name))}dispose(){var t;for(let e=0;e<this.pages.length;e++)(t=this.pages[e].texture)===null||t===void 0||t.dispose()}}class Ey{constructor(t){this.index=0,this.lines=t.split(/\r\n|\r|\n/)}readLine(){return this.index>=this.lines.length?null:this.lines[this.index++]}readEntry(t,e){if(!e||(e=e.trim(),e.length==0))return 0;let i=e.indexOf(":");if(i==-1)return 0;t[0]=e.substr(0,i).trim();for(let r=1,n=i+1;;r++){let a=e.indexOf(",",n);if(a==-1)return t[r]=e.substr(n).trim(),r;if(t[r]=e.substr(n,a-n).trim(),n=a+1,r==4)return 4}}}class Py{constructor(t){this.minFilter=Ye.Nearest,this.magFilter=Ye.Nearest,this.uWrap=Qi.ClampToEdge,this.vWrap=Qi.ClampToEdge,this.texture=null,this.width=0,this.height=0,this.pma=!1,this.regions=new Array,this.name=t}setTexture(t){this.texture=t,t.setFilters(this.minFilter,this.magFilter),t.setWraps(this.uWrap,this.vWrap);for(let e of this.regions)e.texture=t}}class Np extends Cy{constructor(t,e){super(),this.x=0,this.y=0,this.offsetX=0,this.offsetY=0,this.originalWidth=0,this.originalHeight=0,this.index=0,this.degrees=0,this.names=null,this.values=null,this.page=t,this.name=e,t.regions.push(this)}}class Qs extends ti{constructor(t,e){super(t),this.region=null,this.regionUVs=[],this.uvs=[],this.triangles=[],this.color=new tt(1,1,1,1),this.width=0,this.height=0,this.hullLength=0,this.edges=[],this.parentMesh=null,this.sequence=null,this.tempColor=new tt(0,0,0,0),this.path=e}updateRegion(){if(!this.region)throw new Error("Region not set.");let t=this.regionUVs;(!this.uvs||this.uvs.length!=t.length)&&(this.uvs=Y.newFloatArray(t.length));let e=this.uvs,i=this.uvs.length,r=this.region.u,n=this.region.v,a=0,o=0;if(this.region instanceof Np){let h=this.region,l=h.page,c=l.width,u=l.height;switch(h.degrees){case 90:r-=(h.originalHeight-h.offsetY-h.height)/c,n-=(h.originalWidth-h.offsetX-h.width)/u,a=h.originalHeight/c,o=h.originalWidth/u;for(let d=0;d<i;d+=2)e[d]=r+t[d+1]*a,e[d+1]=n+(1-t[d])*o;return;case 180:r-=(h.originalWidth-h.offsetX-h.width)/c,n-=h.offsetY/u,a=h.originalWidth/c,o=h.originalHeight/u;for(let d=0;d<i;d+=2)e[d]=r+(1-t[d])*a,e[d+1]=n+(1-t[d+1])*o;return;case 270:r-=h.offsetY/c,n-=h.offsetX/u,a=h.originalHeight/c,o=h.originalWidth/u;for(let d=0;d<i;d+=2)e[d]=r+(1-t[d+1])*a,e[d+1]=n+t[d]*o;return}r-=h.offsetX/c,n-=(h.originalHeight-h.offsetY-h.height)/u,a=h.originalWidth/c,o=h.originalHeight/u}else this.region?(a=this.region.u2-r,o=this.region.v2-n):(r=n=0,a=o=1);for(let h=0;h<i;h+=2)e[h]=r+t[h]*a,e[h+1]=n+t[h+1]*o}getParentMesh(){return this.parentMesh}setParentMesh(t){this.parentMesh=t,t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)}copy(){if(this.parentMesh)return this.newLinkedMesh();let t=new Qs(this.name,this.path);return t.region=this.region,t.color.setFromColor(this.color),this.copyTo(t),t.regionUVs=new Array(this.regionUVs.length),Y.arrayCopy(this.regionUVs,0,t.regionUVs,0,this.regionUVs.length),t.uvs=new Array(this.uvs.length),Y.arrayCopy(this.uvs,0,t.uvs,0,this.uvs.length),t.triangles=new Array(this.triangles.length),Y.arrayCopy(this.triangles,0,t.triangles,0,this.triangles.length),t.hullLength=this.hullLength,t.sequence=this.sequence!=null?this.sequence.copy():null,this.edges&&(t.edges=new Array(this.edges.length),Y.arrayCopy(this.edges,0,t.edges,0,this.edges.length)),t.width=this.width,t.height=this.height,t}computeWorldVertices(t,e,i,r,n,a){this.sequence!=null&&this.sequence.apply(t,this),super.computeWorldVertices(t,e,i,r,n,a)}newLinkedMesh(){let t=new Qs(this.name,this.path);return t.region=this.region,t.color.setFromColor(this.color),t.timelineAttachment=this.timelineAttachment,t.setParentMesh(this.parentMesh?this.parentMesh:this),t.region!=null&&t.updateRegion(),t}}class $r extends ti{constructor(t){super(t),this.lengths=[],this.closed=!1,this.constantSpeed=!1,this.color=new tt(1,1,1,1)}copy(){let t=new $r(this.name);return this.copyTo(t),t.lengths=new Array(this.lengths.length),Y.arrayCopy(this.lengths,0,t.lengths,0,this.lengths.length),t.closed=closed,t.constantSpeed=this.constantSpeed,t.color.setFromColor(this.color),t}}class Pc extends ti{constructor(t){super(t),this.x=0,this.y=0,this.rotation=0,this.color=new tt(.38,.94,0,1)}computeWorldPosition(t,e){return e.x=this.x*t.a+this.y*t.b+t.worldX,e.y=this.x*t.c+this.y*t.d+t.worldY,e}computeWorldRotation(t){let e=D.cosDeg(this.rotation),i=D.sinDeg(this.rotation),r=e*t.a+i*t.b,n=e*t.c+i*t.d;return Math.atan2(n,r)*D.radDeg}copy(){let t=new Pc(this.name);return t.x=this.x,t.y=this.y,t.rotation=this.rotation,t.color.setFromColor(this.color),t}}class ct extends gp{constructor(t,e){super(t),this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.rotation=0,this.width=0,this.height=0,this.color=new tt(1,1,1,1),this.region=null,this.sequence=null,this.offset=Y.newFloatArray(8),this.uvs=Y.newFloatArray(8),this.tempColor=new tt(1,1,1,1),this.path=e}updateRegion(){if(!this.region)throw new Error("Region not set.");let t=this.region,e=this.uvs;if(t==null){e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=1,e[5]=1,e[6]=1,e[7]=0;return}let i=this.width/this.region.originalWidth*this.scaleX,r=this.height/this.region.originalHeight*this.scaleY,n=-this.width/2*this.scaleX+this.region.offsetX*i,a=-this.height/2*this.scaleY+this.region.offsetY*r,o=n+this.region.width*i,h=a+this.region.height*r,l=this.rotation*Math.PI/180,c=Math.cos(l),u=Math.sin(l),d=this.x,f=this.y,p=n*c+d,m=n*u,g=a*c+f,x=a*u,y=o*c+d,b=o*u,v=h*c+f,_=h*u,w=this.offset;w[0]=p-x,w[1]=g+m,w[2]=p-_,w[3]=v+m,w[4]=y-_,w[5]=v+b,w[6]=y-x,w[7]=g+b,t.degrees==90?(e[0]=t.u2,e[1]=t.v2,e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2)}computeWorldVertices(t,e,i,r){this.sequence!=null&&this.sequence.apply(t,this);let n=t.bone,a=this.offset,o=n.worldX,h=n.worldY,l=n.a,c=n.b,u=n.c,d=n.d,f=0,p=0;f=a[0],p=a[1],e[i]=f*l+p*c+o,e[i+1]=f*u+p*d+h,i+=r,f=a[2],p=a[3],e[i]=f*l+p*c+o,e[i+1]=f*u+p*d+h,i+=r,f=a[4],p=a[5],e[i]=f*l+p*c+o,e[i+1]=f*u+p*d+h,i+=r,f=a[6],p=a[7],e[i]=f*l+p*c+o,e[i+1]=f*u+p*d+h}copy(){let t=new ct(this.name,this.path);return t.region=this.region,t.x=this.x,t.y=this.y,t.scaleX=this.scaleX,t.scaleY=this.scaleY,t.rotation=this.rotation,t.width=this.width,t.height=this.height,Y.arrayCopy(this.uvs,0,t.uvs,0,8),Y.arrayCopy(this.offset,0,t.offset,0,8),t.color.setFromColor(this.color),t.sequence=this.sequence!=null?this.sequence.copy():null,t}}ct.X1=0;ct.Y1=1;ct.C1R=2;ct.C1G=3;ct.C1B=4;ct.C1A=5;ct.U1=6;ct.V1=7;ct.X2=8;ct.Y2=9;ct.C2R=10;ct.C2G=11;ct.C2B=12;ct.C2A=13;ct.U2=14;ct.V2=15;ct.X3=16;ct.Y3=17;ct.C3R=18;ct.C3G=19;ct.C3B=20;ct.C3A=21;ct.U3=22;ct.V3=23;ct.X4=24;ct.Y4=25;ct.C4R=26;ct.C4G=27;ct.C4B=28;ct.C4A=29;ct.U4=30;ct.V4=31;class My{constructor(t){this.atlas=t}loadSequence(t,e,i){let r=i.regions;for(let n=0,a=r.length;n<a;n++){let o=i.getPath(e,n),h=this.atlas.findRegion(o);if(h==null)throw new Error("Region not found in atlas: "+o+" (sequence: "+t+")");r[n]=h}}newRegionAttachment(t,e,i,r){let n=new ct(e,i);if(r!=null)this.loadSequence(e,i,r);else{let a=this.atlas.findRegion(i);if(!a)throw new Error("Region not found in atlas: "+i+" (region attachment: "+e+")");n.region=a}return n}newMeshAttachment(t,e,i,r){let n=new Qs(e,i);if(r!=null)this.loadSequence(e,i,r);else{let a=this.atlas.findRegion(i);if(!a)throw new Error("Region not found in atlas: "+i+" (mesh attachment: "+e+")");n.region=a}return n}newBoundingBoxAttachment(t,e){return new Ec(e)}newPathAttachment(t,e){return new $r(e)}newPointAttachment(t,e){return new Pc(e)}newClippingAttachment(t,e){return new ko(e)}}class Dp{constructor(t,e,i){if(this.index=0,this.parent=null,this.length=0,this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=te.Normal,this.skinRequired=!1,this.color=new tt,t<0)throw new Error("index must be >= 0.");if(!e)throw new Error("name cannot be null.");this.index=t,this.name=e,this.parent=i}}var te;(function(s){s[s.Normal=0]="Normal",s[s.OnlyTranslation=1]="OnlyTranslation",s[s.NoRotationOrReflection=2]="NoRotationOrReflection",s[s.NoScale=3]="NoScale",s[s.NoScaleOrReflection=4]="NoScaleOrReflection"})(te||(te={}));class Mu{constructor(t,e,i){if(this.parent=null,this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.a=0,this.b=0,this.c=0,this.d=0,this.worldY=0,this.worldX=0,this.sorted=!1,this.active=!1,!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=i,this.setToSetupPose()}isActive(){return this.active}update(){this.updateWorldTransformWith(this.ax,this.ay,this.arotation,this.ascaleX,this.ascaleY,this.ashearX,this.ashearY)}updateWorldTransform(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransformWith(t,e,i,r,n,a,o){this.ax=t,this.ay=e,this.arotation=i,this.ascaleX=r,this.ascaleY=n,this.ashearX=a,this.ashearY=o;let h=this.parent;if(!h){let f=this.skeleton,p=i+90+o,m=f.scaleX,g=f.scaleY;this.a=D.cosDeg(i+a)*r*m,this.b=D.cosDeg(p)*n*m,this.c=D.sinDeg(i+a)*r*g,this.d=D.sinDeg(p)*n*g,this.worldX=t*m+f.x,this.worldY=e*g+f.y;return}let l=h.a,c=h.b,u=h.c,d=h.d;switch(this.worldX=l*t+c*e+h.worldX,this.worldY=u*t+d*e+h.worldY,this.data.transformMode){case te.Normal:{let f=i+90+o,p=D.cosDeg(i+a)*r,m=D.cosDeg(f)*n,g=D.sinDeg(i+a)*r,x=D.sinDeg(f)*n;this.a=l*p+c*g,this.b=l*m+c*x,this.c=u*p+d*g,this.d=u*m+d*x;return}case te.OnlyTranslation:{let f=i+90+o;this.a=D.cosDeg(i+a)*r,this.b=D.cosDeg(f)*n,this.c=D.sinDeg(i+a)*r,this.d=D.sinDeg(f)*n;break}case te.NoRotationOrReflection:{let f=l*l+u*u,p=0;f>1e-4?(f=Math.abs(l*d-c*u)/f,l/=this.skeleton.scaleX,u/=this.skeleton.scaleY,c=u*f,d=l*f,p=Math.atan2(u,l)*D.radDeg):(l=0,u=0,p=90-Math.atan2(d,c)*D.radDeg);let m=i+a-p,g=i+o-p+90,x=D.cosDeg(m)*r,y=D.cosDeg(g)*n,b=D.sinDeg(m)*r,v=D.sinDeg(g)*n;this.a=l*x-c*b,this.b=l*y-c*v,this.c=u*x+d*b,this.d=u*y+d*v;break}case te.NoScale:case te.NoScaleOrReflection:{let f=D.cosDeg(i),p=D.sinDeg(i),m=(l*f+c*p)/this.skeleton.scaleX,g=(u*f+d*p)/this.skeleton.scaleY,x=Math.sqrt(m*m+g*g);x>1e-5&&(x=1/x),m*=x,g*=x,x=Math.sqrt(m*m+g*g),this.data.transformMode==te.NoScale&&l*d-c*u<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY<0)&&(x=-x);let y=Math.PI/2+Math.atan2(g,m),b=Math.cos(y)*x,v=Math.sin(y)*x,_=D.cosDeg(a)*r,w=D.cosDeg(90+o)*n,T=D.sinDeg(a)*r,S=D.sinDeg(90+o)*n;this.a=m*_+b*T,this.b=m*w+b*S,this.c=g*_+v*T,this.d=g*w+v*S;break}}this.a*=this.skeleton.scaleX,this.b*=this.skeleton.scaleX,this.c*=this.skeleton.scaleY,this.d*=this.skeleton.scaleY}setToSetupPose(){let t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY}getWorldRotationX(){return Math.atan2(this.c,this.a)*D.radDeg}getWorldRotationY(){return Math.atan2(this.d,this.b)*D.radDeg}getWorldScaleX(){return Math.sqrt(this.a*this.a+this.c*this.c)}getWorldScaleY(){return Math.sqrt(this.b*this.b+this.d*this.d)}updateAppliedTransform(){let t=this.parent;if(!t){this.ax=this.worldX-this.skeleton.x,this.ay=this.worldY-this.skeleton.y,this.arotation=Math.atan2(this.c,this.a)*D.radDeg,this.ascaleX=Math.sqrt(this.a*this.a+this.c*this.c),this.ascaleY=Math.sqrt(this.b*this.b+this.d*this.d),this.ashearX=0,this.ashearY=Math.atan2(this.a*this.b+this.c*this.d,this.a*this.d-this.b*this.c)*D.radDeg;return}let e=t.a,i=t.b,r=t.c,n=t.d,a=1/(e*n-i*r),o=n*a,h=i*a,l=r*a,c=e*a,u=this.worldX-t.worldX,d=this.worldY-t.worldY;this.ax=u*o-d*h,this.ay=d*c-u*l;let f,p,m,g;if(this.data.transformMode==te.OnlyTranslation)f=this.a,p=this.b,m=this.c,g=this.d;else{switch(this.data.transformMode){case te.NoRotationOrReflection:{let _=Math.abs(e*n-i*r)/(e*e+r*r),w=e/this.skeleton.scaleX;i=-(r/this.skeleton.scaleY)*_*this.skeleton.scaleX,n=w*_*this.skeleton.scaleY,a=1/(e*n-i*r),o=n*a,h=i*a;break}case te.NoScale:case te.NoScaleOrReflection:let x=D.cosDeg(this.rotation),y=D.sinDeg(this.rotation);e=(e*x+i*y)/this.skeleton.scaleX,r=(r*x+n*y)/this.skeleton.scaleY;let b=Math.sqrt(e*e+r*r);b>1e-5&&(b=1/b),e*=b,r*=b,b=Math.sqrt(e*e+r*r),this.data.transformMode==te.NoScale&&a<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY<0)&&(b=-b);let v=D.PI/2+Math.atan2(r,e);i=Math.cos(v)*b,n=Math.sin(v)*b,a=1/(e*n-i*r),o=n*a,h=i*a,l=r*a,c=e*a}f=o*this.a-h*this.c,p=o*this.b-h*this.d,m=c*this.c-l*this.a,g=c*this.d-l*this.b}if(this.ashearX=0,this.ascaleX=Math.sqrt(f*f+m*m),this.ascaleX>1e-4){let x=f*g-p*m;this.ascaleY=x/this.ascaleX,this.ashearY=-Math.atan2(f*p+m*g,x)*D.radDeg,this.arotation=Math.atan2(m,f)*D.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(p*p+g*g),this.ashearY=0,this.arotation=90-Math.atan2(g,p)*D.radDeg}worldToLocal(t){let e=1/(this.a*this.d-this.b*this.c),i=t.x-this.worldX,r=t.y-this.worldY;return t.x=i*this.d*e-r*this.b*e,t.y=r*this.a*e-i*this.c*e,t}localToWorld(t){let e=t.x,i=t.y;return t.x=e*this.a+i*this.b+this.worldX,t.y=e*this.c+i*this.d+this.worldY,t}worldToLocalRotation(t){let e=D.sinDeg(t),i=D.cosDeg(t);return Math.atan2(this.a*e-this.c*i,this.d*i-this.b*e)*D.radDeg+this.rotation-this.shearX}localToWorldRotation(t){t-=this.rotation-this.shearX;let e=D.sinDeg(t),i=D.cosDeg(t);return Math.atan2(i*this.c+e*this.d,i*this.a+e*this.b)*D.radDeg}rotateWorld(t){let e=this.a,i=this.b,r=this.c,n=this.d,a=D.cosDeg(t),o=D.sinDeg(t);this.a=a*e-o*r,this.b=a*i-o*n,this.c=o*e+a*r,this.d=o*i+a*n}}class Mc{constructor(t,e,i){this.name=t,this.order=e,this.skinRequired=i}}let Gp=class{constructor(t,e){if(this.intValue=0,this.floatValue=0,this.stringValue=null,this.time=0,this.volume=0,this.balance=0,!e)throw new Error("data cannot be null.");this.time=t,this.data=e}};class Vp{constructor(t){this.intValue=0,this.floatValue=0,this.stringValue=null,this.audioPath=null,this.volume=0,this.balance=0,this.name=t}}class ky{constructor(t,e){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,this.softness=0,this.active=!1,!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.softness=t.softness,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(let r=0;r<t.bones.length;r++){let n=e.findBone(t.bones[r].name);if(!n)throw new Error(`Couldn't find bone ${t.bones[r].name}`);this.bones.push(n)}let i=e.findBone(t.target.name);if(!i)throw new Error(`Couldn't find bone ${t.target.name}`);this.target=i}isActive(){return this.active}update(){if(this.mix==0)return;let t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.data.uniform,this.softness,this.mix);break}}apply1(t,e,i,r,n,a,o){let h=t.parent;if(!h)throw new Error("IK bone must have parent.");let l=h.a,c=h.b,u=h.c,d=h.d,f=-t.ashearX-t.arotation,p=0,m=0;switch(t.data.transformMode){case te.OnlyTranslation:p=e-t.worldX,m=i-t.worldY;break;case te.NoRotationOrReflection:let y=Math.abs(l*d-c*u)/Math.max(1e-4,l*l+u*u),b=l/t.skeleton.scaleX,v=u/t.skeleton.scaleY;c=-v*y*t.skeleton.scaleX,d=b*y*t.skeleton.scaleY,f+=Math.atan2(v,b)*D.radDeg;default:let _=e-h.worldX,w=i-h.worldY,T=l*d-c*u;Math.abs(T)<=1e-4?(p=0,m=0):(p=(_*d-w*c)/T-t.ax,m=(w*l-_*u)/T-t.ay)}f+=Math.atan2(m,p)*D.radDeg,t.ascaleX<0&&(f+=180),f>180?f-=360:f<-180&&(f+=360);let g=t.ascaleX,x=t.ascaleY;if(r||n){switch(t.data.transformMode){case te.NoScale:case te.NoScaleOrReflection:p=e-t.worldX,m=i-t.worldY}let y=t.data.length*g,b=Math.sqrt(p*p+m*m);if(r&&b<y||n&&b>y&&y>1e-4){let v=(b/y-1)*o+1;g*=v,a&&(x*=v)}}t.updateWorldTransformWith(t.ax,t.ay,t.arotation+f*o,g,x,t.ashearX,t.ashearY)}apply2(t,e,i,r,n,a,o,h,l){let c=t.ax,u=t.ay,d=t.ascaleX,f=t.ascaleY,p=d,m=f,g=e.ascaleX,x=0,y=0,b=0;d<0?(d=-d,x=180,b=-1):(x=0,b=1),f<0&&(f=-f,b=-b),g<0?(g=-g,y=180):y=0;let v=e.ax,_=0,w=0,T=0,S=t.a,C=t.b,E=t.c,M=t.d,N=Math.abs(d-f)<=1e-4;!N||a?(_=0,w=S*v+t.worldX,T=E*v+t.worldY):(_=e.ay,w=S*v+C*_+t.worldX,T=E*v+M*_+t.worldY);let R=t.parent;if(!R)throw new Error("IK parent must itself have a parent.");S=R.a,C=R.b,E=R.c,M=R.d;let I=S*M-C*E,k=w-R.worldX,B=T-R.worldY;I=Math.abs(I)<=1e-4?0:1/I;let z=(k*M-B*C)*I-c,Z=(B*S-k*E)*I-u,G=Math.sqrt(z*z+Z*Z),O=e.data.length*g,X,V;if(G<1e-4){this.apply1(t,i,r,!1,a,!1,l),e.updateWorldTransformWith(v,_,0,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY);return}k=i-R.worldX,B=r-R.worldY;let $=(k*M-B*C)*I-c,H=(B*S-k*E)*I-u,K=$*$+H*H;if(h!=0){h*=d*(g+1)*.5;let ut=Math.sqrt(K),_t=ut-G-O*d+h;if(_t>0){let ht=Math.min(1,_t/(h*2))-1;ht=(_t-h*(1-ht*ht))/ut,$-=ht*$,H-=ht*H,K=$*$+H*H}}t:if(N){O*=d;let ut=(K-G*G-O*O)/(2*G*O);ut<-1?(ut=-1,V=Math.PI*n):ut>1?(ut=1,V=0,a&&(S=(Math.sqrt(K)/(G+O)-1)*l+1,p*=S,o&&(m*=S))):V=Math.acos(ut)*n,S=G+O*ut,C=O*Math.sin(V),X=Math.atan2(H*S-$*C,$*S+H*C)}else{S=d*O,C=f*O;let ut=S*S,_t=C*C,ht=Math.atan2(H,$);E=_t*G*G+ut*K-ut*_t;let At=-2*_t*G,Ut=_t-ut;if(M=At*At-4*Ut*E,M>=0){let hs=Math.sqrt(M);At<0&&(hs=-hs),hs=-(At+hs)*.5;let nh=hs/Ut,Cu=E/hs,cr=Math.abs(nh)<Math.abs(Cu)?nh:Cu;if(cr*cr<=K){B=Math.sqrt(K-cr*cr)*n,X=ht-Math.atan2(B,cr),V=Math.atan2(B/f,(cr-G)/d);break t}}let Ht=D.PI,he=G-S,Qt=he*he,Te=0,Si=0,ze=G+S,hn=ze*ze,ln=0;E=-S*G/(ut-_t),E>=-1&&E<=1&&(E=Math.acos(E),k=S*Math.cos(E)+G,B=C*Math.sin(E),M=k*k+B*B,M<Qt&&(Ht=E,Qt=M,he=k,Te=B),M>hn&&(Si=E,hn=M,ze=k,ln=B)),K<=(Qt+hn)*.5?(X=ht-Math.atan2(Te*n,he),V=Ht*n):(X=ht-Math.atan2(ln*n,ze),V=Si*n)}let nt=Math.atan2(_,v)*b,St=t.arotation;X=(X-nt)*D.radDeg+x-St,X>180?X-=360:X<-180&&(X+=360),t.updateWorldTransformWith(c,u,St+X*l,p,m,0,0),St=e.arotation,V=((V+nt)*D.radDeg-e.ashearX)*b+y-St,V>180?V-=360:V<-180&&(V+=360),e.updateWorldTransformWith(v,_,St+V*l,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY)}}class zp extends Mc{set target(t){this._target=t}get target(){if(this._target)return this._target;throw new Error("BoneData not set.")}constructor(t){super(t,0,!1),this.bones=new Array,this._target=null,this.bendDirection=1,this.compress=!1,this.stretch=!1,this.uniform=!1,this.mix=1,this.softness=0}}class Hp extends Mc{set target(t){this._target=t}get target(){if(this._target)return this._target;throw new Error("SlotData not set.")}constructor(t){super(t,0,!1),this.bones=new Array,this._target=null,this.positionMode=Bi.Fixed,this.spacingMode=ie.Fixed,this.rotateMode=qs.Chain,this.offsetRotation=0,this.position=0,this.spacing=0,this.mixRotate=0,this.mixX=0,this.mixY=0}}var Bi;(function(s){s[s.Fixed=0]="Fixed",s[s.Percent=1]="Percent"})(Bi||(Bi={}));var ie;(function(s){s[s.Length=0]="Length",s[s.Fixed=1]="Fixed",s[s.Percent=2]="Percent",s[s.Proportional=3]="Proportional"})(ie||(ie={}));var qs;(function(s){s[s.Tangent=0]="Tangent",s[s.Chain=1]="Chain",s[s.ChainScale=2]="ChainScale"})(qs||(qs={}));class Ae{constructor(t,e){if(this.position=0,this.spacing=0,this.mixRotate=0,this.mixX=0,this.mixY=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,this.active=!1,!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(let r=0,n=t.bones.length;r<n;r++){let a=e.findBone(t.bones[r].name);if(!a)throw new Error(`Couldn't find bone ${t.bones[r].name}.`);this.bones.push(a)}let i=e.findSlot(t.target.name);if(!i)throw new Error(`Couldn't find target bone ${t.target.name}`);this.target=i,this.position=t.position,this.spacing=t.spacing,this.mixRotate=t.mixRotate,this.mixX=t.mixX,this.mixY=t.mixY}isActive(){return this.active}update(){let t=this.target.getAttachment();if(!(t instanceof $r))return;let e=this.mixRotate,i=this.mixX,r=this.mixY;if(e==0&&i==0&&r==0)return;let n=this.data,a=n.rotateMode==qs.Tangent,o=n.rotateMode==qs.ChainScale,h=this.bones,l=h.length,c=a?l:l+1,u=Y.setArraySize(this.spaces,c),d=o?this.lengths=Y.setArraySize(this.lengths,l):[],f=this.spacing;switch(n.spacingMode){case ie.Percent:if(o)for(let _=0,w=c-1;_<w;_++){let T=h[_],S=T.data.length;if(S<Ae.epsilon)d[_]=0;else{let C=S*T.a,E=S*T.c;d[_]=Math.sqrt(C*C+E*E)}}Y.arrayFill(u,1,c,f);break;case ie.Proportional:let b=0;for(let _=0,w=c-1;_<w;){let T=h[_],S=T.data.length;if(S<Ae.epsilon)o&&(d[_]=0),u[++_]=f;else{let C=S*T.a,E=S*T.c,M=Math.sqrt(C*C+E*E);o&&(d[_]=M),u[++_]=M,b+=M}}if(b>0){b=c/b*f;for(let _=1;_<c;_++)u[_]*=b}break;default:let v=n.spacingMode==ie.Length;for(let _=0,w=c-1;_<w;){let T=h[_],S=T.data.length;if(S<Ae.epsilon)o&&(d[_]=0),u[++_]=f;else{let C=S*T.a,E=S*T.c,M=Math.sqrt(C*C+E*E);o&&(d[_]=M),u[++_]=(v?S+f:f)*M/S}}}let p=this.computeWorldPositions(t,c,a),m=p[0],g=p[1],x=n.offsetRotation,y=!1;if(x==0)y=n.rotateMode==qs.Chain;else{y=!1;let b=this.target.bone;x*=b.a*b.d-b.b*b.c>0?D.degRad:-D.degRad}for(let b=0,v=3;b<l;b++,v+=3){let _=h[b];_.worldX+=(m-_.worldX)*i,_.worldY+=(g-_.worldY)*r;let w=p[v],T=p[v+1],S=w-m,C=T-g;if(o){let E=d[b];if(E!=0){let M=(Math.sqrt(S*S+C*C)/E-1)*e+1;_.a*=M,_.c*=M}}if(m=w,g=T,e>0){let E=_.a,M=_.b,N=_.c,R=_.d,I=0,k=0,B=0;if(a?I=p[v-1]:u[b+1]==0?I=p[v+2]:I=Math.atan2(C,S),I-=Math.atan2(N,E),y){k=Math.cos(I),B=Math.sin(I);let z=_.data.length;m+=(z*(k*E-B*N)-S)*e,g+=(z*(B*E+k*N)-C)*e}else I+=x;I>D.PI?I-=D.PI2:I<-D.PI&&(I+=D.PI2),I*=e,k=Math.cos(I),B=Math.sin(I),_.a=k*E-B*N,_.b=k*M-B*R,_.c=B*E+k*N,_.d=B*M+k*R}_.updateAppliedTransform()}}computeWorldPositions(t,e,i){let r=this.target,n=this.position,a=this.spaces,o=Y.setArraySize(this.positions,e*3+2),h=this.world,l=t.closed,c=t.worldVerticesLength,u=c/6,d=Ae.NONE;if(!t.constantSpeed){let Z=t.lengths;u-=l?1:2;let G=Z[u];this.data.positionMode==Bi.Percent&&(n*=G);let O;switch(this.data.spacingMode){case ie.Percent:O=G;break;case ie.Proportional:O=G/e;break;default:O=1}h=Y.setArraySize(this.world,8);for(let X=0,V=0,$=0;X<e;X++,V+=3){let H=a[X]*O;n+=H;let K=n;if(l)K%=G,K<0&&(K+=G),$=0;else if(K<0){d!=Ae.BEFORE&&(d=Ae.BEFORE,t.computeWorldVertices(r,2,4,h,0,2)),this.addBeforePosition(K,h,0,o,V);continue}else if(K>G){d!=Ae.AFTER&&(d=Ae.AFTER,t.computeWorldVertices(r,c-6,4,h,0,2)),this.addAfterPosition(K-G,h,0,o,V);continue}for(;;$++){let nt=Z[$];if(!(K>nt)){if($==0)K/=nt;else{let St=Z[$-1];K=(K-St)/(nt-St)}break}}$!=d&&(d=$,l&&$==u?(t.computeWorldVertices(r,c-4,4,h,0,2),t.computeWorldVertices(r,0,4,h,4,2)):t.computeWorldVertices(r,$*6+2,8,h,0,2)),this.addCurvePosition(K,h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7],o,V,i||X>0&&H==0)}return o}l?(c+=2,h=Y.setArraySize(this.world,c),t.computeWorldVertices(r,2,c-4,h,0,2),t.computeWorldVertices(r,0,2,h,c-4,2),h[c-2]=h[0],h[c-1]=h[1]):(u--,c-=4,h=Y.setArraySize(this.world,c),t.computeWorldVertices(r,2,c,h,0,2));let f=Y.setArraySize(this.curves,u),p=0,m=h[0],g=h[1],x=0,y=0,b=0,v=0,_=0,w=0,T=0,S=0,C=0,E=0,M=0,N=0,R=0,I=0;for(let Z=0,G=2;Z<u;Z++,G+=6)x=h[G],y=h[G+1],b=h[G+2],v=h[G+3],_=h[G+4],w=h[G+5],T=(m-x*2+b)*.1875,S=(g-y*2+v)*.1875,C=((x-b)*3-m+_)*.09375,E=((y-v)*3-g+w)*.09375,M=T*2+C,N=S*2+E,R=(x-m)*.75+T+C*.16666667,I=(y-g)*.75+S+E*.16666667,p+=Math.sqrt(R*R+I*I),R+=M,I+=N,M+=C,N+=E,p+=Math.sqrt(R*R+I*I),R+=M,I+=N,p+=Math.sqrt(R*R+I*I),R+=M+C,I+=N+E,p+=Math.sqrt(R*R+I*I),f[Z]=p,m=_,g=w;this.data.positionMode==Bi.Percent&&(n*=p);let k;switch(this.data.spacingMode){case ie.Percent:k=p;break;case ie.Proportional:k=p/e;break;default:k=1}let B=this.segments,z=0;for(let Z=0,G=0,O=0,X=0;Z<e;Z++,G+=3){let V=a[Z]*k;n+=V;let $=n;if(l)$%=p,$<0&&($+=p),O=0;else if($<0){this.addBeforePosition($,h,0,o,G);continue}else if($>p){this.addAfterPosition($-p,h,c-4,o,G);continue}for(;;O++){let H=f[O];if(!($>H)){if(O==0)$/=H;else{let K=f[O-1];$=($-K)/(H-K)}break}}if(O!=d){d=O;let H=O*6;for(m=h[H],g=h[H+1],x=h[H+2],y=h[H+3],b=h[H+4],v=h[H+5],_=h[H+6],w=h[H+7],T=(m-x*2+b)*.03,S=(g-y*2+v)*.03,C=((x-b)*3-m+_)*.006,E=((y-v)*3-g+w)*.006,M=T*2+C,N=S*2+E,R=(x-m)*.3+T+C*.16666667,I=(y-g)*.3+S+E*.16666667,z=Math.sqrt(R*R+I*I),B[0]=z,H=1;H<8;H++)R+=M,I+=N,M+=C,N+=E,z+=Math.sqrt(R*R+I*I),B[H]=z;R+=M,I+=N,z+=Math.sqrt(R*R+I*I),B[8]=z,R+=M+C,I+=N+E,z+=Math.sqrt(R*R+I*I),B[9]=z,X=0}for($*=z;;X++){let H=B[X];if(!($>H)){if(X==0)$/=H;else{let K=B[X-1];$=X+($-K)/(H-K)}break}}this.addCurvePosition($*.1,m,g,x,y,b,v,_,w,o,G,i||Z>0&&V==0)}return o}addBeforePosition(t,e,i,r,n){let a=e[i],o=e[i+1],h=e[i+2]-a,l=e[i+3]-o,c=Math.atan2(l,h);r[n]=a+t*Math.cos(c),r[n+1]=o+t*Math.sin(c),r[n+2]=c}addAfterPosition(t,e,i,r,n){let a=e[i+2],o=e[i+3],h=a-e[i],l=o-e[i+1],c=Math.atan2(l,h);r[n]=a+t*Math.cos(c),r[n+1]=o+t*Math.sin(c),r[n+2]=c}addCurvePosition(t,e,i,r,n,a,o,h,l,c,u,d){if(t==0||isNaN(t)){c[u]=e,c[u+1]=i,c[u+2]=Math.atan2(n-i,r-e);return}let f=t*t,p=f*t,m=1-t,g=m*m,x=g*m,y=m*t,b=y*3,v=m*b,_=b*t,w=e*x+r*v+a*_+h*p,T=i*x+n*v+o*_+l*p;c[u]=w,c[u+1]=T,d&&(t<.001?c[u+2]=Math.atan2(n-i,r-e):c[u+2]=Math.atan2(T-(i*g+n*y*2+o*f),w-(e*g+r*y*2+a*f)))}}Ae.NONE=-1;Ae.BEFORE=-2;Ae.AFTER=-3;Ae.epsilon=1e-5;class Ry{constructor(t,e){if(this.darkColor=null,this.attachment=null,this.attachmentState=0,this.sequenceIndex=-1,this.deform=new Array,!t)throw new Error("data cannot be null.");if(!e)throw new Error("bone cannot be null.");this.data=t,this.bone=e,this.color=new tt,this.darkColor=t.darkColor?new tt:null,this.setToSetupPose()}getSkeleton(){return this.bone.skeleton}getAttachment(){return this.attachment}setAttachment(t){this.attachment!=t&&((!(t instanceof ti)||!(this.attachment instanceof ti)||t.timelineAttachment!=this.attachment.timelineAttachment)&&(this.deform.length=0),this.attachment=t,this.sequenceIndex=-1)}setToSetupPose(){this.color.setFromColor(this.data.color),this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),this.data.attachmentName?(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName))):this.attachment=null}}class By{constructor(t,e){if(this.mixRotate=0,this.mixX=0,this.mixY=0,this.mixScaleX=0,this.mixScaleY=0,this.mixShearY=0,this.temp=new Ja,this.active=!1,!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.mixRotate=t.mixRotate,this.mixX=t.mixX,this.mixY=t.mixY,this.mixScaleX=t.mixScaleX,this.mixScaleY=t.mixScaleY,this.mixShearY=t.mixShearY,this.bones=new Array;for(let r=0;r<t.bones.length;r++){let n=e.findBone(t.bones[r].name);if(!n)throw new Error(`Couldn't find bone ${t.bones[r].name}.`);this.bones.push(n)}let i=e.findBone(t.target.name);if(!i)throw new Error(`Couldn't find target bone ${t.target.name}.`);this.target=i}isActive(){return this.active}update(){this.mixRotate==0&&this.mixX==0&&this.mixY==0&&this.mixScaleX==0&&this.mixScaleY==0&&this.mixShearY==0||(this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld())}applyAbsoluteWorld(){let t=this.mixRotate,e=this.mixX,i=this.mixY,r=this.mixScaleX,n=this.mixScaleY,a=this.mixShearY,o=e!=0||i!=0,h=this.target,l=h.a,c=h.b,u=h.c,d=h.d,f=l*d-c*u>0?D.degRad:-D.degRad,p=this.data.offsetRotation*f,m=this.data.offsetShearY*f,g=this.bones;for(let x=0,y=g.length;x<y;x++){let b=g[x];if(t!=0){let v=b.a,_=b.b,w=b.c,T=b.d,S=Math.atan2(u,l)-Math.atan2(w,v)+p;S>D.PI?S-=D.PI2:S<-D.PI&&(S+=D.PI2),S*=t;let C=Math.cos(S),E=Math.sin(S);b.a=C*v-E*w,b.b=C*_-E*T,b.c=E*v+C*w,b.d=E*_+C*T}if(o){let v=this.temp;h.localToWorld(v.set(this.data.offsetX,this.data.offsetY)),b.worldX+=(v.x-b.worldX)*e,b.worldY+=(v.y-b.worldY)*i}if(r!=0){let v=Math.sqrt(b.a*b.a+b.c*b.c);v!=0&&(v=(v+(Math.sqrt(l*l+u*u)-v+this.data.offsetScaleX)*r)/v),b.a*=v,b.c*=v}if(n!=0){let v=Math.sqrt(b.b*b.b+b.d*b.d);v!=0&&(v=(v+(Math.sqrt(c*c+d*d)-v+this.data.offsetScaleY)*n)/v),b.b*=v,b.d*=v}if(a>0){let v=b.b,_=b.d,w=Math.atan2(_,v),T=Math.atan2(d,c)-Math.atan2(u,l)-(w-Math.atan2(b.c,b.a));T>D.PI?T-=D.PI2:T<-D.PI&&(T+=D.PI2),T=w+(T+m)*a;let S=Math.sqrt(v*v+_*_);b.b=Math.cos(T)*S,b.d=Math.sin(T)*S}b.updateAppliedTransform()}}applyRelativeWorld(){let t=this.mixRotate,e=this.mixX,i=this.mixY,r=this.mixScaleX,n=this.mixScaleY,a=this.mixShearY,o=e!=0||i!=0,h=this.target,l=h.a,c=h.b,u=h.c,d=h.d,f=l*d-c*u>0?D.degRad:-D.degRad,p=this.data.offsetRotation*f,m=this.data.offsetShearY*f,g=this.bones;for(let x=0,y=g.length;x<y;x++){let b=g[x];if(t!=0){let v=b.a,_=b.b,w=b.c,T=b.d,S=Math.atan2(u,l)+p;S>D.PI?S-=D.PI2:S<-D.PI&&(S+=D.PI2),S*=t;let C=Math.cos(S),E=Math.sin(S);b.a=C*v-E*w,b.b=C*_-E*T,b.c=E*v+C*w,b.d=E*_+C*T}if(o){let v=this.temp;h.localToWorld(v.set(this.data.offsetX,this.data.offsetY)),b.worldX+=v.x*e,b.worldY+=v.y*i}if(r!=0){let v=(Math.sqrt(l*l+u*u)-1+this.data.offsetScaleX)*r+1;b.a*=v,b.c*=v}if(n!=0){let v=(Math.sqrt(c*c+d*d)-1+this.data.offsetScaleY)*n+1;b.b*=v,b.d*=v}if(a>0){let v=Math.atan2(d,c)-Math.atan2(u,l);v>D.PI?v-=D.PI2:v<-D.PI&&(v+=D.PI2);let _=b.b,w=b.d;v=Math.atan2(w,_)+(v-D.PI/2+m)*a;let T=Math.sqrt(_*_+w*w);b.b=Math.cos(v)*T,b.d=Math.sin(v)*T}b.updateAppliedTransform()}}applyAbsoluteLocal(){let t=this.mixRotate,e=this.mixX,i=this.mixY,r=this.mixScaleX,n=this.mixScaleY,a=this.mixShearY,o=this.target,h=this.bones;for(let l=0,c=h.length;l<c;l++){let u=h[l],d=u.arotation;if(t!=0){let y=o.arotation-d+this.data.offsetRotation;y-=(16384-(16384.499999999996-y/360|0))*360,d+=y*t}let f=u.ax,p=u.ay;f+=(o.ax-f+this.data.offsetX)*e,p+=(o.ay-p+this.data.offsetY)*i;let m=u.ascaleX,g=u.ascaleY;r!=0&&m!=0&&(m=(m+(o.ascaleX-m+this.data.offsetScaleX)*r)/m),n!=0&&g!=0&&(g=(g+(o.ascaleY-g+this.data.offsetScaleY)*n)/g);let x=u.ashearY;if(a!=0){let y=o.ashearY-x+this.data.offsetShearY;y-=(16384-(16384.499999999996-y/360|0))*360,x+=y*a}u.updateWorldTransformWith(f,p,d,m,g,u.ashearX,x)}}applyRelativeLocal(){let t=this.mixRotate,e=this.mixX,i=this.mixY,r=this.mixScaleX,n=this.mixScaleY,a=this.mixShearY,o=this.target,h=this.bones;for(let l=0,c=h.length;l<c;l++){let u=h[l],d=u.arotation+(o.arotation+this.data.offsetRotation)*t,f=u.ax+(o.ax+this.data.offsetX)*e,p=u.ay+(o.ay+this.data.offsetY)*i,m=u.ascaleX*((o.ascaleX-1+this.data.offsetScaleX)*r+1),g=u.ascaleY*((o.ascaleY-1+this.data.offsetScaleY)*n+1),x=u.ashearY+(o.ashearY+this.data.offsetShearY)*a;u.updateWorldTransformWith(f,p,d,m,g,u.ashearX,x)}}}class na{get scaleY(){return na.yDown?-this._scaleY:this._scaleY}set scaleY(t){this._scaleY=t}constructor(t){if(this._updateCache=new Array,this.skin=null,this.scaleX=1,this._scaleY=1,this.x=0,this.y=0,!t)throw new Error("data cannot be null.");this.data=t,this.bones=new Array;for(let e=0;e<t.bones.length;e++){let i=t.bones[e],r;if(!i.parent)r=new Mu(i,this,null);else{let n=this.bones[i.parent.index];r=new Mu(i,this,n),n.children.push(r)}this.bones.push(r)}this.slots=new Array,this.drawOrder=new Array;for(let e=0;e<t.slots.length;e++){let i=t.slots[e],r=this.bones[i.boneData.index],n=new Ry(i,r);this.slots.push(n),this.drawOrder.push(n)}this.ikConstraints=new Array;for(let e=0;e<t.ikConstraints.length;e++){let i=t.ikConstraints[e];this.ikConstraints.push(new ky(i,this))}this.transformConstraints=new Array;for(let e=0;e<t.transformConstraints.length;e++){let i=t.transformConstraints[e];this.transformConstraints.push(new By(i,this))}this.pathConstraints=new Array;for(let e=0;e<t.pathConstraints.length;e++){let i=t.pathConstraints[e];this.pathConstraints.push(new Ae(i,this))}this.color=new tt(1,1,1,1),this.updateCache()}updateCache(){let t=this._updateCache;t.length=0;let e=this.bones;for(let c=0,u=e.length;c<u;c++){let d=e[c];d.sorted=d.data.skinRequired,d.active=!d.sorted}if(this.skin){let c=this.skin.bones;for(let u=0,d=this.skin.bones.length;u<d;u++){let f=this.bones[c[u].index];do f.sorted=!1,f.active=!0,f=f.parent;while(f)}}let i=this.ikConstraints,r=this.transformConstraints,n=this.pathConstraints,a=i.length,o=r.length,h=n.length,l=a+o+h;t:for(let c=0;c<l;c++){for(let u=0;u<a;u++){let d=i[u];if(d.data.order==c){this.sortIkConstraint(d);continue t}}for(let u=0;u<o;u++){let d=r[u];if(d.data.order==c){this.sortTransformConstraint(d);continue t}}for(let u=0;u<h;u++){let d=n[u];if(d.data.order==c){this.sortPathConstraint(d);continue t}}}for(let c=0,u=e.length;c<u;c++)this.sortBone(e[c])}sortIkConstraint(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||this.skin&&Y.contains(this.skin.constraints,t.data,!0)),!t.active)return;let e=t.target;this.sortBone(e);let i=t.bones,r=i[0];if(this.sortBone(r),i.length==1)this._updateCache.push(t),this.sortReset(r.children);else{let n=i[i.length-1];this.sortBone(n),this._updateCache.push(t),this.sortReset(r.children),n.sorted=!0}}sortPathConstraint(t){if(t.active=t.target.bone.isActive()&&(!t.data.skinRequired||this.skin&&Y.contains(this.skin.constraints,t.data,!0)),!t.active)return;let e=t.target,i=e.data.index,r=e.bone;this.skin&&this.sortPathConstraintAttachment(this.skin,i,r),this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,i,r);for(let h=0,l=this.data.skins.length;h<l;h++)this.sortPathConstraintAttachment(this.data.skins[h],i,r);let n=e.getAttachment();n instanceof $r&&this.sortPathConstraintAttachmentWith(n,r);let a=t.bones,o=a.length;for(let h=0;h<o;h++)this.sortBone(a[h]);this._updateCache.push(t);for(let h=0;h<o;h++)this.sortReset(a[h].children);for(let h=0;h<o;h++)a[h].sorted=!0}sortTransformConstraint(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||this.skin&&Y.contains(this.skin.constraints,t.data,!0)),!t.active)return;this.sortBone(t.target);let e=t.bones,i=e.length;if(t.data.local)for(let r=0;r<i;r++){let n=e[r];this.sortBone(n.parent),this.sortBone(n)}else for(let r=0;r<i;r++)this.sortBone(e[r]);this._updateCache.push(t);for(let r=0;r<i;r++)this.sortReset(e[r].children);for(let r=0;r<i;r++)e[r].sorted=!0}sortPathConstraintAttachment(t,e,i){let r=t.attachments[e];if(r)for(let n in r)this.sortPathConstraintAttachmentWith(r[n],i)}sortPathConstraintAttachmentWith(t,e){if(!(t instanceof $r))return;let i=t.bones;if(!i)this.sortBone(e);else{let r=this.bones;for(let n=0,a=i.length;n<a;){let o=i[n++];for(o+=n;n<o;)this.sortBone(r[i[n++]])}}}sortBone(t){if(!t||t.sorted)return;let e=t.parent;e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}sortReset(t){for(let e=0,i=t.length;e<i;e++){let r=t[e];r.active&&(r.sorted&&this.sortReset(r.children),r.sorted=!1)}}updateWorldTransform(){let t=this.bones;for(let i=0,r=t.length;i<r;i++){let n=t[i];n.ax=n.x,n.ay=n.y,n.arotation=n.rotation,n.ascaleX=n.scaleX,n.ascaleY=n.scaleY,n.ashearX=n.shearX,n.ashearY=n.shearY}let e=this._updateCache;for(let i=0,r=e.length;i<r;i++)e[i].update()}updateWorldTransformWith(t){let e=this.getRootBone();if(!e)throw new Error("Root bone must not be null.");let i=t.a,r=t.b,n=t.c,a=t.d;e.worldX=i*this.x+r*this.y+t.worldX,e.worldY=n*this.x+a*this.y+t.worldY;let o=e.rotation+90+e.shearY,h=D.cosDeg(e.rotation+e.shearX)*e.scaleX,l=D.cosDeg(o)*e.scaleY,c=D.sinDeg(e.rotation+e.shearX)*e.scaleX,u=D.sinDeg(o)*e.scaleY;e.a=(i*h+r*c)*this.scaleX,e.b=(i*l+r*u)*this.scaleX,e.c=(n*h+a*c)*this.scaleY,e.d=(n*l+a*u)*this.scaleY;let d=this._updateCache;for(let f=0,p=d.length;f<p;f++){let m=d[f];m!=e&&m.update()}}setToSetupPose(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()}setBonesToSetupPose(){let t=this.bones;for(let n=0,a=t.length;n<a;n++)t[n].setToSetupPose();let e=this.ikConstraints;for(let n=0,a=e.length;n<a;n++){let o=e[n];o.mix=o.data.mix,o.softness=o.data.softness,o.bendDirection=o.data.bendDirection,o.compress=o.data.compress,o.stretch=o.data.stretch}let i=this.transformConstraints;for(let n=0,a=i.length;n<a;n++){let o=i[n],h=o.data;o.mixRotate=h.mixRotate,o.mixX=h.mixX,o.mixY=h.mixY,o.mixScaleX=h.mixScaleX,o.mixScaleY=h.mixScaleY,o.mixShearY=h.mixShearY}let r=this.pathConstraints;for(let n=0,a=r.length;n<a;n++){let o=r[n],h=o.data;o.position=h.position,o.spacing=h.spacing,o.mixRotate=h.mixRotate,o.mixX=h.mixX,o.mixY=h.mixY}}setSlotsToSetupPose(){let t=this.slots;Y.arrayCopy(t,0,this.drawOrder,0,t.length);for(let e=0,i=t.length;e<i;e++)t[e].setToSetupPose()}getRootBone(){return this.bones.length==0?null:this.bones[0]}findBone(t){if(!t)throw new Error("boneName cannot be null.");let e=this.bones;for(let i=0,r=e.length;i<r;i++){let n=e[i];if(n.data.name==t)return n}return null}findSlot(t){if(!t)throw new Error("slotName cannot be null.");let e=this.slots;for(let i=0,r=e.length;i<r;i++){let n=e[i];if(n.data.name==t)return n}return null}setSkinByName(t){let e=this.data.findSkin(t);if(!e)throw new Error("Skin not found: "+t);this.setSkin(e)}setSkin(t){if(t!=this.skin){if(t)if(this.skin)t.attachAll(this,this.skin);else{let e=this.slots;for(let i=0,r=e.length;i<r;i++){let n=e[i],a=n.data.attachmentName;if(a){let o=t.getAttachment(i,a);o&&n.setAttachment(o)}}}this.skin=t,this.updateCache()}}getAttachmentByName(t,e){let i=this.data.findSlot(t);if(!i)throw new Error(`Can't find slot with name ${t}`);return this.getAttachment(i.index,e)}getAttachment(t,e){if(!e)throw new Error("attachmentName cannot be null.");if(this.skin){let i=this.skin.getAttachment(t,e);if(i)return i}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null}setAttachment(t,e){if(!t)throw new Error("slotName cannot be null.");let i=this.slots;for(let r=0,n=i.length;r<n;r++){let a=i[r];if(a.data.name==t){let o=null;if(e&&(o=this.getAttachment(r,e),!o))throw new Error("Attachment not found: "+e+", for slot: "+t);a.setAttachment(o);return}}throw new Error("Slot not found: "+t)}findIkConstraint(t){if(!t)throw new Error("constraintName cannot be null.");let e=this.ikConstraints;for(let i=0,r=e.length;i<r;i++){let n=e[i];if(n.data.name==t)return n}return null}findTransformConstraint(t){if(!t)throw new Error("constraintName cannot be null.");let e=this.transformConstraints;for(let i=0,r=e.length;i<r;i++){let n=e[i];if(n.data.name==t)return n}return null}findPathConstraint(t){if(!t)throw new Error("constraintName cannot be null.");let e=this.pathConstraints;for(let i=0,r=e.length;i<r;i++){let n=e[i];if(n.data.name==t)return n}return null}getBoundsRect(){let t=new Ja,e=new Ja;return this.getBounds(t,e),{x:t.x,y:t.y,width:e.x,height:e.y}}getBounds(t,e,i=new Array(2)){if(!t)throw new Error("offset cannot be null.");if(!e)throw new Error("size cannot be null.");let r=this.drawOrder,n=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,h=Number.NEGATIVE_INFINITY;for(let l=0,c=r.length;l<c;l++){let u=r[l];if(!u.bone.active)continue;let d=0,f=null,p=u.getAttachment();if(p instanceof ct)d=8,f=Y.setArraySize(i,d,0),p.computeWorldVertices(u,f,0,2);else if(p instanceof Qs){let m=p;d=m.worldVerticesLength,f=Y.setArraySize(i,d,0),m.computeWorldVertices(u,0,d,f,0,2)}if(f)for(let m=0,g=f.length;m<g;m+=2){let x=f[m],y=f[m+1];n=Math.min(n,x),a=Math.min(a,y),o=Math.max(o,x),h=Math.max(h,y)}}t.set(n,a),e.set(o-n,h-a)}}na.yDown=!1;class Xp{constructor(){this.name=null,this.bones=new Array,this.slots=new Array,this.skins=new Array,this.defaultSkin=null,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.x=0,this.y=0,this.width=0,this.height=0,this.version=null,this.hash=null,this.fps=0,this.imagesPath=null,this.audioPath=null}findBone(t){if(!t)throw new Error("boneName cannot be null.");let e=this.bones;for(let i=0,r=e.length;i<r;i++){let n=e[i];if(n.name==t)return n}return null}findSlot(t){if(!t)throw new Error("slotName cannot be null.");let e=this.slots;for(let i=0,r=e.length;i<r;i++){let n=e[i];if(n.name==t)return n}return null}findSkin(t){if(!t)throw new Error("skinName cannot be null.");let e=this.skins;for(let i=0,r=e.length;i<r;i++){let n=e[i];if(n.name==t)return n}return null}findEvent(t){if(!t)throw new Error("eventDataName cannot be null.");let e=this.events;for(let i=0,r=e.length;i<r;i++){let n=e[i];if(n.name==t)return n}return null}findAnimation(t){if(!t)throw new Error("animationName cannot be null.");let e=this.animations;for(let i=0,r=e.length;i<r;i++){let n=e[i];if(n.name==t)return n}return null}findIkConstraint(t){if(!t)throw new Error("constraintName cannot be null.");let e=this.ikConstraints;for(let i=0,r=e.length;i<r;i++){let n=e[i];if(n.name==t)return n}return null}findTransformConstraint(t){if(!t)throw new Error("constraintName cannot be null.");let e=this.transformConstraints;for(let i=0,r=e.length;i<r;i++){let n=e[i];if(n.name==t)return n}return null}findPathConstraint(t){if(!t)throw new Error("constraintName cannot be null.");let e=this.pathConstraints;for(let i=0,r=e.length;i<r;i++){let n=e[i];if(n.name==t)return n}return null}}class ku{constructor(t=0,e,i){this.slotIndex=t,this.name=e,this.attachment=i}}class vl{constructor(t){if(this.attachments=new Array,this.bones=Array(),this.constraints=new Array,!t)throw new Error("name cannot be null.");this.name=t}setAttachment(t,e,i){if(!i)throw new Error("attachment cannot be null.");let r=this.attachments;t>=r.length&&(r.length=t+1),r[t]||(r[t]={}),r[t][e]=i}addSkin(t){for(let r=0;r<t.bones.length;r++){let n=t.bones[r],a=!1;for(let o=0;o<this.bones.length;o++)if(this.bones[o]==n){a=!0;break}a||this.bones.push(n)}for(let r=0;r<t.constraints.length;r++){let n=t.constraints[r],a=!1;for(let o=0;o<this.constraints.length;o++)if(this.constraints[o]==n){a=!0;break}a||this.constraints.push(n)}let e=t.getAttachments();for(let r=0;r<e.length;r++){var i=e[r];this.setAttachment(i.slotIndex,i.name,i.attachment)}}copySkin(t){for(let r=0;r<t.bones.length;r++){let n=t.bones[r],a=!1;for(let o=0;o<this.bones.length;o++)if(this.bones[o]==n){a=!0;break}a||this.bones.push(n)}for(let r=0;r<t.constraints.length;r++){let n=t.constraints[r],a=!1;for(let o=0;o<this.constraints.length;o++)if(this.constraints[o]==n){a=!0;break}a||this.constraints.push(n)}let e=t.getAttachments();for(let r=0;r<e.length;r++){var i=e[r];i.attachment&&(i.attachment instanceof Qs?(i.attachment=i.attachment.newLinkedMesh(),this.setAttachment(i.slotIndex,i.name,i.attachment)):(i.attachment=i.attachment.copy(),this.setAttachment(i.slotIndex,i.name,i.attachment)))}}getAttachment(t,e){let i=this.attachments[t];return i?i[e]:null}removeAttachment(t,e){let i=this.attachments[t];i&&delete i[e]}getAttachments(){let t=new Array;for(var e=0;e<this.attachments.length;e++){let i=this.attachments[e];if(i)for(let r in i){let n=i[r];n&&t.push(new ku(e,r,n))}}return t}getAttachmentsForSlot(t,e){let i=this.attachments[t];if(i)for(let r in i){let n=i[r];n&&e.push(new ku(t,r,n))}}clear(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0}attachAll(t,e){let i=0;for(let r=0;r<t.slots.length;r++){let n=t.slots[r],a=n.getAttachment();if(a&&i<e.attachments.length){let o=e.attachments[i];for(let h in o){let l=o[h];if(a==l){let c=this.getAttachment(i,h);c&&n.setAttachment(c);break}}}i++}}}class $p{constructor(t,e,i){if(this.index=0,this.color=new tt(1,1,1,1),this.darkColor=null,this.attachmentName=null,this.blendMode=ms.Normal,t<0)throw new Error("index must be >= 0.");if(!e)throw new Error("name cannot be null.");if(!i)throw new Error("boneData cannot be null.");this.index=t,this.name=e,this.boneData=i}}var ms;(function(s){s[s.Normal=0]="Normal",s[s.Additive=1]="Additive",s[s.Multiply=2]="Multiply",s[s.Screen=3]="Screen"})(ms||(ms={}));class Wp extends Mc{set target(t){this._target=t}get target(){if(this._target)return this._target;throw new Error("BoneData not set.")}constructor(t){super(t,0,!1),this.bones=new Array,this._target=null,this.mixRotate=0,this.mixX=0,this.mixY=0,this.mixScaleX=0,this.mixScaleY=0,this.mixShearY=0,this.offsetRotation=0,this.offsetX=0,this.offsetY=0,this.offsetScaleX=0,this.offsetScaleY=0,this.offsetShearY=0,this.relative=!1,this.local=!1}}class Iy{constructor(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}readSkeletonData(t){let e=this.scale,i=new Xp;i.name="";let r=new Fy(t),n=r.readInt32(),a=r.readInt32();i.hash=a==0&&n==0?null:a.toString(16)+n.toString(16),i.version=r.readString(),i.x=r.readFloat(),i.y=r.readFloat(),i.width=r.readFloat(),i.height=r.readFloat();let o=r.readBoolean();o&&(i.fps=r.readFloat(),i.imagesPath=r.readString(),i.audioPath=r.readString());let h=0;h=r.readInt(!0);for(let c=0;c<h;c++){let u=r.readString();if(!u)throw new Error("String in string table must not be null.");r.strings.push(u)}h=r.readInt(!0);for(let c=0;c<h;c++){let u=r.readString();if(!u)throw new Error("Bone name must not be null.");let d=c==0?null:i.bones[r.readInt(!0)],f=new Dp(c,u,d);f.rotation=r.readFloat(),f.x=r.readFloat()*e,f.y=r.readFloat()*e,f.scaleX=r.readFloat(),f.scaleY=r.readFloat(),f.shearX=r.readFloat(),f.shearY=r.readFloat(),f.length=r.readFloat()*e,f.transformMode=r.readInt(!0),f.skinRequired=r.readBoolean(),o&&tt.rgba8888ToColor(f.color,r.readInt32()),i.bones.push(f)}h=r.readInt(!0);for(let c=0;c<h;c++){let u=r.readString();if(!u)throw new Error("Slot name must not be null.");let d=i.bones[r.readInt(!0)],f=new $p(c,u,d);tt.rgba8888ToColor(f.color,r.readInt32());let p=r.readInt32();p!=-1&&tt.rgb888ToColor(f.darkColor=new tt,p),f.attachmentName=r.readStringRef(),f.blendMode=r.readInt(!0),i.slots.push(f)}h=r.readInt(!0);for(let c=0,u;c<h;c++){let d=r.readString();if(!d)throw new Error("IK constraint data name must not be null.");let f=new zp(d);f.order=r.readInt(!0),f.skinRequired=r.readBoolean(),u=r.readInt(!0);for(let p=0;p<u;p++)f.bones.push(i.bones[r.readInt(!0)]);f.target=i.bones[r.readInt(!0)],f.mix=r.readFloat(),f.softness=r.readFloat()*e,f.bendDirection=r.readByte(),f.compress=r.readBoolean(),f.stretch=r.readBoolean(),f.uniform=r.readBoolean(),i.ikConstraints.push(f)}h=r.readInt(!0);for(let c=0,u;c<h;c++){let d=r.readString();if(!d)throw new Error("Transform constraint data name must not be null.");let f=new Wp(d);f.order=r.readInt(!0),f.skinRequired=r.readBoolean(),u=r.readInt(!0);for(let p=0;p<u;p++)f.bones.push(i.bones[r.readInt(!0)]);f.target=i.bones[r.readInt(!0)],f.local=r.readBoolean(),f.relative=r.readBoolean(),f.offsetRotation=r.readFloat(),f.offsetX=r.readFloat()*e,f.offsetY=r.readFloat()*e,f.offsetScaleX=r.readFloat(),f.offsetScaleY=r.readFloat(),f.offsetShearY=r.readFloat(),f.mixRotate=r.readFloat(),f.mixX=r.readFloat(),f.mixY=r.readFloat(),f.mixScaleX=r.readFloat(),f.mixScaleY=r.readFloat(),f.mixShearY=r.readFloat(),i.transformConstraints.push(f)}h=r.readInt(!0);for(let c=0,u;c<h;c++){let d=r.readString();if(!d)throw new Error("Path constraint data name must not be null.");let f=new Hp(d);f.order=r.readInt(!0),f.skinRequired=r.readBoolean(),u=r.readInt(!0);for(let p=0;p<u;p++)f.bones.push(i.bones[r.readInt(!0)]);f.target=i.slots[r.readInt(!0)],f.positionMode=r.readInt(!0),f.spacingMode=r.readInt(!0),f.rotateMode=r.readInt(!0),f.offsetRotation=r.readFloat(),f.position=r.readFloat(),f.positionMode==Bi.Fixed&&(f.position*=e),f.spacing=r.readFloat(),(f.spacingMode==ie.Length||f.spacingMode==ie.Fixed)&&(f.spacing*=e),f.mixRotate=r.readFloat(),f.mixX=r.readFloat(),f.mixY=r.readFloat(),i.pathConstraints.push(f)}let l=this.readSkin(r,i,!0,o);l&&(i.defaultSkin=l,i.skins.push(l));{let c=i.skins.length;for(Y.setArraySize(i.skins,h=c+r.readInt(!0));c<h;c++){let u=this.readSkin(r,i,!1,o);if(!u)throw new Error("readSkin() should not have returned null.");i.skins[c]=u}}h=this.linkedMeshes.length;for(let c=0;c<h;c++){let u=this.linkedMeshes[c],d=u.skin?i.findSkin(u.skin):i.defaultSkin;if(!d)throw new Error("Not skin found for linked mesh.");if(!u.parent)throw new Error("Linked mesh parent must not be null");let f=d.getAttachment(u.slotIndex,u.parent);if(!f)throw new Error(`Parent mesh not found: ${u.parent}`);u.mesh.timelineAttachment=u.inheritTimeline?f:u.mesh,u.mesh.setParentMesh(f),u.mesh.region!=null&&u.mesh.updateRegion()}this.linkedMeshes.length=0,h=r.readInt(!0);for(let c=0;c<h;c++){let u=r.readStringRef();if(!u)throw new Error;let d=new Vp(u);d.intValue=r.readInt(!1),d.floatValue=r.readFloat(),d.stringValue=r.readString(),d.audioPath=r.readString(),d.audioPath&&(d.volume=r.readFloat(),d.balance=r.readFloat()),i.events.push(d)}h=r.readInt(!0);for(let c=0;c<h;c++){let u=r.readString();if(!u)throw new Error("Animatio name must not be null.");i.animations.push(this.readAnimation(r,u,i))}return i}readSkin(t,e,i,r){let n=null,a=0;if(i){if(a=t.readInt(!0),a==0)return null;n=new vl("default")}else{let o=t.readStringRef();if(!o)throw new Error("Skin name must not be null.");n=new vl(o),n.bones.length=t.readInt(!0);for(let h=0,l=n.bones.length;h<l;h++)n.bones[h]=e.bones[t.readInt(!0)];for(let h=0,l=t.readInt(!0);h<l;h++)n.constraints.push(e.ikConstraints[t.readInt(!0)]);for(let h=0,l=t.readInt(!0);h<l;h++)n.constraints.push(e.transformConstraints[t.readInt(!0)]);for(let h=0,l=t.readInt(!0);h<l;h++)n.constraints.push(e.pathConstraints[t.readInt(!0)]);a=t.readInt(!0)}for(let o=0;o<a;o++){let h=t.readInt(!0);for(let l=0,c=t.readInt(!0);l<c;l++){let u=t.readStringRef();if(!u)throw new Error("Attachment name must not be null");let d=this.readAttachment(t,e,n,h,u,r);d&&n.setAttachment(h,u,d)}}return n}readAttachment(t,e,i,r,n,a){let o=this.scale,h=t.readStringRef();switch(h||(h=n),t.readByte()){case Wi.Region:{let l=t.readStringRef(),c=t.readFloat(),u=t.readFloat(),d=t.readFloat(),f=t.readFloat(),p=t.readFloat(),m=t.readFloat(),g=t.readFloat(),x=t.readInt32(),y=this.readSequence(t);l||(l=h);let b=this.attachmentLoader.newRegionAttachment(i,h,l,y);return b?(b.path=l,b.x=u*o,b.y=d*o,b.scaleX=f,b.scaleY=p,b.rotation=c,b.width=m*o,b.height=g*o,tt.rgba8888ToColor(b.color,x),b.sequence=y,y==null&&b.updateRegion(),b):null}case Wi.BoundingBox:{let l=t.readInt(!0),c=this.readVertices(t,l),u=a?t.readInt32():0,d=this.attachmentLoader.newBoundingBoxAttachment(i,h);return d?(d.worldVerticesLength=l<<1,d.vertices=c.vertices,d.bones=c.bones,a&&tt.rgba8888ToColor(d.color,u),d):null}case Wi.Mesh:{let l=t.readStringRef(),c=t.readInt32(),u=t.readInt(!0),d=this.readFloatArray(t,u<<1,1),f=this.readShortArray(t),p=this.readVertices(t,u),m=t.readInt(!0),g=this.readSequence(t),x=[],y=0,b=0;a&&(x=this.readShortArray(t),y=t.readFloat(),b=t.readFloat()),l||(l=h);let v=this.attachmentLoader.newMeshAttachment(i,h,l,g);return v?(v.path=l,tt.rgba8888ToColor(v.color,c),v.bones=p.bones,v.vertices=p.vertices,v.worldVerticesLength=u<<1,v.triangles=f,v.regionUVs=d,g==null&&v.updateRegion(),v.hullLength=m<<1,v.sequence=g,a&&(v.edges=x,v.width=y*o,v.height=b*o),v):null}case Wi.LinkedMesh:{let l=t.readStringRef(),c=t.readInt32(),u=t.readStringRef(),d=t.readStringRef(),f=t.readBoolean(),p=this.readSequence(t),m=0,g=0;a&&(m=t.readFloat(),g=t.readFloat()),l||(l=h);let x=this.attachmentLoader.newMeshAttachment(i,h,l,p);return x?(x.path=l,tt.rgba8888ToColor(x.color,c),x.sequence=p,a&&(x.width=m*o,x.height=g*o),this.linkedMeshes.push(new Uy(x,u,r,d,f)),x):null}case Wi.Path:{let l=t.readBoolean(),c=t.readBoolean(),u=t.readInt(!0),d=this.readVertices(t,u),f=Y.newArray(u/3,0);for(let g=0,x=f.length;g<x;g++)f[g]=t.readFloat()*o;let p=a?t.readInt32():0,m=this.attachmentLoader.newPathAttachment(i,h);return m?(m.closed=l,m.constantSpeed=c,m.worldVerticesLength=u<<1,m.vertices=d.vertices,m.bones=d.bones,m.lengths=f,a&&tt.rgba8888ToColor(m.color,p),m):null}case Wi.Point:{let l=t.readFloat(),c=t.readFloat(),u=t.readFloat(),d=a?t.readInt32():0,f=this.attachmentLoader.newPointAttachment(i,h);return f?(f.x=c*o,f.y=u*o,f.rotation=l,a&&tt.rgba8888ToColor(f.color,d),f):null}case Wi.Clipping:{let l=t.readInt(!0),c=t.readInt(!0),u=this.readVertices(t,c),d=a?t.readInt32():0,f=this.attachmentLoader.newClippingAttachment(i,h);return f?(f.endSlot=e.slots[l],f.worldVerticesLength=c<<1,f.vertices=u.vertices,f.bones=u.bones,a&&tt.rgba8888ToColor(f.color,d),f):null}}return null}readSequence(t){if(!t.readBoolean())return null;let e=new Br(t.readInt(!0));return e.start=t.readInt(!0),e.digits=t.readInt(!0),e.setupIndex=t.readInt(!0),e}readVertices(t,e){let i=this.scale,r=e<<1,n=new Ly;if(!t.readBoolean())return n.vertices=this.readFloatArray(t,r,i),n;let a=new Array,o=new Array;for(let h=0;h<e;h++){let l=t.readInt(!0);o.push(l);for(let c=0;c<l;c++)o.push(t.readInt(!0)),a.push(t.readFloat()*i),a.push(t.readFloat()*i),a.push(t.readFloat())}return n.vertices=Y.toFloatArray(a),n.bones=o,n}readFloatArray(t,e,i){let r=new Array(e);if(i==1)for(let n=0;n<e;n++)r[n]=t.readFloat();else for(let n=0;n<e;n++)r[n]=t.readFloat()*i;return r}readShortArray(t){let e=t.readInt(!0),i=new Array(e);for(let r=0;r<e;r++)i[r]=t.readShort();return i}readAnimation(t,e,i){t.readInt(!0);let r=new Array,n=this.scale;new tt,new tt;for(let l=0,c=t.readInt(!0);l<c;l++){let u=t.readInt(!0);for(let d=0,f=t.readInt(!0);d<f;d++){let p=t.readByte(),m=t.readInt(!0),g=m-1;switch(p){case Yy:{let x=new Sr(m,u);for(let y=0;y<m;y++)x.setFrame(y,t.readFloat(),t.readStringRef());r.push(x);break}case jy:{let x=t.readInt(!0),y=new Ep(m,x,u),b=t.readFloat(),v=t.readUnsignedByte()/255,_=t.readUnsignedByte()/255,w=t.readUnsignedByte()/255,T=t.readUnsignedByte()/255;for(let S=0,C=0;y.setFrame(S,b,v,_,w,T),S!=g;S++){let E=t.readFloat(),M=t.readUnsignedByte()/255,N=t.readUnsignedByte()/255,R=t.readUnsignedByte()/255,I=t.readUnsignedByte()/255;switch(t.readByte()){case ai:y.setStepped(S);break;case oi:dt(t,y,C++,S,0,b,E,v,M,1),dt(t,y,C++,S,1,b,E,_,N,1),dt(t,y,C++,S,2,b,E,w,R,1),dt(t,y,C++,S,3,b,E,T,I,1)}b=E,v=M,_=N,w=R,T=I}r.push(y);break}case qy:{let x=t.readInt(!0),y=new Pp(m,x,u),b=t.readFloat(),v=t.readUnsignedByte()/255,_=t.readUnsignedByte()/255,w=t.readUnsignedByte()/255;for(let T=0,S=0;y.setFrame(T,b,v,_,w),T!=g;T++){let C=t.readFloat(),E=t.readUnsignedByte()/255,M=t.readUnsignedByte()/255,N=t.readUnsignedByte()/255;switch(t.readByte()){case ai:y.setStepped(T);break;case oi:dt(t,y,S++,T,0,b,C,v,E,1),dt(t,y,S++,T,1,b,C,_,M,1),dt(t,y,S++,T,2,b,C,w,N,1)}b=C,v=E,_=M,w=N}r.push(y);break}case Ky:{let x=t.readInt(!0),y=new kp(m,x,u),b=t.readFloat(),v=t.readUnsignedByte()/255,_=t.readUnsignedByte()/255,w=t.readUnsignedByte()/255,T=t.readUnsignedByte()/255,S=t.readUnsignedByte()/255,C=t.readUnsignedByte()/255,E=t.readUnsignedByte()/255;for(let M=0,N=0;y.setFrame(M,b,v,_,w,T,S,C,E),M!=g;M++){let R=t.readFloat(),I=t.readUnsignedByte()/255,k=t.readUnsignedByte()/255,B=t.readUnsignedByte()/255,z=t.readUnsignedByte()/255,Z=t.readUnsignedByte()/255,G=t.readUnsignedByte()/255,O=t.readUnsignedByte()/255;switch(t.readByte()){case ai:y.setStepped(M);break;case oi:dt(t,y,N++,M,0,b,R,v,I,1),dt(t,y,N++,M,1,b,R,_,k,1),dt(t,y,N++,M,2,b,R,w,B,1),dt(t,y,N++,M,3,b,R,T,z,1),dt(t,y,N++,M,4,b,R,S,Z,1),dt(t,y,N++,M,5,b,R,C,G,1),dt(t,y,N++,M,6,b,R,E,O,1)}b=R,v=I,_=k,w=B,T=z,S=Z,C=G,E=O}r.push(y);break}case Zy:{let x=t.readInt(!0),y=new Rp(m,x,u),b=t.readFloat(),v=t.readUnsignedByte()/255,_=t.readUnsignedByte()/255,w=t.readUnsignedByte()/255,T=t.readUnsignedByte()/255,S=t.readUnsignedByte()/255,C=t.readUnsignedByte()/255;for(let E=0,M=0;y.setFrame(E,b,v,_,w,T,S,C),E!=g;E++){let N=t.readFloat(),R=t.readUnsignedByte()/255,I=t.readUnsignedByte()/255,k=t.readUnsignedByte()/255,B=t.readUnsignedByte()/255,z=t.readUnsignedByte()/255,Z=t.readUnsignedByte()/255;switch(t.readByte()){case ai:y.setStepped(E);break;case oi:dt(t,y,M++,E,0,b,N,v,R,1),dt(t,y,M++,E,1,b,N,_,I,1),dt(t,y,M++,E,2,b,N,w,k,1),dt(t,y,M++,E,3,b,N,T,B,1),dt(t,y,M++,E,4,b,N,S,z,1),dt(t,y,M++,E,5,b,N,C,Z,1)}b=N,v=R,_=I,w=k,T=B,S=z,C=Z}r.push(y);break}case Jy:{let x=new Mp(m,t.readInt(!0),u),y=t.readFloat(),b=t.readUnsignedByte()/255;for(let v=0,_=0;x.setFrame(v,y,b),v!=g;v++){let w=t.readFloat(),T=t.readUnsignedByte()/255;switch(t.readByte()){case ai:x.setStepped(v);break;case oi:dt(t,x,_++,v,0,y,w,b,T,1)}y=w,b=T}r.push(x)}}}}for(let l=0,c=t.readInt(!0);l<c;l++){let u=t.readInt(!0);for(let d=0,f=t.readInt(!0);d<f;d++){let p=t.readByte(),m=t.readInt(!0),g=t.readInt(!0);switch(p){case Oy:r.push(Hi(t,new Qa(m,g,u),1));break;case Ny:r.push(hh(t,new yp(m,g,u),n));break;case Dy:r.push(Hi(t,new xp(m,g,u),n));break;case Gy:r.push(Hi(t,new vp(m,g,u),n));break;case Vy:r.push(hh(t,new _p(m,g,u),1));break;case zy:r.push(Hi(t,new wp(m,g,u),1));break;case Hy:r.push(Hi(t,new Tp(m,g,u),1));break;case Xy:r.push(hh(t,new Sp(m,g,u),1));break;case $y:r.push(Hi(t,new Cp(m,g,u),1));break;case Wy:r.push(Hi(t,new Ap(m,g,u),1))}}}for(let l=0,c=t.readInt(!0);l<c;l++){let u=t.readInt(!0),d=t.readInt(!0),f=d-1,p=new Ip(d,t.readInt(!0),u),m=t.readFloat(),g=t.readFloat(),x=t.readFloat()*n;for(let y=0,b=0;p.setFrame(y,m,g,x,t.readByte(),t.readBoolean(),t.readBoolean()),y!=f;y++){let v=t.readFloat(),_=t.readFloat(),w=t.readFloat()*n;switch(t.readByte()){case ai:p.setStepped(y);break;case oi:dt(t,p,b++,y,0,m,v,g,_,1),dt(t,p,b++,y,1,m,v,x,w,n)}m=v,g=_,x=w}r.push(p)}for(let l=0,c=t.readInt(!0);l<c;l++){let u=t.readInt(!0),d=t.readInt(!0),f=d-1,p=new Fp(d,t.readInt(!0),u),m=t.readFloat(),g=t.readFloat(),x=t.readFloat(),y=t.readFloat(),b=t.readFloat(),v=t.readFloat(),_=t.readFloat();for(let w=0,T=0;p.setFrame(w,m,g,x,y,b,v,_),w!=f;w++){let S=t.readFloat(),C=t.readFloat(),E=t.readFloat(),M=t.readFloat(),N=t.readFloat(),R=t.readFloat(),I=t.readFloat();switch(t.readByte()){case ai:p.setStepped(w);break;case oi:dt(t,p,T++,w,0,m,S,g,C,1),dt(t,p,T++,w,1,m,S,x,E,1),dt(t,p,T++,w,2,m,S,y,M,1),dt(t,p,T++,w,3,m,S,b,N,1),dt(t,p,T++,w,4,m,S,v,R,1),dt(t,p,T++,w,5,m,S,_,I,1)}m=S,g=C,x=E,y=M,b=N,v=R,_=I}r.push(p)}for(let l=0,c=t.readInt(!0);l<c;l++){let u=t.readInt(!0),d=i.pathConstraints[u];for(let f=0,p=t.readInt(!0);f<p;f++)switch(t.readByte()){case ex:r.push(Hi(t,new Up(t.readInt(!0),t.readInt(!0),u),d.positionMode==Bi.Fixed?n:1));break;case ix:r.push(Hi(t,new Lp(t.readInt(!0),t.readInt(!0),u),d.spacingMode==ie.Length||d.spacingMode==ie.Fixed?n:1));break;case sx:let m=new Op(t.readInt(!0),t.readInt(!0),u),g=t.readFloat(),x=t.readFloat(),y=t.readFloat(),b=t.readFloat();for(let v=0,_=0,w=m.getFrameCount()-1;m.setFrame(v,g,x,y,b),v!=w;v++){let T=t.readFloat(),S=t.readFloat(),C=t.readFloat(),E=t.readFloat();switch(t.readByte()){case ai:m.setStepped(v);break;case oi:dt(t,m,_++,v,0,g,T,x,S,1),dt(t,m,_++,v,1,g,T,y,C,1),dt(t,m,_++,v,2,g,T,b,E,1)}g=T,x=S,y=C,b=E}r.push(m)}}for(let l=0,c=t.readInt(!0);l<c;l++){let u=i.skins[t.readInt(!0)];for(let d=0,f=t.readInt(!0);d<f;d++){let p=t.readInt(!0);for(let m=0,g=t.readInt(!0);m<g;m++){let x=t.readStringRef();if(!x)throw new Error("attachmentName must not be null.");let y=u.getAttachment(p,x),b=t.readByte(),v=t.readInt(!0),_=v-1;switch(b){case Qy:{let w=y,T=w.bones,S=w.vertices,C=T?S.length/3*2:S.length,E=t.readInt(!0),M=new Bp(v,E,p,w),N=t.readFloat();for(let R=0,I=0;;R++){let k,B=t.readInt(!0);if(B==0)k=T?Y.newFloatArray(C):S;else{k=Y.newFloatArray(C);let Z=t.readInt(!0);if(B+=Z,n==1)for(let G=Z;G<B;G++)k[G]=t.readFloat();else for(let G=Z;G<B;G++)k[G]=t.readFloat()*n;if(!T)for(let G=0,O=k.length;G<O;G++)k[G]+=S[G]}if(M.setFrame(R,N,k),R==_)break;let z=t.readFloat();switch(t.readByte()){case ai:M.setStepped(R);break;case oi:dt(t,M,I++,R,0,N,z,0,1,1)}N=z}r.push(M);break}case tx:{let w=new Le(v,p,y);for(let T=0;T<v;T++){let S=t.readFloat(),C=t.readInt32();w.setFrame(T,S,bp[C&15],C>>4,t.readFloat())}r.push(w);break}}}}}let a=t.readInt(!0);if(a>0){let l=new vs(a),c=i.slots.length;for(let u=0;u<a;u++){let d=t.readFloat(),f=t.readInt(!0),p=Y.newArray(c,0);for(let y=c-1;y>=0;y--)p[y]=-1;let m=Y.newArray(c-f,0),g=0,x=0;for(let y=0;y<f;y++){let b=t.readInt(!0);for(;g!=b;)m[x++]=g++;p[g+t.readInt(!0)]=g++}for(;g<c;)m[x++]=g++;for(let y=c-1;y>=0;y--)p[y]==-1&&(p[y]=m[--x]);l.setFrame(u,d,p)}r.push(l)}let o=t.readInt(!0);if(o>0){let l=new an(o);for(let c=0;c<o;c++){let u=t.readFloat(),d=i.events[t.readInt(!0)],f=new Gp(u,d);f.intValue=t.readInt(!1),f.floatValue=t.readFloat(),f.stringValue=t.readBoolean()?t.readString():d.stringValue,f.data.audioPath&&(f.volume=t.readFloat(),f.balance=t.readFloat()),l.setFrame(c,f)}r.push(l)}let h=0;for(let l=0,c=r.length;l<c;l++)h=Math.max(h,r[l].getDuration());return new Cc(e,r,h)}}class Fy{constructor(t,e=new Array,i=0,r=new DataView(t.buffer)){this.strings=e,this.index=i,this.buffer=r}readByte(){return this.buffer.getInt8(this.index++)}readUnsignedByte(){return this.buffer.getUint8(this.index++)}readShort(){let t=this.buffer.getInt16(this.index);return this.index+=2,t}readInt32(){let t=this.buffer.getInt32(this.index);return this.index+=4,t}readInt(t){let e=this.readByte(),i=e&127;return e&128&&(e=this.readByte(),i|=(e&127)<<7,e&128&&(e=this.readByte(),i|=(e&127)<<14,e&128&&(e=this.readByte(),i|=(e&127)<<21,e&128&&(e=this.readByte(),i|=(e&127)<<28)))),t?i:i>>>1^-(i&1)}readStringRef(){let t=this.readInt(!0);return t==0?null:this.strings[t-1]}readString(){let t=this.readInt(!0);switch(t){case 0:return null;case 1:return""}t--;let e="";for(let i=0;i<t;){let r=this.readUnsignedByte();switch(r>>4){case 12:case 13:e+=String.fromCharCode((r&31)<<6|this.readByte()&63),i+=2;break;case 14:e+=String.fromCharCode((r&15)<<12|(this.readByte()&63)<<6|this.readByte()&63),i+=3;break;default:e+=String.fromCharCode(r),i++}}return e}readFloat(){let t=this.buffer.getFloat32(this.index);return this.index+=4,t}readBoolean(){return this.readByte()!=0}}let Uy=class{constructor(t,e,i,r,n){this.mesh=t,this.skin=e,this.slotIndex=i,this.parent=r,this.inheritTimeline=n}};class Ly{constructor(t=null,e=null){this.bones=t,this.vertices=e}}var Wi;(function(s){s[s.Region=0]="Region",s[s.BoundingBox=1]="BoundingBox",s[s.Mesh=2]="Mesh",s[s.LinkedMesh=3]="LinkedMesh",s[s.Path=4]="Path",s[s.Point=5]="Point",s[s.Clipping=6]="Clipping"})(Wi||(Wi={}));function Hi(s,t,e){let i=s.readFloat(),r=s.readFloat()*e;for(let n=0,a=0,o=t.getFrameCount()-1;t.setFrame(n,i,r),n!=o;n++){let h=s.readFloat(),l=s.readFloat()*e;switch(s.readByte()){case ai:t.setStepped(n);break;case oi:dt(s,t,a++,n,0,i,h,r,l,e)}i=h,r=l}return t}function hh(s,t,e){let i=s.readFloat(),r=s.readFloat()*e,n=s.readFloat()*e;for(let a=0,o=0,h=t.getFrameCount()-1;t.setFrame(a,i,r,n),a!=h;a++){let l=s.readFloat(),c=s.readFloat()*e,u=s.readFloat()*e;switch(s.readByte()){case ai:t.setStepped(a);break;case oi:dt(s,t,o++,a,0,i,l,r,c,e),dt(s,t,o++,a,1,i,l,n,u,e)}i=l,r=c,n=u}return t}function dt(s,t,e,i,r,n,a,o,h,l){t.setBezier(e,i,r,n,o,s.readFloat(),s.readFloat()*l,s.readFloat(),s.readFloat()*l,a,h)}const Oy=0,Ny=1,Dy=2,Gy=3,Vy=4,zy=5,Hy=6,Xy=7,$y=8,Wy=9,Yy=0,jy=1,qy=2,Ky=3,Zy=4,Jy=5,Qy=0,tx=1,ex=0,ix=1,sx=2,ai=1,oi=2;class Ce{constructor(){this.convexPolygons=new Array,this.convexPolygonsIndices=new Array,this.indicesArray=new Array,this.isConcaveArray=new Array,this.triangles=new Array,this.polygonPool=new xl(()=>new Array),this.polygonIndicesPool=new xl(()=>new Array)}triangulate(t){let e=t,i=t.length>>1,r=this.indicesArray;r.length=0;for(let o=0;o<i;o++)r[o]=o;let n=this.isConcaveArray;n.length=0;for(let o=0,h=i;o<h;++o)n[o]=Ce.isConcave(o,i,e,r);let a=this.triangles;for(a.length=0;i>3;){let o=i-1,h=0,l=1;for(;;){t:if(!n[h]){let d=r[o]<<1,f=r[h]<<1,p=r[l]<<1,m=e[d],g=e[d+1],x=e[f],y=e[f+1],b=e[p],v=e[p+1];for(let _=(l+1)%i;_!=o;_=(_+1)%i){if(!n[_])continue;let w=r[_]<<1,T=e[w],S=e[w+1];if(Ce.positiveArea(b,v,m,g,T,S)&&Ce.positiveArea(m,g,x,y,T,S)&&Ce.positiveArea(x,y,b,v,T,S))break t}break}if(l==0){do{if(!n[h])break;h--}while(h>0);break}o=h,h=l,l=(l+1)%i}a.push(r[(i+h-1)%i]),a.push(r[h]),a.push(r[(h+1)%i]),r.splice(h,1),n.splice(h,1),i--;let c=(i+h-1)%i,u=h==i?0:h;n[c]=Ce.isConcave(c,i,e,r),n[u]=Ce.isConcave(u,i,e,r)}return i==3&&(a.push(r[2]),a.push(r[0]),a.push(r[1])),a}decompose(t,e){let i=t,r=this.convexPolygons;this.polygonPool.freeAll(r),r.length=0;let n=this.convexPolygonsIndices;this.polygonIndicesPool.freeAll(n),n.length=0;let a=this.polygonIndicesPool.obtain();a.length=0;let o=this.polygonPool.obtain();o.length=0;let h=-1,l=0;for(let c=0,u=e.length;c<u;c+=3){let d=e[c]<<1,f=e[c+1]<<1,p=e[c+2]<<1,m=i[d],g=i[d+1],x=i[f],y=i[f+1],b=i[p],v=i[p+1],_=!1;if(h==d){let w=o.length-4,T=Ce.winding(o[w],o[w+1],o[w+2],o[w+3],b,v),S=Ce.winding(b,v,o[0],o[1],o[2],o[3]);T==l&&S==l&&(o.push(b),o.push(v),a.push(p),_=!0)}_||(o.length>0?(r.push(o),n.push(a)):(this.polygonPool.free(o),this.polygonIndicesPool.free(a)),o=this.polygonPool.obtain(),o.length=0,o.push(m),o.push(g),o.push(x),o.push(y),o.push(b),o.push(v),a=this.polygonIndicesPool.obtain(),a.length=0,a.push(d),a.push(f),a.push(p),l=Ce.winding(m,g,x,y,b,v),h=d)}o.length>0&&(r.push(o),n.push(a));for(let c=0,u=r.length;c<u;c++){if(a=n[c],a.length==0)continue;let d=a[0],f=a[a.length-1];o=r[c];let p=o.length-4,m=o[p],g=o[p+1],x=o[p+2],y=o[p+3],b=o[0],v=o[1],_=o[2],w=o[3],T=Ce.winding(m,g,x,y,b,v);for(let S=0;S<u;S++){if(S==c)continue;let C=n[S];if(C.length!=3)continue;let E=C[0],M=C[1],N=C[2],R=r[S],I=R[R.length-2],k=R[R.length-1];if(E!=d||M!=f)continue;let B=Ce.winding(m,g,x,y,I,k),z=Ce.winding(I,k,b,v,_,w);B==T&&z==T&&(R.length=0,C.length=0,o.push(I),o.push(k),a.push(N),m=x,g=y,x=I,y=k,S=0)}}for(let c=r.length-1;c>=0;c--)o=r[c],o.length==0&&(r.splice(c,1),this.polygonPool.free(o),a=n[c],n.splice(c,1),this.polygonIndicesPool.free(a));return r}static isConcave(t,e,i,r){let n=r[(e+t-1)%e]<<1,a=r[t]<<1,o=r[(t+1)%e]<<1;return!this.positiveArea(i[n],i[n+1],i[a],i[a+1],i[o],i[o+1])}static positiveArea(t,e,i,r,n,a){return t*(a-r)+i*(e-a)+n*(r-e)>=0}static winding(t,e,i,r,n,a){let o=i-t,h=r-e;return n*h-a*o+o*e-t*h>=0?1:-1}}class to{constructor(){this.triangulator=new Ce,this.clippingPolygon=new Array,this.clipOutput=new Array,this.clippedVertices=new Array,this.clippedTriangles=new Array,this.scratch=new Array,this.clipAttachment=null,this.clippingPolygons=null}clipStart(t,e){if(this.clipAttachment)return 0;this.clipAttachment=e;let i=e.worldVerticesLength,r=Y.setArraySize(this.clippingPolygon,i);e.computeWorldVertices(t,0,i,r,0,2);let n=this.clippingPolygon;to.makeClockwise(n);let a=this.clippingPolygons=this.triangulator.decompose(n,this.triangulator.triangulate(n));for(let o=0,h=a.length;o<h;o++){let l=a[o];to.makeClockwise(l),l.push(l[0]),l.push(l[1])}return a.length}clipEndWithSlot(t){this.clipAttachment&&this.clipAttachment.endSlot==t.data&&this.clipEnd()}clipEnd(){this.clipAttachment&&(this.clipAttachment=null,this.clippingPolygons=null,this.clippedVertices.length=0,this.clippedTriangles.length=0,this.clippingPolygon.length=0)}isClipping(){return this.clipAttachment!=null}clipTriangles(t,e,i,r,n,a,o,h){let l=this.clipOutput,c=this.clippedVertices,u=this.clippedTriangles,d=this.clippingPolygons,f=d.length,p=h?12:8,m=0;c.length=0,u.length=0;t:for(let g=0;g<r;g+=3){let x=i[g]<<1,y=t[x],b=t[x+1],v=n[x],_=n[x+1];x=i[g+1]<<1;let w=t[x],T=t[x+1],S=n[x],C=n[x+1];x=i[g+2]<<1;let E=t[x],M=t[x+1],N=n[x],R=n[x+1];for(let I=0;I<f;I++){let k=c.length;if(this.clip(y,b,w,T,E,M,d[I],l)){let B=l.length;if(B==0)continue;let z=T-M,Z=E-w,G=y-E,O=M-b,X=1/(z*G+Z*(b-M)),V=B>>1,$=this.clipOutput,H=Y.setArraySize(c,k+V*p);for(let nt=0;nt<B;nt+=2){let St=$[nt],ut=$[nt+1];H[k]=St,H[k+1]=ut,H[k+2]=a.r,H[k+3]=a.g,H[k+4]=a.b,H[k+5]=a.a;let _t=St-E,ht=ut-M,At=(z*_t+Z*ht)*X,Ut=(O*_t+G*ht)*X,Ht=1-At-Ut;H[k+6]=v*At+S*Ut+N*Ht,H[k+7]=_*At+C*Ut+R*Ht,h&&(H[k+8]=o.r,H[k+9]=o.g,H[k+10]=o.b,H[k+11]=o.a),k+=p}k=u.length;let K=Y.setArraySize(u,k+3*(V-2));V--;for(let nt=1;nt<V;nt++)K[k]=m,K[k+1]=m+nt,K[k+2]=m+nt+1,k+=3;m+=V+1}else{let B=Y.setArraySize(c,k+3*p);B[k]=y,B[k+1]=b,B[k+2]=a.r,B[k+3]=a.g,B[k+4]=a.b,B[k+5]=a.a,h?(B[k+6]=v,B[k+7]=_,B[k+8]=o.r,B[k+9]=o.g,B[k+10]=o.b,B[k+11]=o.a,B[k+12]=w,B[k+13]=T,B[k+14]=a.r,B[k+15]=a.g,B[k+16]=a.b,B[k+17]=a.a,B[k+18]=S,B[k+19]=C,B[k+20]=o.r,B[k+21]=o.g,B[k+22]=o.b,B[k+23]=o.a,B[k+24]=E,B[k+25]=M,B[k+26]=a.r,B[k+27]=a.g,B[k+28]=a.b,B[k+29]=a.a,B[k+30]=N,B[k+31]=R,B[k+32]=o.r,B[k+33]=o.g,B[k+34]=o.b,B[k+35]=o.a):(B[k+6]=v,B[k+7]=_,B[k+8]=w,B[k+9]=T,B[k+10]=a.r,B[k+11]=a.g,B[k+12]=a.b,B[k+13]=a.a,B[k+14]=S,B[k+15]=C,B[k+16]=E,B[k+17]=M,B[k+18]=a.r,B[k+19]=a.g,B[k+20]=a.b,B[k+21]=a.a,B[k+22]=N,B[k+23]=R),k=u.length;let z=Y.setArraySize(u,k+3);z[k]=m,z[k+1]=m+1,z[k+2]=m+2,m+=3;continue t}}}}clip(t,e,i,r,n,a,o,h){let l=h,c=!1,u;o.length%4>=2?(u=h,h=this.scratch):u=this.scratch,u.length=0,u.push(t),u.push(e),u.push(i),u.push(r),u.push(n),u.push(a),u.push(t),u.push(e),h.length=0;let d=o,f=o.length-4;for(let p=0;;p+=2){let m=d[p],g=d[p+1],x=d[p+2],y=d[p+3],b=m-x,v=g-y,_=u,w=u.length-2,T=h.length;for(let C=0;C<w;C+=2){let E=_[C],M=_[C+1],N=_[C+2],R=_[C+3],I=b*(R-y)-v*(N-x)>0;if(b*(M-y)-v*(E-x)>0){if(I){h.push(N),h.push(R);continue}let k=R-M,B=N-E,z=k*(x-m)-B*(y-g);if(Math.abs(z)>1e-6){let Z=(B*(g-M)-k*(m-E))/z;h.push(m+(x-m)*Z),h.push(g+(y-g)*Z)}else h.push(m),h.push(g)}else if(I){let k=R-M,B=N-E,z=k*(x-m)-B*(y-g);if(Math.abs(z)>1e-6){let Z=(B*(g-M)-k*(m-E))/z;h.push(m+(x-m)*Z),h.push(g+(y-g)*Z)}else h.push(m),h.push(g);h.push(N),h.push(R)}c=!0}if(T==h.length)return l.length=0,!0;if(h.push(h[0]),h.push(h[1]),p==f)break;let S=h;h=u,h.length=0,u=S}if(l!=h){l.length=0;for(let p=0,m=h.length-2;p<m;p++)l[p]=h[p]}else l.length=l.length-2;return c}static makeClockwise(t){let e=t,i=t.length,r=e[i-2]*e[1]-e[0]*e[i-1],n=0,a=0,o=0,h=0;for(let l=0,c=i-3;l<c;l+=2)n=e[l],a=e[l+1],o=e[l+2],h=e[l+3],r+=n*h-o*a;if(!(r<0))for(let l=0,c=i-2,u=i>>1;l<u;l+=2){let d=e[l],f=e[l+1],p=c-l;e[l]=e[p],e[l+1]=e[p+1],e[p]=d,e[p+1]=f}}}class rx{constructor(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}readSkeletonData(t){let e=this.scale,i=new Xp,r=typeof t=="string"?JSON.parse(t):t,n=r.skeleton;if(n&&(i.hash=n.hash,i.version=n.spine,i.x=n.x,i.y=n.y,i.width=n.width,i.height=n.height,i.fps=n.fps,i.imagesPath=n.images),r.bones)for(let a=0;a<r.bones.length;a++){let o=r.bones[a],h=null,l=F(o,"parent",null);l&&(h=i.findBone(l));let c=new Dp(i.bones.length,o.name,h);c.length=F(o,"length",0)*e,c.x=F(o,"x",0)*e,c.y=F(o,"y",0)*e,c.rotation=F(o,"rotation",0),c.scaleX=F(o,"scaleX",1),c.scaleY=F(o,"scaleY",1),c.shearX=F(o,"shearX",0),c.shearY=F(o,"shearY",0),c.transformMode=Y.enumValue(te,F(o,"transform","Normal")),c.skinRequired=F(o,"skin",!1);let u=F(o,"color",null);u&&c.color.setFromString(u),i.bones.push(c)}if(r.slots)for(let a=0;a<r.slots.length;a++){let o=r.slots[a],h=i.findBone(o.bone);if(!h)throw new Error(`Couldn't find bone ${o.bone} for slot ${o.name}`);let l=new $p(i.slots.length,o.name,h),c=F(o,"color",null);c&&l.color.setFromString(c);let u=F(o,"dark",null);u&&(l.darkColor=tt.fromString(u)),l.attachmentName=F(o,"attachment",null),l.blendMode=Y.enumValue(ms,F(o,"blend","normal")),i.slots.push(l)}if(r.ik)for(let a=0;a<r.ik.length;a++){let o=r.ik[a],h=new zp(o.name);h.order=F(o,"order",0),h.skinRequired=F(o,"skin",!1);for(let c=0;c<o.bones.length;c++){let u=i.findBone(o.bones[c]);if(!u)throw new Error(`Couldn't find bone ${o.bones[c]} for IK constraint ${o.name}.`);h.bones.push(u)}let l=i.findBone(o.target);if(!l)throw new Error(`Couldn't find target bone ${o.target} for IK constraint ${o.name}.`);h.target=l,h.mix=F(o,"mix",1),h.softness=F(o,"softness",0)*e,h.bendDirection=F(o,"bendPositive",!0)?1:-1,h.compress=F(o,"compress",!1),h.stretch=F(o,"stretch",!1),h.uniform=F(o,"uniform",!1),i.ikConstraints.push(h)}if(r.transform)for(let a=0;a<r.transform.length;a++){let o=r.transform[a],h=new Wp(o.name);h.order=F(o,"order",0),h.skinRequired=F(o,"skin",!1);for(let u=0;u<o.bones.length;u++){let d=o.bones[u],f=i.findBone(d);if(!f)throw new Error(`Couldn't find bone ${d} for transform constraint ${o.name}.`);h.bones.push(f)}let l=o.target,c=i.findBone(l);if(!c)throw new Error(`Couldn't find target bone ${l} for transform constraint ${o.name}.`);h.target=c,h.local=F(o,"local",!1),h.relative=F(o,"relative",!1),h.offsetRotation=F(o,"rotation",0),h.offsetX=F(o,"x",0)*e,h.offsetY=F(o,"y",0)*e,h.offsetScaleX=F(o,"scaleX",0),h.offsetScaleY=F(o,"scaleY",0),h.offsetShearY=F(o,"shearY",0),h.mixRotate=F(o,"mixRotate",1),h.mixX=F(o,"mixX",1),h.mixY=F(o,"mixY",h.mixX),h.mixScaleX=F(o,"mixScaleX",1),h.mixScaleY=F(o,"mixScaleY",h.mixScaleX),h.mixShearY=F(o,"mixShearY",1),i.transformConstraints.push(h)}if(r.path)for(let a=0;a<r.path.length;a++){let o=r.path[a],h=new Hp(o.name);h.order=F(o,"order",0),h.skinRequired=F(o,"skin",!1);for(let u=0;u<o.bones.length;u++){let d=o.bones[u],f=i.findBone(d);if(!f)throw new Error(`Couldn't find bone ${d} for path constraint ${o.name}.`);h.bones.push(f)}let l=o.target,c=i.findSlot(l);if(!c)throw new Error(`Couldn't find target slot ${l} for path constraint ${o.name}.`);h.target=c,h.positionMode=Y.enumValue(Bi,F(o,"positionMode","Percent")),h.spacingMode=Y.enumValue(ie,F(o,"spacingMode","Length")),h.rotateMode=Y.enumValue(qs,F(o,"rotateMode","Tangent")),h.offsetRotation=F(o,"rotation",0),h.position=F(o,"position",0),h.positionMode==Bi.Fixed&&(h.position*=e),h.spacing=F(o,"spacing",0),(h.spacingMode==ie.Length||h.spacingMode==ie.Fixed)&&(h.spacing*=e),h.mixRotate=F(o,"mixRotate",1),h.mixX=F(o,"mixX",1),h.mixY=F(o,"mixY",h.mixX),i.pathConstraints.push(h)}if(r.skins)for(let a=0;a<r.skins.length;a++){let o=r.skins[a],h=new vl(o.name);if(o.bones)for(let l=0;l<o.bones.length;l++){let c=o.bones[l],u=i.findBone(c);if(!u)throw new Error(`Couldn't find bone ${c} for skin ${o.name}.`);h.bones.push(u)}if(o.ik)for(let l=0;l<o.ik.length;l++){let c=o.ik[l],u=i.findIkConstraint(c);if(!u)throw new Error(`Couldn't find IK constraint ${c} for skin ${o.name}.`);h.constraints.push(u)}if(o.transform)for(let l=0;l<o.transform.length;l++){let c=o.transform[l],u=i.findTransformConstraint(c);if(!u)throw new Error(`Couldn't find transform constraint ${c} for skin ${o.name}.`);h.constraints.push(u)}if(o.path)for(let l=0;l<o.path.length;l++){let c=o.path[l],u=i.findPathConstraint(c);if(!u)throw new Error(`Couldn't find path constraint ${c} for skin ${o.name}.`);h.constraints.push(u)}for(let l in o.attachments){let c=i.findSlot(l);if(!c)throw new Error(`Couldn't find slot ${l} for skin ${o.name}.`);let u=o.attachments[l];for(let d in u){let f=this.readAttachment(u[d],h,c.index,d,i);f&&h.setAttachment(c.index,d,f)}}i.skins.push(h),h.name=="default"&&(i.defaultSkin=h)}for(let a=0,o=this.linkedMeshes.length;a<o;a++){let h=this.linkedMeshes[a],l=h.skin?i.findSkin(h.skin):i.defaultSkin;if(!l)throw new Error(`Skin not found: ${h.skin}`);let c=l.getAttachment(h.slotIndex,h.parent);if(!c)throw new Error(`Parent mesh not found: ${h.parent}`);h.mesh.timelineAttachment=h.inheritTimeline?c:h.mesh,h.mesh.setParentMesh(c),h.mesh.region!=null&&h.mesh.updateRegion()}if(this.linkedMeshes.length=0,r.events)for(let a in r.events){let o=r.events[a],h=new Vp(a);h.intValue=F(o,"int",0),h.floatValue=F(o,"float",0),h.stringValue=F(o,"string",""),h.audioPath=F(o,"audio",null),h.audioPath&&(h.volume=F(o,"volume",1),h.balance=F(o,"balance",0)),i.events.push(h)}if(r.animations)for(let a in r.animations){let o=r.animations[a];this.readAnimation(o,a,i)}return i}readAttachment(t,e,i,r,n){let a=this.scale;switch(r=F(t,"name",r),F(t,"type","region")){case"region":{let o=F(t,"path",r),h=this.readSequence(F(t,"sequence",null)),l=this.attachmentLoader.newRegionAttachment(e,r,o,h);if(!l)return null;l.path=o,l.x=F(t,"x",0)*a,l.y=F(t,"y",0)*a,l.scaleX=F(t,"scaleX",1),l.scaleY=F(t,"scaleY",1),l.rotation=F(t,"rotation",0),l.width=t.width*a,l.height=t.height*a,l.sequence=h;let c=F(t,"color",null);return c&&l.color.setFromString(c),l.region!=null&&l.updateRegion(),l}case"boundingbox":{let o=this.attachmentLoader.newBoundingBoxAttachment(e,r);if(!o)return null;this.readVertices(t,o,t.vertexCount<<1);let h=F(t,"color",null);return h&&o.color.setFromString(h),o}case"mesh":case"linkedmesh":{let o=F(t,"path",r),h=this.readSequence(F(t,"sequence",null)),l=this.attachmentLoader.newMeshAttachment(e,r,o,h);if(!l)return null;l.path=o;let c=F(t,"color",null);c&&l.color.setFromString(c),l.width=F(t,"width",0)*a,l.height=F(t,"height",0)*a,l.sequence=h;let u=F(t,"parent",null);if(u)return this.linkedMeshes.push(new nx(l,F(t,"skin",null),i,u,F(t,"timelines",!0))),l;let d=t.uvs;return this.readVertices(t,l,d.length),l.triangles=t.triangles,l.regionUVs=d,l.region!=null&&l.updateRegion(),l.edges=F(t,"edges",null),l.hullLength=F(t,"hull",0)*2,l}case"path":{let o=this.attachmentLoader.newPathAttachment(e,r);if(!o)return null;o.closed=F(t,"closed",!1),o.constantSpeed=F(t,"constantSpeed",!0);let h=t.vertexCount;this.readVertices(t,o,h<<1);let l=Y.newArray(h/3,0);for(let u=0;u<t.lengths.length;u++)l[u]=t.lengths[u]*a;o.lengths=l;let c=F(t,"color",null);return c&&o.color.setFromString(c),o}case"point":{let o=this.attachmentLoader.newPointAttachment(e,r);if(!o)return null;o.x=F(t,"x",0)*a,o.y=F(t,"y",0)*a,o.rotation=F(t,"rotation",0);let h=F(t,"color",null);return h&&o.color.setFromString(h),o}case"clipping":{let o=this.attachmentLoader.newClippingAttachment(e,r);if(!o)return null;let h=F(t,"end",null);h&&(o.endSlot=n.findSlot(h));let l=t.vertexCount;this.readVertices(t,o,l<<1);let c=F(t,"color",null);return c&&o.color.setFromString(c),o}}return null}readSequence(t){if(t==null)return null;let e=new Br(F(t,"count",0));return e.start=F(t,"start",1),e.digits=F(t,"digits",0),e.setupIndex=F(t,"setup",0),e}readVertices(t,e,i){let r=this.scale;e.worldVerticesLength=i;let n=t.vertices;if(i==n.length){let h=Y.toFloatArray(n);if(r!=1)for(let l=0,c=n.length;l<c;l++)h[l]*=r;e.vertices=h;return}let a=new Array,o=new Array;for(let h=0,l=n.length;h<l;){let c=n[h++];o.push(c);for(let u=h+c*4;h<u;h+=4)o.push(n[h]),a.push(n[h+1]*r),a.push(n[h+2]*r),a.push(n[h+3])}e.bones=o,e.vertices=Y.toFloatArray(a)}readAnimation(t,e,i){let r=this.scale,n=new Array;if(t.slots)for(let o in t.slots){let h=t.slots[o],l=i.findSlot(o);if(!l)throw new Error("Slot not found: "+o);let c=l.index;for(let u in h){let d=h[u];if(!d)continue;let f=d.length;if(u=="attachment"){let p=new Sr(f,c);for(let m=0;m<f;m++){let g=d[m];p.setFrame(m,F(g,"time",0),F(g,"name",null))}n.push(p)}else if(u=="rgba"){let p=new Ep(f,f<<2,c),m=d[0],g=F(m,"time",0),x=tt.fromString(m.color);for(let y=0,b=0;;y++){p.setFrame(y,g,x.r,x.g,x.b,x.a);let v=d[y+1];if(!v){p.shrink(b);break}let _=F(v,"time",0),w=tt.fromString(v.color),T=m.curve;T&&(b=ft(T,p,b,y,0,g,_,x.r,w.r,1),b=ft(T,p,b,y,1,g,_,x.g,w.g,1),b=ft(T,p,b,y,2,g,_,x.b,w.b,1),b=ft(T,p,b,y,3,g,_,x.a,w.a,1)),g=_,x=w,m=v}n.push(p)}else if(u=="rgb"){let p=new Pp(f,f*3,c),m=d[0],g=F(m,"time",0),x=tt.fromString(m.color);for(let y=0,b=0;;y++){p.setFrame(y,g,x.r,x.g,x.b);let v=d[y+1];if(!v){p.shrink(b);break}let _=F(v,"time",0),w=tt.fromString(v.color),T=m.curve;T&&(b=ft(T,p,b,y,0,g,_,x.r,w.r,1),b=ft(T,p,b,y,1,g,_,x.g,w.g,1),b=ft(T,p,b,y,2,g,_,x.b,w.b,1)),g=_,x=w,m=v}n.push(p)}else if(u=="alpha")n.push(Ci(d,new Mp(f,f,c),0,1));else if(u=="rgba2"){let p=new kp(f,f*7,c),m=d[0],g=F(m,"time",0),x=tt.fromString(m.light),y=tt.fromString(m.dark);for(let b=0,v=0;;b++){p.setFrame(b,g,x.r,x.g,x.b,x.a,y.r,y.g,y.b);let _=d[b+1];if(!_){p.shrink(v);break}let w=F(_,"time",0),T=tt.fromString(_.light),S=tt.fromString(_.dark),C=m.curve;C&&(v=ft(C,p,v,b,0,g,w,x.r,T.r,1),v=ft(C,p,v,b,1,g,w,x.g,T.g,1),v=ft(C,p,v,b,2,g,w,x.b,T.b,1),v=ft(C,p,v,b,3,g,w,x.a,T.a,1),v=ft(C,p,v,b,4,g,w,y.r,S.r,1),v=ft(C,p,v,b,5,g,w,y.g,S.g,1),v=ft(C,p,v,b,6,g,w,y.b,S.b,1)),g=w,x=T,y=S,m=_}n.push(p)}else if(u=="rgb2"){let p=new Rp(f,f*6,c),m=d[0],g=F(m,"time",0),x=tt.fromString(m.light),y=tt.fromString(m.dark);for(let b=0,v=0;;b++){p.setFrame(b,g,x.r,x.g,x.b,y.r,y.g,y.b);let _=d[b+1];if(!_){p.shrink(v);break}let w=F(_,"time",0),T=tt.fromString(_.light),S=tt.fromString(_.dark),C=m.curve;C&&(v=ft(C,p,v,b,0,g,w,x.r,T.r,1),v=ft(C,p,v,b,1,g,w,x.g,T.g,1),v=ft(C,p,v,b,2,g,w,x.b,T.b,1),v=ft(C,p,v,b,3,g,w,y.r,S.r,1),v=ft(C,p,v,b,4,g,w,y.g,S.g,1),v=ft(C,p,v,b,5,g,w,y.b,S.b,1)),g=w,x=T,y=S,m=_}n.push(p)}}}if(t.bones)for(let o in t.bones){let h=t.bones[o],l=i.findBone(o);if(!l)throw new Error("Bone not found: "+o);let c=l.index;for(let u in h){let d=h[u],f=d.length;if(f!=0){if(u==="rotate")n.push(Ci(d,new Qa(f,f,c),0,1));else if(u==="translate"){let p=new yp(f,f<<1,c);n.push(lh(d,p,"x","y",0,r))}else if(u==="translatex"){let p=new xp(f,f,c);n.push(Ci(d,p,0,r))}else if(u==="translatey"){let p=new vp(f,f,c);n.push(Ci(d,p,0,r))}else if(u==="scale"){let p=new _p(f,f<<1,c);n.push(lh(d,p,"x","y",1,1))}else if(u==="scalex"){let p=new wp(f,f,c);n.push(Ci(d,p,1,1))}else if(u==="scaley"){let p=new Tp(f,f,c);n.push(Ci(d,p,1,1))}else if(u==="shear"){let p=new Sp(f,f<<1,c);n.push(lh(d,p,"x","y",0,1))}else if(u==="shearx"){let p=new Cp(f,f,c);n.push(Ci(d,p,0,1))}else if(u==="sheary"){let p=new Ap(f,f,c);n.push(Ci(d,p,0,1))}}}}if(t.ik)for(let o in t.ik){let h=t.ik[o],l=h[0];if(!l)continue;let c=i.findIkConstraint(o);if(!c)throw new Error("IK Constraint not found: "+o);let u=i.ikConstraints.indexOf(c),d=new Ip(h.length,h.length<<1,u),f=F(l,"time",0),p=F(l,"mix",1),m=F(l,"softness",0)*r;for(let g=0,x=0;;g++){d.setFrame(g,f,p,m,F(l,"bendPositive",!0)?1:-1,F(l,"compress",!1),F(l,"stretch",!1));let y=h[g+1];if(!y){d.shrink(x);break}let b=F(y,"time",0),v=F(y,"mix",1),_=F(y,"softness",0)*r,w=l.curve;w&&(x=ft(w,d,x,g,0,f,b,p,v,1),x=ft(w,d,x,g,1,f,b,m,_,r)),f=b,p=v,m=_,l=y}n.push(d)}if(t.transform)for(let o in t.transform){let h=t.transform[o],l=h[0];if(!l)continue;let c=i.findTransformConstraint(o);if(!c)throw new Error("Transform constraint not found: "+o);let u=i.transformConstraints.indexOf(c),d=new Fp(h.length,h.length*6,u),f=F(l,"time",0),p=F(l,"mixRotate",1),m=F(l,"mixX",1),g=F(l,"mixY",m),x=F(l,"mixScaleX",1),y=F(l,"mixScaleY",x),b=F(l,"mixShearY",1);for(let v=0,_=0;;v++){d.setFrame(v,f,p,m,g,x,y,b);let w=h[v+1];if(!w){d.shrink(_);break}let T=F(w,"time",0),S=F(w,"mixRotate",1),C=F(w,"mixX",1),E=F(w,"mixY",C),M=F(w,"mixScaleX",1),N=F(w,"mixScaleY",M),R=F(w,"mixShearY",1),I=l.curve;I&&(_=ft(I,d,_,v,0,f,T,p,S,1),_=ft(I,d,_,v,1,f,T,m,C,1),_=ft(I,d,_,v,2,f,T,g,E,1),_=ft(I,d,_,v,3,f,T,x,M,1),_=ft(I,d,_,v,4,f,T,y,N,1),_=ft(I,d,_,v,5,f,T,b,R,1)),f=T,p=S,m=C,g=E,x=M,y=N,x=M,l=w}n.push(d)}if(t.path)for(let o in t.path){let h=t.path[o],l=i.findPathConstraint(o);if(!l)throw new Error("Path constraint not found: "+o);let c=i.pathConstraints.indexOf(l);for(let u in h){let d=h[u],f=d[0];if(!f)continue;let p=d.length;if(u==="position"){let m=new Up(p,p,c);n.push(Ci(d,m,0,l.positionMode==Bi.Fixed?r:1))}else if(u==="spacing"){let m=new Lp(p,p,c);n.push(Ci(d,m,0,l.spacingMode==ie.Length||l.spacingMode==ie.Fixed?r:1))}else if(u==="mix"){let m=new Op(p,p*3,c),g=F(f,"time",0),x=F(f,"mixRotate",1),y=F(f,"mixX",1),b=F(f,"mixY",y);for(let v=0,_=0;;v++){m.setFrame(v,g,x,y,b);let w=d[v+1];if(!w){m.shrink(_);break}let T=F(w,"time",0),S=F(w,"mixRotate",1),C=F(w,"mixX",1),E=F(w,"mixY",C),M=f.curve;M&&(_=ft(M,m,_,v,0,g,T,x,S,1),_=ft(M,m,_,v,1,g,T,y,C,1),_=ft(M,m,_,v,2,g,T,b,E,1)),g=T,x=S,y=C,b=E,f=w}n.push(m)}}}if(t.attachments)for(let o in t.attachments){let h=t.attachments[o],l=i.findSkin(o);if(!l)throw new Error("Skin not found: "+o);for(let c in h){let u=h[c],d=i.findSlot(c);if(!d)throw new Error("Slot not found: "+c);let f=d.index;for(let p in u){let m=u[p],g=l.getAttachment(f,p);for(let x in m){let y=m[x],b=y[0];if(b){if(x=="deform"){let v=g.bones,_=g.vertices,w=v?_.length/3*2:_.length,T=new Bp(y.length,y.length,f,g),S=F(b,"time",0);for(let C=0,E=0;;C++){let M,N=F(b,"vertices",null);if(!N)M=v?Y.newFloatArray(w):_;else{M=Y.newFloatArray(w);let B=F(b,"offset",0);if(Y.arrayCopy(N,0,M,B,N.length),r!=1)for(let z=B,Z=z+N.length;z<Z;z++)M[z]*=r;if(!v)for(let z=0;z<w;z++)M[z]+=_[z]}T.setFrame(C,S,M);let R=y[C+1];if(!R){T.shrink(E);break}let I=F(R,"time",0),k=b.curve;k&&(E=ft(k,T,E,C,0,S,I,0,1,1)),S=I,b=R}n.push(T)}else if(x=="sequence"){let v=new Le(y.length,f,g),_=0;for(let w=0;w<y.length;w++){let T=F(b,"delay",_),S=F(b,"time",0),C=le[F(b,"mode","hold")],E=F(b,"index",0);v.setFrame(w,S,C,E,T),_=T,b=y[w+1]}n.push(v)}}}}}}if(t.drawOrder){let o=new vs(t.drawOrder.length),h=i.slots.length,l=0;for(let c=0;c<t.drawOrder.length;c++,l++){let u=t.drawOrder[c],d=null,f=F(u,"offsets",null);if(f){d=Y.newArray(h,-1);let p=Y.newArray(h-f.length,0),m=0,g=0;for(let x=0;x<f.length;x++){let y=f[x],b=i.findSlot(y.slot);if(!b)throw new Error("Slot not found: "+b);let v=b.index;for(;m!=v;)p[g++]=m++;d[m+y.offset]=m++}for(;m<h;)p[g++]=m++;for(let x=h-1;x>=0;x--)d[x]==-1&&(d[x]=p[--g])}o.setFrame(l,F(u,"time",0),d)}n.push(o)}if(t.events){let o=new an(t.events.length),h=0;for(let l=0;l<t.events.length;l++,h++){let c=t.events[l],u=i.findEvent(c.name);if(!u)throw new Error("Event not found: "+c.name);let d=new Gp(Y.toSinglePrecision(F(c,"time",0)),u);d.intValue=F(c,"int",u.intValue),d.floatValue=F(c,"float",u.floatValue),d.stringValue=F(c,"string",u.stringValue),d.data.audioPath&&(d.volume=F(c,"volume",1),d.balance=F(c,"balance",0)),o.setFrame(h,d)}n.push(o)}let a=0;for(let o=0,h=n.length;o<h;o++)a=Math.max(a,n[o].getDuration());i.animations.push(new Cc(e,n,a))}}class nx{constructor(t,e,i,r,n){this.mesh=t,this.skin=e,this.slotIndex=i,this.parent=r,this.inheritTimeline=n}}function Ci(s,t,e,i){let r=s[0],n=F(r,"time",0),a=F(r,"value",e)*i,o=0;for(let h=0;;h++){t.setFrame(h,n,a);let l=s[h+1];if(!l)return t.shrink(o),t;let c=F(l,"time",0),u=F(l,"value",e)*i;r.curve&&(o=ft(r.curve,t,o,h,0,n,c,a,u,i)),n=c,a=u,r=l}}function lh(s,t,e,i,r,n){let a=s[0],o=F(a,"time",0),h=F(a,e,r)*n,l=F(a,i,r)*n,c=0;for(let u=0;;u++){t.setFrame(u,o,h,l);let d=s[u+1];if(!d)return t.shrink(c),t;let f=F(d,"time",0),p=F(d,e,r)*n,m=F(d,i,r)*n,g=a.curve;g&&(c=ft(g,t,c,u,0,o,f,h,p,n),c=ft(g,t,c,u,1,o,f,l,m,n)),o=f,h=p,l=m,a=d}}function ft(s,t,e,i,r,n,a,o,h,l){if(s=="stepped")return t.setStepped(i),e;let c=r<<2,u=s[c],d=s[c+1]*l,f=s[c+2],p=s[c+3]*l;return t.setBezier(e,i,r,n,o,u,d,f,p,a,h),e+1}function F(s,t,e){return s[t]!==void 0?s[t]:e}typeof Math.fround>"u"&&(Math.fround=function(s){return function(t){return s[0]=t,s[0]}}(new Float32Array(1)));var L=(s=>(s.Renderer="renderer",s.Application="application",s.WebGLPipes="webgl-pipes",s.WebGLPipesAdaptor="webgl-pipes-adaptor",s.WebGLSystem="webgl-system",s.WebGPUPipes="webgpu-pipes",s.WebGPUPipesAdaptor="webgpu-pipes-adaptor",s.WebGPUSystem="webgpu-system",s.CanvasSystem="canvas-system",s.CanvasPipesAdaptor="canvas-pipes-adaptor",s.CanvasPipes="canvas-pipes",s.Asset="asset",s.LoadParser="load-parser",s.ResolveParser="resolve-parser",s.CacheParser="cache-parser",s.DetectionParser="detection-parser",s.MaskEffect="mask-effect",s))(L||{});const _l=s=>{if(typeof s=="function"||typeof s=="object"&&s.extension){if(!s.extension)throw new Error("Extension class must have an extension object");s={...typeof s.extension!="object"?{type:s.extension}:s.extension,ref:s}}if(typeof s=="object")s={...s};else throw new Error("Invalid extension type");return typeof s.type=="string"&&(s.type=[s.type]),s},fa=(s,t)=>_l(s).priority??t,$t={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...s){return s.map(_l).forEach(t=>{t.type.forEach(e=>{var i,r;return(r=(i=this._removeHandlers)[e])==null?void 0:r.call(i,t)})}),this},add(...s){return s.map(_l).forEach(t=>{t.type.forEach(e=>{const i=this._addHandlers,r=this._queue;i[e]?i[e](t):(r[e]=r[e]||[],r[e].push(t))})}),this},handle(s,t,e){const i=this._addHandlers,r=this._removeHandlers;if(i[s]||r[s])throw new Error(`Extension type ${s} already has a handler`);i[s]=t,r[s]=e;const n=this._queue;return n[s]&&(n[s].forEach(a=>t(a)),delete n[s]),this},handleByMap(s,t){return this.handle(s,e=>{t[e.name]=e.ref},e=>{delete t[e.name]})},handleByNamedList(s,t,e=-1){return this.handle(s,i=>{t.findIndex(n=>n.name===i.name)>=0||(t.push({name:i.name,value:i.ref}),t.sort((n,a)=>fa(a.value,e)-fa(n.value,e)))},i=>{const r=t.findIndex(n=>n.name===i.name);r!==-1&&t.splice(r,1)})},handleByList(s,t,e=-1){return this.handle(s,i=>{t.includes(i.ref)||(t.push(i.ref),t.sort((r,n)=>fa(n,e)-fa(r,e)))},i=>{const r=t.indexOf(i.ref);r!==-1&&t.splice(r,1)})}};var On=(s=>(s[s.INTERACTION=50]="INTERACTION",s[s.HIGH=25]="HIGH",s[s.NORMAL=0]="NORMAL",s[s.LOW=-25]="LOW",s[s.UTILITY=-50]="UTILITY",s))(On||{});let ch=class{constructor(t,e=null,i=0,r=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=i,this.once=r}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}};const Fe=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new ch(null,null,1/0),this.deltaMS=1/Fe.targetFPMS,this.elapsedMS=1/Fe.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,i=On.NORMAL){return this._addListener(new ch(t,e,i))}addOnce(t,e,i=On.NORMAL){return this._addListener(new ch(t,e,i,!0))}_addListener(t){let e=this._head.next,i=this._head;if(!e)t.connect(i);else{for(;e;){if(t.priority>e.priority){t.connect(i);break}i=e,e=e.next}t.previous||t.connect(i)}return this._startIfPossible(),this}remove(t,e){let i=this._head.next;for(;i;)i.match(t,e)?i=i.destroy():i=i.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const n=t-this._lastFrame|0;if(n<this._minElapsedMS)return;this._lastFrame=t-n%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*Fe.targetFPMS;const i=this._head;let r=i.next;for(;r;)r=r.emit(this);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,Fe.targetFPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!Fe._shared){const t=Fe._shared=new Fe;t.autoStart=!0,t._protected=!0}return Fe._shared}static get system(){if(!Fe._system){const t=Fe._system=new Fe;t.autoStart=!0,t._protected=!0}return Fe._system}};let ts=Fe;ts.targetFPMS=.06;let Yp=class{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,On.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?ts.shared:new ts,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}};Yp.extension=L.Application;class jp{static init(t){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let e,i;if(this._resizeTo===globalThis.window)e=globalThis.innerWidth,i=globalThis.innerHeight;else{const{clientWidth:r,clientHeight:n}=this._resizeTo;e=r,i=n}this.renderer.resize(e,i),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}jp.extension=L.Application;$t.add(jp);$t.add(Yp);var zi=(s=>(s[s.Low=0]="Low",s[s.Normal=1]="Normal",s[s.High=2]="High",s))(zi||{});const wl=(s,t)=>{const e=t.split("?")[1];return e&&(s+=`?${e}`),s},ax={createCanvas:(s,t)=>{const e=document.createElement("canvas");return e.width=s,e.height=t,e},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(s,t)=>fetch(s,t),parseXML:s=>new DOMParser().parseFromString(s,"text/xml")},Tt={ADAPTER:ax,RETINA_PREFIX:/@([0-9\.]+)x/,FAIL_IF_MAJOR_PERFORMANCE_CAVEAT:!1,RESOLUTION:2};function ii(s){if(typeof s!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(s)}`)}function cn(s){return s.split("?")[0].split("#")[0]}function ox(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function hx(s,t,e){return s.replace(new RegExp(ox(t),"g"),e)}function lx(s,t){let e="",i=0,r=-1,n=0,a=-1;for(let o=0;o<=s.length;++o){if(o<s.length)a=s.charCodeAt(o);else{if(a===47)break;a=47}if(a===47){if(!(r===o-1||n===1))if(r!==o-1&&n===2){if(e.length<2||i!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){const h=e.lastIndexOf("/");if(h!==e.length-1){h===-1?(e="",i=0):(e=e.slice(0,h),i=e.length-1-e.lastIndexOf("/")),r=o,n=0;continue}}else if(e.length===2||e.length===1){e="",i=0,r=o,n=0;continue}}t&&(e.length>0?e+="/..":e="..",i=2)}else e.length>0?e+=`/${s.slice(r+1,o)}`:e=s.slice(r+1,o),i=o-r-1;r=o,n=0}else a===46&&n!==-1?++n:n=-1}return e}const de={toPosix(s){return hx(s,"\\","/")},isUrl(s){return/^https?:/.test(this.toPosix(s))},isDataUrl(s){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(s)},hasProtocol(s){return/^[^/:]+:\//.test(this.toPosix(s))},getProtocol(s){ii(s),s=this.toPosix(s);let t="";const e=/^file:\/\/\//.exec(s),i=/^[^/:]+:\/\//.exec(s),r=/^[^/:]+:\//.exec(s);if(e||i||r){const n=(e==null?void 0:e[0])||(i==null?void 0:i[0])||(r==null?void 0:r[0]);t=n,s=s.slice(n.length)}return t},toAbsolute(s,t,e){if(this.isDataUrl(s))return s;const i=cn(this.toPosix(t??Tt.ADAPTER.getBaseUrl())),r=cn(this.toPosix(e??this.rootname(i)));return ii(s),s=this.toPosix(s),s.startsWith("/")?de.join(r,s.slice(1)):this.isAbsolute(s)?s:this.join(i,s)},normalize(s){if(s=this.toPosix(s),ii(s),s.length===0)return".";let t="";const e=s.startsWith("/");this.hasProtocol(s)&&(t=this.rootname(s),s=s.slice(t.length));const i=s.endsWith("/");return s=lx(s,!1),s.length>0&&i&&(s+="/"),e?`/${s}`:t+s},isAbsolute(s){return ii(s),s=this.toPosix(s),this.hasProtocol(s)?!0:s.startsWith("/")},join(...s){if(s.length===0)return".";let t;for(let e=0;e<s.length;++e){const i=s[e];if(ii(i),i.length>0)if(t===void 0)t=i;else{const r=s[e-1]??"";this.extname(r)?t+=`/../${i}`:t+=`/${i}`}}return t===void 0?".":this.normalize(t)},dirname(s){if(ii(s),s.length===0)return".";s=this.toPosix(s);let t=s.charCodeAt(0);const e=t===47;let i=-1,r=!0;const n=this.getProtocol(s),a=s;s=s.slice(n.length);for(let o=s.length-1;o>=1;--o)if(t=s.charCodeAt(o),t===47){if(!r){i=o;break}}else r=!1;return i===-1?e?"/":this.isUrl(a)?n+s:n:e&&i===1?"//":n+s.slice(0,i)},rootname(s){ii(s),s=this.toPosix(s);let t="";if(s.startsWith("/")?t="/":t=this.getProtocol(s),this.isUrl(s)){const e=s.indexOf("/",t.length);e!==-1?t=s.slice(0,e):t=s,t.endsWith("/")||(t+="/")}return t},basename(s,t){ii(s),t&&ii(t),s=cn(this.toPosix(s));let e=0,i=-1,r=!0,n;if(t!==void 0&&t.length>0&&t.length<=s.length){if(t.length===s.length&&t===s)return"";let a=t.length-1,o=-1;for(n=s.length-1;n>=0;--n){const h=s.charCodeAt(n);if(h===47){if(!r){e=n+1;break}}else o===-1&&(r=!1,o=n+1),a>=0&&(h===t.charCodeAt(a)?--a===-1&&(i=n):(a=-1,i=o))}return e===i?i=o:i===-1&&(i=s.length),s.slice(e,i)}for(n=s.length-1;n>=0;--n)if(s.charCodeAt(n)===47){if(!r){e=n+1;break}}else i===-1&&(r=!1,i=n+1);return i===-1?"":s.slice(e,i)},extname(s){ii(s),s=cn(this.toPosix(s));let t=-1,e=0,i=-1,r=!0,n=0;for(let a=s.length-1;a>=0;--a){const o=s.charCodeAt(a);if(o===47){if(!r){e=a+1;break}continue}i===-1&&(r=!1,i=a+1),o===46?t===-1?t=a:n!==1&&(n=1):t!==-1&&(n=-1)}return t===-1||i===-1||n===0||n===1&&t===i-1&&t===e+1?"":s.slice(t,i)},parse(s){ii(s);const t={root:"",dir:"",base:"",ext:"",name:""};if(s.length===0)return t;s=cn(this.toPosix(s));let e=s.charCodeAt(0);const i=this.isAbsolute(s);let r;t.root=this.rootname(s),i||this.hasProtocol(s)?r=1:r=0;let n=-1,a=0,o=-1,h=!0,l=s.length-1,c=0;for(;l>=r;--l){if(e=s.charCodeAt(l),e===47){if(!h){a=l+1;break}continue}o===-1&&(h=!1,o=l+1),e===46?n===-1?n=l:c!==1&&(c=1):n!==-1&&(c=-1)}return n===-1||o===-1||c===0||c===1&&n===o-1&&n===a+1?o!==-1&&(a===0&&i?t.base=t.name=s.slice(1,o):t.base=t.name=s.slice(a,o)):(a===0&&i?(t.name=s.slice(1,n),t.base=s.slice(1,o)):(t.name=s.slice(a,n),t.base=s.slice(a,o)),t.ext=s.slice(n,o)),t.dir=this.dirname(s),t},sep:"/",delimiter:":"};var uh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Rt={},cx={get exports(){return Rt},set exports(s){Rt=s}};(function(s){var t=Object.prototype.hasOwnProperty,e="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1));function r(h,l,c){this.fn=h,this.context=l,this.once=c||!1}function n(h,l,c,u,d){if(typeof c!="function")throw new TypeError("The listener must be a function");var f=new r(c,u||h,d),p=e?e+l:l;return h._events[p]?h._events[p].fn?h._events[p]=[h._events[p],f]:h._events[p].push(f):(h._events[p]=f,h._eventsCount++),h}function a(h,l){--h._eventsCount===0?h._events=new i:delete h._events[l]}function o(){this._events=new i,this._eventsCount=0}o.prototype.eventNames=function(){var l=[],c,u;if(this._eventsCount===0)return l;for(u in c=this._events)t.call(c,u)&&l.push(e?u.slice(1):u);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(c)):l},o.prototype.listeners=function(l){var c=e?e+l:l,u=this._events[c];if(!u)return[];if(u.fn)return[u.fn];for(var d=0,f=u.length,p=new Array(f);d<f;d++)p[d]=u[d].fn;return p},o.prototype.listenerCount=function(l){var c=e?e+l:l,u=this._events[c];return u?u.fn?1:u.length:0},o.prototype.emit=function(l,c,u,d,f,p){var m=e?e+l:l;if(!this._events[m])return!1;var g=this._events[m],x=arguments.length,y,b;if(g.fn){switch(g.once&&this.removeListener(l,g.fn,void 0,!0),x){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,c),!0;case 3:return g.fn.call(g.context,c,u),!0;case 4:return g.fn.call(g.context,c,u,d),!0;case 5:return g.fn.call(g.context,c,u,d,f),!0;case 6:return g.fn.call(g.context,c,u,d,f,p),!0}for(b=1,y=new Array(x-1);b<x;b++)y[b-1]=arguments[b];g.fn.apply(g.context,y)}else{var v=g.length,_;for(b=0;b<v;b++)switch(g[b].once&&this.removeListener(l,g[b].fn,void 0,!0),x){case 1:g[b].fn.call(g[b].context);break;case 2:g[b].fn.call(g[b].context,c);break;case 3:g[b].fn.call(g[b].context,c,u);break;case 4:g[b].fn.call(g[b].context,c,u,d);break;default:if(!y)for(_=1,y=new Array(x-1);_<x;_++)y[_-1]=arguments[_];g[b].fn.apply(g[b].context,y)}}return!0},o.prototype.on=function(l,c,u){return n(this,l,c,u,!1)},o.prototype.once=function(l,c,u){return n(this,l,c,u,!0)},o.prototype.removeListener=function(l,c,u,d){var f=e?e+l:l;if(!this._events[f])return this;if(!c)return a(this,f),this;var p=this._events[f];if(p.fn)p.fn===c&&(!d||p.once)&&(!u||p.context===u)&&a(this,f);else{for(var m=0,g=[],x=p.length;m<x;m++)(p[m].fn!==c||d&&!p[m].once||u&&p[m].context!==u)&&g.push(p[m]);g.length?this._events[f]=g.length===1?g[0]:g:a(this,f)}return this},o.prototype.removeAllListeners=function(l){var c;return l?(c=e?e+l:l,this._events[c]&&a(this,c)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=e,o.EventEmitter=o,s.exports=o})(cx);let It=class{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new It(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}toString(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`}static get shared(){return dh.x=0,dh.y=0,dh}};const dh=new It,pa=[new It,new It,new It,new It];let Zt=class{constructor(t=0,e=0,i=0,r=0){this.type="rectangle",this.x=Number(t),this.y=Number(e),this.width=Number(i),this.height=Number(r)}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Zt(0,0,0,0)}clone(){return new Zt(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e){const S=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=S)return!1;const E=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>E}const i=this.left,r=this.right,n=this.top,a=this.bottom;if(r<=i||a<=n)return!1;const o=pa[0].set(t.left,t.top),h=pa[1].set(t.left,t.bottom),l=pa[2].set(t.right,t.top),c=pa[3].set(t.right,t.bottom);if(l.x<=o.x||h.y<=o.y)return!1;const u=Math.sign(e.a*e.d-e.b*e.c);if(u===0||(e.apply(o,o),e.apply(h,h),e.apply(l,l),e.apply(c,c),Math.max(o.x,h.x,l.x,c.x)<=i||Math.min(o.x,h.x,l.x,c.x)>=r||Math.max(o.y,h.y,l.y,c.y)<=n||Math.min(o.y,h.y,l.y,c.y)>=a))return!1;const d=u*(h.y-o.y),f=u*(o.x-h.x),p=d*i+f*n,m=d*r+f*n,g=d*i+f*a,x=d*r+f*a;if(Math.max(p,m,g,x)<=d*o.x+f*o.y||Math.min(p,m,g,x)>=d*c.x+f*c.y)return!1;const y=u*(o.y-l.y),b=u*(l.x-o.x),v=y*i+b*n,_=y*r+b*n,w=y*i+b*a,T=y*r+b*a;return!(Math.max(v,_,w,T)<=y*o.x+b*o.y||Math.min(v,_,w,T)>=y*c.x+b*c.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){const e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),r=Math.max(this.y,t.y),n=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=r,this.height=Math.max(n-r,0),this}ceil(t=1,e=.001){const i=Math.ceil((this.x+this.width-e)*t)/t,r=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=r-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),r=Math.min(this.y,t.y),n=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=r,this.height=n-r,this}getBounds(t){return t=t||new Zt,t.copyFrom(this),t}toString(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}};const fi=(s,t)=>(Array.isArray(s)||(s=[s]),t?s.map(e=>typeof e=="string"?t(e):e):s);let ux=class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const i=fi(t);let r;for(let o=0;o<this.parsers.length;o++){const h=this.parsers[o];if(h.test(e)){r=h.getCacheableAssets(i,e);break}}r||(r={},i.forEach(o=>{r[o]=e}));const n=Object.keys(r),a={cacheKeys:n,keys:i};i.forEach(o=>{this._cacheMap.set(o,a)}),n.forEach(o=>{this._cache.has(o)&&this._cache.get(o)!==e&&console.warn("[Cache] already has key:",o),this._cache.set(o,r[o])})}remove(t){if(this._cacheMap.get(t),!this._cacheMap.has(t)){console.warn(`[Assets] Asset id ${t} was not found in the Cache`);return}const e=this._cacheMap.get(t);e.cacheKeys.forEach(r=>{this._cache.delete(r)}),e.keys.forEach(r=>{this._cacheMap.delete(r)})}get parsers(){return this._parsers}};const je=new ux,eo=()=>{},fh={},Ru={};function Tl(s,t){let e=Ru[s];return e===void 0&&(fh[t]===void 0&&(fh[t]=1),Ru[s]=e=fh[t]++),e}let dx=0;const qp=class extends Rt{constructor(s={}){super(),this.resourceType="textureSampler",this.uid=dx++,this._maxAnisotropy=1,s={...qp.DEFAULT,...s},this.addressMode=s.addressMode,this.addressModeU=s.addressModeU??this.addressModeU,this.addressModeV=s.addressModeV??this.addressModeV,this.addressModeW=s.addressModeW??this.addressModeW,this.scaleMode=s.scaleMode,this.magFilter=s.magFilter??this.magFilter,this.minFilter=s.minFilter??this.minFilter,this.mipmapFilter=s.mipmapFilter??this.mipmapFilter,this.lodMinClamp=s.lodMinClamp,this.lodMaxClamp=s.lodMaxClamp,this.compare=s.compare,this.maxAnisotropy=s.maxAnisotropy??1}set addressMode(s){this.addressModeU=s,this.addressModeV=s,this.addressModeW=s}get addressMode(){return this.addressModeU}set scaleMode(s){this.magFilter=s,this.minFilter=s,this.mipmapFilter=s}get scaleMode(){return this.magFilter}set maxAnisotropy(s){this._maxAnisotropy=Math.min(s,16),this._maxAnisotropy>1&&(this.scaleMode="linear")}get maxAnisotropy(){return this._maxAnisotropy}get resourceId(){return this._resourceId||this.generateResourceId()}update(){this.emit("change",this),this._resourceId=null}generateResourceId(){const s=`${this.addressModeU}-${this.addressModeV}-${this.addressModeW}-${this.magFilter}-${this.minFilter}-${this.mipmapFilter}-${this.lodMinClamp}-${this.lodMaxClamp}-${this.compare}-${this._maxAnisotropy}`;return this._resourceId=Tl(s,"sampler"),this._resourceId}destroy(){this.emit("destroy",this),this.removeAllListeners()}};let Nn=qp;Nn.DEFAULT={addressMode:"clamp-to-edge",scaleMode:"nearest"};let fx=0,px=0;class vi extends Rt{constructor(t={}){var i,r;super(),this.uid=fx++,this.resourceType="textureSource",this.resourceId=px++,this.type="unknown",this._resolution=1,this.pixelWidth=1,this.pixelHeight=1,this.width=1,this.height=1,this.sampleCount=1,this.mipLevelCount=1,this.autoGenerateMipmaps=!1,this.format="rgba8unorm-srgb",this.viewDimensions="2d",this.dimension="2d",this.antialias=!1,this.depthStencil=!0,this.resource=t.resource,this._resolution=t.resolution??1,t.width?this.pixelWidth=t.width*this._resolution:this.pixelWidth=((i=t.resource)==null?void 0:i.width)??1,t.height?this.pixelHeight=t.height*this._resolution:this.pixelHeight=((r=t.resource)==null?void 0:r.height)??1,this.width=this.pixelWidth/this._resolution,this.height=this.pixelHeight/this._resolution,this.format=t.format??"bgra8unorm",this.viewDimensions=t.view??"2d",this.dimension=t.dimensions??"2d",this.mipLevelCount=t.mipLevelCount??1,this.autoGenerateMipmaps=t.autoGenerateMipmaps??!1,this.sampleCount=t.sampleCount??1,this.antialias=t.antialias??!1;const e=t.style??{};this.style=e instanceof Nn?e:new Nn(e),this.style.on("change",this.onStyleUpdate,this),this.styleSourceKey=(this.style.resourceId<<24)+this.uid}get source(){return this}update(){this.emit("update",this)}onStyleUpdate(){this.styleSourceKey=(this.style.resourceId<<24)+this.uid}destroy(){this.emit("destroy",this),this.style&&(this.style.destroy(),this.style=null),this.type=null,this.resource=null,this.removeAllListeners()}get resolution(){return this._resolution}set resolution(t){this._resolution!==t&&(this._resolution=t,this.width=this.pixelWidth/t,this.height=this.pixelHeight/t)}resize(t,e,i){i=i||this._resolution,t=t||this.width,e=e||this.height;const r=Math.round(t*i),n=Math.round(e*i);this.width=r/i,this.height=n/i,this._resolution=i,!(this.pixelWidth===r&&this.pixelHeight===n)&&(this.pixelWidth=r,this.pixelHeight=n,this.emit("resize",this),this.resourceId++,this.emit("change",this))}}const mx=Math.PI*2,gx=180/Math.PI,bx=Math.PI/180;let it=class{constructor(t=1,e=0,i=0,r=1,n=0,a=0){this.array=null,this.a=t,this.b=e,this.c=i,this.d=r,this.tx=n,this.ty=a}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,i,r,n,a){return this.a=t,this.b=e,this.c=i,this.d=r,this.tx=n,this.ty=a,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(t,e){e=e||new It;const i=t.x,r=t.y;return e.x=this.a*i+this.c*r+this.tx,e.y=this.b*i+this.d*r+this.ty,e}applyInverse(t,e){e=e||new It;const i=this.a,r=this.b,n=this.c,a=this.d,o=this.tx,h=this.ty,l=1/(i*a+n*-r),c=t.x,u=t.y;return e.x=a*l*c+-n*l*u+(h*n-o*a)*l,e.y=i*l*u+-r*l*c+(-h*i+o*r)*l,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),r=this.a,n=this.c,a=this.tx;return this.a=r*e-this.b*i,this.b=r*i+this.b*e,this.c=n*e-this.d*i,this.d=n*i+this.d*e,this.tx=a*e-this.ty*i,this.ty=a*i+this.ty*e,this}append(t){const e=this.a,i=this.b,r=this.c,n=this.d;return this.a=t.a*e+t.b*r,this.b=t.a*i+t.b*n,this.c=t.c*e+t.d*r,this.d=t.c*i+t.d*n,this.tx=t.tx*e+t.ty*r+this.tx,this.ty=t.tx*i+t.ty*n+this.ty,this}appendFrom(t,e){const i=t.a,r=t.b,n=t.c,a=t.d,o=t.tx,h=t.ty,l=e.a,c=e.b,u=e.c,d=e.d;return this.a=i*l+r*u,this.b=i*c+r*d,this.c=n*l+a*u,this.d=n*c+a*d,this.tx=o*l+h*u+e.tx,this.ty=o*c+h*d+e.ty,this}setTransform(t,e,i,r,n,a,o,h,l){return this.a=Math.cos(o+l)*n,this.b=Math.sin(o+l)*n,this.c=-Math.sin(o-h)*a,this.d=Math.cos(o-h)*a,this.tx=t-(i*this.a+r*this.c),this.ty=e-(i*this.b+r*this.d),this}prepend(t){const e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const i=this.a,r=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=r*t.a+this.d*t.c,this.d=r*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,i=this.b,r=this.c,n=this.d,a=t.pivot,o=-Math.atan2(-r,n),h=Math.atan2(i,e),l=Math.abs(o+h);return l<1e-5||Math.abs(mx-l)<1e-5?(t.rotation=h,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=h),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(r*r+n*n),t.position.x=this.tx+(a.x*e+a.y*r),t.position.y=this.ty+(a.x*i+a.y*n),t}invert(){const t=this.a,e=this.b,i=this.c,r=this.d,n=this.tx,a=t*r-e*i;return this.a=r/a,this.b=-e/a,this.c=-i/a,this.d=t/a,this.tx=(i*this.ty-r*n)/a,this.ty=-(t*this.ty-e*n)/a,this}isIdentity(){return this.a===1&&this.b===0&&this.c===0&&this.d===1&&this.tx===0&&this.ty===0}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new it;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}toString(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return xx.identity()}static get shared(){return yx.identity()}};const yx=new it,xx=new it,Ls=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Os=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Ns=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Ds=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Sl=[],Kp=[],ma=Math.sign;function vx(){for(let s=0;s<16;s++){const t=[];Sl.push(t);for(let e=0;e<16;e++){const i=ma(Ls[s]*Ls[e]+Ns[s]*Os[e]),r=ma(Os[s]*Ls[e]+Ds[s]*Os[e]),n=ma(Ls[s]*Ns[e]+Ns[s]*Ds[e]),a=ma(Os[s]*Ns[e]+Ds[s]*Ds[e]);for(let o=0;o<16;o++)if(Ls[o]===i&&Os[o]===r&&Ns[o]===n&&Ds[o]===a){t.push(o);break}}}for(let s=0;s<16;s++){const t=new it;t.set(Ls[s],Os[s],Ns[s],Ds[s],0,0),Kp.push(t)}}vx();const Nt={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:s=>Ls[s],uY:s=>Os[s],vX:s=>Ns[s],vY:s=>Ds[s],inv:s=>s&8?s&15:-s&7,add:(s,t)=>Sl[s][t],sub:(s,t)=>Sl[s][Nt.inv(t)],rotate180:s=>s^4,isVertical:s=>(s&3)===2,byDirection:(s,t)=>Math.abs(s)*2<=Math.abs(t)?t>=0?Nt.S:Nt.N:Math.abs(t)*2<=Math.abs(s)?s>0?Nt.E:Nt.W:t>0?s>0?Nt.SE:Nt.SW:s>0?Nt.NE:Nt.NW,matrixAppendRotationInv:(s,t,e=0,i=0)=>{const r=Kp[Nt.inv(t)];r.tx=e,r.ty=i,s.append(r)}};class Bu extends Rt{constructor(t={}){super(),this.uvs={x0:0,y0:0,x1:0,y1:0,x2:0,y2:0,x3:0,y3:0},this.frame=t.frame||new Zt(0,0,1,1),this.orig=t.orig||this.frame,this.rotate=t.rotate??0,this.trim=t.trim,this.defaultAnchor=t.defaultAnchor,this.updateUvs()}updateUvs(){const t=this.uvs,e=this.frame;let i=this.rotate;if(i){const r=e.width/2,n=e.height/2,a=e.x+r,o=e.y+n;i=Nt.add(i,Nt.NW),t.x0=a+r*Nt.uX(i),t.y0=o+n*Nt.uY(i),i=Nt.add(i,2),t.x1=a+r*Nt.uX(i),t.y1=o+n*Nt.uY(i),i=Nt.add(i,2),t.x2=a+r*Nt.uX(i),t.y2=o+n*Nt.uY(i),i=Nt.add(i,2),t.x3=a+r*Nt.uX(i),t.y3=o+n*Nt.uY(i)}else t.x0=e.x,t.y0=e.y,t.x1=e.x+e.width,t.y1=e.y,t.x2=e.x+e.width,t.y2=e.y+e.height,t.x3=e.x,t.y3=e.y+e.height}update(){this.updateUvs(),this.emit("update",this)}destroy(){this.emit("destroy",this),this.removeAllListeners(),this.frame=null,this.orig=null,this.trim=null,this.defaultAnchor=null,this.uvs=null}}const Iu=new it;let Zp=class{constructor(t,e){this.mapCoord=new it,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1,this.texture=t}get texture(){return this._texture}set texture(t){var e;this.texture!==t&&((e=this._texture)==null||e.removeListener("update",this.update,this),this._texture=t,this._texture.addListener("update",this.update,this),this.update())}multiplyUvs(t,e){e===void 0&&(e=t);const i=this.mapCoord;for(let r=0;r<t.length;r+=2){const n=t[r],a=t[r+1];e[r]=n*i.a+a*i.c+i.tx,e[r+1]=n*i.b+a*i.d+i.ty}return e}update(){const t=this._texture;this._updateID++;const e=t.layout.uvs;this.mapCoord.set(e.x1-e.x0,e.y1-e.y0,e.x3-e.x0,e.y3-e.y0,e.x0,e.y0);const i=t.layout.orig,r=t.layout.trim;r&&(Iu.set(i.width/r.width,0,0,i.height/r.height,-r.x/r.width,-r.y/r.height),this.mapCoord.append(Iu));const n=t.source,a=this.uClampFrame,o=this.clampMargin/n._resolution,h=this.clampOffset;return a[0]=(t.frameX+o+h)/n.width,a[1]=(t.frameY+o+h)/n.height,a[2]=(t.frameX+t.frameWidth-o+h)/n.width,a[3]=(t.frameY+t.frameHeight-o+h)/n.height,this.uClampOffset[0]=h/n.pixelWidth,this.uClampOffset[1]=h/n.pixelHeight,this.isSimple=t.frameWidth===n.width&&t.frameHeight===n.height&&t.layout.rotate===0,!0}},_x=0,j=class extends Rt{constructor({source:t,style:e,layout:i,label:r}={}){super(),this.id=_x++,this.styleSourceKey=0,this.label=r,this.source=(t==null?void 0:t.source)??new vi,this.layout=i instanceof Bu?i:new Bu(i),e&&(this._style=e instanceof Nn?e:new Nn(e)),this.styleSourceKey=(this.style.resourceId<<24)+this._source.uid}static from(t){return typeof t=="string"?je.get(t):new j({source:t})}set source(t){this._source&&(this._source.off("update",this.onStyleSourceUpdate,this),this._source.off("resize",this.onUpdate,this)),this._source=t,t.on("update",this.onStyleSourceUpdate,this),t.on("resize",this.onUpdate,this),this.styleSourceKey=(this.style.resourceId<<24)+this._source.uid,this.emit("update",this)}get source(){return this._source}get style(){return this._style||this.source.style}set style(t){var e,i;(e=this._style)==null||e.off("change",this.onStyleSourceUpdate,this),this._style=t,(i=this._style)==null||i.on("change",this.onStyleSourceUpdate,this)}get layout(){return this._layout}set layout(t){var e;(e=this._layout)==null||e.off("update",this.onUpdate,this),this._layout=t,t.on("update",this.onUpdate,this),this.emit("update",this)}get textureMatrix(){return this._textureMatrix||(this._textureMatrix=new Zp(this)),this._textureMatrix}set frameWidth(t){this._layout.frame.width=t/this._source.width}get frameWidth(){return this._source.pixelWidth/this._source._resolution*this._layout.frame.width}set frameHeight(t){this._layout.frame.height=t/this._source.height}get frameHeight(){return this._source.pixelHeight/this._source._resolution*this._layout.frame.height}set frameX(t){if(t===0){this._layout.frame.x=0;return}this._layout.frame.x=this._source.width/t}get frameX(){return this._source.width*this._layout.frame.x}set frameY(t){if(t===0){this._layout.frame.y=0;return}this._layout.frame.y=this._source.height/t}get frameY(){return this._source.height*this._layout.frame.y}get width(){return this._source.width*this._layout.orig.width}get height(){return this._source.height*this._layout.orig.height}destroy(t=!1){this._style&&(this._style.destroy(),this._style=null),this._layout&&(this._layout.destroy(),this._layout=null),this._source&&t&&(this._source.destroy(),this._source=null),this._textureMatrix=null,this.removeAllListeners()}onStyleSourceUpdate(){this.styleSourceKey=(this.style.resourceId<<24)+this._source.uid,this.emit("update",this)}onUpdate(){this.emit("update",this)}};j.EMPTY=new j({});j.EMPTY.label="EMPTY";j.EMPTY.destroy=eo;class Jp extends Rt{constructor(t){super(),this.baseRenderedFontSize=100,this.baseMeasurementFontSize=100,this.pages=[],this.chars={},this.lineHeight=0,this.baseLineOffset=0,this.pages=[];const{textures:e,data:i}=t;Object.keys(i.pages).forEach(r=>{const n=i.pages[parseInt(r,10)],a=e[n.id];this.pages.push({texture:a})}),Object.keys(i.chars).forEach(r=>{const n=i.chars[r],a=e[n.page].source,o=new Zt(n.x/a.width,n.y/a.height,n.width/a.width,n.height/a.height),h=new j({source:a,layout:{frame:o}});this.chars[r]={id:r.codePointAt(0),xOffset:n.xOffset,yOffset:n.yOffset,xAdvance:n.xAdvance,kerning:n.kerning??{},texture:h}}),this.fontMetrics={ascent:0,descent:0,fontSize:i.fontSize},this.baseLineOffset=i.baseLineOffset,this.lineHeight=i.lineHeight,this.fontName=i.fontName,this.baseMeasurementFontSize=i.fontSize,this.baseRenderedFontSize=i.fontSize,this.distanceField=i.distanceField??{fieldType:"none",distanceRange:0}}destroy(){this.emit("destroy",this),this.removeAllListeners();for(const t in this.chars)this.chars[t].texture.destroy();this.chars=null;for(let t=0;t<this.pages.length;t++){const{texture:e}=this.pages[t];e.destroy(!0)}this.pages=null}}const ph={test(s){return typeof s=="string"&&s.startsWith("info face=")},parse(s){const t=s.match(/^[a-z]+\s+.+$/gm),e={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const u in t){const d=t[u].match(/^[a-z]+/gm)[0],f=t[u].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),p={};for(const m in f){const g=f[m].split("="),x=g[0],y=g[1].replace(/"/gm,""),b=parseFloat(y),v=isNaN(b)?y:b;p[x]=v}e[d].push(p)}const i={chars:{},pages:[],lineHeight:0,fontSize:0,fontName:"",distanceField:null,baseLineOffset:0},[r]=e.info,[n]=e.common,[a]=e.distanceField??[];a&&(i.distanceField={distanceRange:parseInt(a.distanceRange,10),fieldType:a.fieldType}),i.fontSize=parseInt(r.size,10),i.fontName=r.face,i.lineHeight=parseInt(n.lineHeight,10);const o=e.page;for(let u=0;u<o.length;u++)i.pages.push({id:parseInt(o[u].id,10)||0,file:o[u].file});const h={};i.baseLineOffset=i.lineHeight-parseInt(n.base,10);const l=e.char;for(let u=0;u<l.length;u++){const d=l[u],f=parseInt(d.id,10);let p=d.letter??d.char;p==="space"&&(p=" "),h[f]=p,i.chars[p]={id:f,page:parseInt(d.page,10)||0,x:parseInt(d.x,10),y:parseInt(d.y,10),width:parseInt(d.width,10),height:parseInt(d.height,10),xOffset:parseInt(d.xoffset,10),yOffset:parseInt(d.yoffset,10),xAdvance:parseInt(d.xadvance,10),kerning:{}}}const c=e.kerning||[];for(let u=0;u<c.length;u++){const d=parseInt(c[u].first,10),f=parseInt(c[u].second,10),p=parseInt(c[u].amount,10);i.chars[h[f]].kerning[h[d]]=p}return i}},Fu={test(s){const t=s;return"getElementsByTagName"in t&&t.getElementsByTagName("page").length&&t.getElementsByTagName("info")[0].getAttribute("face")!==null},parse(s){const t={chars:{},pages:[],lineHeight:0,fontSize:0,fontName:"",distanceField:null,baseLineOffset:0},e=s.getElementsByTagName("info")[0],i=s.getElementsByTagName("common")[0],r=s.getElementsByTagName("distanceField")[0];r&&(t.distanceField={fieldType:r.getAttribute("fieldType"),distanceRange:parseInt(r.getAttribute("distanceRange"),10)});const n=s.getElementsByTagName("page"),a=s.getElementsByTagName("char"),o=s.getElementsByTagName("kerning");t.fontSize=parseInt(e.getAttribute("size"),10),t.fontName=e.getAttribute("face"),t.lineHeight=parseInt(i.getAttribute("lineHeight"),10);for(let l=0;l<n.length;l++)t.pages.push({id:parseInt(n[l].getAttribute("id"),10)||0,file:n[l].getAttribute("file")});const h={};t.baseLineOffset=t.lineHeight-parseInt(i.getAttribute("base"),10);for(let l=0;l<a.length;l++){const c=a[l],u=parseInt(c.getAttribute("id"),10);let d=c.getAttribute("letter")??c.getAttribute("char");d==="space"&&(d=" "),h[u]=d,t.chars[d]={id:u,page:parseInt(c.getAttribute("page"),10)||0,x:parseInt(c.getAttribute("x"),10),y:parseInt(c.getAttribute("y"),10),width:parseInt(c.getAttribute("width"),10),height:parseInt(c.getAttribute("height"),10),xOffset:parseInt(c.getAttribute("xoffset"),10),yOffset:parseInt(c.getAttribute("yoffset"),10),xAdvance:parseInt(c.getAttribute("xadvance"),10),kerning:{}}}for(let l=0;l<o.length;l++){const c=parseInt(o[l].getAttribute("first"),10),u=parseInt(o[l].getAttribute("second"),10),d=parseInt(o[l].getAttribute("amount"),10);t.chars[h[u]].kerning[h[c]]=d}return t}},Uu={test(s){return typeof s=="string"&&s.includes("<font>")?Fu.test(Tt.ADAPTER.parseXML(s)):!1},parse(s){return Fu.parse(Tt.ADAPTER.parseXML(s))}},wx=[".xml",".fnt"],Tx={extension:L.CacheParser,test:s=>s instanceof Jp,getCacheableAssets(s,t){const e={};return s.forEach(i=>{e[i]=t}),e[t.fontName]=t,e}},Sx={extension:{type:L.LoadParser,priority:zi.Normal},test(s){return wx.includes(de.extname(s).toLowerCase())},async testParse(s){return ph.test(s)||Uu.test(s)},async parse(s,t,e){const i=ph.test(s)?ph.parse(s):Uu.parse(s),{src:r}=t,{pages:n}=i,a=[];for(let c=0;c<n.length;++c){const u=n[c].file;let d=de.join(de.dirname(r),u);d=wl(d,r),a.push(d)}const o=await e.load(a),h=a.map(c=>o[c]);return new Jp({data:i,textures:h})},async load(s,t){return await(await Tt.ADAPTER.fetch(s)).text()},unload(s){s.destroy()}},Cx={extension:L.CacheParser,test:s=>Array.isArray(s)&&s.every(t=>t instanceof j),getCacheableAssets:(s,t)=>{const e={};return s.forEach(i=>{t.forEach((r,n)=>{e[i+(n===0?"":n+1)]=r})}),e}},Ax={extension:{type:L.DetectionParser,priority:1},test:async()=>{if(!globalThis.createImageBitmap)return!1;const s="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=",t=await Tt.ADAPTER.fetch(s).then(e=>e.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async s=>[...s,"avif"],remove:async s=>s.filter(t=>t!=="avif")},Lu=["png","jpg","jpeg"],Ex={extension:{type:L.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async s=>[...s,...Lu],remove:async s=>s.filter(t=>!Lu.includes(t))},Px="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function kc(s){return Px?!1:document.createElement("video").canPlayType(s)!==""}const Mx={extension:{type:L.DetectionParser,priority:0},test:async()=>kc("video/mp4"),add:async s=>[...s,"mp4","m4v"],remove:async s=>s.filter(t=>t!=="mp4"&&t!=="m4v")},kx={extension:{type:L.DetectionParser,priority:0},test:async()=>kc("video/ogg"),add:async s=>[...s,"ogv"],remove:async s=>s.filter(t=>t!=="ogv")},Rx={extension:{type:L.DetectionParser,priority:0},test:async()=>kc("video/webm"),add:async s=>[...s,"webm"],remove:async s=>s.filter(t=>t!=="webm")},Bx={extension:{type:L.DetectionParser,priority:0},test:async()=>{if(!globalThis.createImageBitmap)return!1;const s="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",t=await Tt.ADAPTER.fetch(s).then(e=>e.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async s=>[...s,"webp"],remove:async s=>s.filter(t=>t!=="webp")};function aa(s,t){if(Array.isArray(t)){for(const e of t)if(s.startsWith(`data:${e}`))return!0;return!1}return s.startsWith(`data:${t}`)}function Ii(s,t){const e=s.split("?")[0],i=de.extname(e).toLowerCase();return Array.isArray(t)?t.includes(i):i===t}const Ix=".json",Fx="application/json",Ux={extension:{type:L.LoadParser,priority:zi.Low},name:"loadJson",test(s){return aa(s,Fx)||Ii(s,Ix)},async load(s){return await(await Tt.ADAPTER.fetch(s)).json()}},Lx=".txt",Ox="text/plain",Nx={name:"loadTxt",extension:{type:L.LoadParser,priority:zi.Low},test(s){return aa(s,Ox)||Ii(s,Lx)},async load(s){return await(await Tt.ADAPTER.fetch(s)).text()}},Dx=["normal","bold","100","200","300","400","500","600","700","800","900"],Gx=[".ttf",".otf",".woff",".woff2"],Vx=["font/ttf","font/otf","font/woff","font/woff2"],zx=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function Hx(s){const t=de.extname(s),r=de.basename(s,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(o=>o.charAt(0).toUpperCase()+o.slice(1));let n=r.length>0;for(const o of r)if(!o.match(zx)){n=!1;break}let a=r.join(" ");return n||(a=`"${a.replace(/[\\"]/g,"\\$&")}"`),a}const Xx={extension:{type:L.LoadParser,priority:zi.Low},name:"loadWebFont",test(s){return aa(s,Vx)||Ii(s,Gx)},async load(s,t){var i,r,n;const e=Tt.ADAPTER.getFontFaceSet();if(e){const a=[],o=((i=t.data)==null?void 0:i.family)??Hx(s),h=((n=(r=t.data)==null?void 0:r.weights)==null?void 0:n.filter(c=>Dx.includes(c)))??["normal"],l=t.data??{};for(let c=0;c<h.length;c++){const u=h[c],d=new FontFace(o,`url(${encodeURI(s)})`,{...l,weight:u});await d.load(),e.add(d),a.push(d)}return a.length===1?a[0]:a}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(s){(Array.isArray(s)?s:[s]).forEach(t=>Tt.ADAPTER.getFontFaceSet().delete(t))}},Ou={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function ki(s){if(typeof s=="number")return s;if(typeof s=="string"){if(Ou[s]!==void 0)return Ou[s];if(s[0]==="#"){if(s.length===4){const t=parseInt(s[1]+s[1],16),e=parseInt(s[2]+s[2],16),i=parseInt(s[3]+s[3],16);return(t<<16)+(e<<8)+i}return parseInt(s.substring(1),16)}console.warn(`[pixi.js] Invalid color: ${s}`)}return 0}class Ti{constructor(t=1/0,e=1/0,i=-1/0,r=-1/0){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrixStack=[],this.matrix=new it,this.minX=t,this.minY=e,this.maxX=i,this.maxY=r}get rectangle(){this._rectangle||(this._rectangle=new Zt);const t=this._rectangle;return this.minX>this.maxX||this.minY>this.maxY?(t.x=0,t.y=0,t.width=0,t.height=0):(t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY),t}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrixStack.length=0,this.matrix.identity()}pushMatrix(t){this.matrixStack.push(t),this.matrixStack.length>1?(this.matrix.copyFrom(this.matrixStack[this.matrixStack.length-2]),this.matrix.append(t)):this.matrix.copyFrom(t)}popMatrix(){this.matrixStack.pop(),this.matrixStack.length>1?(this.matrix.copyFrom(this.matrixStack[this.matrixStack.length-2]),this.matrix.append(this.matrixStack[this.matrixStack.length-1])):this.matrixStack.length===1?this.matrix.copyFrom(this.matrixStack[0]):this.matrix.identity()}setMatrix(t){this.matrix.copyFrom(t)}set(t,e,i,r){this.minX=t,this.minY=e,this.maxX=i,this.maxY=r}addFrame(t,e,i,r){const n=this.matrix,a=n.a,o=n.b,h=n.c,l=n.d,c=n.tx,u=n.ty;let d=this.minX,f=this.minY,p=this.maxX,m=this.maxY,g=a*t+h*e+c,x=o*t+l*e+u;d=g<d?g:d,f=x<f?x:f,p=g>p?g:p,m=x>m?x:m,g=a*i+h*e+c,x=o*i+l*e+u,d=g<d?g:d,f=x<f?x:f,p=g>p?g:p,m=x>m?x:m,g=a*t+h*r+c,x=o*t+l*r+u,d=g<d?g:d,f=x<f?x:f,p=g>p?g:p,m=x>m?x:m,g=a*i+h*r+c,x=o*i+l*r+u,d=g<d?g:d,f=x<f?x:f,p=g>p?g:p,m=x>m?x:m,this.minX=d,this.minY=f,this.maxX=p,this.maxY=m}addRect(t){this.addFrame(t.x,t.y,t.x+t.width,t.y+t.height)}addBounds(t){this.addFrame(t.minX,t.minY,t.maxX,t.maxY)}addBoundsMask(t){this.minX=this.minX>t.minX?this.minX:t.minX,this.minY=this.minY>t.minY?this.minY:t.minY,this.maxX=this.maxX<t.maxX?this.maxX:t.maxX,this.maxY=this.maxY<t.maxY?this.maxY:t.maxY}applyMatrix(t){const e=this.minX,i=this.minY,r=this.maxX,n=this.maxY,{a,b:o,c:h,d:l,tx:c,ty:u}=t;let d=a*e+h*i+c,f=o*e+l*i+u;this.minX=d,this.minY=f,this.maxX=d,this.maxY=f,d=a*r+h*i+c,f=o*r+l*i+u,this.minX=d<this.minX?d:this.minX,this.minY=f<this.minY?f:this.minY,this.maxX=d>this.maxX?d:this.maxX,this.maxY=f>this.maxY?f:this.maxY,d=a*e+h*n+c,f=o*e+l*n+u,this.minX=d<this.minX?d:this.minX,this.minY=f<this.minY?f:this.minY,this.maxX=d>this.maxX?d:this.maxX,this.maxY=f>this.maxY?f:this.maxY,d=a*r+h*n+c,f=o*r+l*n+u,this.minX=d<this.minX?d:this.minX,this.minY=f<this.minY?f:this.minY,this.maxX=d>this.maxX?d:this.maxX,this.maxY=f>this.maxY?f:this.maxY}fit(t){return this.minX<t.left&&(this.minX=t.left),this.maxX>t.right&&(this.maxX=t.right),this.minY<t.top&&(this.minY=t.top),this.maxY>t.bottom&&(this.maxY=t.bottom),this}pad(t,e=t){return this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e,this}ceil(){return this.minX=Math.floor(this.minX),this.minY=Math.floor(this.minY),this.maxX=Math.ceil(this.maxX),this.maxY=Math.ceil(this.maxY),this}clone(){return new Ti(this.minX,this.minY,this.maxX,this.maxY)}scale(t,e=t){return this.minX*=t,this.minY*=e,this.maxX*=t,this.maxY*=e,this}get x(){return this.minX}get y(){return this.minY}get width(){return this.maxX-this.minX}get height(){return this.maxY-this.minY}get isPositive(){return this.maxX-this.minX>0&&this.maxY-this.minY>0}get isValid(){return this.minX+this.minY!==1/0}addVertexData(t,e,i){let r=this.minX,n=this.minY,a=this.maxX,o=this.maxY;const h=this.matrix,l=h.a,c=h.b,u=h.c,d=h.d,f=h.tx,p=h.ty;for(let m=e;m<i;m+=2){const g=t[m],x=t[m+1],y=l*g+u*x+f,b=c*g+d*x+p;r=y<r?y:r,n=b<n?b:n,a=y>a?y:a,o=b>o?b:o}this.minX=r,this.minY=n,this.maxX=a,this.maxY=o}toString(){return`[@pixi:Bounds minX=${this.minX} minY=${this.minY} maxX=${this.maxX} maxY=${this.maxY} width=${this.width} height=${this.height}]`}}function Cl(s){if(typeof s=="string")return s;let t=(s|0).toString(16);return t="000000".substring(0,6-t.length)+t,`#${t}`}class Ro extends vi{constructor(t){super(t),this.type="image",this.alphaMode=t.alphaMode??0}}const Bo=Tt.ADAPTER.createCanvas(),tr=1;Bo.width=tr;Bo.height=tr;const ns=Bo.getContext("2d");ns.fillStyle="#ffffff";ns.fillRect(0,0,tr,tr);ns.beginPath();ns.moveTo(0,0);ns.lineTo(tr,0);ns.lineTo(tr,tr);ns.closePath();ns.fillStyle="#ffffff";ns.fill();j.WHITE=new j({source:new Ro({resource:Bo})});j.WHITE.label="WHITE";j.WHITE.destroy=eo;let $x=0;const Al=class{constructor(s,t,e,i){this.uid=$x++,this.type="linear",this.gradientStops=[],this.x0=s,this.y0=t,this.x1=e,this.y1=i}addColorStop(s,t){return t=Cl(t),this.gradientStops.push({offset:s,color:t}),this}buildLinearGradient(){const s=Al.defaultTextureSize,{gradientStops:t}=this,e=Tt.ADAPTER.createCanvas();e.width=s,e.height=s;const i=e.getContext("2d"),r=i.createLinearGradient(0,0,Al.defaultTextureSize,1);for(let p=0;p<t.length;p++){const m=t[p];r.addColorStop(m.offset,m.color)}i.fillStyle=r,i.fillRect(0,0,s,s),this.texture=new j({source:new Ro({resource:e}),style:{addressModeU:"clamp-to-edge",addressModeV:"repeat"}});const{x0:n,y0:a,x1:o,y1:h}=this,l=new it,c=o-n,u=h-a,d=Math.sqrt(c*c+u*u),f=Math.atan2(u,c);l.translate(-n,-a),l.scale(1/s,1/s),l.rotate(-f),l.scale(256/d,1),this.transform=l}};let Dn=Al;Dn.defaultTextureSize=256;const Nu={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};let Wx=0;class Rc{constructor(t,e){this.uid=Wx++,this.transform=new it,this.texture=t,this.repetition=e,this.transform.scale(1/t.frameWidth,1/t.frameHeight),e&&(t.style.addressModeU=Nu[e].addressModeU,t.style.addressModeV=Nu[e].addressModeV)}setTransform(t){const e=this.texture;this.transform.copyFrom(t),this.transform.invert(),this.transform.scale(1/e.frameWidth,1/e.frameHeight)}}const Yx={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0};function jx(s,t){var h;const e=s.match(/[a-df-z][^a-df-z]*/gi),i=(h=s.match(/[+-]?\d*\.?\d+(?:[eE][+-]?\d+)?/g))==null?void 0:h.map(parseFloat),r=[];e.forEach(l=>{var f;const c=(f=l.match(/[+-]?\d*\.?\d+(?:[eE][+-]?\d+)?/g))==null?void 0:f.map(parseFloat),u=l[0];let d=1;c&&(d=c.length/Yx[u.toLowerCase()]);for(let p=0;p<d;p++)r.push(u)});let n=0,a=0,o=0;for(let l=0;l<r.length;l++){const c=r[l];switch(c){case"M":a=i[n++],o=i[n++],t.moveTo(a,o);break;case"m":a+=i[n++],o+=i[n++],t.moveTo(a,o);break;case"H":a=i[n++],t.lineTo(a,o);break;case"h":a+=i[n++],t.lineTo(a,o);break;case"V":o=i[n++],t.lineTo(a,o);break;case"v":o+=i[n++],t.lineTo(a,o);break;case"L":a=i[n++],o=i[n++],t.lineTo(a,o);break;case"l":a+=i[n++],o+=i[n++],t.lineTo(a,o);break;case"C":a=i[n+4],o=i[n+5],t.bezierCurveTo(i[n],i[n+1],i[n+2],i[n+3],a,o),n+=6;break;case"c":t.bezierCurveTo(a+i[n],o+i[n+1],a+i[n+2],o+i[n+3],a+i[n+4],o+i[n+5]),a+=i[n+4],o+=i[n+5],n+=6;break;case"S":a=i[n+2],o=i[n+3],t.bezierCurveToShort(i[n],i[n+1],a,o),n+=4;break;case"s":t.bezierCurveToShort(a+i[n],o+i[n+1],a+i[n+2],o+i[n+3]),a+=i[n+2],o+=i[n+3],n+=4;break;case"Q":a=i[n+2],o=i[n+3],t.quadraticCurveTo(i[n],i[n+1],a,o),n+=4;break;case"q":t.quadraticCurveTo(a+i[n],o+i[n+1],a+i[n+2],o+i[n+3]),a+=i[n+2],o+=i[n+3],n+=4;break;case"T":a=i[n++],o=i[n++],t.quadraticCurveToShort(a,o);break;case"t":a+=i[n++],o+=i[n++],t.quadraticCurveToShort(a,o);break;case"A":a=i[n+5],o=i[n+6],t.arcToSvg(i[n],i[n+1],i[n+2],i[n+3],i[n+4],a,o),n+=7;break;case"a":a+=i[n+5],o+=i[n+6],t.arcToSvg(i[n],i[n+1],i[n+2],i[n+3],i[n+4],a,o),n+=7;break;case"Z":case"z":t.closePath();break;default:console.warn(`Unknown SVG path command: ${c}`)}}return t}class Bc{constructor(t=0,e=0,i=0){this.type="circle",this.x=t,this.y=e,this.radius=i}clone(){return new Bc(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const i=this.radius*this.radius;let r=this.x-t,n=this.y-e;return r*=r,n*=n,r+n<=i}getBounds(t){return t=t||new Zt,t.x=this.x-this.radius,t.y=this.y-this.radius,t.width=this.radius*2,t.height=this.radius*2,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.radius=t.radius,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class Ic{constructor(t=0,e=0,i=0,r=0){this.type="ellipse",this.x=t,this.y=e,this.halfWidth=i,this.halfHeight=r}clone(){return new Ic(this.x,this.y,this.halfWidth,this.halfHeight)}contains(t,e){if(this.halfWidth<=0||this.halfHeight<=0)return!1;let i=(t-this.x)/this.halfWidth,r=(e-this.y)/this.halfHeight;return i*=i,r*=r,i+r<=1}getBounds(){return new Zt(this.x-this.halfWidth,this.y-this.halfHeight,this.halfWidth*2,this.halfHeight*2)}copyFrom(t){return this.x=t.x,this.y=t.y,this.halfWidth=t.halfWidth,this.halfHeight=t.halfHeight,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} halfWidth=${this.halfWidth} halfHeight=${this.halfHeight}]`}}class Fr{constructor(...t){this.type="polygon";let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){const i=[];for(let r=0,n=e.length;r<n;r++)i.push(e[r].x,e[r].y);e=i}this.points=e,this.closePath=!0}clone(){const t=this.points.slice(),e=new Fr(t);return e.closePath=this.closePath,e}contains(t,e){let i=!1;const r=this.points.length/2;for(let n=0,a=r-1;n<r;a=n++){const o=this.points[n*2],h=this.points[n*2+1],l=this.points[a*2],c=this.points[a*2+1];h>e!=c>e&&t<(l-o)*((e-h)/(c-h))+o&&(i=!i)}return i}getBounds(t){t=t||new Zt;const e=this.points;let i=1/0,r=-1/0,n=1/0,a=-1/0;for(let o=0,h=e.length;o<h;o+=2){const l=e[o],c=e[o+1];i=l<i?l:i,r=l>r?l:r,n=c<n?c:n,a=c>a?c:a}return t.x=i,t.width=r-i,t.y=n,t.height=a-n,t}copyFrom(t){return this.points=t.points.slice(),this.closePath=t.closePath,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[@pixi/math:PolygoncloseStroke=${this.closePath}points=${this.points.reduce((t,e)=>`${t}, ${e}`,"")}]`}get lastX(){return this.points[this.points.length-2]}get lastY(){return this.points[this.points.length-1]}get x(){return this.points[this.points.length-2]}get y(){return this.points[this.points.length-1]}}class Fc{constructor(t=0,e=0,i=0,r=0,n=20){this.type="roundedRectangle",this.x=t,this.y=e,this.width=i,this.height=r,this.radius=n}getBounds(t){return t=t||new Zt,t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}clone(){return new Fc(this.x,this.y,this.width,this.height,this.radius)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+i&&e<=this.y+this.height-i||t>=this.x+i&&t<=this.x+this.width-i)return!0;let r=t-(this.x+i),n=e-(this.y+i);const a=i*i;if(r*r+n*n<=a||(r=t-(this.x+this.width-i),r*r+n*n<=a)||(n=e-(this.y+this.height-i),r*r+n*n<=a)||(r=t-(this.x+i),r*r+n*n<=a))return!0}return!1}toString(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}const qx=8,ga=11920929e-14,Kx=1;function Qp(s,t,e,i,r,n,a,o,h){let c=Kx/1;return c*=c,Zx(t,e,i,r,n,a,o,h,s,c),s}function Zx(s,t,e,i,r,n,a,o,h,l){El(s,t,e,i,r,n,a,o,h,l,0),h.push(a,o)}function El(s,t,e,i,r,n,a,o,h,l,c){if(c>qx)return;const u=(s+e)/2,d=(t+i)/2,f=(e+r)/2,p=(i+n)/2,m=(r+a)/2,g=(n+o)/2,x=(u+f)/2,y=(d+p)/2,b=(f+m)/2,v=(p+g)/2,_=(x+b)/2,w=(y+v)/2;if(c>0){let T=a-s,S=o-t;const C=Math.abs((e-a)*S-(i-o)*T),E=Math.abs((r-a)*S-(n-o)*T);if(C>ga&&E>ga){if((C+E)*(C+E)<=l*(T*T+S*S)){h.push(_,w);return}}else if(C>ga){if(C*C<=l*(T*T+S*S)){h.push(_,w);return}}else if(E>ga){if(E*E<=l*(T*T+S*S)){h.push(_,w);return}}else if(T=_-(s+a)/2,S=w-(t+o)/2,T*T+S*S<=l){h.push(_,w);return}}El(s,t,u,d,x,y,_,w,h,l,c+1),El(_,w,b,v,m,g,a,o,h,l,c+1)}const Jx=8,Qx=11920929e-14,tv=1;function ev(s,t,e,i,r,n,a){let h=tv/1;return h*=h,iv(t,e,i,r,n,a,s,h),s}function iv(s,t,e,i,r,n,a,o){Pl(a,s,t,e,i,r,n,o,0),a.push(r,n)}function Pl(s,t,e,i,r,n,a,o,h){if(h>Jx)return;const l=(t+i)/2,c=(e+r)/2,u=(i+n)/2,d=(r+a)/2,f=(l+u)/2,p=(c+d)/2;let m=n-t,g=a-e;const x=Math.abs((i-n)*g-(r-a)*m);if(x>Qx){if(x*x<=o*(m*m+g*g)){s.push(f,p);return}}else if(m=f-(t+n)/2,g=p-(e+a)/2,m*m+g*g<=o){s.push(f,p);return}Pl(s,t,e,l,c,f,p,o,h+1),Pl(s,f,p,u,d,n,a,o,h+1)}function tm(s,t,e,i,r,n,a,o){let h=Math.abs(r-n);(!a&&r>n||a&&n>r)&&(h=2*Math.PI-h),o=o||Math.max(6,Math.floor(6*Math.pow(i,1/3)*(h/Math.PI))),o=Math.max(o,3);let l=h/o,c=r;l*=a?-1:1;for(let u=0;u<o+1;u++){const d=Math.cos(c),f=Math.sin(c),p=t+d*i,m=e+f*i;s.push(p,m),c+=l}}function sv(s,t,e,i,r,n){const a=s[s.length-2],h=s[s.length-1]-e,l=a-t,c=r-e,u=i-t,d=Math.abs(h*u-l*c);if(d<1e-8||n===0){(s[s.length-2]!==t||s[s.length-1]!==e)&&s.push(t,e);return}const f=h*h+l*l,p=c*c+u*u,m=h*c+l*u,g=n*Math.sqrt(f)/d,x=n*Math.sqrt(p)/d,y=g*m/f,b=x*m/p,v=g*u+x*l,_=g*c+x*h,w=l*(x+y),T=h*(x+y),S=u*(g+b),C=c*(g+b),E=Math.atan2(T-_,w-v),M=Math.atan2(C-_,S-v);tm(s,v+t,_+e,n,E,M,l*c>u*h)}const Mn=Math.PI*2,mh={centerX:0,centerY:0,ang1:0,ang2:0},gh=({x:s,y:t},e,i,r,n,a,o,h)=>{s*=e,t*=i;const l=r*s-n*t,c=n*s+r*t;return h.x=l+a,h.y=c+o,h};function rv(s,t){const e=t===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(t/4),i=t===1.5707963267948966?.551915024494:e,r=Math.cos(s),n=Math.sin(s),a=Math.cos(s+t),o=Math.sin(s+t);return[{x:r-n*i,y:n+r*i},{x:a+o*i,y:o-a*i},{x:a,y:o}]}const Du=(s,t,e,i)=>{const r=s*i-t*e<0?-1:1;let n=s*e+t*i;return n>1&&(n=1),n<-1&&(n=-1),r*Math.acos(n)},nv=(s,t,e,i,r,n,a,o,h,l,c,u,d)=>{const f=Math.pow(r,2),p=Math.pow(n,2),m=Math.pow(c,2),g=Math.pow(u,2);let x=f*p-f*g-p*m;x<0&&(x=0),x/=f*g+p*m,x=Math.sqrt(x)*(a===o?-1:1);const y=x*r/n*u,b=x*-n/r*c,v=l*y-h*b+(s+e)/2,_=h*y+l*b+(t+i)/2,w=(c-y)/r,T=(u-b)/n,S=(-c-y)/r,C=(-u-b)/n,E=Du(1,0,w,T);let M=Du(w,T,S,C);o===0&&M>0&&(M-=Mn),o===1&&M<0&&(M+=Mn),d.centerX=v,d.centerY=_,d.ang1=E,d.ang2=M};function av(s,t,e,i,r,n,a,o=0,h=0,l=0){if(n===0||a===0)return;const c=Math.sin(o*Mn/360),u=Math.cos(o*Mn/360),d=u*(t-i)/2+c*(e-r)/2,f=-c*(t-i)/2+u*(e-r)/2;if(d===0&&f===0)return;n=Math.abs(n),a=Math.abs(a);const p=Math.pow(d,2)/Math.pow(n,2)+Math.pow(f,2)/Math.pow(a,2);p>1&&(n*=Math.sqrt(p),a*=Math.sqrt(p)),nv(t,e,i,r,n,a,h,l,c,u,d,f,mh);let{ang1:m,ang2:g}=mh;const{centerX:x,centerY:y}=mh;let b=Math.abs(g)/(Mn/4);Math.abs(1-b)<1e-7&&(b=1);const v=Math.max(Math.ceil(b),1);g/=v;let _=s[s.length-2],w=s[s.length-1];const T={x:0,y:0};for(let S=0;S<v;S++){const C=rv(m,g),{x:E,y:M}=gh(C[0],n,a,u,c,x,y,T),{x:N,y:R}=gh(C[1],n,a,u,c,x,y,T),{x:I,y:k}=gh(C[2],n,a,u,c,x,y,T);Qp(s,_,w,E,M,N,R,I,k),_=I,w=k,m+=g}}const ov=new Zt;class hv{constructor(t){this.shapePrimitives=[],this.currentPoly=null,this._bounds=new Ti,this.graphicsPath2D=t}moveTo(t,e){return this.startPoly(t,e),this}lineTo(t,e){this._ensurePoly();const i=this.currentPoly.points,r=i[i.length-2],n=i[i.length-1];return(r!==t||n!==e)&&i.push(t,e),this}arc(t,e,i,r,n,a){this._ensurePoly(!1);const o=this.currentPoly.points;return tm(o,t,e,i,r,n,a),this}arcTo(t,e,i,r,n){this._ensurePoly();const a=this.currentPoly.points;return sv(a,t,e,i,r,n),this}arcToSvg(t,e,i,r,n,a,o){const h=this.currentPoly.points;return av(h,this.currentPoly.lastX,this.currentPoly.lastY,a,o,t,e,i,r,n),this}bezierCurveTo(t,e,i,r,n,a){this._ensurePoly();const o=this.currentPoly;return Qp(this.currentPoly.points,o.lastX,o.lastY,t,e,i,r,n,a),this}quadraticCurveTo(t,e,i,r){this._ensurePoly();const n=this.currentPoly;return ev(this.currentPoly.points,n.lastX,n.lastY,t,e,i,r),this}closePath(){return this.endPoly(!0),this}addPath(t,e){this.endPoly(),e&&!e.isIdentity()&&(t=t.clone(!0),t.transform(e));for(let i=0;i<t.instructions.length;i++){const r=t.instructions[i];this[r.action](...r.data)}return this}finish(t=!1){this.endPoly(t)}rect(t,e,i,r,n){return this.drawShape(new Zt(t,e,i,r),n),this}circle(t,e,i,r){return this.drawShape(new Bc(t,e,i),r),this}poly(t,e,i){const r=new Fr(t);r.closePath=e,this.drawShape(r,i)}ellipse(t,e,i,r,n){return this.drawShape(new Ic(t,e,i,r),n),this}roundRect(t,e,i,r,n,a){return this.drawShape(new Fc(t,e,i,r,n),a),this}drawShape(t,e){return this.endPoly(),this.shapePrimitives.push({shape:t,transform:e}),this}startPoly(t,e){let i=this.currentPoly;return i&&this.endPoly(),i=new Fr,i.points.push(t,e),this.currentPoly=i,this}endPoly(t=!1){const e=this.currentPoly;return e&&e.points.length>2&&(e.closePath=t,this.shapePrimitives.push({shape:e})),this.currentPoly=null,this}_ensurePoly(t=!0){if(!this.currentPoly&&(this.currentPoly=new Fr,t)){const e=this.shapePrimitives[this.shapePrimitives.length-1];if(e){let i=e.shape.x,r=e.shape.y;if(e.transform.isIdentity()){const n=e.transform,a=i;i=n.a*i+n.c*r+n.tx,r=n.b*a+n.d*r+n.ty}this.currentPoly.points.push(i,i)}else this.currentPoly.points.push(0,0)}}buildPath(){const t=this.graphicsPath2D;this.shapePrimitives.length=0,this.currentPoly=null;for(let e=0;e<t.instructions.length;e++){const i=t.instructions[e];this[i.action](...i.data)}this.finish()}isPointInPath(t,e){const i=this.shapePrimitives;for(let r=0;r<i.length;r++)if(i[r].shape.contains(t,e))return!0;return!1}get bounds(){const t=this._bounds;t.clear();const e=this.shapePrimitives;for(let i=0;i<e.length;i++){const r=e[i],n=r.shape.getBounds(ov);r.transform?(t.pushMatrix(r.transform),t.addRect(n),t.popMatrix()):t.addRect(n)}return t}}let lv=0;class Wr{constructor(t){this.instructions=[],this.uid=lv++,this.dirty=!0,typeof t=="string"?jx(t,this):this.instructions=(t==null?void 0:t.slice())??[]}get shapePath(){return this._shapePath||(this._shapePath=new hv(this)),this.dirty&&(this.dirty=!1,this._shapePath.buildPath()),this._shapePath}addPath(t,e){return t=t.clone(),this.instructions.push({action:"addPath",data:[t,e]}),this.dirty=!0,this}arc(...t){return this.instructions.push({action:"arc",data:t}),this.dirty=!0,this}arcTo(...t){return this.instructions.push({action:"arcTo",data:t}),this.dirty=!0,this}arcToSvg(...t){return this.instructions.push({action:"arcToSvg",data:t}),this.dirty=!0,this}bezierCurveTo(...t){return this.instructions.push({action:"bezierCurveTo",data:t}),this.dirty=!0,this}bezierCurveToShort(t,e,i,r){const n=this.instructions[this.instructions.length-1],a=this.getLastPoint(It.shared);let o=0,h=0;if(!n||n.action!=="bezierCurveTo")o=a.x,h=a.y;else{o=n.data[2],h=n.data[3];const l=a.x,c=a.y;o=l+(l-o),h=c+(c-h)}return this.instructions.push({action:"bezierCurveTo",data:[o,h,t,e,i,r]}),this.dirty=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this.dirty=!0,this}ellipse(...t){return this.instructions.push({action:"ellipse",data:t}),this.dirty=!0,this}lineTo(...t){return this.instructions.push({action:"lineTo",data:t}),this.dirty=!0,this}moveTo(...t){return this.instructions.push({action:"moveTo",data:t}),this}quadraticCurveTo(...t){return this.instructions.push({action:"quadraticCurveTo",data:t}),this.dirty=!0,this}quadraticCurveToShort(t,e){const i=this.instructions[this.instructions.length-1],r=this.getLastPoint(It.shared);let n=0,a=0;if(!i||i.action!=="quadraticCurveTo")n=r.x,a=r.y;else{n=i.data[0],a=i.data[1];const o=r.x,h=r.y;n=o+(o-n),a=h+(h-a)}return this.instructions.push({action:"quadraticCurveTo",data:[n,a,t,e]}),this.dirty=!0,this}rect(t,e,i,r,n){return this.instructions.push({action:"rect",data:[t,e,i,r,n]}),this.dirty=!0,this}circle(t,e,i,r){return this.instructions.push({action:"circle",data:[t,e,i,r]}),this.dirty=!0,this}roundRect(...t){return this.instructions.push({action:"roundRect",data:t}),this.dirty=!0,this}poly(...t){return this.instructions.push({action:"poly",data:t}),this.dirty=!0,this}star(t,e,i,r,n,a=0,o){n=n||r/2;const h=-1*Math.PI/2+a,l=i*2,c=Math.PI*2/l,u=[];for(let d=0;d<l;d++){const f=d%2?n:r,p=d*c+h;u.push(t+f*Math.cos(p),e+f*Math.sin(p))}return this.poly(u,!0,o),this}clone(t=!1){const e=new Wr;if(!t)e.instructions=this.instructions.slice();else for(let i=0;i<this.instructions.length;i++){const r=this.instructions[i];e.instructions.push({action:r.action,data:r.data.slice()})}return e}getLastPoint(t){let e=this.instructions.length-1,i=this.instructions[e];if(!i)return t.x=0,t.y=0,t;for(;i.action==="closePath";){if(e--,e<0)return t.x=0,t.y=0,t;i=this.instructions[e]}let r,n,a;switch(i.action){case"moveTo":case"lineTo":t.x=i.data[0],t.y=i.data[1];break;case"quadraticCurveTo":t.x=i.data[2],t.y=i.data[3];break;case"bezierCurveTo":t.x=i.data[4],t.y=i.data[5];break;case"arc":case"arcToSvg":t.x=i.data[5],t.y=i.data[6];break;case"addPath":t.x=i.data[0].lastX,t.y=i.data[2].lastY;break;case"rect":if(a=i.data[4],r=i.data[0],n=i.data[1],a){const{a:o,b:h,c:l,d:c,tx:u,ty:d}=a;t.x=o*r+l*n+u,t.y=h*r+c*n+d}else t.x=r,t.y=n;break;default:console.warn(`${i.action} is not supported yet`);break}return t}clear(){return this.instructions.length=0,this.dirty=!0,this}transform(t){if(t.isIdentity())return this;const e=t.a,i=t.b,r=t.c,n=t.d,a=t.tx,o=t.ty;let h=0,l=0,c=0,u=0,d=0,f=0,p=0,m=0;for(let g=0;g<this.instructions.length;g++){const x=this.instructions[g],y=x.data;switch(x.action){case"moveTo":case"lineTo":h=y[0],l=y[1],y[0]=e*h+r*l+a,y[1]=i*h+n*l+o;break;case"bezierCurveTo":c=y[0],u=y[1],d=y[2],f=y[3],h=y[4],l=y[5],y[0]=e*c+r*u+a,y[1]=i*c+n*u+o,y[2]=e*d+r*f+a,y[3]=i*d+n*f+o,y[4]=e*h+r*l+a,y[5]=i*h+n*l+o;break;case"quadraticCurveTo":c=y[0],u=y[1],h=y[2],l=y[3],y[0]=e*c+r*u+a,y[1]=i*c+n*u+o,y[2]=e*h+r*l+a,y[3]=i*h+n*l+o;break;case"arcToSvg":h=y[5],l=y[6],p=y[0],m=y[1],y[0]=e*p+r*m,y[1]=i*p+n*m,y[5]=e*h+r*l+a,y[6]=i*h+n*l+o;break;case"rect":y[4]=bh(y[4],t);break;case"ellipse":y[8]=bh(y[8],t);break;case"roundRect":y[5]=bh(y[5],t);break;case"addPath":y[0].transform(t);break;default:console.warn("unknown transform action",x.action);break}}return this.dirty=!0,this}get bounds(){return this.shapePath.bounds}}function bh(s,t){return s?s.prepend(t):t.clone()}function cv(s,t){if(typeof s=="string"){const i=document.createElement("div");i.innerHTML=s.trim(),s=i.querySelector("svg")}const e={context:t,path:new Wr};return em(s,e,null,null),t}function em(s,t,e,i){const r=s.children,{fillStyle:n,strokeStyle:a}=uv(s);n&&e?e={...e,...n}:n&&(e=n),a&&i?i={...i,...a}:a&&(i=a),t.context.fillStyle=e,t.context.strokeStyle=i;let o,h,l,c,u,d,f,p,m,g,x,y,b,v,_,w,T;switch(s.nodeName.toLowerCase()){case"path":v=s.getAttribute("d"),_=new Wr(v),t.context.path(_),e&&t.context.fill(),i&&t.context.stroke();break;case"circle":f=ne(s,"cx",0),p=ne(s,"cy",0),m=ne(s,"r",0),t.context.ellipse(f,p,m,m),e&&t.context.fill(),i&&t.context.stroke();break;case"rect":o=ne(s,"x",0),h=ne(s,"y",0),w=ne(s,"width",0),T=ne(s,"height",0),g=ne(s,"rx",0),x=ne(s,"ry",0),g||x?t.context.roundRect(o,h,w,T,g||x):t.context.rect(o,h,w,T),e&&t.context.fill(),i&&t.context.stroke();break;case"ellipse":f=ne(s,"cx",0),p=ne(s,"cy",0),g=ne(s,"rx",0),x=ne(s,"ry",0),t.context.beginPath(),t.context.ellipse(f,p,g,x),e&&t.context.fill(),i&&t.context.stroke();break;case"line":l=ne(s,"x1",0),c=ne(s,"y1",0),u=ne(s,"x2",0),d=ne(s,"y2",0),t.context.beginPath(),t.context.moveTo(l,c),t.context.lineTo(u,d),i&&t.context.stroke();break;case"polygon":b=s.getAttribute("points"),y=b.match(/\d+/g).map(S=>parseInt(S,10)),t.context.poly(y,!0),e&&t.context.fill(),i&&t.context.stroke();break;case"polyline":b=s.getAttribute("points"),y=b.match(/\d+/g).map(S=>parseInt(S,10)),t.context.poly(y,!1),i&&t.context.stroke();break;case"g":case"svg":break;default:{console.info(`[SVG parser] <${s.nodeName}> elements unsupported`);break}}for(let S=0;S<r.length;S++)em(r[S],t,e,i)}function ne(s,t,e){const i=s.getAttribute(t);return i?Number(i):e}function uv(s){const t=s.getAttribute("style"),e={},i={};let r=!1,n=!1;if(t){const a=t.split(";");for(let o=0;o<a.length;o++){const h=a[o],[l,c]=h.split(":");switch(l){case"stroke":c!=="none"&&(e.color=ki(c),n=!0);break;case"stroke-width":e.width=Number(c);break;case"fill":c!=="none"&&(r=!0,i.color=ki(c));break;case"fill-opacity":i.alpha=Number(c);break;case"stroke-opacity":e.alpha=Number(c);break;case"opacity":i.alpha=Number(c),e.alpha=Number(c);break}}}else{const a=s.getAttribute("stroke");a&&a!=="none"&&(n=!0,e.color=ki(a),e.width=ne(s,"stroke-width",1));const o=s.getAttribute("fill");o&&o!=="none"&&(r=!0,i.color=ki(o))}return{strokeStyle:n?e:null,fillStyle:r?i:null}}function io(s,t){if(!s)return null;let e,i;if(s!=null&&s.fill?(i=s.fill,e={...t,...s}):(i=s,e=t),typeof i=="number"||typeof i=="string")return{...e,color:ki(i),texture:j.WHITE};if(i instanceof Rc){const n=i;return{...e,color:16777215,texture:n.texture,matrix:n.transform}}else if(i instanceof Dn){const n=i;return n.buildLinearGradient(),{...e,color:16777215,texture:n.texture,matrix:n.transform}}const r={...t,...s};if(r.texture!==j.WHITE){const n=r.matrix||new it;n.scale(1/r.texture.frameWidth,1/r.texture.frameHeight),r.matrix=n,r.color=16777215}return r.color=ki(r.color),r}let dv=0;const ur=new It,Gu=new it,Gs=class extends Rt{constructor(){super(...arguments),this.uid=dv++,this.usage=0,this.dirty=!0,this.batchMode="auto",this.instructions=[],this.activePath=new Wr,this._transform=new it,this._fillStyle={...Gs.defaultFillStyle},this._fillStyleOriginal=16777215,this._strokeStyle={...Gs.defaultStrokeStyle},this._strokeStyleOriginal=16777215,this._stateStack=[],this._tick=0,this._bounds=new Ti,this.boundsDirty=!0}set fillStyle(s){if(this._fillStyleOriginal!==s)if(this._fillStyleOriginal=s,typeof s=="number"||typeof s=="string")this._fillStyle.color=ki(s),this._fillStyle.texture=j.WHITE;else if(s instanceof Rc){const t=s;this._fillStyle.color=16777215,this._fillStyle.texture=t.texture,this._fillStyle.matrix=t.transform}else if(s instanceof Dn){const t=s;t.buildLinearGradient(),this._fillStyle.color=16777215,this._fillStyle.texture=t.texture,this._fillStyle.matrix=t.transform}else this._fillStyle={...Gs.defaultFillStyle,...s}}get fillStyle(){return this._fillStyleOriginal}set strokeStyle(s){if(this._strokeStyleOriginal!==s)if(this._strokeStyleOriginal=s,typeof s=="number"||typeof s=="string")this._strokeStyle.color=ki(s),this._strokeStyle.texture=j.WHITE;else if(s instanceof Dn){const t=s;t.buildLinearGradient(),this._strokeStyle.color=16777215,this._strokeStyle.texture=t.texture,this._strokeStyle.matrix=t.transform}else this._strokeStyle={...Gs.defaultStrokeStyle,...s}}get strokeStyle(){return this._strokeStyleOriginal}setFillStyle(s){return this.fillStyle=s,this}setStrokeStyle(s){return this.strokeStyle=s,this}texture(s,t,e,i,r,n){return this.instructions.push({action:"texture",data:{image:s,dx:e||0,dy:i||0,dw:r||s.frameWidth,dh:n||s.frameHeight,transform:this._transform.clone(),alpha:this._fillStyle.alpha,style:t||16777215}}),this.onUpdate(),this}beginPath(){return this.activePath=new Wr,this}fill(s){let t;const e=this.instructions[this.instructions.length-1];if(this._tick===0&&e&&e.action==="stroke"?t=e.data.path:t=this.activePath.clone(),!t)return this;let i=this._fillStyle;return s&&(i=io(s,Gs.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:i,path:t}}),this.onUpdate(),this.activePath.instructions.length=0,this._tick=0,this}stroke(s){let t;const e=this.instructions[this.instructions.length-1];if(this._tick===0&&e&&e.action==="fill"?t=e.data.path:t=this.activePath.clone(),!t)return this;let i=this._strokeStyle;return s&&(i=io(s,Gs.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:i,path:t}}),this.onUpdate(),this.activePath.instructions.length=0,this._tick=0,this}cut(){for(let s=0;s<2;s++){const t=this.instructions[this.instructions.length-1-s],e=this.activePath.clone();t&&(t.action==="stroke"||t.action==="fill")&&(t.data.hole=e)}return this.activePath.instructions.length=0,this}arc(s,t,e,i,r,n){this._tick++;const a=this._transform;return this.activePath.arc(a.a*s+a.c*t+a.tx,a.b*s+a.d*t+a.ty,e,i,r,n),this}arcTo(s,t,e,i,r){this._tick++;const n=this._transform;return this.activePath.arcTo(n.a*s+n.c*t+n.tx,n.b*s+n.d*t+n.ty,n.a*e+n.c*i+n.tx,n.b*e+n.d*i+n.ty,r),this}arcToSvg(s,t,e,i,r,n,a){this._tick++;const o=this._transform;return this.activePath.arcToSvg(s,t,e,i,r,o.a*n+o.c*a+o.tx,o.b*n+o.d*a+o.ty),this}bezierCurveTo(s,t,e,i,r,n){this._tick++;const a=this._transform;return this.activePath.bezierCurveTo(a.a*s+a.c*t+a.tx,a.b*s+a.d*t+a.ty,a.a*e+a.c*i+a.tx,a.b*e+a.d*i+a.ty,a.a*r+a.c*n+a.tx,a.b*r+a.d*n+a.ty),this}closePath(){var s;return this._tick++,(s=this.activePath)==null||s.closePath(),this}ellipse(s,t,e,i){return this._tick++,this.activePath.ellipse(s,t,e,i,this._transform.clone()),this}circle(s,t,e){return this._tick++,this.activePath.circle(s,t,e,this._transform.clone()),this}path(s){return this._tick++,this.activePath.addPath(s,this._transform.clone()),this}lineTo(s,t){this._tick++;const e=this._transform;return this.activePath.lineTo(e.a*s+e.c*t+e.tx,e.b*s+e.d*t+e.ty),this}moveTo(s,t){this._tick++;const e=this._transform;return this.activePath.moveTo(e.a*s+e.c*t+e.tx,e.b*s+e.d*t+e.ty),this}quadraticCurveTo(s,t,e,i){this._tick++;const r=this._transform;this.activePath.quadraticCurveTo(r.a*s+r.c*t+r.tx,r.b*s+r.d*t+r.ty,r.a*e+r.c*i+r.tx,r.b*e+r.d*i+r.ty)}rect(s,t,e,i){return this._tick++,this.activePath.rect(s,t,e,i,this._transform.clone()),this}roundRect(s,t,e,i,r){return this._tick++,this.activePath.roundRect(s,t,e,i,r,this._transform.clone()),this}poly(s,t){return this._tick++,this.activePath.poly(s,t,this._transform.clone()),this}star(s,t,e,i,r,n){return this._tick++,this.activePath.star(s,t,e,i,r,n,this._transform.clone()),this}svg(s){this._tick++,cv(s,this)}restore(){const s=this._stateStack.pop();s&&(this._transform=s.transform,this._fillStyle=s.fillStyle,this._strokeStyle=s.strokeStyle)}save(){this._stateStack.push({transform:this._transform.clone(),fillStyle:{...this._fillStyle},strokeStyle:{...this._strokeStyle}})}getTransform(){return this._transform}resetTransform(){return this._transform.identity(),this}rotate(s){return this._transform.rotate(s),this}scale(s,t=s){return this._transform.scale(s,t),this}setTransform(s,t,e,i,r,n){return s instanceof it?(this._transform.set(s.a,s.b,s.c,s.d,s.tx,s.ty),this):(this._transform.set(s,t,e,i,r,n),this)}transform(s,t,e,i,r,n){return s instanceof it?(this._transform.append(s),this):(Gu.set(s,t,e,i,r,n),this._transform.append(Gu),this)}translate(s,t){return this._transform.translate(s,t),this}clear(){return this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this.dirty||(this.emit("update",this,16),this.dirty=!0,this.boundsDirty=!0)}get bounds(){if(!this.boundsDirty)return this._bounds;const s=this._bounds;s.clear();for(let t=0;t<this.instructions.length;t++){const e=this.instructions[t],i=e.action;if(i==="fill"){const r=e.data;s.addBounds(r.path.bounds)}else if(i==="texture"){const r=e.data;s.pushMatrix(r.transform),s.addFrame(r.dx,r.dy,r.dx+r.dw,r.dy+r.dh),s.popMatrix()}}return s}containsPoint(s){const t=this.instructions;let e=!1;return t.forEach(i=>{var h;const r=i.data,n=r.path;if(!i.action||!n)return;const a=r.style,o=(h=n.shapePath)==null?void 0:h.shapePrimitives;this._forEachShape(o,l=>{var d;if(!a||!l)return;typeof a!="number"&&a.matrix?a.matrix.applyInverse(s,ur):ur.copyFrom(s),e=l.contains(ur.x,ur.y);const c=r.hole;if(!c)return;const u=(d=c.shapePath)==null?void 0:d.shapePrimitives;u&&this._forEachShape(u,f=>{f.contains(ur.x,ur.y)&&(e=!1)})})}),e}_forEachShape(s,t){s==null||s.forEach(e=>{const i=e==null?void 0:e.shape;i&&t(i)})}destroy(s=!1){if(this._stateStack.length=0,this._transform=null,this.emit("destroy",this),this.removeAllListeners(),typeof s=="boolean"?s:s==null?void 0:s.texture){const e=typeof s=="boolean"?s:s==null?void 0:s.textureSource;this._fillStyle.texture&&this._fillStyle.texture.destroy(e),this._strokeStyle.texture&&this._strokeStyle.texture.destroy(e)}this._fillStyle=null,this._strokeStyle=null,this.instructions=null,this.activePath=null,this._bounds=null,this._stateStack=null,this.transformMatrix=null,this.customShader=null,this._transform=null}};let Fi=Gs;Fi.defaultFillStyle={color:0,alpha:1,texture:j.WHITE};Fi.defaultStrokeStyle={width:1,color:0,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:j.WHITE};const fv=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,pv=".svg",mv="image/svg+xml",gv={extension:{type:L.LoadParser,priority:zi.Low},name:"loadSVG",test(s){return aa(s,mv)||Ii(s,pv)},async testParse(s){return typeof s=="string"&&s.startsWith("data:image/svg+xml")||typeof s=="string"&&fv.test(s)},async parse(s){const t=new Fi;return t.svg(s),t},async load(s){return(await Tt.ADAPTER.fetch(s)).text()}};function bv(s,t=1){var i;const e=(i=Tt.RETINA_PREFIX)==null?void 0:i.exec(s);return e?parseFloat(e[1]):t}let Vu=0,yh;const yv="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",xv={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${yv}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},vv={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`};let xh,_v=class{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const e=URL.createObjectURL(new Blob([xv.code],{type:"application/javascript"})),i=new Worker(e);i.addEventListener("message",r=>{i.terminate(),URL.revokeObjectURL(e),t(r.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){yh===void 0&&(yh=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<yh&&(xh||(xh=URL.createObjectURL(new Blob([vv.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(xh),t.addEventListener("message",e=>{this.complete(e.data),this.returnWorker(e.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const i=new Promise((r,n)=>{this.queue.push({id:t,arguments:e,resolve:r,reject:n})});return this.next(),i}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),i=e.id;this.resolveHash[Vu]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:Vu++,id:i})}};const zu=new _v;function wv(s,t,e){return new j({source:s,label:e})}const Tv=[".jpeg",".jpg",".png",".webp",".avif"],Sv=["image/jpeg","image/png","image/webp","image/avif"];async function Cv(s){const t=await Tt.ADAPTER.fetch(s);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${s}: ${t.status} ${t.statusText}`);const e=await t.blob();return await createImageBitmap(e)}const im={name:"loadTextures",extension:{type:L.LoadParser,priority:zi.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(s){return aa(s,Sv)||Ii(s,Tv)},async load(s,t,e){var n;let i=null;globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await zu.isImageBitmapSupported()?i=await zu.loadImageBitmap(s):i=await Cv(s):i=await new Promise(a=>{i=new Image,i.crossOrigin=this.config.crossOrigin,i.src=s,i.complete?a(i):i.onload=()=>{a(i)}});const r=new Ro({resource:i,resolution:((n=t.data)==null?void 0:n.resolution)||bv(s),...t.data});return wv(r,e,s)},unload(s){s.destroy(!0)}},Av={extension:L.ResolveParser,test:im.test,parse:s=>{var t;return{resolution:parseFloat(((t=Tt.RETINA_PREFIX.exec(s))==null?void 0:t[1])??"1"),format:s.split(".").pop(),src:s}}};$t.add(Cx,Ex,Ax,Bx,Mx,kx,Rx,Ux,Nx,Xx,gv,im,Av,Sx,Tx);const Hu={loader:L.LoadParser,resolver:L.ResolveParser,cache:L.CacheParser,detection:L.DetectionParser};$t.handle(L.Asset,s=>{const t=s.ref;Object.entries(Hu).filter(([e])=>!!t[e]).forEach(([e,i])=>$t.add(Object.assign(t[e],{extension:t[e].extension??i})))},s=>{const t=s.ref;Object.keys(Hu).filter(e=>!!t[e]).forEach(e=>$t.remove(t[e]))});let ye=class{constructor(t,e,i){this._x=e||0,this._y=i||0,this.observer=t}clone(t){return new ye(t,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.observer.onUpdate()),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.observer.onUpdate()),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[@pixi/math:ObservablePoint x=${0} y=${0} scope=${this.observer}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.observer.onUpdate(this))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.observer.onUpdate(this))}};function Ev(s,t,e){const i=s.length;let r;if(t>=i||e===0)return;e=t+e>i?i-t:e;const n=i-e;for(r=t;r<n;++r)s[r]=s[r+e];s.length=n}const Pv={removeChildren(s=0,t){const e=t??this.children.length,i=e-s,r=[];if(i>0&&i<=e){for(let n=e-1;n>=s;n--){const a=this.children[n];a&&(this.layerGroup&&this.layerGroup.removeChild(a),r.push(a),a.parent=null)}Ev(this.children,s,e);for(let n=0;n<r.length;++n)this.emit("childRemoved",r[n],this,n),r[n].emit("removed",this);return r}else if(i===0&&this.children.length===0)return r;throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},removeChildAt(s){const t=this.getChildAt(s);return this.removeChild(t)},getChildAt(s){if(s<0||s>=this.children.length)throw new Error(`getChildAt: Index (${s}) does not exist.`);return this.children[s]},setChildIndex(s,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);this.getChildIndex(s),this.addChildAt(s,t)},getChildIndex(s){const t=this.children.indexOf(s);if(t===-1)throw new Error("The supplied Container must be a child of the caller");return t},addChildAt(s,t){const{children:e}=this;if(t<0||t>e.length)throw new Error(`${s}addChildAt: The index ${t} supplied is out of bounds ${e.length}`);if(s.parent){const i=s.parent.children.indexOf(s);if(s.parent===this&&i===t)return s;i!==-1&&s.parent.children.splice(i,1)}return t===e.length?e.push(s):e.splice(t,0,s),s.parent=this,s.didChange=!0,s.didViewUpdate=!1,s.updateFlags=15,this.layerGroup&&this.layerGroup.addChild(s),this.emit("childAdded",s,this,t),s.emit("added",this),s},swapChildren(s,t){if(s===t)return;const e=this.getChildIndex(s),i=this.getChildIndex(t);this.children[e]=t,this.children[i]=s},removeFromParent(){var s;(s=this.parent)==null||s.removeChild(this)}};class Uc{constructor(t){this.pipe="filter",this.priority=1,this.filters=t==null?void 0:t.filters}destroy(){for(let t=0;t<this.filters.length;t++)this.filters[t].destroy();this.filters=null}}const sm=[];function Mv(s){const t=sm.pop()||new Uc;return t.filters=s,t}function kv(s){s.filters=null,sm.push(s)}let Rv=class{constructor(t,e){this._pool=[],this._count=0,this._index=0,this._classType=t,e&&this.prepopulate(e)}prepopulate(t){for(let e=0;e<t;e++)this._pool[this._index++]=new this._classType;this._count+=t}get(t){var i;let e;return this._index>0?e=this._pool[--this._index]:e=new this._classType,(i=e.init)==null||i.call(e,t),e}return(t){var e;(e=t.reset)==null||e.call(t),this._pool[this._index++]=t}get totalSize(){return this._count}get totalFree(){return this._pool.length}get totalUsed(){return this._count-this._pool.length}};class Bv{constructor(){this._poolsByClass=new Map}prepopulate(t,e){this.getPool(t).prepopulate(e)}get(t,e){return this.getPool(t).get(e)}return(t){this.getPool(t.constructor).return(t)}getPool(t){return this._poolsByClass.has(t)||this._poolsByClass.set(t,new Rv(t)),this._poolsByClass.get(t)}stats(){const t={};return this._poolsByClass.forEach(e=>{const i=t[e._classType.name]?e._classType.name+e._classType.ID:e._classType.name;t[i]={free:e.totalFree,used:e.totalUsed,size:e.totalSize}}),t}}const Ft=new Bv;class Iv{constructor(){this._effectClasses=[],this.tests=[],this._initialized=!1}init(){this._initialized||(this._initialized=!0,this._effectClasses.forEach(t=>{this.add({test:t.test,maskClass:t})}))}add(t){this.tests.push(t)}getMaskEffect(t){this._initialized||this.init();for(let e=0;e<this.tests.length;e++){const i=this.tests[e];if(i.test(t))return Ft.get(i.maskClass,t)}return t}returnMaskEffect(t){Ft.return(t)}}const Ml=new Iv;$t.handleByList(L.MaskEffect,Ml._effectClasses);const Fv={_mask:null,_filters:null,set mask(s){if(this._mask||(this._mask={mask:null,effect:null}),this._mask.mask===s||(this._mask.effect&&(this.removeEffect(this._mask.effect),Ml.returnMaskEffect(this._mask.effect),this._mask.effect=null),this._mask.mask=s,s==null))return;const t=Ml.getMaskEffect(s);this._mask.effect=t,this.addEffect(t)},get mask(){var s;return(s=this._mask)==null?void 0:s.mask},set filters(s){if(!Array.isArray(s)&&s!==null&&(s=[s]),this._filters||(this._filters={filters:null,effect:null}),this._filters.filters===s||(this._filters.effect&&(this.removeEffect(this._filters.effect),kv(this._filters.effect),this._filters.effect=null),this._filters.filters=s,!s))return;const t=Mv(s);this._filters.effect=t,this.addEffect(t)},get filters(){var s;return(s=this._filters)==null?void 0:s.filters}},Uv={getChildByLabel(s,t=!1){const e=this.children;for(let i=0;i<e.length;i++){const r=e[i];if(r.label===s||s instanceof RegExp&&s.test(r.label))return r}if(t)for(let i=0;i<e.length;i++){const n=e[i].getChildByLabel(s,!0);if(n)return n}return null},getChildrenByLabel(s,t=!1,e=[]){const i=this.children;for(let r=0;r<i.length;r++){const n=i[r];(n.label===s||s instanceof RegExp&&s.test(n.label))&&e.push(n)}if(t)for(let r=0;r<i.length;r++)i[r].getChildrenByLabel(s,!0,e);return e}};function er(s,t){const e=t._scale,i=t._pivot,r=t.position,n=e._x,a=e._y,o=i._x,h=i._y;s.a=t._cx*n,s.b=t._sx*n,s.c=t._cy*a,s.d=t._sy*a,s.tx=r._x-(o*s.a+h*s.c),s.ty=r._y-(o*s.b+h*s.d)}function Io(s,t,e){e.clear();let i;return s.parent?t?i=s.parent.worldTransform:i=so(s,new it):i=it.IDENTITY,rm(s,e,i,t),e.isValid||e.set(0,0,0,0),e}function rm(s,t,e,i){var o,h;if(!s.visible||!s.measurable)return;let r;i?r=s.worldTransform:(s.didChange&&er(s.localTransform,s),r=it.shared.appendFrom(s.localTransform,e).clone());const n=t,a=!!s.effects.length;a&&(t=t.clone()),s.view&&(t.setMatrix(r),s.view.addBounds(t));for(let l=0;l<s.children.length;l++)rm(s.children[l],t,r,i);if(a){for(let l=0;l<s.effects.length;l++)(h=(o=s.effects[l]).addBounds)==null||h.call(o,t);n.addBounds(t)}}function so(s,t){const e=s.parent;return e&&(so(e,t),e.didChange&&er(e.localTransform,e),t.append(e.localTransform)),t}function xr(s,t,e){t.clear(),e||(e=new it),s.view&&(t.setMatrix(e),s.view.addBounds(t));for(let i=0;i<s.children.length;i++)nm(s.children[i],t,e,s);return t.isValid||t.set(0,0,0,0),t}function nm(s,t,e,i){var a,o;if(!s.visible||!s.measurable)return;s.didChange&&er(s.localTransform,s);const r=s.localTransform,n=it.shared.appendFrom(r,e).clone();s.view&&(t.setMatrix(n),s.view.addBounds(t));for(let h=0;h<s.children.length;h++)nm(s.children[h],t,n,i);for(let h=0;h<s.effects.length;h++)(o=(a=s.effects[h]).addLocalBounds)==null||o.call(a,t,i)}const dr=new Ti,ba=new it,Lv={get width(){return this.scale.x*xr(this,dr,ba).width},set width(s){this.scale.x=s/xr(this,dr,ba).width},get height(){return this.scale.y*xr(this,dr,ba).height},set height(s){this.scale.y=s/xr(this,dr,ba).height},getLocalBounds(){return xr(this,dr,this.localTransform).rectangle},getBounds(s){return Io(this,s,dr).rectangle}},Ov={_onRender:null,set onRender(s){const t=this.layerGroup;if(!s){this._onRender&&(t==null||t.removeOnRender(this)),this._onRender=null;return}this._onRender||t==null||t.addOnRender(this),this._onRender=s},get onRender(){return this._onRender}},Nv={getGlobalPosition(s=new It,t=!1){return this.parent?this.parent.toGlobal(this.position,s,t):(s.x=this.position.x,s.y=this.position.y),s},toGlobal(s,t,e=!1){if(!e){this.didChange&&er(this.localTransform,this);const i=so(this,new it);return i.append(this.localTransform),i.apply(s,t)}return this.worldTransform.apply(s,t)},toLocal(s,t,e,i){if(t&&(s=t.toGlobal(s,e,i)),!i){this.didChange&&er(this.localTransform,this);const r=so(this,new it);return r.append(this.localTransform),r.applyInverse(s,e)}return this.worldTransform.applyInverse(s,e)}};let Dv=0;class Gv{constructor(){this.uid=Dv++,this.instructions=[],this.instructionSize=0}reset(){this.instructionSize=0}add(t){this.instructions[this.instructionSize++]=t}log(){this.instructions.length=this.instructionSize,console.table(this.instructions,["type","action"])}lastInstruction(){return this.instructions[this.instructionSize-1]}}class Vv{constructor(t){this.type="layer",this.root=null,this.rootRenderable=null,this.canBundle=!1,this.layerGroupParent=null,this.layerGroupChildren=[],this.children=[],this.worldTransform=new it,this.worldColor=4294967295,this.childrenToUpdate={},this.updateTick=0,this.childrenRenderablesToUpdate={list:[],index:0},this.structureDidChange=!0,this.instructionSet=new Gv,this.onRenderContainers=[],this.root=t,this.addChild(t)}get localTransform(){return this.root.localTransform}get layerTransform(){return this.root.layerTransform}addLayerGroupChild(t){t.layerGroupParent&&t.layerGroupParent.removeLayerGroupChild(t),t.layerGroupParent=this,this.onChildUpdate(t.root),this.layerGroupChildren.push(t)}removeLayerGroupChild(t){t.root.didChange&&this.removeChildFromUpdate(t.root);const e=this.layerGroupChildren.indexOf(t);e>-1&&this.layerGroupChildren.splice(e,1),t.layerGroupParent=null}addChild(t){if(this.structureDidChange=!0,t!==this.root&&(this.children.push(t),t.updateTick=-1,t.parent===this.root?t.relativeLayerDepth=1:t.relativeLayerDepth=t.parent.relativeLayerDepth+1,t._onRender&&this.addOnRender(t)),t.layerGroup){if(t.layerGroup.root===t){this.addLayerGroupChild(t.layerGroup);return}}else t.layerGroup=this,t.didChange=!0;const e=t.children;t.isLayerRoot||this.onChildUpdate(t);for(let i=0;i<e.length;i++)this.addChild(e[i])}removeChild(t){if(this.structureDidChange=!0,t._onRender&&this.removeOnRender(t),t.layerGroup.root!==t){const i=t.children;for(let r=0;r<i.length;r++)this.removeChild(i[r]);t.didChange&&t.layerGroup.removeChildFromUpdate(t),t.layerGroup=null}else this.removeLayerGroupChild(t.layerGroup);const e=this.children.indexOf(t);e>-1&&this.children.splice(e,1)}onChildUpdate(t){let e=this.childrenToUpdate[t.relativeLayerDepth];e||(e=this.childrenToUpdate[t.relativeLayerDepth]={index:0,list:[]}),e.list[e.index++]=t}updateRenderable(t){t.layerVisibleRenderable<3||(t.didViewUpdate=!1,this.instructionSet.renderPipes[t.view.type].updateRenderable(t))}onChildViewUpdate(t){this.childrenRenderablesToUpdate.list[this.childrenRenderablesToUpdate.index++]=t}removeChildFromUpdate(t){const e=this.childrenToUpdate[t.relativeLayerDepth];if(!e)return;const i=e.list.indexOf(t);i>-1&&e.list.splice(i,1),e.index--}get isRenderable(){const t=this.worldColor>>24&255;return this.root.localVisibleRenderable===3&&t>0}addOnRender(t){this.onRenderContainers.push(t)}removeOnRender(t){this.onRenderContainers.splice(this.onRenderContainers.indexOf(t),1)}runOnRender(){this.onRenderContainers.forEach(t=>{t._onRender()})}}let am=0;function om(){return am++}const Xu=new ye(null),$u=new ye(null),Wu=new ye(null,1,1),kl=1,hm=2,Rl=4;class W extends Rt{constructor({label:t,layer:e,view:i}={}){super(),this.uid=am++,this.label=null,this.updateFlags=15,this.isLayerRoot=!1,this.layerGroup=null,this.didChange=!1,this.didViewUpdate=!1,this.relativeLayerDepth=0,this.children=[],this.parent=null,this.includeInBuild=!0,this.measurable=!0,this.isSimple=!0,this.updateTick=-1,this.localTransform=new it,this.layerTransform=new it,this.position=new ye(this,0,0),this._scale=Wu,this._pivot=$u,this._skew=Xu,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._rotation=0,this.localColor=4294967295,this.layerColor=4294967295,this.localBlendMode="inherit",this.layerBlendMode="normal",this.localVisibleRenderable=3,this.layerVisibleRenderable=3,this.effects=[],t&&(this.label=t),e&&this.enableLayer(),i&&(this.view=i,this.view.owner=this)}static mixin(t){Object.defineProperties(W.prototype,Object.getOwnPropertyDescriptors(t))}addEffect(t){this.effects.indexOf(t)===-1&&(this.effects.push(t),this.effects.sort((i,r)=>i.priority-r.priority),!this.isLayerRoot&&this.layerGroup&&(this.layerGroup.structureDidChange=!0),this.updateIsSimple())}removeEffect(t){const e=this.effects.indexOf(t);e!==-1&&(this.effects.splice(e,1),!this.isLayerRoot&&this.layerGroup&&(this.layerGroup.structureDidChange=!0),this.updateIsSimple())}addChild(...t){if(t.length>1){for(let i=0;i<t.length;i++)this.addChild(t[i]);return t[0]}const e=t[0];return e.parent===this?(this.children.splice(this.children.indexOf(e),1),this.children.push(e),this.layerGroup&&!this.isLayerRoot&&(this.layerGroup.structureDidChange=!0),e):(e.parent&&e.parent.removeChild(e),this.children.push(e),e.parent=this,e.didChange=!0,e.didViewUpdate=!1,e.updateFlags=15,this.layerGroup&&this.layerGroup.addChild(e),e)}removeChild(...t){if(t.length>1){for(let r=0;r<t.length;r++)this.removeChild(t[r]);return t[0]}const e=t[0],i=this.children.indexOf(e);return i>-1&&(this.children.splice(i,1),this.layerGroup&&this.layerGroup.removeChild(e)),e.parent=null,e}onUpdate(t){if(t&&t===this._skew&&this.updateSkew(),!this.didChange)if(this.didChange=!0,this.isLayerRoot){const e=this.layerGroup.layerGroupParent;e&&e.onChildUpdate(this)}else this.layerGroup&&this.layerGroup.onChildUpdate(this)}onViewUpdate(){this.didViewUpdate||(this.didViewUpdate=!0,this.layerGroup&&this.layerGroup.onChildViewUpdate(this))}set layer(t){if(this.isLayerRoot&&t===!1)throw new Error("[Pixi] cannot undo a layer just yet");t&&this.enableLayer()}get layer(){return this.isLayerRoot}enableLayer(){if(this.layerGroup&&this.layerGroup.root===this)return;this.isLayerRoot=!0;const t=this.layerGroup;if(t&&t.removeChild(this),this.layerGroup=new Vv(this),t){for(let e=0;e<t.layerGroupChildren.length;e++){const i=t.layerGroupChildren[e];let r=i.root;for(;r;){if(r===this){this.layerGroup.addLayerGroupChild(i);break}r=r.parent}}t.addLayerGroupChild(this.layerGroup)}this.updateIsSimple()}get worldTransform(){return this._worldTransform||(this._worldTransform=new it),this.layerGroup&&(this.isLayerRoot?this._worldTransform.copyFrom(this.layerGroup.worldTransform):this._worldTransform.appendFrom(this.layerTransform,this.layerGroup.worldTransform)),this._worldTransform}get x(){return this.position.x}set x(t){this.position.x=t}get y(){return this.position.y}set y(t){this.position.y=t}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this.onUpdate(this._skew))}get angle(){return this.rotation*gx}set angle(t){this.rotation=t*bx}get pivot(){return this._pivot===$u&&(this._pivot=new ye(this,0,0)),this._pivot}get skew(){return this._skew===Xu&&(this._skew=new ye(this,0,0)),this._skew}get scale(){return this._scale===Wu&&(this._scale=new ye(this,1,1)),this._scale}updateSkew(){const t=this._rotation,e=this._skew;this._cx=Math.cos(t+e._y),this._sx=Math.sin(t+e._y),this._cy=-Math.sin(t-e._x),this._sy=Math.cos(t-e._x)}set alpha(t){t=t*255|0,t!==(this.localColor>>24&255)&&(this.localColor=this.localColor&16777215|t<<24,this.updateFlags|=kl,this.onUpdate())}get alpha(){return(this.localColor>>24&255)/255}set tint(t){t=((t&255)<<16)+(t&65280)+(t>>16&255),t!==(this.localColor&16777215)&&(this.localColor=this.localColor&4278190080|t&16777215,this.updateFlags|=kl,this.onUpdate())}get tint(){const t=this.localColor&16777215;return((t&255)<<16)+(t&65280)+(t>>16&255)}set blendMode(t){this.localBlendMode!==t&&(this.layerGroup&&!this.isLayerRoot&&(this.layerGroup.structureDidChange=!0),this.updateFlags|=hm,this.localBlendMode=t,this.onUpdate())}get blendMode(){return this.localBlendMode}get visible(){return!!(this.localVisibleRenderable&2)}set visible(t){const e=t?1:0;(this.localVisibleRenderable&2)>>1!==e&&(this.layerGroup&&!this.isLayerRoot&&(this.layerGroup.structureDidChange=!0),this.updateFlags|=Rl,this.localVisibleRenderable=this.localVisibleRenderable&1|e<<1,this.onUpdate())}get renderable(){return!!(this.localVisibleRenderable&1)}set renderable(t){const e=t?1:0;(this.localVisibleRenderable&1)!==e&&(this.localVisibleRenderable=this.localVisibleRenderable&2|e,this.updateFlags|=Rl,this.layerGroup&&!this.isLayerRoot&&(this.layerGroup.structureDidChange=!0),this.onUpdate())}get isRenderable(){const t=this.layerColor>>24&255;return this.localVisibleRenderable===3&&t>0}updateIsSimple(){this.isSimple=!this.isLayerRoot&&this.effects.length===0}destroy(t=!1){this.removeFromParent(),this.parent=null,this._mask=null,this._filters=null,this.effects=null,this.position=null,this._scale=null,this._pivot=null,this._skew=null,this.emit("destroyed"),this.removeAllListeners();const e=typeof t=="boolean"?t:t==null?void 0:t.children,i=this.removeChildren(0,this.children.length);if(e)for(let r=0;r<i.length;++r)i[r].destroy(t);this.view&&(this.view.destroy(t),this.view.owner=null)}}W.mixin(Pv);W.mixin(Nv);W.mixin(Ov);W.mixin(Lv);W.mixin(Fv);W.mixin(Uv);class zv{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){this.tickerAdded||!this.domElement||(ts.system.add(this.tickerUpdate,this,On.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(ts.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&t.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t.deltaTime,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}}const fs=new zv;class Fo{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=Fo.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new It,this.page=new It,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,i){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,i,r,n){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class ro extends Fo{constructor(){super(...arguments),this.client=new It,this.movement=new It,this.offset=new It,this.global=new It,this.screen=new It}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,i){return t.worldTransform.applyInverse(i||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,i,r,n,a,o,h,l,c,u,d,f,p,m){throw new Error("Method not implemented.")}}class ri extends ro{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class Yr extends ro{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}Yr.DOM_DELTA_PIXEL=0;Yr.DOM_DELTA_LINE=1;Yr.DOM_DELTA_PAGE=2;const Hv=2048,Xv=new It,un=new It;class $v{constructor(t){this.dispatch=new Rt,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((i,r)=>i.priority-r.priority)}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let i=0,r=e.length;i<r;i++)e[i].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){fs.pauseUpdate=!0;const r=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",n=this[r](this.rootTarget,this.rootTarget.eventMode,Xv.set(t,e),this.hitTestFn,this.hitPruneFn);return n&&n[0]}propagate(t,e){if(!t.target)return;const i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let r=0,n=i.length-1;r<n;r++)if(t.currentTarget=i[r],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let r=i.length-2;r>=0;r--)if(t.currentTarget=i[r],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,i=this._allInteractiveElements){if(i.length===0)return;t.eventPhase=t.BUBBLING_PHASE;const r=Array.isArray(e)?e:[e];for(let n=i.length-1;n>=0;n--)r.forEach(a=>{t.currentTarget=i[n],this.notifyTarget(t,a)})}propagationPath(t){const e=[t];for(let i=0;i<Hv&&t!==this.rootTarget&&t.parent;i++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,i,r,n,a=!1){let o=!1;if(this._interactivePrune(t))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(fs.pauseUpdate=!1),t.interactiveChildren&&t.children){const c=t.children;for(let u=c.length-1;u>=0;u--){const d=c[u],f=this.hitTestMoveRecursive(d,this._isInteractive(e)?e:d.eventMode,i,r,n,a||n(t,i));if(f){if(f.length>0&&!f[f.length-1].parent)continue;const p=t.isInteractive();(f.length>0||p)&&(p&&this._allInteractiveElements.push(t),f.push(t)),this._hitElements.length===0&&(this._hitElements=f),o=!0}}}const h=this._isInteractive(e),l=t.isInteractive();return l&&l&&this._allInteractiveElements.push(t),a||this._hitElements.length>0?null:o?this._hitElements:h&&!n(t,i)&&r(t,i)?l?[t]:[]:null}hitTestRecursive(t,e,i,r,n){if(this._interactivePrune(t)||n(t,i))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(fs.pauseUpdate=!1),t.interactiveChildren&&t.children){const h=t.children,l=i;for(let c=h.length-1;c>=0;c--){const u=h[c],d=this.hitTestRecursive(u,this._isInteractive(e)?e:u.eventMode,l,r,n);if(d){if(d.length>0&&!d[d.length-1].parent)continue;const f=t.isInteractive();return(d.length>0||f)&&d.push(t),d}}}const a=this._isInteractive(e),o=t.isInteractive();return a&&r(t,i)?o?[t]:[]:null}_isInteractive(t){return t==="static"||t==="dynamic"}_interactivePrune(t){return!t||!t.visible||!t.renderable||t.eventMode==="none"||t.eventMode==="passive"&&!t.interactiveChildren}hitPruneFn(t,e){if(t.hitArea&&(t.worldTransform.applyInverse(e,un),!t.hitArea.contains(un.x,un.y)))return!0;if(t.effects&&t.effects.length){let i=!1;for(let r=0;r<t.effects.length;r++){const n=t.effects[r];if(n.containsPoint){if(!n.containsPoint(e))return!1;i=!0}}return i}return!1}hitTestFn(t,e){var i;return t.eventMode==="passive"?!1:t.hitArea?!0:(i=t.view)!=null&&i.containsPoint?(t.worldTransform.applyInverse(e,un),t.view.containsPoint(un)):!1}notifyTarget(t,e){var n,a;e=e??t.type;const i=`on${e}`;(a=(n=t.currentTarget)[i])==null||a.call(n,t);const r=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,r),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof ri)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),e.pointerType==="touch")this.dispatchEvent(e,"touchstart");else if(e.pointerType==="mouse"||e.pointerType==="pen"){const r=e.button===2;this.dispatchEvent(e,r?"rightdown":"mousedown")}const i=this.trackingData(t.pointerId);i.pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){var h,l;if(!(t instanceof ri)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const e=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const i=e.pointerType==="mouse"||e.pointerType==="pen",r=this.trackingData(t.pointerId),n=this.findMountedTarget(r.overTargets);if(((h=r.overTargets)==null?void 0:h.length)>0&&n!==e.target){const c=t.type==="mousemove"?"mouseout":"pointerout",u=this.createPointerEvent(t,c,n);if(this.dispatchEvent(u,"pointerout"),i&&this.dispatchEvent(u,"mouseout"),!e.composedPath().includes(n)){const d=this.createPointerEvent(t,"pointerleave",n);for(d.eventPhase=d.AT_TARGET;d.target&&!e.composedPath().includes(d.target);)d.currentTarget=d.target,this.notifyTarget(d),i&&this.notifyTarget(d,"mouseleave"),d.target=d.target.parent;this.freeEvent(d)}this.freeEvent(u)}if(n!==e.target){const c=t.type==="mousemove"?"mouseover":"pointerover",u=this.clonePointerEvent(e,c);this.dispatchEvent(u,"pointerover"),i&&this.dispatchEvent(u,"mouseover");let d=n==null?void 0:n.parent;for(;d&&d!==this.rootTarget.parent&&d!==e.target;)d=d.parent;if(!d||d===this.rootTarget.parent){const p=this.clonePointerEvent(e,"pointerenter");for(p.eventPhase=p.AT_TARGET;p.target&&p.target!==n&&p.target!==this.rootTarget.parent;)p.currentTarget=p.target,this.notifyTarget(p),i&&this.notifyTarget(p,"mouseenter"),p.target=p.target.parent;this.freeEvent(p)}this.freeEvent(u)}const a=[],o=this.enableGlobalMoveEvents??!0;this.moveOnAll?a.push("pointermove"):this.dispatchEvent(e,"pointermove"),o&&a.push("globalpointermove"),e.pointerType==="touch"&&(this.moveOnAll?a.splice(1,0,"touchmove"):this.dispatchEvent(e,"touchmove"),o&&a.push("globaltouchmove")),i&&(this.moveOnAll?a.splice(1,0,"mousemove"):this.dispatchEvent(e,"mousemove"),o&&a.push("globalmousemove"),this.cursor=(l=e.target)==null?void 0:l.cursor),a.length>0&&this.all(e,a),this._allInteractiveElements.length=0,this._hitElements.length=0,r.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){var a;if(!(t instanceof ri)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),i=this.createPointerEvent(t),r=i.pointerType==="mouse"||i.pointerType==="pen";this.dispatchEvent(i,"pointerover"),r&&this.dispatchEvent(i,"mouseover"),i.pointerType==="mouse"&&(this.cursor=(a=i.target)==null?void 0:a.cursor);const n=this.clonePointerEvent(i,"pointerenter");for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),r&&this.notifyTarget(n,"mouseenter"),n.target=n.target.parent;e.overTargets=i.composedPath(),this.freeEvent(i),this.freeEvent(n)}mapPointerOut(t){if(!(t instanceof ri)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId);if(e.overTargets){const i=t.pointerType==="mouse"||t.pointerType==="pen",r=this.findMountedTarget(e.overTargets),n=this.createPointerEvent(t,"pointerout",r);this.dispatchEvent(n),i&&this.dispatchEvent(n,"mouseout");const a=this.createPointerEvent(t,"pointerleave",r);for(a.eventPhase=a.AT_TARGET;a.target&&a.target!==this.rootTarget.parent;)a.currentTarget=a.target,this.notifyTarget(a),i&&this.notifyTarget(a,"mouseleave"),a.target=a.target.parent;e.overTargets=null,this.freeEvent(n),this.freeEvent(a)}this.cursor=null}mapPointerUp(t){if(!(t instanceof ri)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=performance.now(),i=this.createPointerEvent(t);if(this.dispatchEvent(i,"pointerup"),i.pointerType==="touch")this.dispatchEvent(i,"touchend");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const o=i.button===2;this.dispatchEvent(i,o?"rightup":"mouseup")}const r=this.trackingData(t.pointerId),n=this.findMountedTarget(r.pressTargetsByButton[t.button]);let a=n;if(n&&!i.composedPath().includes(n)){let o=n;for(;o&&!i.composedPath().includes(o);){if(i.currentTarget=o,this.notifyTarget(i,"pointerupoutside"),i.pointerType==="touch")this.notifyTarget(i,"touchendoutside");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const h=i.button===2;this.notifyTarget(i,h?"rightupoutside":"mouseupoutside")}o=o.parent}delete r.pressTargetsByButton[t.button],a=o}if(a){const o=this.clonePointerEvent(i,"click");o.target=a,o.path=null,r.clicksByButton[t.button]||(r.clicksByButton[t.button]={clickCount:0,target:o.target,timeStamp:e});const h=r.clicksByButton[t.button];if(h.target===o.target&&e-h.timeStamp<200?++h.clickCount:h.clickCount=1,h.target=o.target,h.timeStamp=e,o.detail=h.clickCount,o.pointerType==="mouse"){const l=o.button===2;this.dispatchEvent(o,l?"rightclick":"click")}else o.pointerType==="touch"&&this.dispatchEvent(o,"tap");this.dispatchEvent(o,"pointertap"),this.freeEvent(o)}this.freeEvent(i)}mapPointerUpOutside(t){if(!(t instanceof ri)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),i=this.findMountedTarget(e.pressTargetsByButton[t.button]),r=this.createPointerEvent(t);if(i){let n=i;for(;n;)r.currentTarget=n,this.notifyTarget(r,"pointerupoutside"),r.pointerType==="touch"?this.notifyTarget(r,"touchendoutside"):(r.pointerType==="mouse"||r.pointerType==="pen")&&this.notifyTarget(r,r.button===2?"rightupoutside":"mouseupoutside"),n=n.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(r)}mapWheel(t){if(!(t instanceof Yr)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let i=1;i<t.length&&t[i].parent===e;i++)e=t[i];return e}createPointerEvent(t,e,i){const r=this.allocateEvent(ri);return this.copyPointerData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.nativeEvent=t.nativeEvent,r.originalEvent=t,r.target=i??this.hitTest(r.global.x,r.global.y)??this._hitElements[0],typeof e=="string"&&(r.type=e),r}createWheelEvent(t){const e=this.allocateEvent(Yr);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const i=this.allocateEvent(ri);return i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice(),i.type=e??i.type,i}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof ri&&e instanceof ri&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof ro&&e instanceof ro&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const i=t.currentTarget._events[e];if(i&&t.currentTarget.isInteractive())if("fn"in i)i.once&&t.currentTarget.removeListener(e,i.fn,void 0,!0),i.fn.call(i.context,t);else for(let r=0,n=i.length;r<n&&!t.propagationImmediatelyStopped;r++)i[r].once&&t.currentTarget.removeListener(e,i[r].fn,void 0,!0),i[r].fn.call(i[r].context,t)}}const Wv=1,Yv={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},Bl=class{constructor(s){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=s,this.rootBoundary=new $v(null),fs.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new ri(null),this.rootWheelEvent=new Yr(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...Bl.defaultEventFeatures},{set:(t,e,i)=>(e==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=i),t[e]=i,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(s){const{element:t,resolution:e}=this.renderer;this.setTargetElement(t),this.resolution=e,Bl._defaultEventMode=s.eventMode??"passive",Object.assign(this.features,s.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(s){this.resolution=s}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(s){s=s||"default";let t=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(t=!1),this.currentCursor===s)return;this.currentCursor=s;const e=this.cursorStyles[s];if(e)switch(typeof e){case"string":t&&(this.domElement.style.cursor=e);break;case"function":e(s);break;case"object":t&&Object.assign(this.domElement.style,e);break}else t&&typeof s=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,s)&&(this.domElement.style.cursor=s)}get pointer(){return this.rootPointerEvent}onPointerDown(s){if(!this.features.click||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&s.pointerType==="touch"))return;const t=this.normalizeToPointerData(s);this.autoPreventDefault&&t[0].isNormalized&&(s.cancelable||!("cancelable"in s))&&s.preventDefault();for(let e=0,i=t.length;e<i;e++){const r=t[e],n=this.bootstrapEvent(this.rootPointerEvent,r);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(s){if(!this.features.move||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&s.pointerType==="touch"))return;fs.pointerMoved();const t=this.normalizeToPointerData(s);for(let e=0,i=t.length;e<i;e++){const r=this.bootstrapEvent(this.rootPointerEvent,t[e]);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(s){if(!this.features.click||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&s.pointerType==="touch"))return;let t=s.target;s.composedPath&&s.composedPath().length>0&&(t=s.composedPath()[0]);const e=t!==this.domElement?"outside":"",i=this.normalizeToPointerData(s);for(let r=0,n=i.length;r<n;r++){const a=this.bootstrapEvent(this.rootPointerEvent,i[r]);a.type+=e,this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(s){if(!this.features.click||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&s.pointerType==="touch"))return;const t=this.normalizeToPointerData(s);for(let e=0,i=t.length;e<i;e++){const r=this.bootstrapEvent(this.rootPointerEvent,t[e]);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}onWheel(s){if(!this.features.wheel)return;const t=this.normalizeWheelEvent(s);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(t)}setTargetElement(s){this.removeEvents(),this.domElement=s,fs.domElement=s,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;fs.addTickerListener();const s=this.domElement.style;s&&(globalThis.navigator.msPointerEnabled?(s.msContentZooming="none",s.msTouchAction="none"):this.supportsPointerEvents&&(s.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;fs.removeTickerListener();const s=this.domElement.style;globalThis.navigator.msPointerEnabled?(s.msContentZooming="",s.msTouchAction=""):this.supportsPointerEvents&&(s.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(s,t,e){const i=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},r=1/this.resolution;s.x=(t-i.left)*(this.domElement.width/i.width)*r,s.y=(e-i.top)*(this.domElement.height/i.height)*r}normalizeToPointerData(s){const t=[];if(this.supportsTouchEvents&&s instanceof TouchEvent)for(let e=0,i=s.changedTouches.length;e<i;e++){const r=s.changedTouches[e];typeof r.button>"u"&&(r.button=0),typeof r.buttons>"u"&&(r.buttons=1),typeof r.isPrimary>"u"&&(r.isPrimary=s.touches.length===1&&s.type==="touchstart"),typeof r.width>"u"&&(r.width=r.radiusX||1),typeof r.height>"u"&&(r.height=r.radiusY||1),typeof r.tiltX>"u"&&(r.tiltX=0),typeof r.tiltY>"u"&&(r.tiltY=0),typeof r.pointerType>"u"&&(r.pointerType="touch"),typeof r.pointerId>"u"&&(r.pointerId=r.identifier||0),typeof r.pressure>"u"&&(r.pressure=r.force||.5),typeof r.twist>"u"&&(r.twist=0),typeof r.tangentialPressure>"u"&&(r.tangentialPressure=0),typeof r.layerX>"u"&&(r.layerX=r.offsetX=r.clientX),typeof r.layerY>"u"&&(r.layerY=r.offsetY=r.clientY),r.isNormalized=!0,r.type=s.type,t.push(r)}else if(!globalThis.MouseEvent||s instanceof MouseEvent&&(!this.supportsPointerEvents||!(s instanceof globalThis.PointerEvent))){const e=s;typeof e.isPrimary>"u"&&(e.isPrimary=!0),typeof e.width>"u"&&(e.width=1),typeof e.height>"u"&&(e.height=1),typeof e.tiltX>"u"&&(e.tiltX=0),typeof e.tiltY>"u"&&(e.tiltY=0),typeof e.pointerType>"u"&&(e.pointerType="mouse"),typeof e.pointerId>"u"&&(e.pointerId=Wv),typeof e.pressure>"u"&&(e.pressure=.5),typeof e.twist>"u"&&(e.twist=0),typeof e.tangentialPressure>"u"&&(e.tangentialPressure=0),e.isNormalized=!0,t.push(e)}else t.push(s);return t}normalizeWheelEvent(s){const t=this.rootWheelEvent;return this.transferMouseData(t,s),t.deltaX=s.deltaX,t.deltaY=s.deltaY,t.deltaZ=s.deltaZ,t.deltaMode=s.deltaMode,this.mapPositionToPoint(t.screen,s.clientX,s.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.nativeEvent=s,t.type=s.type,t}bootstrapEvent(s,t){return s.originalEvent=null,s.nativeEvent=t,s.pointerId=t.pointerId,s.width=t.width,s.height=t.height,s.isPrimary=t.isPrimary,s.pointerType=t.pointerType,s.pressure=t.pressure,s.tangentialPressure=t.tangentialPressure,s.tiltX=t.tiltX,s.tiltY=t.tiltY,s.twist=t.twist,this.transferMouseData(s,t),this.mapPositionToPoint(s.screen,t.clientX,t.clientY),s.global.copyFrom(s.screen),s.offset.copyFrom(s.screen),s.isTrusted=t.isTrusted,s.type==="pointerleave"&&(s.type="pointerout"),s.type.startsWith("mouse")&&(s.type=s.type.replace("mouse","pointer")),s.type.startsWith("touch")&&(s.type=Yv[s.type]||s.type),s}transferMouseData(s,t){s.isTrusted=t.isTrusted,s.srcElement=t.srcElement,s.timeStamp=performance.now(),s.type=t.type,s.altKey=t.altKey,s.button=t.button,s.buttons=t.buttons,s.client.x=t.clientX,s.client.y=t.clientY,s.ctrlKey=t.ctrlKey,s.metaKey=t.metaKey,s.movement.x=t.movementX,s.movement.y=t.movementY,s.page.x=t.pageX,s.page.y=t.pageY,s.relatedTarget=null,s.shiftKey=t.shiftKey}};let Uo=Bl;Uo.extension={name:"events",type:[L.WebGLSystem,L.CanvasSystem,L.WebGPUSystem],priority:-1};Uo.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};const jv={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,get interactive(){return this.eventMode==="dynamic"||this.eventMode==="static"},set interactive(s){this.eventMode=s?"static":"passive"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??Uo.defaultEventMode},set eventMode(s){this._internalEventMode=s},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(s,t,e){const i=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,r=typeof t=="function"?void 0:t;s=i?`${s}capture`:s,t=typeof t=="function"?t:t.handleEvent,this.on(s,t,r)},removeEventListener(s,t,e){const i=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,r=typeof t=="function"?void 0:t;s=i?`${s}capture`:s,t=typeof t=="function"?t:t.handleEvent,this.off(s,t,r)},dispatchEvent(s){if(!(s instanceof Fo))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return s.defaultPrevented=!1,s.path=null,s.target=this,s.manager.dispatchEvent(s),!s.defaultPrevented}};$t.add(Uo);W.mixin(jv);const vn=class{constructor(s,t){this.linkedSheets=[],this._texture=s instanceof j?s:null,this.textureSource=s.source,this.textures={},this.animations={},this.data=t;const e=parseFloat(t.meta.scale);e?(this.resolution=e,s.source.resolution=this.resolution):this.resolution=s.source._resolution,this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}parse(){return new Promise(s=>{this._callback=s,this._batchIndex=0,this._frameKeys.length<=vn.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(s){let t=s;const e=vn.BATCH_SIZE;for(;t-s<e&&t<this._frameKeys.length;){const i=this._frameKeys[t],r=this._frames[i],n=r.frame;if(n){let a=null,o=null;const h=r.trimmed!==!1&&r.sourceSize?r.sourceSize:r.frame,l=new Zt(0,0,Math.floor(h.w)/this.resolution,Math.floor(h.h)/this.resolution);r.rotated?a=new Zt(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.h)/this.resolution,Math.floor(n.w)/this.resolution):a=new Zt(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution),r.trimmed!==!1&&r.spriteSourceSize&&(o=new Zt(Math.floor(r.spriteSourceSize.x)/this.resolution,Math.floor(r.spriteSourceSize.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution),o.x/=this.textureSource.width,o.y/=this.textureSource.height,o.width/=this.textureSource.width,o.height/=this.textureSource.height),a.x/=this.textureSource.width,a.y/=this.textureSource.height,a.width/=this.textureSource.width,a.height/=this.textureSource.height,l.x/=this.textureSource.width,l.y/=this.textureSource.height,l.width/=this.textureSource.width,l.height/=this.textureSource.height,this.textures[i]=new j({source:this.textureSource,layout:{frame:a,orig:l,trim:o,rotate:r.rotated?2:0,defaultAnchor:r.anchor},label:i})}t++}}_processAnimations(){const s=this.data.animations||{};for(const t in s){this.animations[t]=[];for(let e=0;e<s[t].length;e++){const i=s[t][e];this.animations[t].push(this.textures[i])}}}_parseComplete(){const s=this._callback;this._callback=null,this._batchIndex=0,s.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*vn.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*vn.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(s=!1){var t;for(const e in this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,s&&((t=this._texture)==null||t.destroy(),this.textureSource.destroy()),this._texture=null,this.textureSource=null,this.linkedSheets=[]}};let Il=vn;Il.BATCH_SIZE=1e3;const qv=["jpg","png","jpeg","avif","webp"];function lm(s,t,e){const i={};if(s.forEach(r=>{i[r]=t}),Object.keys(t.textures).forEach(r=>{i[r]=t.textures[r]}),!e){const r=de.dirname(s[0]);t.linkedSheets.forEach((n,a)=>{const o=lm([`${r}/${t.data.meta.related_multi_packs[a]}`],n,!0);Object.assign(i,o)})}return i}const Kv={extension:L.Asset,cache:{test:s=>s instanceof Il,getCacheableAssets:(s,t)=>lm(s,t,!1)},resolver:{test:s=>{const e=s.split("?")[0].split("."),i=e.pop(),r=e.pop();return i==="json"&&qv.includes(r)},parse:s=>{var e;const t=s.split(".");return{resolution:parseFloat(((e=Tt.RETINA_PREFIX.exec(s))==null?void 0:e[1])??"1"),format:t[t.length-2],src:s}}},loader:{name:"spritesheetLoader",extension:{type:L.LoadParser,priority:zi.Normal},async testParse(s,t){return de.extname(t.src).toLowerCase()===".json"&&!!s.frames},async parse(s,t,e){var l,c;let i=de.dirname(t.src);i&&i.lastIndexOf("/")!==i.length-1&&(i+="/");let r=i+s.meta.image;r=wl(r,t.src);const a=(await e.load([r]))[r],o=new Il(a.source,s);await o.parse();const h=(l=s==null?void 0:s.meta)==null?void 0:l.related_multi_packs;if(Array.isArray(h)){const u=[];for(const f of h){if(typeof f!="string")continue;let p=i+f;(c=t.data)!=null&&c.ignoreMultiPack||(p=wl(p,t.src),u.push(e.load({src:p,data:{ignoreMultiPack:!0}})))}const d=await Promise.all(u);o.linkedSheets=d,d.forEach(f=>{f.linkedSheets=[o].concat(o.linkedSheets.filter(p=>p!==f))})}return o},unload(s){s.destroy(!0)}}};$t.add(Kv);const oa={onViewUpdate:()=>{}};let Zv=0;class Jv{constructor(t){var e,i;this.owner=oa,this.batched=!0,this.buildId=0,this.uid=Zv++,this.type="sprite",this._bounds=[0,1,0,0],this._sourceBounds=[0,1,0,0],this.boundsDirty=!0,this.sourceBoundsDirty=!0,this.anchor=new ye(this,((e=t.layout.defaultAnchor)==null?void 0:e.x)||0,((i=t.layout.defaultAnchor)==null?void 0:i.y)||0),this.texture=t}set texture(t){this._texture!==t&&(t.on("update",this.onUpdate,this),this._texture=t,t.off("update",this.onUpdate,this),this.onUpdate())}get texture(){return this._texture}get bounds(){return this.boundsDirty&&(this.updateBounds(),this.boundsDirty=!1),this._bounds}get sourceBounds(){return this.sourceBoundsDirty&&(this._updateSourceBounds(),this.sourceBoundsDirty=!1),this._sourceBounds}updateBounds(){const t=this._texture,e=t._source,i=t.layout,r=i.orig,n=i.trim,a=e.width,o=e.height,h=a*r.width,l=o*r.height,c=this.anchor,u=this._bounds;if(n){const d=a*n.width,f=o*n.height;u[1]=n.x*a-c._x*h,u[0]=u[1]+d,u[3]=n.y*o-c._y*l,u[2]=u[3]+f}else u[1]=-c._x*h,u[0]=u[1]+h,u[3]=-c._y*l,u[2]=u[3]+l}_updateSourceBounds(){const t=this.anchor,e=this._texture,i=e._source,n=e.layout.orig,a=this._sourceBounds,o=i.width*n.width,h=i.height*n.height;a[1]=-t._x*o,a[0]=a[1]+o,a[3]=-t._y*h,a[2]=a[3]+h}addBounds(t){if(this._texture._layout.trim){const i=this.sourceBounds;t.addFrame(i[0],i[2],i[1],i[3])}else{const i=this.bounds;t.addFrame(i[0],i[2],i[1],i[3])}}onUpdate(){this.didUpdate=!0,this.sourceBoundsDirty=this.boundsDirty=!0,this.owner.onViewUpdate()}containsPoint(t){const e=this._texture.frameWidth,i=this._texture.frameHeight,r=-e*this.anchor.x;let n=0;return t.x>=r&&t.x<r+e&&(n=-i*this.anchor.y,t.y>=n&&t.y<n+i)}destroy(t=!1){if(this.anchor=null,typeof t=="boolean"?t:t==null?void 0:t.texture){const i=typeof t=="boolean"?t:t==null?void 0:t.textureSource;this._texture.destroy(i)}this._texture=null,this._bounds=null,this._sourceBounds=null}}class lt extends W{static from(t){return typeof t=="string"?new lt(je.get(t)):new lt(t)}constructor(t=j.EMPTY){t instanceof j&&(t={texture:t}),t.texture??(t.texture=j.EMPTY),super({view:new Jv(t.texture),label:"Sprite",...t})}get anchor(){return this.view.anchor}get texture(){return this.view.texture}set texture(t){this.view.texture=t}}const Qv=new Ti;function cm(s,t,e){const i=Qv;s.measurable=!0,Io(s,e,i),t.addBoundsMask(i),s.measurable=!1}function um(s,t,e){const i=new Ti;s.measurable=!0;const r=dm(s,e,new it);xr(s,i,r),s.measurable=!1,t.addBoundsMask(i)}function dm(s,t,e){return s?(s!==t&&(dm(s.parent,t,e),s.didChange&&er(s.localTransform,s),e.append(s.localTransform)),e):(console.warn("Item is not inside the root container"),e)}class fm{constructor(t){this.priority=0,this.pipe="alphaMask",t!=null&&t.mask&&this.init(t.mask)}init(t){this.mask=t,this.renderMaskToTexture=!(t instanceof lt),this.mask.renderable=this.renderMaskToTexture,this.mask.includeInBuild=!this.renderMaskToTexture,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask=null}addBounds(t,e){cm(this.mask,t,e)}addLocalBounds(t,e){um(this.mask,t,e)}containsPoint(t){const e=this.mask;return e.containsPoint?e.containsPoint(t):!1}destroy(){this.reset()}static test(t){return t instanceof lt}}fm.extension=L.MaskEffect;class pm{constructor(t){this.priority=0,this.pipe="colorMask",t!=null&&t.mask&&this.init(t.mask)}init(t){this.mask=t}destroy(){}static test(t){return typeof t=="number"}}pm.extension=L.MaskEffect;class mm{constructor(t){this.priority=0,this.pipe="stencilMask",t!=null&&t.mask&&this.init(t.mask)}init(t){this.mask=t,this.mask.includeInBuild=!1,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask.includeInBuild=!0,this.mask=null}addBounds(t,e){cm(this.mask,t,e)}addLocalBounds(t,e){um(this.mask,t,e)}containsPoint(t){const e=this.mask;return e.containsPoint?e.containsPoint(t):!1}destroy(){this.reset()}static test(t){return t instanceof W}}mm.extension=L.MaskEffect;$t.add(fm,pm,mm);const t_="modulepreload",e_=function(s,t){return new URL(s,t).href},Yu={},vh=function(t,e,i){if(!e||e.length===0)return t();const r=document.getElementsByTagName("link");return Promise.all(e.map(n=>{if(n=e_(n,i),n in Yu)return;Yu[n]=!0;const a=n.endsWith(".css"),o=a?'[rel="stylesheet"]':"";if(!!i)for(let c=r.length-1;c>=0;c--){const u=r[c];if(u.href===n&&(!a||u.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${o}`))return;const l=document.createElement("link");if(l.rel=a?"stylesheet":t_,a||(l.as="script",l.crossOrigin=""),l.href=n,document.head.appendChild(l),a)return new Promise((c,u)=>{l.addEventListener("load",c),l.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>t())};let _h;function i_(){return typeof _h>"u"&&(_h=function(){var e;const t={stencil:!0,failIfMajorPerformanceCaveat:Tt.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!Tt.ADAPTER.getWebGLRenderingContext())return!1;let r=Tt.ADAPTER.createCanvas().getContext("webgl2",t);const n=!!((e=r==null?void 0:r.getContextAttributes())!=null&&e.stencil);if(r){const a=r.getExtension("WEBGL_lose_context");a&&a.loseContext()}return r=null,n}catch{return!1}}()),_h}async function s_(s={}){if(!Tt.ADAPTER.getNavigator().gpu)return!1;try{return await(await navigator.gpu.requestAdapter(s)).requestDevice(),!0}catch{return!1}}const ju=["webgpu","webgl","canvas"];async function r_(s){let t=[];s.preference?(t.push(s.preference),ju.forEach(n=>{n!==s.preference&&t.push(n)})):t=ju.slice();let e;(s.manageImports??!0)&&await vh(()=>import("./all-fdb6c31a.js"),[],import.meta.url);let i={};for(let n=0;n<t.length;n++){const a=t[n];if(a==="webgpu"&&await s_()){const{WebGPURenderer:o}=await vh(()=>Promise.resolve().then(()=>JT),void 0,import.meta.url);e=o,i={...s,...s.webgpu};break}else if(a==="webgl"&&i_()){const{WebGLRenderer:o}=await vh(()=>Promise.resolve().then(()=>NT),void 0,import.meta.url);e=o,i={...s,...s.webgl};break}else if(a==="canvas"){i={...s};break}}delete i.webgpu,delete i.webgl;const r=new e;return await r.init(i),r}const gm=class{constructor(){this.stage=new W}async init(s){s={...s},this.renderer=await r_(s),gm._plugins.forEach(t=>{t.init.call(this,s)})}render(){this.renderer.render({container:this.stage})}get canvas(){return this.renderer.element}};let Lc=gm;Lc._plugins=[];$t.handleByList(L.Application,Lc._plugins);let n_=class{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let i=0;i<e;i++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}};const no=s=>!Array.isArray(s);let a_=class{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,i)=>(this._parsersValidated=!1,t[e]=i,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const i={promise:null,parser:null};return i.promise=(async()=>{var a,o;let r=null,n=null;if(e.loadParser&&(n=this._parserHash[e.loadParser],n||console.warn(`[Assets] specified load parser "${e.loadParser}" not found while loading ${t}`)),!n){for(let h=0;h<this.parsers.length;h++){const l=this.parsers[h];if(l.load&&((a=l.test)!=null&&a.call(l,t,e,this))){n=l;break}}if(!n)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}r=await n.load(t,e,this),i.parser=n;for(let h=0;h<this.parsers.length;h++){const l=this.parsers[h];l.parse&&l.parse&&await((o=l.testParse)==null?void 0:o.call(l,r,e,this))&&(r=await l.parse(r,e,this)||r,i.parser=l)}return r})(),i}async load(t,e){this._parsersValidated||this._validateParsers();let i=0;const r={},n=no(t),a=fi(t,l=>({alias:[l],src:l})),o=a.length,h=a.map(async l=>{const c=de.toAbsolute(l.src);if(!r[l.src])try{this.promiseCache[c]||(this.promiseCache[c]=this._getLoadPromiseAndParser(c,l)),r[l.src]=await this.promiseCache[c].promise,e&&e(++i/o)}catch(u){throw delete this.promiseCache[c],delete r[l.src],new Error(`[Loader.load] Failed to load ${c}.
${u}`)}});return await Promise.all(h),n?r[a[0].src]:r}async unload(t){const i=fi(t,r=>({alias:[r],src:r})).map(async r=>{var o,h;const n=de.toAbsolute(r.src),a=this.promiseCache[n];if(a){const l=await a.promise;(h=(o=a.parser)==null?void 0:o.unload)==null||h.call(o,l,r,this),delete this.promiseCache[n]}});await Promise.all(i)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name).reduce((t,e)=>(t[e.name]&&console.warn(`[Assets] loadParser name conflict "${e.name}"`),{...t,[e.name]:e}),{})}};function bm(s,t,e,i,r){const n=t[e];for(let a=0;a<n.length;a++){const o=n[a];e<t.length-1?bm(s.replace(i[e],o),t,e+1,i,r):r.push(s.replace(i[e],o))}}function o_(s){const t=/\{(.*?)\}/g,e=s.match(t),i=[];if(e){const r=[];e.forEach(n=>{const a=n.substring(1,n.length-1).split(",");r.push(a)}),bm(s,r,0,e,i)}else i.push(s);return i}let h_=class{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map(i=>`${encodeURIComponent(i)}=${encodeURIComponent(e[i])}`).join("&")}}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){const i=[];Array.isArray(e)?e.forEach(r=>{const n=r.src??r.srcs,a=r.alias??r.name;let o;if(typeof a=="string"){const h=this._createBundleAssetId(t,a);i.push(h),o=[a,h]}else{const h=a.map(l=>this._createBundleAssetId(t,l));i.push(...h),o=[...a,...h]}this.add({...r,alias:o,src:n})}):Object.keys(e).forEach(r=>{const n=[r,this._createBundleAssetId(t,r)];if(typeof e[r]=="string")this.add({alias:n,src:e[r]});else if(Array.isArray(e[r]))this.add({alias:n,src:e[r]});else{const a=e[r],o=a.src??a.srcs;this.add({...a,alias:n,src:Array.isArray(o)?o:[o]})}i.push(...n)}),this._bundles[t]=i}add(t){const e=[];Array.isArray(t)?e.push(...t):e.push(t);const i=n=>{this.hasKey(n)&&console.warn(`[Resolver] already has key: ${n} overwriting`)};fi(e).forEach(n=>{const{alias:a,name:o,src:h,srcs:l}=n;let{data:c,format:u,loadParser:d}=n;const f=fi(h||l).map(g=>typeof g=="string"?o_(g):Array.isArray(g)?g:[g]),p=fi(a||o);Array.isArray(a)?a.forEach(i):i(a);const m=[];f.forEach(g=>{g.forEach(x=>{let y={};if(typeof x!="object"){y.src=x;for(let b=0;b<this._parsers.length;b++){const v=this._parsers[b];if(v.test(x)){y=v.parse(x);break}}}else c=x.data??c,u=x.format??u,d=x.loadParser??d,y={...y,...x};y=this.buildResolvedAsset(y,{aliases:p,data:c,format:u,loadParser:d}),m.push(y)})}),p.forEach(g=>{this._assetMap[g]=m})})}resolveBundle(t){const e=no(t);t=fi(t);const i={};return t.forEach(r=>{const n=this._bundles[r];if(n){const a=this.resolve(n),o={};for(const h in a){const l=a[h];o[this._extractAssetIdFromBundle(r,h)]=l}i[r]=o}}),e?i[t[0]]:i}resolveUrl(t){const e=this.resolve(t);if(typeof t!="string"){const i={};for(const r in e)i[r]=e[r].src;return i}return e.src}resolve(t){const e=no(t);t=fi(t);const i={};return t.forEach(r=>{if(!this._resolverHash[r])if(this._assetMap[r]){let n=this._assetMap[r];const a=n[0],o=this._getPreferredOrder(n);o==null||o.priority.forEach(h=>{o.params[h].forEach(l=>{const c=n.filter(u=>u[h]?u[h]===l:!1);c.length&&(n=c)})}),this._resolverHash[r]=n[0]??a}else this._resolverHash[r]=this.buildResolvedAsset({alias:[r],src:r},{});i[r]=this._resolverHash[r]}),e?i[t[0]]:i}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const i=t[0],r=this._preferredOrder.find(n=>n.params.format.includes(i.format));if(r)return r}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const e=/\?/.test(t)?"&":"?";return`${t}${e}${this._defaultSearchParams}`}buildResolvedAsset(t,e){const{aliases:i,data:r,loadParser:n,format:a}=e;return(this._basePath||this._rootPath)&&(t.src=de.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=i??t.alias??[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data={...r||{},...t.data},t.loadParser=n??t.loadParser,t.format=a??t.src.split(".").pop(),t.srcs=t.src,t.name=t.alias,t}},l_=class{constructor(){this._detections=[],this._initialized=!1,this.resolver=new h_,this.loader=new a_,this.cache=je,this._backgroundLoader=new n_(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){var n,a,o;if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let h=t.manifest;typeof h=="string"&&(h=await this.load(h)),this.resolver.addManifest(h)}const e=((n=t.texturePreference)==null?void 0:n.resolution)??1,i=typeof e=="number"?[e]:e;let r=[];if((a=t.texturePreference)!=null&&a.format){const h=(o=t.texturePreference)==null?void 0:o.format;r=typeof h=="string"?[h]:h;for(const l of this._detections)await l.test()||(r=await l.remove(r))}else for(const h of this._detections)await h.test()&&(r=await h.add(r));this.resolver.prefer({params:{format:r,resolution:i}}),t.preferences&&this.setPreferences(t.preferences)}add(t){this.resolver.add(t)}async load(t,e){this._initialized||await this.init();const i=no(t),r=fi(t).map(o=>{if(typeof o!="string"){this.add(o);const h=o.src||o.srcs,l=o.alias||o.name;return l&&Array.isArray(l)?l[0]:h&&Array.isArray(h)?h[0]:l||h}return this.resolver.hasKey(o)||this.add({alias:o,src:o}),o}),n=this.resolver.resolve(r),a=await this._mapLoadToResolve(n,e);return i?a[r[0]]:a}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let i=!1;typeof t=="string"&&(i=!0,t=[t]);const r=this.resolver.resolveBundle(t),n={},a=Object.keys(r);let o=0,h=0;const l=()=>{e==null||e(++o/h)},c=a.map(u=>{const d=r[u];return h+=Object.keys(d).length,this._mapLoadToResolve(d,l).then(f=>{n[u]=f})});return await Promise.all(c),i?n[t[0]]:n}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach(i=>{this._backgroundLoader.add(Object.values(i))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return je.get(t);const e={};for(let i=0;i<t.length;i++)e[i]=je.get(t[i]);return e}async _mapLoadToResolve(t,e){const i=Object.values(t),r=Object.keys(t);this._backgroundLoader.active=!1;const n=await this.loader.load(i,e);this._backgroundLoader.active=!0;const a={};return i.forEach((o,h)=>{const l=n[o.src],c=[o.src];o.alias&&c.push(...o.alias),a[r[h]]=l,je.set(c,l)}),a}async unload(t){this._initialized||await this.init();const e=fi(t).map(r=>typeof r!="string"?r.src:r),i=this.resolver.resolve(e);await this._unloadFromResolved(i)}async unloadBundle(t){this._initialized||await this.init(),t=fi(t);const e=this.resolver.resolveBundle(t),i=Object.keys(e).map(r=>this._unloadFromResolved(e[r]));await Promise.all(i)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach(i=>{je.remove(i.src)}),await this.loader.unload(e)}get detections(){return this._detections}setPreferences(t){this.loader.parsers.forEach(e=>{e.config&&Object.keys(e.config).filter(i=>i in t).forEach(i=>{e.config[i]=t[i]})})}};const Ri=new l_;$t.handleByList(L.LoadParser,Ri.loader.parsers).handleByList(L.ResolveParser,Ri.resolver.parsers).handleByList(L.CacheParser,Ri.cache.parsers).handleByList(L.DetectionParser,Ri.detections);class Ni{constructor(t){this.usageTick=0,this.dirty=!0,this.resources={};let e=0;for(const i in t){const r=t[i];this.setResource(r,e++)}this.updateKey()}update(){this.updateKey()}updateKey(){if(!this.dirty)return;this.dirty=!1;const t=[];let e=0;for(const i in this.resources)t[e++]=this.resources[i].resourceId;this.key=t.join("|")}setResource(t,e){var r,n;const i=this.resources[e];t!==i&&(i&&((r=t.off)==null||r.call(t,"change",this.onResourceChange,this)),(n=t.on)==null||n.call(t,"change",this.onResourceChange,this),this.resources[e]=t,this.dirty=!0)}getResource(t){return this.resources[t]}destroy(){var e;const t=this.resources;for(const i in t){const r=t[i];(e=r.off)==null||e.call(r,"change",this.onResourceChange,this)}this.resources=null}onResourceChange(){this.dirty=!0,this.update()}}let As=class extends Rt{constructor({gpuProgram:t,glProgram:e,groups:i,resources:r,groupMap:n}){super(),this.uniformBindMap={},this.gpuProgram=t,this.glProgram=e;const a={};if(r&&i)throw new Error("[Shader] Cannot have both resources and groups");if(!r&&!i)throw new Error("[Shader] Must provide either resources or groups descriptor");if(!t&&i&&!n)throw new Error("[Shader] No group map or WebGPU shader provided - consider using resources instead.");if(!t&&i&&n)for(const o in n)for(const h in n[o]){const l=n[o][h];a[l]={group:o,binding:h,name:l}}else if(t&&i&&!n){const o=t.structsAndGroups.groups;n={},o.forEach(h=>{n[h.group]=n[h.group]||{},n[h.group][h.binding]=h.name,a[h.name]=h})}else if(r){if(t){const o=t.structsAndGroups.groups;n={},o.forEach(h=>{n[h.group]=n[h.group]||{},n[h.group][h.binding]=h.name,a[h.name]=h})}else{n={},i={99:new Ni};let o=0;for(const h in r)a[h]={group:99,binding:o,name:h},i[99].setResource(r[h],o),n[99]=n[99]||{},n[99][o]=h,o++}i={};for(const o in r){const h=o,l=r[o],c=a[h];c&&(i[c.group]=i[c.group]||new Ni,i[c.group].setResource(l,c.binding))}}this.groups=i,this.uniformBindMap=n,this.resources=this._buildResourceAccessor(i,a)}_buildResourceAccessor(t,e){const i={};for(const r in e){const n=e[r];Object.defineProperty(i,n.name,{get(){return t[n.group].getResource(n.binding)},set(a){t[n.group].setResource(a,n.binding)}})}return i}destroy(t=!1){var e,i;this.emit("destroy",this),t&&((e=this.gpuProgram)==null||e.destroy(),(i=this.glProgram)==null||i.destroy()),this.gpuProgram=null,this.glProgram=null,this.groups=null,this.removeAllListeners(),this.uniformBindMap=null,this.resources=null}};const c_={normal:0,additive:1,multiply:2,screen:3,overlay:4},wh=0,Th=1,Sh=2,Ch=3,Ah=4,Eh=5;let Es=class{constructor(){this.data=0,this.blendMode="normal",this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<wh)}set blend(t){!!(this.data&1<<wh)!==t&&(this.data^=1<<wh)}get offsets(){return!!(this.data&1<<Th)}set offsets(t){!!(this.data&1<<Th)!==t&&(this.data^=1<<Th)}set cullMode(t){if(t==="none"){this.culling=!1;return}this.culling=!0,this.clockwiseFrontFace=t==="front"}get cullMode(){return this.culling?this.clockwiseFrontFace?"front":"back":"none"}get culling(){return!!(this.data&1<<Sh)}set culling(t){!!(this.data&1<<Sh)!==t&&(this.data^=1<<Sh)}get depthTest(){return!!(this.data&1<<Ch)}set depthTest(t){!!(this.data&1<<Ch)!==t&&(this.data^=1<<Ch)}get depthMask(){return!!(this.data&1<<Eh)}set depthMask(t){!!(this.data&1<<Eh)!==t&&(this.data^=1<<Eh)}get clockwiseFrontFace(){return!!(this.data&1<<Ah)}set clockwiseFrontFace(t){!!(this.data&1<<Ah)!==t&&(this.data^=1<<Ah)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!=="none",this._blendMode=t,this._blendModeId=c_[t]||0}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const t=new Es;return t.depthTest=!1,t.blend=!0,t}};const ym=class extends As{constructor(t){t={...ym.defaultOptions,...t},super({gpuProgram:t.gpuProgram,glProgram:t.glProgram,resources:t.resources}),this.enabled=!0,this._state=Es.for2d(),this.padding=t.padding,typeof t.antialias=="boolean"?this.antialias=t.antialias?"on":"off":this.antialias=t.antialias??"inherit",this.resolution=t.resolution,this.blendRequired=t.blendRequired}apply(t,e,i,r){t.applyFilter(this,e,i,r)}get blendMode(){return this._state.blendMode}set blendMode(t){this._state.blendMode=t}};let nr=ym;nr.defaultOptions={blendMode:"normal",resolution:1,padding:0,antialias:"inherit",blendRequired:!1};function u_(s,{requestedPrecision:t,maxSupportedPrecision:e}){if(s.substring(0,9)!=="precision"){let i=t;if(t==="highp"&&e!=="highp"&&(i="mediump"),s.substring(0,8)!=="#version")return`precision ${i} float;
${s}`;const r=s.indexOf(`
`);return`${s.substring(0,r+1)}precision ${i} float;
${s.substring(r+1)}`}else if(e!=="highp"&&s.substring(0,15)==="precision highp")return s.replace("precision highp","precision mediump");return s}const d_={},f_={};function p_(s,{name:t="pixi-program"},e=!0){t=t.replace(/\s+/g,"-"),t+=e?"-fragment":"-vertex";const i=e?d_:f_;if(i[t]?(i[t]++,t+=`-${i[t]}`):i[t]=1,s.indexOf("#define SHADER_NAME")!==-1)return s;const r=`#define SHADER_NAME ${t}`;if(s.substring(0,8)!=="#version")return`${r}
${s}`;const n=s.indexOf(`
`);return`${s.substring(0,n+1)}${r}
${s.substring(n+1)}`}function m_(s,{version:t="300 es"}){return s.substring(0,8)==="#version"?s:`#version ${t}
${s}`}const Ph={ensurePrecision:u_,setProgramName:p_,setProgramVersion:m_},_n=class{constructor({fragment:s,vertex:t,name:e}){const i={ensurePrecision:{requestedPrecision:"highp",maxSupportedPrecision:"highp"},setProgramName:{name:e},setProgramVersion:{version:"300 es"}};Object.keys(Ph).forEach(r=>{const n=i[r]??{};s=Ph[r](s,n,!0),t=Ph[r](t,n,!1)}),this.fragment=s,this.vertex=t,this.key=`${this.vertex}:${this.fragment}`}destroy(){this.fragment=null,this.vertex=null,this.attributeData=null,this.uniformData=null,this.uniformBlockData=null,this.transformFeedbackVaryings=null}static from(s){const t=`${s.vertex}:${s.fragment}`;return _n.programCached[t]||(_n.programCached[t]=new _n(s)),_n.programCached[t]}};let as=_n;as.programCached={};function g_(s){var u;const t=new RegExp("(?<!\\/\\/.*)@(group|binding)\\(\\d+\\)[^;]+;","g"),e=/@group\((\d+)\)/,i=/@binding\((\d+)\)/,r=/var(<[^>]+>)? (\w+)/,n=/:\s*(\w+)/,a=/struct\s+(\w+)\s*{([^}]+)}/g,o=/(\w+)\s*:\s*([\w\<\>]+)/g,h=/struct\s+(\w+)/,l=(u=s.match(t))==null?void 0:u.map(d=>({group:parseInt(d.match(e)[1],10),binding:parseInt(d.match(i)[1],10),name:d.match(r)[2],isUniform:d.match(r)[1]==="<uniform>",type:d.match(n)[1]}));if(!l)return{groups:[],structs:[]};const c=s.match(a).map(d=>{const f=d.match(h)[1],p=d.match(o).reduce((m,g)=>{const[x,y]=g.split(":");return m[x.trim()]=y.trim(),m},{});return{name:f,members:p}}).filter(({name:d})=>l.some(f=>f.type===d));return{groups:l,structs:c}}var wn=(s=>(s[s.VERTEX=1]="VERTEX",s[s.FRAGMENT=2]="FRAGMENT",s[s.COMPUTE=4]="COMPUTE",s))(wn||{});function b_({groups:s}){const t=[];for(let e=0;e<s.length;e++){const i=s[e];t[i.group]||(t[i.group]=[]),i.isUniform?t[i.group].push({binding:i.binding,visibility:wn.VERTEX|wn.FRAGMENT,buffer:{type:"uniform"}}):i.type==="sampler"?t[i.group].push({binding:i.binding,visibility:wn.FRAGMENT,sampler:{type:"filtering"}}):i.type==="texture_2d"&&t[i.group].push({binding:i.binding,visibility:wn.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d",multisampled:!1}})}return t}function y_({groups:s}){const t=[];for(let e=0;e<s.length;e++){const i=s[e];t[i.group]||(t[i.group]={}),t[i.group][i.name]=i.binding}return t}const Tn=class{constructor({fragment:s,vertex:t,compute:e,layout:i,gpuLayout:r}){this._layoutKey=0,this.fragment=s,this.vertex=t,this.compute=e;const n=g_(this.fragment.source);this.structsAndGroups=n,this.layout=i??y_(n),this.gpuLayout=r??b_(n)}destroy(){this._gpuLayout=null,this.gpuLayout=null,this.layout=null,this.structsAndGroups=null,this.fragment=null,this.vertex=null,this.compute=null}static from(s){const t=`${s.vertex.source}:${s.fragment.source}:${s.fragment.entryPoint}:${s.vertex.entryPoint}`;return Tn.programCached[t]||(Tn.programCached[t]=new Tn(s)),Tn.programCached[t]}};let os=Tn;os.programCached={};let x_=0;function Ur(){return x_++}const xm=class{constructor(s,t){this.uid=Ur(),this.resourceType="uniformGroup",this.resourceId=this.uid,this.isUniformGroup=!0,this.dirtyId=0,t={...xm.DEFAULT,...t},this.uniformStructures=s;const e={};for(const i in s){const r=s[i];r.name=i,r.size=r.size??1,e[i]=r.value??r}this.uniforms=e,this.dirtyId=1,this.ubo=t.ubo,this.isStatic=t.isStatic,this.signature=Object.keys(e).map(i=>`${i}-${s[i].type}`).join("-")}update(){this.dirtyId++}};let re=xm;re.DEFAULT={ubo:!1,isStatic:!1};var v_=`
in vec2 vTextureCoord;
in vec4 vColor;

uniform vec4 inputSize;
uniform vec4 inputClamp;

out vec4 fragColor;

uniform vec2 uCenter;
uniform float uTime;
uniform float uSpeed;
uniform vec4 uWave;

uniform sampler2D myTexture;


const float PI = 3.14159;

void main()
{
    float uAmplitude = uWave[0];
    float uWavelength = uWave[1];
    float uBrightness = uWave[2];
    float uRadius = uWave[3];

    float halfWavelength = uWavelength * 0.5 / inputSize.x;
    float maxRadius = uRadius / inputSize.x;
    float currentRadius = uTime * uSpeed / inputSize.x;

    float fade = 1.0;

    if (maxRadius > 0.0) {
        if (currentRadius > maxRadius) {
            fragColor = texture(myTexture, vTextureCoord);
            return;
        }
        fade = 1.0 - pow(currentRadius / maxRadius, 2.0);
    }

    vec2 dir = vec2(vTextureCoord - uCenter / inputSize.xy);
    dir.y *= inputSize.y / inputSize.x;
    float dist = length(dir);

    if (dist <= 0.0 || dist < currentRadius - halfWavelength || dist > currentRadius + halfWavelength) {
        fragColor = texture(myTexture, vTextureCoord);
        return;
    }

    vec2 diffUV = normalize(dir);

    float diff = (dist - currentRadius) / halfWavelength;

    float p = 1.0 - pow(abs(diff), 2.0);

    // float powDiff = diff * pow(p, 2.0) * ( amplitude * fade );
    float powDiff = 1.25 * sin(diff * PI) * p * ( uAmplitude * fade );

    vec2 offset = diffUV * powDiff / inputSize.xy;

    // Do clamp :
    vec2 coord = vTextureCoord + offset;
    vec2 clampedCoord = clamp(coord, inputClamp.xy, inputClamp.zw);
    vec4 color = texture(myTexture, clampedCoord);
    if (coord != clampedCoord) {
        color *= max(0.0, 1.0 - length(coord - clampedCoord));
    }

    // No clamp :
    // fragColor = texture(myTexture, vTextureCoord + offset);

    color.rgb *= 1.0 + (uBrightness - 1.0) * p * fade;

    fragColor = color;
}
`,__=`in vec2 aPosition;
out vec2 vTextureCoord;

uniform globalUniforms {
  mat3 projectionMatrix;
  mat3 worldTransformMatrix;
  float worldAlpha;
};

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * outputFrame.zw + outputFrame.xy;
    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,qu=`struct GlobalUniforms {
    projectionMatrix:mat3x3<f32>,
    worldTransformMatrix:mat3x3<f32>,
    worldAlpha: f32
}

struct GlobalFilterUniforms {
    inputSize:vec4<f32>,
    inputPixel:vec4<f32>,
    inputClamp:vec4<f32>,
    outputFrame:vec4<f32>,
    backgroundFrame:vec4<f32>,
    globalFrame:vec4<f32>,
};

struct ShockWaveUniforms {
    uTime: f32,
    uOffset: vec2<f32>,
    uSpeed: f32,
    uWave: vec4<f32>,
};
@group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;
@group(1) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(1) @binding(1) var myTexture: texture_2d<f32>;
@group(1) @binding(2) var mySampler : sampler;
@group(1) @binding(3) var backTexture: texture_2d<f32>;
@group(2) @binding(0) var<uniform> shockwaveUniforms : ShockWaveUniforms;

struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>,
    @location(1) backgroundUv : vec2<f32>,
};

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.outputFrame.zw + gfu.outputFrame.xy;
    return vec4((globalUniforms.projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.outputFrame.zw * gfu.inputSize.zw);
}

fn filterBackgroundTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * gfu.backgroundFrame.zw;
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return  (aPosition.xy / gfu.globalFrame.zw) + (gfu.globalFrame.xy / gfu.globalFrame.zw);  
}
fn getSize() -> vec2<f32>
{
    return gfu.globalFrame.zw;
}

@vertex
fn mainVertex(
    @location(0) aPosition : vec2<f32>, 
) -> VSOutput {
    return VSOutput(
        filterVertexPosition(aPosition),
        filterTextureCoord(aPosition),
        filterBackgroundTextureCoord(aPosition),
    );
}

@fragment
fn mainFragment(
    @location(0) uv: vec2<f32>,
    @location(1) backgroundUv: vec2<f32>,
    @builtin(position) position: vec4<f32>
) -> @location(0) vec4<f32> {

    let uTime = shockwaveUniforms.uTime;
    let uOffset = shockwaveUniforms.uOffset;
    let uSpeed = shockwaveUniforms.uSpeed;
    let uAmplitude = shockwaveUniforms.uWave[0];
    let uWavelength = shockwaveUniforms.uWave[1];
    let uBrightness = shockwaveUniforms.uWave[2];
    let uRadius = shockwaveUniforms.uWave[3];
    let halfWavelength: f32 = uWavelength * 0.5 / gfu.inputSize.x;
    let maxRadius: f32 = uRadius / gfu.inputSize.x;
    let currentRadius: f32 = uTime * uSpeed / gfu.inputSize.x;
    var fade: f32 = 1.0;
    var returnColorOnly: bool = false;
    
    if (maxRadius > 0.0) {
        if (currentRadius > maxRadius) {
            returnColorOnly = true;
        }
        fade = 1.0 - pow(currentRadius / maxRadius, 2.0);
    }
    var dir: vec2<f32> = vec2<f32>(uv - uOffset / gfu.inputSize.xy);
    dir.y *= gfu.inputSize.y / gfu.inputSize.x;

    let dist:f32 = length(dir);

    if (dist <= 0.0 || dist < currentRadius - halfWavelength || dist > currentRadius + halfWavelength) {
        returnColorOnly = true;
    }

    let diffUV: vec2<f32> = normalize(dir);
    let diff: f32 = (dist - currentRadius) / halfWavelength;
    let p: f32 = 1.0 - pow(abs(diff), 2.0);
    let powDiff: f32 = 1.25 * sin(diff * PI) * p * ( uAmplitude * fade );
    let offset: vec2<f32> = diffUV * powDiff / gfu.inputSize.xy;
    // Do clamp :
    let coord: vec2<f32> = uv + offset;
    let clampedCoord: vec2<f32> = clamp(coord, gfu.inputClamp.xy, gfu.inputClamp.zw);

    var clampedColor: vec4<f32> = textureSample(myTexture, mySampler, clampedCoord);
    
    if (boolVec2(coord, clampedCoord)) 
    {
        clampedColor *= max(0.0, 1.0 - length(coord - clampedCoord));
    }
    // No clamp :
    return select(clampedColor * vec4<f32>(vec3<f32>(1.0 + (uBrightness - 1.0) * p * fade), clampedColor.a), textureSample(myTexture, mySampler, uv), returnColorOnly);
}

fn boolVec2(x: vec2<f32>, y: vec2<f32>) -> bool
{
    if (x.x == y.x && x.y == y.y)
    {
        return true;
    }
    
    return false;
}

const PI: f32 = 3.14159265358979323846264;
`;const vm=class extends nr{constructor(s={}){s={...vm.DEFAULT,...s};const t=new os({vertex:{source:qu,entryPoint:"mainVertex"},fragment:{source:qu,entryPoint:"mainFragment"}}),e=new as({vertex:__,fragment:v_,name:"shockwave-filter"});super({gpuProgram:t,glProgram:e,resources:{shockwaveUniforms:new re({uTime:{value:0,type:"f32"},uCenter:{value:s.center,type:"vec2<f32>"},uSpeed:{value:s.speed,type:"f32"},uWave:{value:new Float32Array(4),type:"vec4<f32>"}})},resolution:1}),this.time=0,this.uniforms=this.resources.shockwaveUniforms.uniforms,Object.assign(this,s)}apply(s,t,e,i){this.uniforms.uTime=this.time,s.applyFilter(this,t,e,i)}get center(){return this.uniforms.uCenter}set center(s){this.uniforms.uCenter=s}get centerX(){return this.uniforms.uCenter.x}set centerX(s){this.uniforms.uCenter.x=s}get centerY(){return this.uniforms.uCenter.y}set centerY(s){this.uniforms.uCenter.y=s}get speed(){return this.uniforms.uSpeed}set speed(s){this.uniforms.uSpeed=s}get amplitude(){return this.uniforms.uWave[0]}set amplitude(s){this.uniforms.uWave[0]=s}get wavelength(){return this.uniforms.uWave[1]}set wavelength(s){this.uniforms.uWave[1]=s}get brightness(){return this.uniforms.uWave[2]}set brightness(s){this.uniforms.uWave[2]=s}get radius(){return this.uniforms.uWave[3]}set radius(s){this.uniforms.uWave[3]=s}};let w_=vm;w_.DEFAULT={center:{x:0,y:0},speed:500,amplitude:30,wavelength:160,brightness:1,radius:-1};function jr(s){return s+=s===0?1:0,--s,s|=s>>>1,s|=s>>>2,s|=s>>>4,s|=s>>>8,s|=s>>>16,s+1}let T_=0,Qe=class extends Rt{constructor({data:t,size:e,usage:i,label:r}){super(),this.resourceType="buffer",this.resourceId=Ur(),this.uid=T_++,this._updateID=1,t instanceof Array&&(t=new Float32Array(t)),this._data=t,e=e??(t==null?void 0:t.byteLength);const n=!!t;this.descriptor={size:e,usage:i,mappedAtCreation:n,label:r}}get data(){return this._data}set data(t){if(this._data!==t){const e=this._data;this._data=t,e.length!==t.length?(this.descriptor.size=t.byteLength,this.resourceId=Ur(),this.emit("change",this)):this.emit("update",this)}}update(t){this._updateSize=t||this.descriptor.size,this._updateID++,this.emit("update",this)}destroy(){this.emit("destroy",this),this._data=null,this.descriptor=null,this.removeAllListeners()}};var wt=(s=>(s[s.MAP_READ=1]="MAP_READ",s[s.MAP_WRITE=2]="MAP_WRITE",s[s.COPY_SRC=4]="COPY_SRC",s[s.COPY_DST=8]="COPY_DST",s[s.INDEX=16]="INDEX",s[s.VERTEX=32]="VERTEX",s[s.UNIFORM=64]="UNIFORM",s[s.STORAGE=128]="STORAGE",s[s.INDIRECT=256]="INDIRECT",s[s.QUERY_RESOLVE=512]="QUERY_RESOLVE",s[s.STATIC=1024]="STATIC",s))(wt||{});function Ku(s,t){if(!(s instanceof Qe)){let e=t?wt.INDEX:wt.VERTEX;s instanceof Array&&(t?(s=new Uint32Array(s),e=wt.INDEX|wt.COPY_DST):(s=new Float32Array(s),e=wt.VERTEX|wt.COPY_DST)),s=new Qe({data:s,label:"index-mesh-buffer",usage:e})}return s}let S_=1,Lo=class extends Rt{constructor({attributes:t,indexBuffer:e,topology:i}){super(),this.uid=S_++,this._layoutKey=0,this.tick=0,this.attributes=t,this.buffers=[];for(const r in t){const n=t[r];n.buffer=Ku(n.buffer,!1),this.buffers.indexOf(n.buffer)===-1&&(this.buffers.push(n.buffer),n.buffer.on("update",this.onBufferUpdate,this))}e&&(this.indexBuffer=Ku(e,!0),this.buffers.push(this.indexBuffer)),this.topology=i||"triangle-list"}setBufferAtIndex(t,e){const i=this.buffers[e];i.off("update",this.onBufferUpdate,this),t.on("update",this.onBufferUpdate,this),this.buffers[e]=t;for(const r in this.attributes){const n=this.attributes[r];n.buffer===i&&(n.buffer=t)}}onBufferUpdate(){this.tick=this.tick++,this.emit("update",this)}getAttribute(t){return this.attributes[t]}getIndex(){return this.indexBuffer}getBuffer(t){return this.getAttribute(t).buffer}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.getBuffer(t).data.length/(e.stride/4||e.size)}return 0}destroy(t=!1){this.emit("destroy",this),this.removeAllListeners(),t&&this.buffers.forEach(e=>e.destroy()),this.attributes=null,this.buffers=null}};const _m=class extends Lo{constructor(s={}){s={..._m.defaultOptions,...s};const t=s.positions||new Float32Array([0,0,1,0,1,1,0,1]),e=s.uvs||new Float32Array([0,0,1,0,1,1,0,1]),i=s.indices||new Uint32Array([0,1,2,0,2,3]),r=new Qe({data:t,label:"attribute-mesh-positions",usage:wt.VERTEX|wt.COPY_DST}),n=new Qe({data:e,label:"attribute-mesh-uvs",usage:wt.VERTEX|wt.COPY_DST}),a=new Qe({data:i,label:"index-mesh-buffer",usage:wt.INDEX|wt.COPY_DST});super({attributes:{aPosition:{buffer:r,shaderLocation:0,format:"float32x2",stride:2*4,offset:0},aUV:{buffer:n,shaderLocation:1,format:"float32x2",stride:2*4,offset:0}},indexBuffer:a,topology:s.topology}),this.batchMode="auto"}get positions(){return this.attributes.aPosition.buffer.data}set positions(s){this.attributes.aPosition.buffer.data=s}get uvs(){return this.attributes.aUV.buffer.data}set uvs(s){this.attributes.aUV.buffer.data=s}get indices(){return this.indexBuffer.data}set indices(s){this.indexBuffer.data=s}};let Oo=_m;Oo.defaultOptions={topology:"triangle-list"};const wm=class extends Oo{constructor(s={}){super({}),this.build(s)}build(s){s={...wm.defaultOptions,...s},this.verticesX=this.verticesX??s.verticesX,this.verticesY=this.verticesY??s.verticesY,this.width=this.width??s.width,this.height=this.height??s.height;const t=this.verticesX*this.verticesY,e=[],i=[],r=[],n=this.verticesX-1,a=this.verticesY-1,o=this.width/n,h=this.height/a;for(let c=0;c<t;c++){const u=c%this.verticesX,d=c/this.verticesX|0;e.push(u*o,d*h),i.push(u/n,d/a)}const l=n*a;for(let c=0;c<l;c++){const u=c%n,d=c/n|0,f=d*this.verticesX+u,p=d*this.verticesX+u+1,m=(d+1)*this.verticesX+u,g=(d+1)*this.verticesX+u+1;r.push(f,p,m,p,g,m)}this.buffers[0].data=new Float32Array(e),this.buffers[1].data=new Float32Array(i),this.indexBuffer.data=new Uint32Array(r),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()}};let Tm=wm;Tm.defaultOptions={width:100,height:100,verticesX:10,verticesY:10};const Sm=class extends Tm{constructor(s){s={...Sm.defaultOptions,...s},super({width:s.width,height:s.height,verticesX:4,verticesY:4}),this._textureMatrix=new it,this.update(s)}update(s){this.updateUvs(s),this.updatePositions(s)}updatePositions(s){this.width=s.width??this.width,this.height=s.height??this.height,this._leftWidth=s.leftWidth??this._leftWidth,this._rightWidth=s.rightWidth??this._rightWidth,this._topHeight=s.topHeight??this._topHeight,this._bottomHeight=s.bottomHeight??this._bottomHeight;const t=this.positions,e=this._leftWidth+this._rightWidth,i=this.width>e?1:this.width/e,r=this._topHeight+this._bottomHeight,n=this.height>r?1:this.height/r,a=Math.min(i,n);t[9]=t[11]=t[13]=t[15]=this._topHeight*a,t[17]=t[19]=t[21]=t[23]=this.height-this._bottomHeight*a,t[25]=t[27]=t[29]=t[31]=this.height,t[2]=t[10]=t[18]=t[26]=this._leftWidth*a,t[4]=t[12]=t[20]=t[28]=this.width-this._rightWidth*a,t[6]=t[14]=t[22]=t[30]=this.width,this.getBuffer("aPosition").update()}updateUvs(s){this._originalWidth=s.originalWidth??this._originalWidth,this._originalHeight=s.originalHeight??this._originalHeight,this._leftWidth=s.leftWidth??this._leftWidth,this._rightWidth=s.rightWidth??this._rightWidth,this._topHeight=s.topHeight??this._topHeight,this._bottomHeight=s.bottomHeight??this._bottomHeight,s.textureMatrix&&this._textureMatrix.copyFrom(s.textureMatrix);const t=this._textureMatrix,e=this.uvs;e[0]=e[8]=e[16]=e[24]=0,e[1]=e[3]=e[5]=e[7]=0,e[6]=e[14]=e[22]=e[30]=1,e[25]=e[27]=e[29]=e[31]=1;const i=1/this._originalWidth,r=1/this._originalHeight;e[2]=e[10]=e[18]=e[26]=i*this._leftWidth,e[9]=e[11]=e[13]=e[15]=r*this._topHeight,e[4]=e[12]=e[20]=e[28]=1-i*this._rightWidth,e[17]=e[19]=e[21]=e[23]=1-r*this._bottomHeight,C_(t,e),this.getBuffer("aUV").update()}};let Cm=Sm;Cm.defaultOptions={width:100,height:100,leftWidth:10,topHeight:10,rightWidth:10,bottomHeight:10,originalWidth:100,originalHeight:100};function C_(s,t,e){e??(e=t);const i=s.a,r=s.b,n=s.c,a=s.d,o=s.tx,h=s.ty;for(let l=0;l<t.length;l+=2){const c=t[l],u=t[l+1];e[l]=c*i+u*n+o,e[l+1]=c*r+u*a+h}return e}let A_=0;const Zu=new Fr;class ao{constructor(t){this.uid=A_++,this.type="mesh",this.canBundle=!0,this.owner=oa,this.shader=t.shader,t.texture&&(this.texture=t.texture),this._geometry=t.geometry,this._geometry.on("update",this.onGeometryUpdate,this)}set shader(t){this._shader!==t&&(this._shader=t,this.onUpdate())}get shader(){return this._shader}set geometry(t){var e;this._geometry!==t&&((e=this._geometry)==null||e.off("update",this.onUpdate,this),t.on("update",this.onUpdate,this),this._geometry=t,this.onUpdate())}get geometry(){return this._geometry}set texture(t){this._texture!==t&&(this.shader&&(this.shader.resources.uTexture=t.source,this.shader.resources.uSampler=t.style),this._texture=t,this.onUpdate())}get texture(){return this._texture}addBounds(t){t.addVertexData(this.geometry.positions,0,this.geometry.positions.length)}containsPoint(t){const{x:e,y:i}=t,r=this.geometry.getBuffer("aPosition").data,n=Zu.points,a=this.geometry.getIndex().data,o=a.length,h=this.geometry.topology==="triangle-strip"?3:1;for(let l=0;l+2<o;l+=h){const c=a[l]*2,u=a[l+1]*2,d=a[l+2]*2;if(n[0]=r[c],n[1]=r[c+1],n[2]=r[u],n[3]=r[u+1],n[4]=r[d],n[5]=r[d+1],Zu.contains(e,i))return!0}return!1}get batched(){return this._shader?!1:this._geometry.batchMode==="auto"?this._geometry.positions.length/2<=100:this._geometry.batchMode==="batch"}destroy(t=!1){if(typeof t=="boolean"?t:t==null?void 0:t.texture){const i=typeof t=="boolean"?t:t==null?void 0:t.textureSource;this._texture.destroy(i)}this._texture=null,this._geometry=null,this._shader=null}onGeometryUpdate(){this.onUpdate()}onUpdate(){this.owner.onViewUpdate()}}const Ju={};function Am(s,t,e=3){if(Ju[t])return;let i=new Error().stack;typeof i>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${s}`):(i=i.split(`
`).splice(e).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${s}`),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${s}`),console.warn(i))),Ju[t]=!0}const Em=class extends W{constructor(s){s instanceof j&&(s={texture:s}),s={...Em.defaultOptions,...s};const t=s.texture,e=new Cm({width:t.width,height:t.height,originalWidth:t.width,originalHeight:t.height,leftWidth:s.leftWidth,topHeight:s.topHeight,rightWidth:s.rightWidth,bottomHeight:s.bottomHeight,textureMatrix:t.textureMatrix.mapCoord});super({view:new ao({geometry:e,texture:t}),label:"NineSlicePlane",...s})}get width(){return this.view.geometry.width}set width(s){this.view.geometry.updatePositions({width:s})}get height(){return this.view.geometry.height}set height(s){this.view.geometry.updatePositions({height:s})}get leftWidth(){return this.view.geometry._leftWidth}set leftWidth(s){this.view.geometry.updateUvs({leftWidth:s})}get topHeight(){return this.view.geometry._topHeight}set topHeight(s){this.view.geometry.updateUvs({topHeight:s})}get rightWidth(){return this.view.geometry._rightWidth}set rightWidth(s){this.view.geometry.updateUvs({rightWidth:s})}get bottomHeight(){return this.view.geometry._bottomHeight}set bottomHeight(s){this.view.geometry.updateUvs({bottomHeight:s})}get texture(){return this.view.texture}set texture(s){s!==this.view.texture&&(this.view.geometry.updateUvs({originalWidth:s.width,originalHeight:s.height,textureMatrix:s.textureMatrix.mapCoord}),this.view.texture=s)}};let Pm=Em;Pm.defaultOptions={texture:j.EMPTY,leftWidth:10,topHeight:10,rightWidth:10,bottomHeight:10};class pi extends Pm{constructor(t){Am("v8","NineSlicePlane is deprecated. Use NineSliceSprite instead."),super(t)}}function Oc({vertexSrc:s,fragmentSrc:t,maxTextures:e,name:i}){if(t.indexOf("%count%")<0)throw new Error('Fragment template must contain "%count%".');if(t.indexOf("%forloop%")<0)throw new Error('Fragment template must contain "%forloop%".');const r=E_(e);return t=t.replace(/%count%/gi,`${e}`),t=t.replace(/%forloop%/gi,r),i=i?`${i}-`:"",new as({vertex:s,fragment:t,name:`${i}batch`})}function E_(s){const t=[];for(let e=0;e<s;e++)e>0&&t.push("else"),e<s-1&&t.push(`if(vTextureId < ${e}.5)`),t.push("{"),t.push(`	outColor = texture(uSamplers[${e}], vTextureCoord);`),t.push("}");return t.join(`
`)}var P_=`in vec2 vTextureCoord;
in vec4 vColor;
in float vTextureId;
uniform sampler2D uSamplers[%count%];

out vec4 finalColor;

void main(void){
    vec4 outColor;
    %forloop%
    finalColor = outColor * vColor;
}
`,M_=`precision highp float;
in vec2 aPosition;
in vec2 aUV;
in vec4 aColor;
in float aTextureId;

uniform globalUniforms {
  mat3 projectionMatrix;
  mat3 worldTransformMatrix;
  float worldAlpha;
};

out vec2 vTextureCoord;
out vec4 vColor;
out float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * worldTransformMatrix * vec3(aPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aUV;
    vTextureId = aTextureId;
    
    vColor = vec4(aColor.rgb * aColor.a, aColor.a)  * worldAlpha;
}
`;function k_(s){return Oc({vertexSrc:M_,fragmentSrc:P_,maxTextures:s,name:"default"})}const _i=16,Mm=new Int32Array(_i);for(let s=0;s<_i;s++)Mm[s]=s;const Nc=new re({uSamplers:{value:Mm,type:`array<u32,${_i}>`}},{isStatic:!0});class km{constructor(){this.didUpload=!1}init(){const t=new re({tint:{value:new Float32Array([1,1,1,1]),type:"f32"},translationMatrix:{value:new it,type:"mat3x3<f32>"}});this.shader=new As({glProgram:k_(_i),resources:{uniforms:t,batchSamplers:Nc}})}execute(t,e){const i=t.renderer;t.state.blendMode=e.blendMode,i.state.set(t.state),i.shader.bind(this.shader,this.didUpload),this.didUpload=!0;const r=e.batchParent;i.geometry.bind(r.geometry,this.shader.glProgram);for(let n=0;n<e.textures.textures.length;n++)i.texture.bind(e.textures.textures[n],n);i.shader.bindUniformBlock(i.globalUniforms.uniformGroup,"globalUniforms",0),i.geometry.draw("triangle-list",e.size,e.start)}destroy(){this.shader.destroy(!0),this.shader=null}}km.extension={type:[L.WebGLPipesAdaptor],name:"batch"};const Qu=new Float32Array(1),td=new Uint32Array(1);let R_=class extends Lo{constructor(){const e=new Qe({data:Qu,label:"attribute-batch-buffer",usage:wt.VERTEX|wt.COPY_DST}),i=new Qe({data:td,label:"index-batch-buffer",usage:wt.INDEX|wt.COPY_DST}),r=6*4;super({attributes:{aPosition:{buffer:e,shaderLocation:0,format:"float32x2",stride:r,offset:0},aUV:{buffer:e,shaderLocation:1,format:"float32x2",stride:r,offset:2*4},aColor:{buffer:e,shaderLocation:2,format:"unorm8x4",stride:r,offset:4*4},aTextureId:{buffer:e,shaderLocation:3,format:"float32",stride:r,offset:5*4}},indexBuffer:i})}reset(){this.indexBuffer.data=td,this.buffers[0].data=Qu}};function Dc({vertex:s,fragment:t,maxTextures:e}){if(t.source.indexOf("%bindings%")<0)throw new Error('Fragment template must contain "%bindings%".');if(t.source.indexOf("%forloop%")<0)throw new Error('Fragment template must contain "%forloop%".');const i=I_(e),r=B_(e);let n=t.source;n=n.replace(/%bindings%/gi,i),n=n.replace(/%forloop%/gi,r);let a=s.source;return a===t.source&&(a=n),new os({vertex:{source:a,entryPoint:s.entryPoint},fragment:{source:n,entryPoint:t.entryPoint}})}function B_(s){const t=[];if(s===1)t.push("outColor = textureSampleGrad(textureSource1, textureSampler1, uv, uvDx, uvDy);");else{t.push("switch textureId {");for(let e=0;e<s;e++)e===s-1?t.push("  default:{"):t.push(`  case ${e}:{`),t.push(`      outColor = textureSampleGrad(textureSource${e+1}, textureSampler${e+1}, uv, uvDx, uvDy);`),t.push("      break;}");t.push("}")}return t.join(`
`)}function I_(s){const t=[];if(s===1)t.push("@group(1) @binding(0) var textureSource1: texture_2d<f32>;"),t.push("@group(1) @binding(1) var textureSampler1: sampler;");else{let e=0;for(let i=0;i<s;i++)t.push(`@group(1) @binding(${e++}) var textureSource${i+1}: texture_2d<f32>;`),t.push(`@group(1) @binding(${e++}) var textureSampler${i+1}: sampler;`)}return t.join(`
`)}var ed=`struct GlobalUniforms {
  projectionMatrix:mat3x3<f32>,
  worldTransformMatrix:mat3x3<f32>,
  worldAlpha: f32
}

@group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;

struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>,
    @location(1) color : vec4<f32>,
    @location(2) @interpolate(flat) textureId : u32,
  };

  
@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
  @location(1) aUV : vec2<f32>,
  @location(2) aColor : vec4<f32>,
  @location(3) aTexture : f32,
) -> VSOutput {

  var  mvpMatrix = globalUniforms.projectionMatrix * globalUniforms.worldTransformMatrix;

  var  colorOut = aColor;

  var alpha = vec4<f32>(
    colorOut.a * globalUniforms.worldAlpha,
    colorOut.a * globalUniforms.worldAlpha,
    colorOut.a * globalUniforms.worldAlpha,
    globalUniforms.worldAlpha
  );

  colorOut *= alpha;


  return VSOutput(
    vec4<f32>((mvpMatrix * vec3<f32>(aPosition, 1.0)).xy, 0.0, 1.0),
    aUV,
    colorOut,
    u32(aTexture)
  );
};

%bindings%

@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
  @location(1) color:vec4<f32>,
  @location(2) @interpolate(flat) textureId: u32,
) -> @location(0) vec4<f32> {


    var uvDx = dpdx(uv);
    var uvDy = dpdy(uv);

    var outColor:vec4<f32>;
    
    %forloop%
  
    // multiply the alpha!
    outColor.r *= outColor.a;
    outColor.g *= outColor.a;
    outColor.b *= outColor.a;

    return (outColor) * color;
};
`;function F_(s){return Dc({vertex:{source:ed,entryPoint:"mainVertex"},fragment:{source:ed,entryPoint:"mainFragment"},maxTextures:s})}const U_=new Float32Array(1),L_=new Uint32Array(1);function O_(){const t=new Qe({data:U_,label:"attribute-batch-buffer",usage:wt.VERTEX|wt.COPY_DST}),e=new Qe({data:L_,label:"index-batch-buffer",usage:wt.INDEX|wt.COPY_DST}),i=6*4;return new Lo({attributes:{aPosition:{buffer:t,shaderLocation:0,format:"float32x2",stride:i,offset:0},aUV:{buffer:t,shaderLocation:1,format:"float32x2",stride:i,offset:2*4},aColor:{buffer:t,shaderLocation:2,format:"unorm8x4",stride:i,offset:4*4},aTextureId:{buffer:t,shaderLocation:3,format:"float32",stride:i,offset:5*4}},indexBuffer:e})}const Rm={};function Bm(s){const t=s.map(e=>e.styleSourceKey).join("-");return Rm[t]||N_(s,t)}function N_(s,t){const e={};let i=0;for(let n=0;n<_i;n++){const a=n<s.length?s[n]:j.EMPTY.source;e[i++]=a.source,e[i++]=a.style}const r=new Ni(e);return Rm[t]=r,r}class Im{init(){this.shader=new As({gpuProgram:F_(_i),groups:{}})}execute(t,e){t.state.blendMode=e.blendMode,e.textures.bindGroup||(e.textures.bindGroup=Bm(e.textures.textures));const i=this.shader.gpuProgram,r=t.renderer.encoder,n=t.renderer.globalUniforms.bindGroup;this.shader.groups[1]=e.textures.bindGroup;const a=e.batchParent;r.setPipelineFromGeometryProgramAndState(a.geometry,i,t.state),r.setGeometry(a.geometry),r.setBindGroup(0,n,i),r.setBindGroup(1,e.textures.bindGroup,i),r.renderPassEncoder.drawIndexed(e.size,1,e.start)}destroy(){this.shader.destroy(!0),this.shader=null}}Im.extension={type:[L.WebGPUPipesAdaptor],name:"batch"};let id=class{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData),this.size=this.rawBinaryData.byteLength}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}get float64View(){return this._float64Array||(this._float64Array=new Float64Array(this.rawBinaryData)),this._float64Array}get bigUint64View(){return this._bigUint64Array||(this._bigUint64Array=new BigUint64Array(this.rawBinaryData)),this._bigUint64Array}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this.uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}};function Fl(s,t){const e=s.byteLength/8|0,i=new Float64Array(s,0,e),r=new Float64Array(t,0,e);for(let o=0;o<e;o++)r[o]=i[o];const n=new Uint8Array(s,e*8),a=new Uint8Array(t,e*8);for(let o=0;o<n.length;o++)a[o]=n[o]}const sd=[];let Mh=0;const D_=[];let kh=0;const Rh={};function G_(s,t,e,i){Mh=0,kh=0;const r=16,n=s.textures,a=t.textures,o=D_;for(let l=0;l<a.length;l++)o[l]=a[l],kh++;for(let l=0;l<n.length;l++)a[l]=n[l];const h=t.batchLocations;for(let l=0;l<kh;l++){const c=o[l];let u=!1;for(let d=0;d<n.length;d++)if(c===n[d]){u=!0,Rh[l]=e,h[c.styleSourceKey]=d;break}u||(sd[Mh++]=o[l])}for(let l=0;l<Mh;l++){const c=sd[l];for(let u=0;u<r;u++){const d=(u+i)%16;if(Rh[d]!==e){a[d]=c,Rh[d]=e,h[c.styleSourceKey]=d;break}}}return t}const V_=[];let Bh=0;class z_{constructor(){this.textures=[],this.size=0,this.batchLocations={}}}class H_{constructor(){this.textureTicks={},this.tick=1e3}begin(){Bh=0,this.bindingOffset=0,this.reset()}reset(){this.tick++,this.output=V_[Bh++]||new z_,this.output.size=0}finish(t){let e=this.output;return t&&t.textures.length&&e.textures.length&&(e=G_(t,e,this.tick,this.bindingOffset++)),this.reset(),e}add(t){const e=this.tick,i=this.textureTicks;if(i[t.styleSourceKey]===e)return!0;const r=t.styleSourceKey,n=this.output;return n.size===_i?!1:(n.textures[n.size]=t,i[r]=e,n.batchLocations[r]=n.size++,Bh=0,!0)}destroy(){this.output=null,this.textureTicks=null}}class rd{constructor(){this.type="batch",this.action="renderer",this.elementStart=0,this.elementSize=0,this.start=0,this.size=0,this.canBundle=!0}destroy(){this.textures=null,this.batchParent=null}}class Fm{constructor(t=4,e=6){this.maxSize=4096*20,this.dirty=!0,this.batchIndex=0,this.batches=[],this.vertexSize=6,this.textureBatcher=new H_,this.elements=[],this.attributeBuffer=new id(t*this.vertexSize*4),this.indexBuffer=new Uint32Array(e)}begin(){this.batchIndex=0,this.currentBlendMode="inherit";let t=this.batches[this.batchIndex];t||(t=this.batches[this.batchIndex]=new rd),t.elementSize=0,t.start=0,t.size=0,this.attributeSize=0,this.indexSize=0,this.elementSize=0,this.textureBatcher.begin(),this.dirty=!0}add(t){let e=this.batches[this.batchIndex];const i=t.texture,r=t.blendMode;(this.currentBlendMode!==r||e.elementSize>=this.maxSize||!this.textureBatcher.add(i))&&(this.break(!1),this.currentBlendMode=r,e=this.batches[this.batchIndex],e.blendMode=r,this.textureBatcher.add(i)),e.elementSize++,t.batcher=this,t.batch=e,t.location=this.attributeSize,t.indexStart=this.indexSize,this.indexSize+=t.indexSize,this.attributeSize+=t.vertexSize*this.vertexSize,this.elements[this.elementSize++]=t}checkAndUpdateTexture(t,e){const i=t.batch.textures.batchLocations[e.styleSourceKey];return i===void 0?!1:(t.textureId=i,t.texture=e,!0)}updateElement(t){this.dirty=!0,t.packAttributes(this.attributeBuffer.float32View,this.attributeBuffer.uint32View,t.location,t.textureId)}hideElement(t){this.dirty=!0;const e=this.attributeBuffer.float32View;let i=t.location;for(let r=0;r<t.vertexSize;r++)e[i]=0,e[i+1]=0,i+=6}break(t){if(this.elementSize===0)return;let e;this.batchIndex>0&&(e=this.batches[this.batchIndex-1]),this.attributeSize*4>this.attributeBuffer.size&&this._resizeAttributeBuffer(this.attributeSize*4),this.indexSize>this.indexBuffer.length&&this._resizeIndexBuffer(this.indexSize);const i=this.batches[this.batchIndex];i.size=this.indexSize-i.start,!t&&e?i.textures=this.textureBatcher.finish(e.textures):i.textures=this.textureBatcher.finish();const r=this.elementSize-i.elementStart;for(let a=0;a<r;a++){const o=this.elements[i.elementStart+a];o.textureId=i.textures.batchLocations[o.texture.styleSourceKey],o.packAttributes(this.attributeBuffer.float32View,this.attributeBuffer.uint32View,o.location,o.textureId),o.packIndex(this.indexBuffer,o.indexStart,o.location/this.vertexSize)}this.batchIndex++;let n=this.batches[this.batchIndex];n||(n=this.batches[this.batchIndex]=new rd),n.blendMode=this.currentBlendMode,n.elementStart=this.elementSize,n.elementSize=0,n.start=this.indexSize}finish(){if(this.break(!1),this.elementSize===0)return;const t=this.batches[this.batchIndex];if(t.size=this.indexSize-t.start,this.batchIndex>0){const e=this.batches[this.batchIndex-1];t.textures=this.textureBatcher.finish(e.textures);return}t.textures=this.textureBatcher.finish()}update(){}ensureAttributeBuffer(t){t*4<this.attributeBuffer.size||this._resizeAttributeBuffer(t*4)}ensureIndexBuffer(t){t<this.indexBuffer.length||this._resizeIndexBuffer(t)}_resizeAttributeBuffer(t){const e=Math.max(t,this.attributeBuffer.size*2),i=new id(e);Fl(this.attributeBuffer.rawBinaryData,i.rawBinaryData),this.attributeBuffer=i}_resizeIndexBuffer(t){const e=this.indexBuffer,i=Math.max(t,e.length*2),r=new Uint32Array(i);Fl(e.buffer,r.buffer),this.indexBuffer=r}destroy(){for(let t=0;t<this.batches.length;t++)this.batches[t].destroy();this.batches=null;for(let t=0;t<this.elements.length;t++)this.elements[t].batch=null;this.elements=null,this.indexBuffer=null,this.attributeBuffer.destroy(),this.attributeBuffer=null,this.textureBatcher.destroy(),this.boundTextures=null}}class Um{constructor(t,e){this.toUpdate=[],this.state=Es.for2d(),this._batches={},this.renderer=t,this.adaptor=e,this.adaptor.init()}buildStart(t){this.lastBatch=0,this._batches[t.uid]||(this._batches[t.uid]={batcher:new Fm,geometry:O_()}),this._batches[t.uid].batcher.begin()}addToBatch(t,e){this._batches[e.uid].batcher.add(t)}break(t){const e=this._batches[t.uid].batcher,i=t.instructionSize>0&&t.lastInstruction().type!=="batch";for(e.break(i);this.lastBatch<e.batchIndex;){const r=e.batches[this.lastBatch++];r.elementSize!==0&&(r.batchParent=this._batches[t.uid],t.instructions[t.instructionSize++]=r)}}buildEnd(t){this.break(t);const{geometry:e,batcher:i}=this._batches[t.uid];i.elementSize!==0&&(i.finish(),e.indexBuffer.data=i.indexBuffer,e.buffers[0].data=i.attributeBuffer.float32View,e.indexBuffer.update(i.indexSize*4))}upload(t){const e=this._batches[t.uid];if(e&&e.batcher.dirty){e.batcher.dirty=!1;const i=e.geometry.buffers[0];i.update(e.batcher.attributeSize*4),this.renderer.buffer.updateBuffer(i)}}execute(t){this.adaptor.execute(this,t)}destroy(){this.toUpdate=null,this.instructionSet=null,this.activeBatcher=null,this.state=null,this._batches=null,this.renderer=null,this.adaptor.destroy(),this.adaptor=null;for(const t in this._batches){const e=this._batches[t];e.batcher.destroy(),e.geometry.destroy()}}}Um.extension={type:[L.WebGLPipes,L.WebGPUPipes,L.CanvasPipes],name:"batch"};var nd=`struct GlobalUniforms {
  projectionMatrix:mat3x3<f32>,
  worldTransformMatrix:mat3x3<f32>,
  worldAlpha: f32
}

struct GlobalFilterUniforms {
  inputSize:vec4<f32>,
  inputPixel:vec4<f32>,
  inputClamp:vec4<f32>,
  outputFrame:vec4<f32>,
  backgroundFrame:vec4<f32>,
  globalFrame:vec4<f32>,
};

struct AlphaUniforms {
  uAlpha:f32,
};

@group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;

@group(1) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(1) @binding(1) var iTexture: texture_2d<f32>;
@group(1) @binding(2) var iSampler : sampler;

@group(2) @binding(0) var<uniform> alphaUniforms : AlphaUniforms;

struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>,
  };

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * max(gfu.outputFrame.zw, vec2(0.)) + gfu.outputFrame.xy;

    return vec4((globalUniforms.projectionMatrix * globalUniforms.worldTransformMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.outputFrame.zw * gfu.inputSize.zw);
}

fn filterBackgroundTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * gfu.backgroundFrame.zw;
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return  (aPosition.xy / gfu.globalFrame.zw) + (gfu.globalFrame.xy / gfu.globalFrame.zw);  
}

fn getSize() -> vec2<f32>
{
  return gfu.globalFrame.zw;
}
  
@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {
  return VSOutput(
   filterVertexPosition(aPosition),
   filterTextureCoord(aPosition),
  );
}

@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
) -> @location(0) vec4<f32> {
  return textureSample(iTexture, iSampler, uv) * alphaUniforms.uAlpha;
}`;const Lm=class extends nr{constructor(s){s={...Lm.DEFAULT_OPTIONS,...s};const t=new os({vertex:{source:nd,entryPoint:"mainVertex"},fragment:{source:nd,entryPoint:"mainFragment"}}),e=new re({uAlpha:{value:s.alpha,type:"f32"}});super({gpuProgram:t,resources:{filterUniforms:e}})}get alpha(){return this.resources.filterUniforms.uniforms.uAlpha}set alpha(s){this.resources.filterUniforms.uniforms.uAlpha=s}};let X_=Lm;X_.DEFAULT_OPTIONS={alpha:1};var $_=`
in vec2 vTextureCoord;
in vec2 backgroundUv;
in vec4 vColor;

out vec4 fragColor;

uniform float uBlend;

uniform sampler2D myTexture;
uniform sampler2D backTexture;

{FUNCTIONS}

void main()
{ 
    vec4 back = texture(backTexture, backgroundUv);
    vec4 front = texture(myTexture, vTextureCoord);

    {MAIN}
}
`,W_=`in vec2 aPosition;
out vec2 vTextureCoord;
out vec2 backgroundUv;

uniform globalUniforms {
  mat3 projectionMatrix;
  mat3 worldTransformMatrix;
  float worldAlpha;
};

uniform vec4 inputSize;
uniform vec4 outputFrame;
uniform vec4 backgroundFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;
    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (outputFrame.zw * inputSize.zw);
}

vec2 filterBackgroundTextureCoord( void ) 
{
    return aPosition * aPosition * backgroundFrame.zw;
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
    backgroundUv = filterBackgroundTextureCoord();
}
`,Y_=`struct GlobalUniforms {
  projectionMatrix:mat3x3<f32>,
  worldTransformMatrix:mat3x3<f32>,
  worldAlpha: f32
}

struct GlobalFilterUniforms {
  inputSize:vec4<f32>,
  inputPixel:vec4<f32>,
  inputClamp:vec4<f32>,
  outputFrame:vec4<f32>,
  backgroundFrame:vec4<f32>,
  globalFrame:vec4<f32>,
};

struct BlendUniforms {
  uBlend:f32,
};

@group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;

@group(1) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(1) @binding(1) var myTexture: texture_2d<f32>;
@group(1) @binding(2) var mySampler : sampler;
@group(1) @binding(3) var backTexture: texture_2d<f32>;

@group(2) @binding(0) var<uniform> blendUniforms : BlendUniforms;


struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>,
    @location(1) backgroundUv : vec2<f32>,
  };

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.outputFrame.zw + gfu.outputFrame.xy;

    return vec4((globalUniforms.projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.outputFrame.zw * gfu.inputSize.zw);
}

fn filterBackgroundTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * aPosition * gfu.backgroundFrame.zw;
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return  (aPosition.xy / gfu.globalFrame.zw) + (gfu.globalFrame.xy / gfu.globalFrame.zw);  
}
  
@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {
  return VSOutput(
   filterVertexPosition(aPosition),
   filterTextureCoord(aPosition),
   filterBackgroundTextureCoord(aPosition),
  );
}

{FUNCTIONS}

@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
  @location(1) backgroundUv: vec2<f32>,
) -> @location(0) vec4<f32> {


   var back =  textureSample(backTexture, mySampler, backgroundUv);
   var front = textureSample(myTexture, mySampler, uv);
   
   var out = vec4<f32>(0.0,0.0,0.0,0.0);

   {MAIN}

   return out;
}`;class jt extends nr{constructor(t){const e=t.gpu,i=ad({source:Y_,...e}),r=new os({vertex:{source:i,entryPoint:"mainVertex"},fragment:{source:i,entryPoint:"mainFragment"}}),n=t.gl,a=ad({source:$_,...n}),o=new as({vertex:W_,fragment:a}),h=new re({uBlend:{value:1,type:"f32"}});super({gpuProgram:r,glProgram:o,blendRequired:!0,resources:{blendUniforms:h,backTexture:j.EMPTY}})}}function ad(s){const{source:t,functions:e,main:i}=s;return t.replace("{FUNCTIONS}",e).replace("{MAIN}",i)}const Gc=`
	float getLuminosity(vec3 c) {
		return 0.3 * c.r + 0.59 * c.g + 0.11 * c.b;
	}

	vec3 setLuminosity(vec3 c, float lum) {
		float modLum = lum - getLuminosity(c);
		vec3 color = c.rgb + vec3(modLum);

		// clip back into legal range
		modLum = getLuminosity(color);
		vec3 modLumVec = vec3(modLum);

		float cMin = min(color.r, min(color.g, color.b));
		float cMax = max(color.r, max(color.g, color.b));

		if(cMin < 0.0) {
			color = mix(modLumVec, color, modLum / (modLum - cMin));
		}

		if(cMax > 1.0) {
			color = mix(modLumVec, color, (1.0 - modLum) / (cMax - modLum));
		}

		return color;
	}

	float getSaturation(vec3 c) {
		return max(c.r, max(c.g, c.b)) - min(c.r, min(c.g, c.b));
	}

	vec3 setSaturationMinMidMax(vec3 cSorted, float s) {
		vec3 colorSorted = cSorted;

		if(colorSorted.z > colorSorted.x) {
			colorSorted.y = (((colorSorted.y - colorSorted.x) * s) / (colorSorted.z - colorSorted.x));
			colorSorted.z = s;
		}
		else {
			colorSorted.y = 0.0;
			colorSorted.z = 0.0;
		}

		colorSorted.x = 0.0;

		return colorSorted;
	}

	vec3 setSaturation(vec3 c, float s) {
		vec3 color = c;

		if(color.r <= color.g && color.r <= color.b) {
			if(color.g <= color.b) {
				color = setSaturationMinMidMax(color.rgb, s).rgb;
			}
			else {
				color = setSaturationMinMidMax(color.rbg, s).rbg;
			}
		}
		else if(color.g <= color.r && color.g <= color.b) {
			if(color.r <= color.b) {
				color = setSaturationMinMidMax(color.grb, s).grb;
			}
			else {
				color = setSaturationMinMidMax(color.gbr, s).gbr;
			}
		}
		else {
			// Using bgr for both fixes part of hue
			if(color.r <= color.g) {
				color = setSaturationMinMidMax(color.brg, s).brg;
			}
			else {
				color = setSaturationMinMidMax(color.bgr, s).bgr;
			}
		}

		return color;
	}
    `,Vc=`
	fn getLuminosity(c: vec3<f32>) -> f32
	{
		return 0.3*c.r + 0.59*c.g + 0.11*c.b;
	}

	fn setLuminosity(c: vec3<f32>, lum: f32) -> vec3<f32>
	{
		var modLum: f32 = lum - getLuminosity(c);
		var color: vec3<f32> = c.rgb + modLum;

		// clip back into legal range
		modLum = getLuminosity(color);
		let modLumVec = vec3<f32>(modLum);

		let cMin: f32 = min(color.r, min(color.g, color.b));
		let cMax: f32 = max(color.r, max(color.g, color.b));

		if(cMin < 0.0)
		{
			color = mix(modLumVec, color, modLum / (modLum - cMin));
		}

		if(cMax > 1.0)
		{
			color = mix(modLumVec, color, (1 - modLum) / (cMax - modLum));
		}

		return color;
	}

	fn getSaturation(c: vec3<f32>) -> f32
	{
		return max(c.r, max(c.g, c.b)) - min(c.r, min(c.g, c.b));
	}

	fn setSaturationMinMidMax(cSorted: vec3<f32>, s: f32) -> vec3<f32>
	{
		var colorSorted = cSorted;

		if(colorSorted.z > colorSorted.x)
		{
			colorSorted.y = (((colorSorted.y - colorSorted.x) * s) / (colorSorted.z - colorSorted.x));
			colorSorted.z = s;
		}
		else
		{
			colorSorted.y = 0;
			colorSorted.z = 0;
		}

		colorSorted.x = 0;

		return colorSorted;
	}

	fn setSaturation(c: vec3<f32>, s: f32) -> vec3<f32>
	{
		var color = c;

		if (color.r <= color.g && color.r <= color.b)
		{
			if (color.g <= color.b)
			{
				color = vec3<f32>(setSaturationMinMidMax(color.rgb, s)).rgb;
			}
			else
			{
				color = vec3<f32>(setSaturationMinMidMax(color.rbg, s)).rbg;
			}
		}
		else if (color.g <= color.r && color.g <= color.b)
		{
			if (color.r <= color.b)
			{
				color = vec3<f32>(setSaturationMinMidMax(color.grb, s)).grb;
			}
			else
			{
				color = vec3<f32>(setSaturationMinMidMax(color.gbr, s)).gbr;
			}
		}
		else
		{
			// Using bgr for both fixes part of hue
			if (color.r <= color.g)
			{
				color = vec3<f32>(setSaturationMinMidMax(color.brg, s)).brg;
			}
			else
			{
				color  = vec3<f32>(setSaturationMinMidMax(color.bgr, s)).bgr;
			}
		}

		return color;
	}
	`;var j_=`in vec2 vMaskCoord;
in vec2 vTextureCoord;

uniform sampler2D myTexture;
uniform sampler2D mapTexture;

uniform float alpha;
uniform vec4 maskClamp;

out vec4 fragColor;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    // TODO look into why this is needed
    float npmAlpha = alpha; 
    vec4 original = texture(myTexture, vTextureCoord);
    vec4 masky = texture(mapTexture, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    fragColor = original;
}
`,q_=`in vec2 aPosition;

out vec2 vTextureCoord;
out vec2 vMaskCoord;

uniform globalUniforms {
  mat3 projectionMatrix;
  mat3 worldTransformMatrix;
  float worldAlpha;
};

uniform vec4 inputSize;
uniform vec4 outputFrame;
uniform mat3 filterMatrix;

vec4 filterVertexPosition(  vec2 aPosition )
{
    vec2 position = aPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord(  vec2 aPosition )
{
    return aPosition * (outputFrame.zw * inputSize.zw);
}

vec2 getFilterCoord( vec2 aPosition )
{
    return  ( filterMatrix * vec3( filterTextureCoord(aPosition), 1.0)  ).xy;
}   

void main(void)
{
    gl_Position = filterVertexPosition(aPosition);
    vTextureCoord = filterTextureCoord(aPosition);
    vMaskCoord = getFilterCoord(aPosition);
}
`,od=`struct GlobalUniforms {
  projectionMatrix:mat3x3<f32>,
  worldTransformMatrix:mat3x3<f32>,
  worldAlpha: f32
}

struct GlobalFilterUniforms {
  inputSize:vec4<f32>,
  inputPixel:vec4<f32>,
  inputClamp:vec4<f32>,
  outputFrame:vec4<f32>,
  backgroundFrame:vec4<f32>,
  globalFrame:vec4<f32>,
};

struct MaskUniforms {
  filterMatrix:mat3x3<f32>,
  maskClamp:vec4<f32>,
  alpha:f32,
};



@group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;

@group(1) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(1) @binding(1) var myTexture: texture_2d<f32>;
@group(1) @binding(2) var mySampler : sampler;
@group(1) @binding(3) var backTexture: texture_2d<f32>;

@group(2) @binding(0) var<uniform> filterUniforms : MaskUniforms;
@group(2) @binding(1) var mapTexture: texture_2d<f32>;

struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>,
    @location(1) backgroundUv : vec2<f32>,
  };

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.outputFrame.zw + gfu.outputFrame.xy;

    return vec4((globalUniforms.projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.outputFrame.zw * gfu.inputSize.zw);
}

fn filterBackgroundTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * gfu.backgroundFrame.zw;
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return  (aPosition.xy / gfu.globalFrame.zw) + (gfu.globalFrame.xy / gfu.globalFrame.zw);  
}

fn getFilterCoord(aPosition:vec2<f32> ) -> vec2<f32>
{
  return ( filterUniforms.filterMatrix * vec3( filterTextureCoord(aPosition), 1.0)  ).xy;
}

fn getSize() -> vec2<f32>
{

  
  return gfu.globalFrame.zw;
}
  
@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {
  return VSOutput(
   filterVertexPosition(aPosition),
   filterTextureCoord(aPosition),
   getFilterCoord(aPosition)
  );
}

@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
  @location(1) filterUv: vec2<f32>,
  @builtin(position) position: vec4<f32>
) -> @location(0) vec4<f32> {

    var maskClamp = filterUniforms.maskClamp;

     var clip = step(3.5,
        step(maskClamp.x, filterUv.x) +
        step(maskClamp.y, filterUv.y) +
        step(filterUv.x, maskClamp.z) +
        step(filterUv.y, maskClamp.w));

    var mask = textureSample(mapTexture, mySampler, filterUv);
    var source = textureSample(myTexture, mySampler, uv);
    
    var npmAlpha = 0.0;

    var alphaMul = 1.0 - npmAlpha * (1.0 - mask.a);

   
    //return source * (alphaMul * masky.r * alpha * clip);
    return source  * (alphaMul * mask.r) * clip;//  * (alphaMul * mask.r) * clip;// * filterUniforms.alpha * clip);
}`;class K_ extends nr{constructor({sprite:t}){const e=new Zp(t.texture),i=new re({filterMatrix:{value:new it,type:"mat3x3<f32>"},maskClamp:{value:e.uClampFrame,type:"vec4<f32>"},alpha:{value:1,type:"f32"}}),r=new os({vertex:{source:od,entryPoint:"mainVertex"},fragment:{source:od,entryPoint:"mainFragment"}}),n=as.from({vertex:q_,fragment:j_,name:"mask-filter"});super({gpuProgram:r,glProgram:n,resources:{filterUniforms:i,mapTexture:t.texture.source}}),this.sprite=t,this.textureMatrix=e}apply(t,e,i,r){this.textureMatrix.texture=this.sprite.texture,t.calculateSpriteMatrix(this.resources.filterUniforms.uniforms.filterMatrix,this.sprite).prepend(this.textureMatrix.mapCoord),this.resources.mapTexture=this.sprite.texture.source,t.applyFilter(this,e,i,r)}}var Z_=`
in vec2 vTextureCoord;
in vec4 vColor;

out vec4 fragColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D myTexture;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture(myTexture, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * 0.2);
    float diff = (randomValue - 0.5) *  0.5;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    fragColor = color;
}
`,J_=`in vec2 aPosition;
out vec2 vTextureCoord;

uniform globalUniforms {
  mat3 projectionMatrix;
  mat3 worldTransformMatrix;
  float worldAlpha;
};

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * outputFrame.zw + outputFrame.xy;
    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,hd=`struct GlobalUniforms {
  projectionMatrix:mat3x3<f32>,
  worldTransformMatrix:mat3x3<f32>,
  worldAlpha: f32
}

struct GlobalFilterUniforms {
  inputSize:vec4<f32>,
  inputPixel:vec4<f32>,
  inputClamp:vec4<f32>,
  outputFrame:vec4<f32>,
  backgroundFrame:vec4<f32>,
  globalFrame:vec4<f32>,
};

struct NoiseUniforms {
  uNoise:f32,
  uSeed:f32,
};



@group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;

@group(1) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(1) @binding(1) var myTexture: texture_2d<f32>;
@group(1) @binding(2) var mySampler : sampler;
@group(1) @binding(3) var backTexture: texture_2d<f32>;

@group(2) @binding(0) var<uniform> noiseUniforms : NoiseUniforms;

struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>,
    @location(1) backgroundUv : vec2<f32>,
  };

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.outputFrame.zw + gfu.outputFrame.xy;

    return vec4((globalUniforms.projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.outputFrame.zw * gfu.inputSize.zw);
}

fn filterBackgroundTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * gfu.backgroundFrame.zw;
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return  (aPosition.xy / gfu.globalFrame.zw) + (gfu.globalFrame.xy / gfu.globalFrame.zw);  
}

fn getSize() -> vec2<f32>
{
  return gfu.globalFrame.zw;
}
  
@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {
  return VSOutput(
   filterVertexPosition(aPosition),
   filterTextureCoord(aPosition),
   filterBackgroundTextureCoord(aPosition),
  );
}

fn rand(co:vec2<f32>) -> f32
{
  return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}



@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
  @location(1) backgroundUv: vec2<f32>,
  @builtin(position) position: vec4<f32>
) -> @location(0) vec4<f32> {

    var pixelPosition =  globalTextureCoord(position.xy);// / (getSize());//-  gfu.outputFrame.xy);
  
    
    var sample = textureSample(myTexture, mySampler, uv);
    var back = textureSample(backTexture, mySampler, backgroundUv);
    var randomValue =  rand(pixelPosition.xy * noiseUniforms.uSeed);
    var diff = (randomValue - 0.5) * noiseUniforms.uNoise;
  
    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (sample.a > 0.0) {
      sample.r /= sample.a;
      sample.g /= sample.a;
      sample.b /= sample.a;
    }

    sample.r += diff;
    sample.g += diff;
    sample.b += diff;

    // Premultiply alpha again.
    sample.r *= sample.a;
    sample.g *= sample.a;
    sample.b *= sample.a;
    
    return sample;
}`;const Om=class extends nr{constructor(s={}){s={...Om.DEFAULT,...s};const t=new os({vertex:{source:hd,entryPoint:"mainVertex"},fragment:{source:hd,entryPoint:"mainFragment"}}),e=new as({vertex:J_,fragment:Z_,name:"noise-filter"});super({gpuProgram:t,glProgram:e,resources:{noiseUniforms:new re({uNoise:{value:s.noise,type:"f32"},uSeed:{value:s.seed??Math.random(),type:"f32"}})},resolution:1});const i=s.noise??.5,r=s.seed??Math.random();this.noise=i,this.seed=r}get noise(){return this.resources.noiseUniforms.uniforms.uNoise}set noise(s){this.resources.noiseUniforms.uniforms.uNoise=s}get seed(){return this.resources.noiseUniforms.uniforms.uSeed}set seed(s){this.resources.noiseUniforms.uniforms.uSeed=s}};let No=Om;No.DEFAULT={noise:.5,seed:void 0};class Nm{constructor(t){this.filterGlobalUniforms=new re({inputSize:{value:new Float32Array(4),type:"vec4<f32>"},inputPixel:{value:new Float32Array(4),type:"vec4<f32>"},inputClamp:{value:new Float32Array(4),type:"vec4<f32>"},outputFrame:{value:new Float32Array(4),type:"vec4<f32>"},backgroundFrame:{value:new Float32Array(4),type:"vec4<f32>"},globalFrame:{value:new Float32Array(4),type:"vec4<f32>"}}),this.renderer=t}push(t,e,i){this.renderer.renderPipes.batch.break(i),i.add({type:"filter",canBundle:!1,action:"pushFilter",container:e,filterEffect:t})}pop(t,e,i){this.renderer.renderPipes.batch.break(i),i.add({type:"filter",action:"popFilter",canBundle:!1})}execute(t){t.action==="pushFilter"?this.renderer.filter.push(t):t.action==="popFilter"&&this.renderer.filter.pop()}destroy(){this.renderer=null,this.filterGlobalUniforms=null}}Nm.extension={type:[L.WebGLPipes,L.WebGPUPipes,L.CanvasPipes],name:"filter"};let Q_=0;class tw{constructor(t){this.poolKeyHash={},this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1}createTexture(t,e,i){const r=new vi({...this.textureOptions,width:t,height:e,resolution:1,antialias:i});return new j({source:r,label:`texturePool_${Q_++}`})}getOptimalTexture(t,e,i=1,r){let n=Math.ceil(t*i-1e-6),a=Math.ceil(e*i-1e-6);n=jr(n),a=jr(a);const o=(n<<17)+(a<<1)+(r?1:0);this.texturePool[o]||(this.texturePool[o]=[]);let h=this.texturePool[o].pop();return h||(h=this.createTexture(n,a,r)),h.source._resolution=i,h.source.width=n/i,h.source.height=a/i,h.source.pixelWidth=n,h.source.pixelHeight=a,h.frameX=0,h.frameY=0,h.frameWidth=t,h.frameHeight=e,h.layout.update(),this.poolKeyHash[h.id]=o,h}getSameSizeTexture(t){const e=t.source;return this.getOptimalTexture(e.width,e.height,e._resolution,e.antialias)}returnTexture(t){const e=this.poolKeyHash[t.id];this.texturePool[e].push(t)}clear(t){if(t=t!==!1,t)for(const e in this.texturePool){const i=this.texturePool[e];if(i)for(let r=0;r<i.length;r++)i[r].destroy(!0)}this.texturePool={}}}const li=new tw;function ew(s,t){t.clear();const e=t.matrix;for(let i=0;i<s.length;i++){const r=s[i];r.layerVisibleRenderable<3||(t.matrix=r.worldTransform,r.view.addBounds(t))}return t.matrix=e,t}const iw=new Lo({attributes:{aPosition:{buffer:new Float32Array([0,0,1,0,1,1,0,1]),shaderLocation:0,format:"float32x2",stride:2*4,offset:0}},indexBuffer:new Uint32Array([0,1,2,0,2,3])});let Dm=class{constructor(t){this.filterStackIndex=0,this.filterStack=[],this.filterGlobalUniforms=new re({inputSize:{value:new Float32Array(4),type:"vec4<f32>"},inputPixel:{value:new Float32Array(4),type:"vec4<f32>"},inputClamp:{value:new Float32Array(4),type:"vec4<f32>"},outputFrame:{value:new Float32Array(4),type:"vec4<f32>"},backgroundFrame:{value:new Float32Array(4),type:"vec4<f32>"},globalFrame:{value:new Float32Array(4),type:"vec4<f32>"}}),this.globalFilterBindGroup=new Ni({}),this.renderer=t}push(t){const e=this.renderer,i=t.filterEffect.filters;this.filterStack[this.filterStackIndex]||(this.filterStack[this.filterStackIndex]=this.getFilterData());const r=this.filterStack[this.filterStackIndex];this.filterStackIndex++;const n=r.bounds;if(t.renderables?ew(t.renderables,n):Io(t.container,!0,n),i.length===0){r.skip=!0;return}let a=e.renderTarget.rootRenderTarget.colorTexture.source._resolution,o=0,h=e.renderTarget.rootRenderTarget.colorTexture.source.antialias,l=!1,c=!1;for(let u=0;u<i.length;u++){const d=i[u];a=Math.min(a,d.resolution),o+=d.padding,d.antialias!=="inherit"&&(d.antialias==="on"?h=!0:h=!1),c=d.enabled||c,l=l||d.blendRequired}if(!c){r.skip=!0;return}if(n.scale(a).fit(e.renderTarget.rootRenderTarget.viewport).scale(1/a).pad(o).ceil(),!n.isPositive){r.skip=!0;return}r.skip=!1,r.bounds=n,r.blendRequired=l,r.container=t.container,r.filterEffect=t.filterEffect,r.previousRenderSurface=e.renderTarget.renderTarget,r.inputTexture=li.getOptimalTexture(n.width,n.height,a,h),e.renderTarget.bind(r.inputTexture,!0),e.globalUniforms.push({offset:n})}pop(){const t=this.renderer;this.filterStackIndex--;const e=this.filterStack[this.filterStackIndex];if(e.skip)return;this.activeFilterData=e;const i=e.inputTexture,r=e.bounds;let n=j.EMPTY;e.blendRequired&&(t.encoder.finishRenderPass(),n=this.getBackTexture(e.previousRenderSurface,r));const a=It.shared;this.filterStackIndex>0&&(a.x=this.filterStack[this.filterStackIndex-1].bounds.minX,a.y=this.filterStack[this.filterStackIndex-1].bounds.minY),this.updateGlobalFilterUniforms(r,i,n,a);const o=e.filterEffect.filters;this.filterGlobalUniforms.update();let h=this.filterGlobalUniforms;if(t.renderPipes.uniformBatch&&(h=t.renderPipes.uniformBatch.getUniformBufferResource(this.filterGlobalUniforms)),this.globalFilterBindGroup.setResource(h,0),this.globalFilterBindGroup.setResource(i.style,2),this.globalFilterBindGroup.setResource(n.source,3),o.length===1)t.globalUniforms.pop(),o[0].apply(this,i,e.previousRenderSurface,!1),li.returnTexture(i);else{let l=e.inputTexture;const c=this.filterGlobalUniforms.uniforms.outputFrame,u=c[0],d=c[1];if(c[0]=0,c[1]=0,this.filterGlobalUniforms.update(),t.renderPipes.uniformBatch){const m=t.renderPipes.uniformBatch.getUniformBufferResource(this.filterGlobalUniforms);this.globalFilterBindGroup.setResource(m,0)}let f=li.getOptimalTexture(r.width,r.height,l.source._resolution,!1),p=0;for(p=0;p<o.length-1;++p){o[p].apply(this,l,f,!0);const g=l;l=f,f=g}t.globalUniforms.pop(),t.renderPipes.uniformBatch?this.globalFilterBindGroup.setResource(h,0):(c[0]=u,c[1]=d,this.filterGlobalUniforms.update()),o[p].apply(this,l,e.previousRenderSurface,!1),li.returnTexture(l),li.returnTexture(f)}e.blendRequired&&li.returnTexture(n)}updateGlobalFilterUniforms(t,e,i,r){const n=t.minX,a=t.minY,o=this.filterGlobalUniforms.uniforms,h=o.outputFrame,l=o.inputSize,c=o.inputPixel,u=o.inputClamp,d=o.backgroundFrame,f=o.globalFrame;h[0]=n-r.x,h[1]=a-r.y,h[2]=e.frameWidth,h[3]=e.frameHeight,l[0]=e.source.width,l[1]=e.source.height,l[2]=1/l[0],l[3]=1/l[1],c[0]=e.source.pixelWidth,c[1]=e.source.pixelHeight,c[2]=1/c[0],c[3]=1/c[1],u[0]=.5*c[2],u[1]=.5*c[3],u[2]=e.frameWidth*l[2]-.5*c[2],u[3]=e.frameHeight*l[3]-.5*c[3],d[0]=0,d[1]=0,d[2]=i.layout.frame.width,d[3]=i.layout.frame.height;let p=this.renderer.renderTarget.rootRenderTarget.colorTexture.source._resolution;this.filterStackIndex>0&&(p=this.filterStack[this.filterStackIndex-1].inputTexture.source._resolution),f[0]=r.x*p,f[1]=r.y*p;const m=this.renderer.renderTarget.rootRenderTarget.colorTexture;f[2]=m.source.width*p,f[3]=m.source.height*p}getBackTexture(t,e){const i=t.colorTexture.source._resolution,r=li.getOptimalTexture(e.width,e.height,i,!1);let n=e.minX,a=e.minY;this.filterStackIndex&&(n-=this.filterStack[this.filterStackIndex-1].bounds.minX,a-=this.filterStack[this.filterStackIndex-1].bounds.minY),n=Math.floor(n*i),a=Math.floor(a*i);const o=Math.ceil(e.width*i),h=Math.ceil(e.height*i);return this.renderer.renderTarget.copyToTexture(t,r,{x:n,y:a},{width:o,height:h}),r}applyFilter(t,e,i,r){const n=this.renderer;n.renderTarget.bind(i,!!r),this.globalFilterBindGroup.setResource(e.source,1),t.groups[0]=n.globalUniforms.bindGroup,t.groups[1]=this.globalFilterBindGroup,n.encoder.draw({geometry:iw,shader:t,state:t._state,topology:"triangle-list"})}getFilterData(){return{skip:!1,inputTexture:null,bounds:new Ti,container:null,filterEffect:null,blendRequired:!1,previousRenderSurface:null}}calculateSpriteMatrix(t,e){const i=this.activeFilterData,r=t.set(i.inputTexture._source.width,0,0,i.inputTexture._source.height,i.bounds.minX,i.bounds.minY),n=e.worldTransform.copyTo(it.shared);return n.invert(),r.prepend(n),r.scale(1/e.texture.frameWidth,1/e.texture.frameHeight),r.translate(e.anchor.x,e.anchor.y),r}destroy(){}};Dm.extension={type:[L.WebGLSystem,L.WebGPUSystem],name:"filter"};var sw=`in vec2 vTextureCoord;
in vec4 vColor;
in float vTextureId;
uniform sampler2D uSamplers[%count%];

out vec4 finalColor;

void main(void){
    vec4 outColor;
    %forloop%
    finalColor = outColor * vColor;
}
`,rw=`precision highp float;
in vec2 aPosition;
in vec2 aUV;
in vec4 aColor;
in float aTextureId;

uniform globalUniforms {
  mat3 projectionMatrix;
  mat3 worldTransformMatrix;
  float worldAlpha;
};

uniform mat3 transformMatrix;
uniform vec4 color;

out vec2 vTextureCoord;
out vec4 vColor;
out float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * worldTransformMatrix * transformMatrix * vec3(aPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aUV;
    vTextureId = aTextureId;
    
    vColor = vec4(aColor.rgb * aColor.a, aColor.a)  * worldAlpha;
}
`;function nw(s){return Oc({vertexSrc:rw,fragmentSrc:sw,maxTextures:s,name:"graphics"})}function Do(s,t,e){t[e++]=(s&255)/255,t[e++]=(s>>8&255)/255,t[e++]=(s>>16&255)/255,t[e++]=(s>>24&255)/255}class Gm{init(){const t=new re({color:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},transformMatrix:{value:new it,type:"mat3x3<f32>"}});this.shader=new As({glProgram:nw(_i),resources:{localUniforms:t,batchSamplers:Nc}})}execute(t,e){const i=e.view.context,r=i.customShader||this.shader,n=t.renderer,a=n.graphicsContext;if(!a.updateGpuContext(i).batches.length)return;const{geometry:o,batches:h}=a.getContextRenderData(i),l=t.state;l.blendMode=e.layerBlendMode,n.state.set(t.state);const c=r.resources.localUniforms.uniforms;c.transformMatrix=e.layerTransform,Do(e.layerColor,c.color,0),n.shader.bind(r),n.shader.bindUniformBlock(n.globalUniforms.uniformGroup,"globalUniforms"),n.geometry.bind(o,r.glProgram);for(let u=0;u<h.length;u++){const d=h[u];if(d.size){for(let f=0;f<d.textures.textures.length;f++)n.texture.bind(d.textures.textures[f],f);n.geometry.draw("triangle-list",d.size,d.start)}}}destroy(){this.shader.destroy(!0),this.shader=null}}Gm.extension={type:[L.WebGLPipesAdaptor],name:"graphics"};var ld=`struct GlobalUniforms {
  projectionMatrix:mat3x3<f32>,
  worldTransformMatrix:mat3x3<f32>,
  worldAlpha: f32
}

struct LocalUniforms {
  color:vec4<f32>,
  transformMatrix:mat3x3<f32>
}


@group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;
%bindings%
@group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;


struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>,
    @location(1) color : vec4<f32>,
    @location(2) @interpolate(flat) textureId : u32,
  };

  
@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
  @location(1) aUV : vec2<f32>,
  @location(2) aColor : vec4<f32>,
  @location(3) aTexture : f32,
) -> VSOutput {

  var  mvpMatrix = globalUniforms.projectionMatrix * globalUniforms.worldTransformMatrix * localUniforms.transformMatrix;

  var  colorOut = aColor * localUniforms.color.bgra;

  var alpha = vec4<f32>(
    colorOut.a * globalUniforms.worldAlpha,
    colorOut.a * globalUniforms.worldAlpha,
    colorOut.a * globalUniforms.worldAlpha,
    globalUniforms.worldAlpha
  );

  colorOut *= alpha;


  return VSOutput(
    vec4<f32>((mvpMatrix * vec3<f32>(aPosition, 1.0)).xy, 0.0, 1.0),
    aUV,
    colorOut,
    u32(aTexture)
  );
};


@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
  @location(1) color:vec4<f32>,
  @location(2) @interpolate(flat) textureId: u32,
) -> @location(0) vec4<f32> {


    var uvDx = dpdx(uv);
    var uvDy = dpdy(uv);

    var outColor:vec4<f32>;
    
    %forloop%
  
    // multiply the alpha!
    outColor.r *= outColor.a;
    outColor.g *= outColor.a;
    outColor.b *= outColor.a;

    return (outColor) * color; //* 0.1;
};
`;function aw(s){return Dc({vertex:{source:ld,entryPoint:"mainVertex"},fragment:{source:ld,entryPoint:"mainFragment"},maxTextures:s})}class Vm{init(){const t=new re({color:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},transformMatrix:{value:new it,type:"mat3x3<f32>"}});this.shader=new As({gpuProgram:aw(_i),groups:{2:new Ni({0:t})}})}execute(t,e){const i=e.view.context,r=i.customShader||this.shader,n=t.renderer,a=n.graphicsContext;if(!a.getGpuContext(i).batches.length)return;const{geometry:o,batches:h}=a.getContextRenderData(i);t.state.blendMode=e.layerBlendMode;const l=r.resources.localUniforms;r.resources.localUniforms.uniforms.transformMatrix=e.layerTransform,Do(e.layerColor,l.uniforms.color,0);const c=n.encoder;c.setPipelineFromGeometryProgramAndState(o,r.gpuProgram,t.state),c.setGeometry(o);const u=n.globalUniforms.bindGroup;c.setBindGroup(0,u,r.gpuProgram);const d=n.renderPipes.uniformBatch.getUniformBindGroup(l,!0);c.setBindGroup(2,d,r.gpuProgram);for(let f=0;f<h.length;f++){const p=h[f];r.groups[1]=p.textures.bindGroup,c.setBindGroup(1,p.textures.bindGroup,r.gpuProgram),c.renderPassEncoder.drawIndexed(p.size,1,p.start)}}destroy(){this.shader.destroy(!0),this.shader=null}}Vm.extension={type:[L.WebGPUPipesAdaptor],name:"graphics"};function ow(s,t,e){const i=s>>16&255,r=s>>8&255,n=s&255,a=t>>16&255,o=t>>8&255,h=t&255,l=i+(a-i)*e,c=r+(o-r)*e,u=n+(h-n)*e;return(l<<16)+(c<<8)+u}const hw=16777215+(16777215<<32);function zc(s,t){const e=(s>>24&255)/255,i=(t>>24&255)/255,r=e*i*255,n=s&16777215,a=t&16777215;let o=16777215;return n+(a<<32)!==hw&&(n===16777215?o=a:a===16777215?o=n:o=ow(n,a,.5)),o+(r<<24)}class Hc{constructor(){this.batcher=null,this.batch=null,this.applyTransform=!0}get blendMode(){return this.applyTransform?this.renderable.layerBlendMode:"normal"}packIndex(t,e,i){const r=this.geometryData.indices;for(let n=0;n<this.indexSize;n++)t[e++]=r[n+this.indexOffset]+i-this.vertexOffset}packAttributes(t,e,i,r){const n=this.geometryData,a=n.vertices,o=n.uvs,h=this.vertexOffset*2,l=(this.vertexOffset+this.vertexSize)*2,c=this.color,u=c>>16|c&65280|(c&255)<<16;if(this.applyTransform){const d=this.renderable,f=zc(u+(this.alpha*255<<24),d.layerColor),p=d.layerTransform,m=p.a,g=p.b,x=p.c,y=p.d,b=p.tx,v=p.ty;for(let _=h;_<l;_+=2){const w=a[_],T=a[_+1];t[i++]=m*w+x*T+b,t[i++]=g*w+y*T+v,t[i++]=o[_],t[i++]=o[_+1],e[i++]=f,t[i++]=r}}else{const d=u+(this.alpha*255<<24);for(let f=h;f<l;f+=2)t[i++]=a[f],t[i++]=a[f+1],t[i++]=o[f],t[i++]=o[f+1],e[i++]=d,t[i++]=r}}get vertSize(){return this.vertexSize}copyTo(t){t.indexOffset=this.indexOffset,t.indexSize=this.indexSize,t.vertexOffset=this.vertexOffset,t.vertexSize=this.vertexSize,t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.geometryData=this.geometryData}}const Ih={build(s,t){let e,i,r,n,a,o;if(s.type==="circle"){const v=s;e=v.x,i=v.y,a=o=v.radius,r=n=0}else if(s.type==="ellipse"){const v=s;e=v.x,i=v.y,a=v.halfWidth,o=v.halfHeight,r=n=0}else{const v=s,_=v.width/2,w=v.height/2;e=v.x+_,i=v.y+w,a=o=Math.max(0,Math.min(v.radius,Math.min(_,w))),r=_-a,n=w-o}if(!(a>=0&&o>=0&&r>=0&&n>=0))return t;const h=Math.ceil(2.3*Math.sqrt(a+o)),l=h*8+(r?4:0)+(n?4:0);if(l===0)return t;if(h===0)return t[0]=t[6]=e+r,t[1]=t[3]=i+n,t[2]=t[4]=e-r,t[5]=t[7]=i-n,t;let c=0,u=h*4+(r?2:0)+2,d=u,f=l,p=r+a,m=n,g=e+p,x=e-p,y=i+m;if(t[c++]=g,t[c++]=y,t[--u]=y,t[--u]=x,n){const v=i-m;t[d++]=x,t[d++]=v,t[--f]=v,t[--f]=g}for(let v=1;v<h;v++){const _=Math.PI/2*(v/h),w=r+Math.cos(_)*a,T=n+Math.sin(_)*o,S=e+w,C=e-w,E=i+T,M=i-T;t[c++]=S,t[c++]=E,t[--u]=E,t[--u]=C,t[d++]=C,t[d++]=M,t[--f]=M,t[--f]=S}p=r,m=n+o,g=e+p,x=e-p,y=i+m;const b=i-m;return t[c++]=g,t[c++]=y,t[--f]=b,t[--f]=g,r&&(t[c++]=x,t[c++]=y,t[--f]=b,t[--f]=x),t},triangulate(s,t,e,i,r,n){if(s.length===0)return;let a=0,o=0;const h=s.length/4;a+=s[0],o+=s[1],a+=s[h|0],o+=s[(h|0)+1],a+=s[h*2|0],o+=s[(h*2|0)+1],a+=s[h*3|0],o+=s[(h*3|0)+1],a/=4,o/=4;let l=i;t[l*e]=a,t[l*e+1]=o,l++;const c=i;t[l*e]=s[0],t[l*e+1]=s[1],l++;for(let u=2;u<s.length;u+=2)t[l*e]=s[u],t[l*e+1]=s[u+1],r[n++]=l,r[n++]=c,r[n++]=l-1,l++;r[n++]=l-1,r[n++]=c,r[n++]=c+1}},lw=1e-4,cd=1e-4;function cw(s){const t=s.length;if(t<6)return 1;let e=0;for(let i=0,r=s[t-2],n=s[t-1];i<t;i+=2){const a=s[i],o=s[i+1];e+=(a-r)*(o+n),r=a,n=o}return e<0?-1:1}function ud(s,t,e,i,r,n,a,o){const h=s-e*r,l=t-i*r,c=s+e*n,u=t+i*n;let d,f;a?(d=i,f=-e):(d=-i,f=e);const p=h+d,m=l+f,g=c+d,x=u+f;return o.push(p,m),o.push(g,x),2}function Rs(s,t,e,i,r,n,a,o){const h=e-s,l=i-t;let c=Math.atan2(h,l),u=Math.atan2(r-s,n-t);o&&c<u?c+=Math.PI*2:!o&&c>u&&(u+=Math.PI*2);let d=c;const f=u-c,p=Math.abs(f),m=Math.sqrt(h*h+l*l),g=(15*p*Math.sqrt(m)/Math.PI>>0)+1,x=f/g;if(d+=x,o){a.push(s,t),a.push(e,i);for(let y=1,b=d;y<g;y++,b+=x)a.push(s,t),a.push(s+Math.sin(b)*m,t+Math.cos(b)*m);a.push(s,t),a.push(r,n)}else{a.push(e,i),a.push(s,t);for(let y=1,b=d;y<g;y++,b+=x)a.push(s+Math.sin(b)*m,t+Math.cos(b)*m),a.push(s,t);a.push(r,n),a.push(s,t)}return g*2}function uw(s,t,e,i,r,n,a,o,h){const l=lw;if(s.length===0)return;const c=t;let u=c.alignment;if(t.alignment!==.5){let V=cw(s);e&&(V*=-1),u=(u-.5)*V+.5}const d=new It(s[0],s[1]),f=new It(s[s.length-2],s[s.length-1]),p=i,m=Math.abs(d.x-f.x)<l&&Math.abs(d.y-f.y)<l;if(p){s=s.slice(),m&&(s.pop(),s.pop(),f.set(s[s.length-2],s[s.length-1]));const V=(d.x+f.x)*.5,$=(f.y+d.y)*.5;s.unshift(V,$),s.push(V,$)}const g=r,x=s.length/2;let y=s.length;const b=g.length/2,v=c.width/2,_=v*v,w=c.miterLimit*c.miterLimit;let T=s[0],S=s[1],C=s[2],E=s[3],M=0,N=0,R=-(S-E),I=T-C,k=0,B=0,z=Math.sqrt(R*R+I*I);R/=z,I/=z,R*=v,I*=v;const Z=u,G=(1-Z)*2,O=Z*2;p||(c.cap==="round"?y+=Rs(T-R*(G-O)*.5,S-I*(G-O)*.5,T-R*G,S-I*G,T+R*O,S+I*O,g,!0)+2:c.cap==="square"&&(y+=ud(T,S,R,I,G,O,!0,g))),g.push(T-R*G,S-I*G),g.push(T+R*O,S+I*O);for(let V=1;V<x-1;++V){T=s[(V-1)*2],S=s[(V-1)*2+1],C=s[V*2],E=s[V*2+1],M=s[(V+1)*2],N=s[(V+1)*2+1],R=-(S-E),I=T-C,z=Math.sqrt(R*R+I*I),R/=z,I/=z,R*=v,I*=v,k=-(E-N),B=C-M,z=Math.sqrt(k*k+B*B),k/=z,B/=z,k*=v,B*=v;const $=C-T,H=S-E,K=C-M,nt=N-E,St=$*K+H*nt,ut=H*K-nt*$,_t=ut<0;if(Math.abs(ut)<.001*Math.abs(St)){g.push(C-R*G,E-I*G),g.push(C+R*O,E+I*O),St>=0&&(c.join==="round"?y+=Rs(C,E,C-R*G,E-I*G,C-k*G,E-B*G,g,!1)+4:y+=2,g.push(C-k*O,E-B*O),g.push(C+k*G,E+B*G));continue}const ht=(-R+T)*(-I+E)-(-R+C)*(-I+S),At=(-k+M)*(-B+E)-(-k+C)*(-B+N),Ut=($*At-K*ht)/ut,Ht=(nt*ht-H*At)/ut,he=(Ut-C)*(Ut-C)+(Ht-E)*(Ht-E),Qt=C+(Ut-C)*G,Te=E+(Ht-E)*G,Si=C-(Ut-C)*O,ze=E-(Ht-E)*O,hn=Math.min($*$+H*H,K*K+nt*nt),ln=_t?G:O,hs=hn+ln*ln*_;he<=hs?c.join==="bevel"||he/_>w?(_t?(g.push(Qt,Te),g.push(C+R*O,E+I*O),g.push(Qt,Te),g.push(C+k*O,E+B*O)):(g.push(C-R*G,E-I*G),g.push(Si,ze),g.push(C-k*G,E-B*G),g.push(Si,ze)),y+=2):c.join==="round"?_t?(g.push(Qt,Te),g.push(C+R*O,E+I*O),y+=Rs(C,E,C+R*O,E+I*O,C+k*O,E+B*O,g,!0)+4,g.push(Qt,Te),g.push(C+k*O,E+B*O)):(g.push(C-R*G,E-I*G),g.push(Si,ze),y+=Rs(C,E,C-R*G,E-I*G,C-k*G,E-B*G,g,!1)+4,g.push(C-k*G,E-B*G),g.push(Si,ze)):(g.push(Qt,Te),g.push(Si,ze)):(g.push(C-R*G,E-I*G),g.push(C+R*O,E+I*O),c.join==="round"?_t?y+=Rs(C,E,C+R*O,E+I*O,C+k*O,E+B*O,g,!0)+2:y+=Rs(C,E,C-R*G,E-I*G,C-k*G,E-B*G,g,!1)+2:c.join==="miter"&&he/_<=w&&(_t?(g.push(Si,ze),g.push(Si,ze)):(g.push(Qt,Te),g.push(Qt,Te)),y+=2),g.push(C-k*G,E-B*G),g.push(C+k*O,E+B*O),y+=2)}T=s[(x-2)*2],S=s[(x-2)*2+1],C=s[(x-1)*2],E=s[(x-1)*2+1],R=-(S-E),I=T-C,z=Math.sqrt(R*R+I*I),R/=z,I/=z,R*=v,I*=v,g.push(C-R*G,E-I*G),g.push(C+R*O,E+I*O),p||(c.cap==="round"?y+=Rs(C-R*(G-O)*.5,E-I*(G-O)*.5,C-R*G,E-I*G,C+R*O,E+I*O,g,!1)+2:c.cap==="square"&&(y+=ud(C,E,R,I,G,O,!1,g)));const X=cd*cd;for(let V=b;V<y+b-2;++V)T=g[V*2],S=g[V*2+1],C=g[(V+1)*2],E=g[(V+1)*2+1],M=g[(V+2)*2],N=g[(V+2)*2+1],!(Math.abs(T*(E-N)+C*(N-S)+M*(S-E))<X)&&o.push(V,V+1,V+2)}var oo={},dw={get exports(){return oo},set exports(s){oo=s}};dw.exports=Go;oo.default=Go;function Go(s,t,e){e=e||2;var i=t&&t.length,r=i?t[0]*e:s.length,n=zm(s,0,r,e,!0),a=[];if(!n||n.next===n.prev)return a;var o,h,l,c,u,d,f;if(i&&(n=bw(s,t,n,e)),s.length>80*e){o=l=s[0],h=c=s[1];for(var p=e;p<r;p+=e)u=s[p],d=s[p+1],u<o&&(o=u),d<h&&(h=d),u>l&&(l=u),d>c&&(c=d);f=Math.max(l-o,c-h),f=f!==0?32767/f:0}return Gn(n,a,e,o,h,f,0),a}function zm(s,t,e,i,r){var n,a;if(r===Ol(s,t,e,i)>0)for(n=t;n<e;n+=i)a=dd(n,s[n],s[n+1],a);else for(n=e-i;n>=t;n-=i)a=dd(n,s[n],s[n+1],a);return a&&Vo(a,a.next)&&(zn(a),a=a.next),a}function ir(s,t){if(!s)return s;t||(t=s);var e=s,i;do if(i=!1,!e.steiner&&(Vo(e,e.next)||Vt(e.prev,e,e.next)===0)){if(zn(e),e=t=e.prev,e===e.next)break;i=!0}else e=e.next;while(i||e!==t);return t}function Gn(s,t,e,i,r,n,a){if(s){!a&&n&&ww(s,i,r,n);for(var o=s,h,l;s.prev!==s.next;){if(h=s.prev,l=s.next,n?pw(s,i,r,n):fw(s)){t.push(h.i/e|0),t.push(s.i/e|0),t.push(l.i/e|0),zn(s),s=l.next,o=l.next;continue}if(s=l,s===o){a?a===1?(s=mw(ir(s),t,e),Gn(s,t,e,i,r,n,2)):a===2&&gw(s,t,e,i,r,n):Gn(ir(s),t,e,i,r,n,1);break}}}}function fw(s){var t=s.prev,e=s,i=s.next;if(Vt(t,e,i)>=0)return!1;for(var r=t.x,n=e.x,a=i.x,o=t.y,h=e.y,l=i.y,c=r<n?r<a?r:a:n<a?n:a,u=o<h?o<l?o:l:h<l?h:l,d=r>n?r>a?r:a:n>a?n:a,f=o>h?o>l?o:l:h>l?h:l,p=i.next;p!==t;){if(p.x>=c&&p.x<=d&&p.y>=u&&p.y<=f&&Cr(r,o,n,h,a,l,p.x,p.y)&&Vt(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function pw(s,t,e,i){var r=s.prev,n=s,a=s.next;if(Vt(r,n,a)>=0)return!1;for(var o=r.x,h=n.x,l=a.x,c=r.y,u=n.y,d=a.y,f=o<h?o<l?o:l:h<l?h:l,p=c<u?c<d?c:d:u<d?u:d,m=o>h?o>l?o:l:h>l?h:l,g=c>u?c>d?c:d:u>d?u:d,x=Ul(f,p,t,e,i),y=Ul(m,g,t,e,i),b=s.prevZ,v=s.nextZ;b&&b.z>=x&&v&&v.z<=y;){if(b.x>=f&&b.x<=m&&b.y>=p&&b.y<=g&&b!==r&&b!==a&&Cr(o,c,h,u,l,d,b.x,b.y)&&Vt(b.prev,b,b.next)>=0||(b=b.prevZ,v.x>=f&&v.x<=m&&v.y>=p&&v.y<=g&&v!==r&&v!==a&&Cr(o,c,h,u,l,d,v.x,v.y)&&Vt(v.prev,v,v.next)>=0))return!1;v=v.nextZ}for(;b&&b.z>=x;){if(b.x>=f&&b.x<=m&&b.y>=p&&b.y<=g&&b!==r&&b!==a&&Cr(o,c,h,u,l,d,b.x,b.y)&&Vt(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;v&&v.z<=y;){if(v.x>=f&&v.x<=m&&v.y>=p&&v.y<=g&&v!==r&&v!==a&&Cr(o,c,h,u,l,d,v.x,v.y)&&Vt(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function mw(s,t,e){var i=s;do{var r=i.prev,n=i.next.next;!Vo(r,n)&&Hm(r,i,i.next,n)&&Vn(r,n)&&Vn(n,r)&&(t.push(r.i/e|0),t.push(i.i/e|0),t.push(n.i/e|0),zn(i),zn(i.next),i=s=n),i=i.next}while(i!==s);return ir(i)}function gw(s,t,e,i,r,n){var a=s;do{for(var o=a.next.next;o!==a.prev;){if(a.i!==o.i&&Cw(a,o)){var h=Xm(a,o);a=ir(a,a.next),h=ir(h,h.next),Gn(a,t,e,i,r,n,0),Gn(h,t,e,i,r,n,0);return}o=o.next}a=a.next}while(a!==s)}function bw(s,t,e,i){var r=[],n,a,o,h,l;for(n=0,a=t.length;n<a;n++)o=t[n]*i,h=n<a-1?t[n+1]*i:s.length,l=zm(s,o,h,i,!1),l===l.next&&(l.steiner=!0),r.push(Sw(l));for(r.sort(yw),n=0;n<r.length;n++)e=xw(r[n],e);return e}function yw(s,t){return s.x-t.x}function xw(s,t){var e=vw(s,t);if(!e)return t;var i=Xm(e,s);return ir(i,i.next),ir(e,e.next)}function vw(s,t){var e=t,i=s.x,r=s.y,n=-1/0,a;do{if(r<=e.y&&r>=e.next.y&&e.next.y!==e.y){var o=e.x+(r-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(o<=i&&o>n&&(n=o,a=e.x<e.next.x?e:e.next,o===i))return a}e=e.next}while(e!==t);if(!a)return null;var h=a,l=a.x,c=a.y,u=1/0,d;e=a;do i>=e.x&&e.x>=l&&i!==e.x&&Cr(r<c?i:n,r,l,c,r<c?n:i,r,e.x,e.y)&&(d=Math.abs(r-e.y)/(i-e.x),Vn(e,s)&&(d<u||d===u&&(e.x>a.x||e.x===a.x&&_w(a,e)))&&(a=e,u=d)),e=e.next;while(e!==h);return a}function _w(s,t){return Vt(s.prev,s,t.prev)<0&&Vt(t.next,s,s.next)<0}function ww(s,t,e,i){var r=s;do r.z===0&&(r.z=Ul(r.x,r.y,t,e,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==s);r.prevZ.nextZ=null,r.prevZ=null,Tw(r)}function Tw(s){var t,e,i,r,n,a,o,h,l=1;do{for(e=s,s=null,n=null,a=0;e;){for(a++,i=e,o=0,t=0;t<l&&(o++,i=i.nextZ,!!i);t++);for(h=l;o>0||h>0&&i;)o!==0&&(h===0||!i||e.z<=i.z)?(r=e,e=e.nextZ,o--):(r=i,i=i.nextZ,h--),n?n.nextZ=r:s=r,r.prevZ=n,n=r;e=i}n.nextZ=null,l*=2}while(a>1);return s}function Ul(s,t,e,i,r){return s=(s-e)*r|0,t=(t-i)*r|0,s=(s|s<<8)&16711935,s=(s|s<<4)&252645135,s=(s|s<<2)&858993459,s=(s|s<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,s|t<<1}function Sw(s){var t=s,e=s;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==s);return e}function Cr(s,t,e,i,r,n,a,o){return(r-a)*(t-o)>=(s-a)*(n-o)&&(s-a)*(i-o)>=(e-a)*(t-o)&&(e-a)*(n-o)>=(r-a)*(i-o)}function Cw(s,t){return s.next.i!==t.i&&s.prev.i!==t.i&&!Aw(s,t)&&(Vn(s,t)&&Vn(t,s)&&Ew(s,t)&&(Vt(s.prev,s,t.prev)||Vt(s,t.prev,t))||Vo(s,t)&&Vt(s.prev,s,s.next)>0&&Vt(t.prev,t,t.next)>0)}function Vt(s,t,e){return(t.y-s.y)*(e.x-t.x)-(t.x-s.x)*(e.y-t.y)}function Vo(s,t){return s.x===t.x&&s.y===t.y}function Hm(s,t,e,i){var r=xa(Vt(s,t,e)),n=xa(Vt(s,t,i)),a=xa(Vt(e,i,s)),o=xa(Vt(e,i,t));return!!(r!==n&&a!==o||r===0&&ya(s,e,t)||n===0&&ya(s,i,t)||a===0&&ya(e,s,i)||o===0&&ya(e,t,i))}function ya(s,t,e){return t.x<=Math.max(s.x,e.x)&&t.x>=Math.min(s.x,e.x)&&t.y<=Math.max(s.y,e.y)&&t.y>=Math.min(s.y,e.y)}function xa(s){return s>0?1:s<0?-1:0}function Aw(s,t){var e=s;do{if(e.i!==s.i&&e.next.i!==s.i&&e.i!==t.i&&e.next.i!==t.i&&Hm(e,e.next,s,t))return!0;e=e.next}while(e!==s);return!1}function Vn(s,t){return Vt(s.prev,s,s.next)<0?Vt(s,t,s.next)>=0&&Vt(s,s.prev,t)>=0:Vt(s,t,s.prev)<0||Vt(s,s.next,t)<0}function Ew(s,t){var e=s,i=!1,r=(s.x+t.x)/2,n=(s.y+t.y)/2;do e.y>n!=e.next.y>n&&e.next.y!==e.y&&r<(e.next.x-e.x)*(n-e.y)/(e.next.y-e.y)+e.x&&(i=!i),e=e.next;while(e!==s);return i}function Xm(s,t){var e=new Ll(s.i,s.x,s.y),i=new Ll(t.i,t.x,t.y),r=s.next,n=t.prev;return s.next=t,t.prev=s,e.next=r,r.prev=e,i.next=e,e.prev=i,n.next=i,i.prev=n,i}function dd(s,t,e,i){var r=new Ll(s,t,e);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function zn(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Ll(s,t,e){this.i=s,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Go.deviation=function(s,t,e,i){var r=t&&t.length,n=r?t[0]*e:s.length,a=Math.abs(Ol(s,0,n,e));if(r)for(var o=0,h=t.length;o<h;o++){var l=t[o]*e,c=o<h-1?t[o+1]*e:s.length;a-=Math.abs(Ol(s,l,c,e))}var u=0;for(o=0;o<i.length;o+=3){var d=i[o]*e,f=i[o+1]*e,p=i[o+2]*e;u+=Math.abs((s[d]-s[p])*(s[f+1]-s[d+1])-(s[d]-s[f])*(s[p+1]-s[d+1]))}return a===0&&u===0?0:Math.abs((u-a)/a)};function Ol(s,t,e,i){for(var r=0,n=t,a=e-i;n<e;n+=i)r+=(s[a]-s[n])*(s[n+1]+s[a+1]),a=n;return r}Go.flatten=function(s){for(var t=s[0][0].length,e={vertices:[],holes:[],dimensions:t},i=0,r=0;r<s.length;r++){for(var n=0;n<s[r].length;n++)for(var a=0;a<t;a++)e.vertices.push(s[r][n][a]);r>0&&(i+=s[r-1].length,e.holes.push(i))}return e};function $m(s,t,e,i,r,n,a){const o=oo(s,t,2);if(!o)return;for(let l=0;l<o.length;l+=3)n[a++]=o[l]+r,n[a++]=o[l+1]+r,n[a++]=o[l+2]+r;let h=r*i;for(let l=0;l<s.length;l+=2)e[h]=s[l],e[h+1]=s[l+1],h+=i}const Pw=[],Mw={build(s,t){for(let e=0;e<s.points.length;e++)t[e]=s.points[e];return t},triangulate(s,t,e,i,r,n){$m(s,Pw,t,e,i,r,n)}},kw={build(s,t){const e=s,i=e.x,r=e.y,n=e.width,a=e.height;return n>=0&&a>=0&&(t[0]=i,t[1]=r,t[2]=i+n,t[3]=r,t[4]=i+n,t[5]=r+a,t[6]=i,t[7]=r+a),t},triangulate(s,t,e,i,r,n){let a=0;i*=e,t[i+a]=s[0],t[i+a+1]=s[1],a+=e,t[i+a]=s[2],t[i+a+1]=s[3],a+=e,t[i+a]=s[6],t[i+a+1]=s[7],a+=e,t[i+a]=s[4],t[i+a+1]=s[5],a+=e;const o=i/e;r[n++]=o,r[n++]=o+1,r[n++]=o+2,r[n++]=o+1,r[n++]=o+3,r[n++]=o+2}},Rw={build(s,t){return t[0]=s.x,t[1]=s.y,t[2]=s.x2,t[3]=s.y2,t[4]=s.x3,t[5]=s.y3,t},triangulate(s,t,e,i,r,n){let a=0;i*=e,t[i+a]=s[0],t[i+a+1]=s[1],a+=e,t[i+a]=s[2],t[i+a+1]=s[3],a+=e,t[i+a]=s[4],t[i+a+1]=s[5];const o=i/e;r[n++]=o,r[n++]=o+1,r[n++]=o+2}};let Bw=0;class Wm{constructor(t){this.uid=Bw++,this.canBundle=!0,this.owner=oa,this.type="graphics",this._context=t||new Fi,this._context.on("update",this.onGraphicsContextUpdate,this)}set context(t){t!==this._context&&(this._context.off("update",this.onGraphicsContextUpdate,this),this._context=t,this._context.on("update",this.onGraphicsContextUpdate,this),this.onGraphicsContextUpdate())}get context(){return this._context}addBounds(t){t.addBounds(this._context.bounds)}containsPoint(t){return this._context.containsPoint(t)}onGraphicsContextUpdate(){this.didUpdate=!0,this.owner.onViewUpdate()}destroy(t=!1){this.owner=null,(typeof t=="boolean"?t:t==null?void 0:t.context)&&this._context.destroy(t),this._context=null}}class kn extends W{constructor(t){t instanceof Fi&&(t={context:t}),super({view:new Wm(t==null?void 0:t.context),label:"Graphics",...t})}get context(){return this.view.context}set context(t){this.view.context=t}}function Iw(s,t,e,i,r,n,a,o=null){let h=0;e*=t,r*=n;const l=o.a,c=o.b,u=o.c,d=o.d,f=o.tx,p=o.ty;for(;h<a;){const m=s[e],g=s[e+1];i[r]=l*m+u*g+f,i[r+1]=c*m+d*g+p,r+=n,e+=t,h++}}function Fw(s,t,e,i){let r=0;for(t*=e;r<i;)s[t]=0,s[t+1]=0,t+=e,r++}function Ym(s,t,e,i,r){const n=t.a,a=t.b,o=t.c,h=t.d,l=t.tx,c=t.ty;e=e||0,i=i||2,r=r||s.length/i-e;let u=e*i;for(let d=0;d<r;d++){const f=s[u],p=s[u+1];s[u]=n*f+o*p+l,s[u+1]=a*f+h*p+c,u+=i}}const Xc={rectangle:kw,polygon:Mw,triangle:Rw,circle:Ih,ellipse:Ih,roundedRectangle:Ih},Uw=new Zt;function Lw(s){const r={vertices:[],uvs:[],indices:[]},n=[];for(let a=0;a<s.instructions.length;a++){const o=s.instructions[a];if(o.action==="texture")Ow(o.data,n,r);else if(o.action==="fill"||o.action==="stroke"){const h=o.action==="stroke",l=o.data.path.shapePath,c=o.data.style,u=o.data.hole;h&&u&&fd(u.shapePath,c,null,!0,n,r),fd(l,c,u,h,n,r)}}return n}function Ow(s,t,e){const{vertices:i,uvs:r,indices:n}=e,a=n.length,o=i.length/2,h=[],l=Xc.rectangle,c=Uw,u=s.image;c.x=s.dx,c.y=s.dy,c.width=s.dw,c.height=s.dh;const d=s.transform;l.build(c,h),d&&Ym(h,d),l.triangulate(h,i,2,o,n,a);const f=u.layout.uvs;r.push(f.x0,f.y0,f.x1,f.y1,f.x3,f.y3,f.x2,f.y2);const p=Ft.get(Hc);p.indexOffset=a,p.indexSize=n.length-a,p.vertexOffset=o,p.vertexSize=i.length/2-o,p.color=s.style,p.alpha=s.alpha,p.texture=u,p.geometryData=e,t.push(p)}function fd(s,t,e,i,r,n){const{vertices:a,uvs:o,indices:h}=n,l=s.shapePrimitives.length-1;s.shapePrimitives.forEach(({shape:c,transform:u},d)=>{const f=h.length,p=a.length/2,m=[],g=Xc[c.type];if(g.build(c,m),u&&Ym(m,u),i){const v=c.closePath??!0;uw(m,t,!1,v,a,2,p,h)}else if(e&&l===d){l!==0&&console.warn("[Pixi Graphics] only the last shape have be cut out");const v=[],_=m.slice();Nw(e.shapePath).forEach(T=>{v.push(_.length/2),_.push(...T)}),$m(_,v,a,2,p,h,f)}else g.triangulate(m,a,2,p,h,f);const x=o.length/2,y=t.texture;if(y!==j.WHITE){const v=t.matrix;u&&v.append(u.clone().invert()),Iw(a,2,p,o,x,2,a.length/2-p,v)}else Fw(o,x,2,a.length/2-p);const b=Ft.get(Hc);b.indexOffset=f,b.indexSize=h.length-f,b.vertexOffset=p,b.vertexSize=a.length/2-p,b.color=t.color,b.alpha=t.alpha,b.texture=y,b.geometryData=n,r.push(b)})}function Nw(s){if(!s)return[];const t=s.shapePrimitives,e=[];for(let i=0;i<t.length;i++){const r=t[i].shape,n=[];Xc[r.type].build(r,n),e.push(n)}return e}class Dw{}class Gw{constructor(){this.geometry=new R_,this.batches=[]}init(){this.batches.length=0,this.geometry.reset()}}class jm{constructor(){this.activeBatchers=[],this.gpuContextHash={},this.graphicsDataContextHash={},this._needsContextNeedsRebuild=[]}prerender(){this.returnActiveBatchers()}getContextRenderData(t){return this.graphicsDataContextHash[t.uid]||this.initContextRenderData(t)}updateGpuContext(t){let e=this.gpuContextHash[t.uid]||this.initContext(t);if(t.dirty){e?this.cleanGraphicsContextData(t):e=this.initContext(t);const i=Lw(t);let r=0;const n=t.batchMode;let a=!0;if(n==="auto"){for(let o=0;o<i.length;o++)if(r+=i[o].vertexSize,r>100){a=!1;break}}else n==="no-batch"&&(a=!1);e=this.gpuContextHash[t.uid]={isBatchable:a,batches:i},t.dirty=!1}return e}getGpuContext(t){return this.gpuContextHash[t.uid]||this.initContext(t)}returnActiveBatchers(){for(let t=0;t<this.activeBatchers.length;t++)Ft.return(this.activeBatchers[t]);this.activeBatchers.length=0}initContextRenderData(t){const e=Ft.get(Gw),i=this.gpuContextHash[t.uid].batches;let r=0,n=0;i.forEach(l=>{l.applyTransform=!1,r+=l.geometryData.vertices.length,n+=l.geometryData.indices.length});const a=Ft.get(Fm);this.activeBatchers.push(a),a.ensureAttributeBuffer(r),a.ensureIndexBuffer(n),a.begin();for(let l=0;l<i.length;l++){const c=i[l];a.add(c)}a.finish();const o=e.geometry;o.indexBuffer.data=a.indexBuffer,o.buffers[0].data=a.attributeBuffer.float32View;const h=a.batches;for(let l=0;l<h.length;l++){const c=h[l];c.textures.bindGroup=Bm(c.textures.textures)}return this.graphicsDataContextHash[t.uid]=e,e.batches=h,e}initContext(t){const e=new Dw;return this.gpuContextHash[t.uid]=e,t.on("update",this.onGraphicsContextUpdate,this),t.on("destroy",this.onGraphicsContextDestroy,this),this.gpuContextHash[t.uid]}onGraphicsContextUpdate(t){this._needsContextNeedsRebuild.push(t)}onGraphicsContextDestroy(t){this.cleanGraphicsContextData(t),this.gpuContextHash[t.uid]=null}cleanGraphicsContextData(t){const e=this.gpuContextHash[t.uid];e.isBatchable||this.graphicsDataContextHash[t.uid]&&(Ft.return(this.getContextRenderData(t)),this.graphicsDataContextHash[t.uid]=null),e.batches&&e.batches.forEach(i=>{Ft.return(i)})}destroy(){}}jm.extension={type:[L.WebGLSystem,L.WebGPUSystem,L.CanvasSystem],name:"graphicsContext"};class qm{constructor(t,e){this.state=Es.for2d(),this.renderableBatchesHash={},this.renderer=t,this.adaptor=e,this.adaptor.init()}validateRenderable(t){const e=t.view.context,i=!!this.renderableBatchesHash[t.uid],r=this.renderer.graphicsContext.updateGpuContext(e);return!!(r.isBatchable||i!==r.isBatchable)}addRenderable(t,e){const i=this.renderer.graphicsContext.updateGpuContext(t.view.context);t.view.didUpdate&&(t.view.didUpdate=!1,this.rebuild(t)),i.isBatchable?this.addToBatcher(t,e):(this.renderer.renderPipes.batch.break(e),e.add({type:"graphics",renderable:t}))}updateRenderable(t){const e=this.renderableBatchesHash[t.uid];if(e)for(let i=0;i<e.length;i++){const r=e[i];r.batcher.updateElement(r)}}execute({renderable:t}){t.isRenderable&&this.adaptor.execute(this,t)}rebuild(t){const e=!!this.renderableBatchesHash[t.uid],i=this.renderer.graphicsContext.updateGpuContext(t.view.context);e&&this.removeBatchForRenderable(t.uid),i.isBatchable&&this.initBatchesForRenderable(t),t.view.batched=i.isBatchable}addToBatcher(t,e){const i=this.renderer.renderPipes.batch,r=this.getBatchesForRenderable(t);for(let n=0;n<r.length;n++){const a=r[n];i.addToBatch(a,e)}}getBatchesForRenderable(t){return this.renderableBatchesHash[t.uid]||this.initBatchesForRenderable(t)}initBatchesForRenderable(t){const e=t.view.context,r=this.renderer.graphicsContext.getGpuContext(e).batches.map(n=>{const a=Ft.get(Hc);return n.copyTo(a),a.renderable=t,a});return this.renderableBatchesHash[t.uid]=r,t.on("destroyed",()=>{this.destroyRenderable(t)}),r}destroyRenderable(t){this.removeBatchForRenderable(t.uid)}removeBatchForRenderable(t){this.renderableBatchesHash[t].forEach(e=>{Ft.return(e)}),this.renderableBatchesHash[t]=null}destroy(){this.renderer=null,this.shader.destroy(),this.shader=null,this.adaptor.destroy(),this.adaptor=null,this.state=null;for(const t in this.renderableBatchesHash)this.removeBatchForRenderable(t);this.renderableBatchesHash=null}}qm.extension={type:[L.WebGLPipes,L.WebGPUPipes,L.CanvasPipes],name:"graphics"};new Ti;L.WebGPUPipes;class Vw extends Rt{constructor({original:t,view:e}){super(),this.uid=om(),this.view=e,this.original=t,this.layerTransform=new it,this.layerColor=4294967295,this.layerVisibleRenderable=3,this.view.owner=this}get layerBlendMode(){return this.original.layerBlendMode}onViewUpdate(){this.didViewUpdate=!0,this.original.layerGroup.onChildViewUpdate(this)}get isRenderable(){return this.original.isRenderable}}function zw(s,t){const e=s.root,i=s.instructionSet;if(i.reset(),t.batch.buildStart(i),t.blendMode.buildStart(),t.colorMask.buildStart(),s.root.view){const a=s.proxyRenderable??$w(s);a&&(t.blendMode.setBlendMode(a,a.layerBlendMode,i),t[a.view.type].addRenderable(a,i))}const r=e.children,n=r.length;for(let a=0;a<n;a++)ha(r[a],i,t);t.batch.buildEnd(i),t.blendMode.buildEnd(i)}function ha(s,t,e){s.layerVisibleRenderable<3||!s.includeInBuild||(s.isSimple?Hw(s,t,e):Xw(s,t,e))}function Hw(s,t,e){const i=s.view;if(i&&(e.blendMode.setBlendMode(s,s.layerBlendMode,t),s.didViewUpdate=!1,e[i.type].addRenderable(s,t)),!s.isLayerRoot){const r=s.children,n=r.length;for(let a=0;a<n;a++)ha(r[a],t,e)}}function Xw(s,t,e){for(let i=0;i<s.effects.length;i++){const r=s.effects[i];e[r.pipe].push(r,s,t)}if(s.isLayerRoot)e.layer.addLayerGroup(s.layerGroup,t);else{const i=s.view;i&&(e.blendMode.setBlendMode(s,s.layerBlendMode,t),s.didViewUpdate=!1,e[i.type].addRenderable(s,t));const r=s.children;if(r.length)for(let n=0;n<r.length;n++)ha(r[n],t,e)}for(let i=s.effects.length-1;i>=0;i--){const r=s.effects[i];e[r.pipe].pop(r,s,t)}}function $w(s){const t=s.root;t.view&&(s.proxyRenderable=new Vw({original:t,view:t.view}))}const Ww=new Ti;class Yw extends Uc{constructor(){super({filters:[new K_({sprite:new lt(j.EMPTY)})]})}get sprite(){return this.filters[0].sprite}set sprite(t){this.filters[0].sprite=t}}class Km{constructor(t){this.activeMaskStage=[],this.renderer=t}push(t,e,i){const r=this.renderer;if(r.renderPipes.batch.break(i),i.add({type:"alphaMask",action:"pushMaskBegin",mask:t,canBundle:!1,maskedContainer:e}),t.renderMaskToTexture){const n=t.mask;n.includeInBuild=!0,ha(n,i,r.renderPipes),n.includeInBuild=!1}r.renderPipes.batch.break(i),i.add({type:"alphaMask",action:"pushMaskEnd",mask:t,maskedContainer:e,canBundle:!1})}pop(t,e,i){this.renderer.renderPipes.batch.break(i),i.add({type:"alphaMask",action:"popMaskEnd",mask:t,canBundle:!1})}execute(t){const e=this.renderer,i=t.mask.renderMaskToTexture;if(t.action==="pushMaskBegin"){const r=Ft.get(Yw);if(i){t.mask.mask.measurable=!0;const n=Io(t.mask.mask,!0,Ww);t.mask.mask.measurable=!1,n.ceil();const a=li.getOptimalTexture(n.width,n.height,1,!1),o=e.renderTarget.push(a,!0);e.globalUniforms.push({projectionMatrix:o.projectionMatrix,offset:n,worldColor:4294967295});const h=r.sprite;h.texture=a,h.worldTransform.tx=n.minX,h.worldTransform.ty=n.minY,this.activeMaskStage.push({filterEffect:r,maskedContainer:t.maskedContainer,filterTexture:a})}else r.sprite=t.mask.mask,this.activeMaskStage.push({filterEffect:r,maskedContainer:t.maskedContainer})}else if(t.action==="pushMaskEnd"){const r=this.activeMaskStage[this.activeMaskStage.length-1];i&&(e.renderTarget.pop(),e.globalUniforms.pop()),e.filter.push({type:"filter",action:"pushFilter",container:r.maskedContainer,filterEffect:r.filterEffect,canBundle:!1})}else if(t.action==="popMaskEnd"){e.filter.pop();const r=this.activeMaskStage.pop();i&&li.returnTexture(r.filterTexture),Ft.return(r.filterEffect)}}destroy(){this.renderer=null,this.activeMaskStage=null}}Km.extension={type:[L.WebGLPipes,L.WebGPUPipes,L.CanvasPipes],name:"alphaMask"};class Zm{constructor(t){this.colorStack=[],this.colorStackIndex=0,this.currentColor=0,this.renderer=t}buildStart(){this.colorStack[0]=15,this.colorStackIndex=1,this.currentColor=15}push(t,e,i){this.renderer.renderPipes.batch.break(i);const n=this.colorStack;n[this.colorStackIndex]=n[this.colorStackIndex-1]&t.mask;const a=this.colorStack[this.colorStackIndex];a!==this.currentColor&&(this.currentColor=a,i.add({type:"colorMask",colorMask:a,canBundle:!1})),this.colorStackIndex++}pop(t,e,i){this.renderer.renderPipes.batch.break(i);const n=this.colorStack;this.colorStackIndex--;const a=n[this.colorStackIndex-1];a!==this.currentColor&&(this.currentColor=a,i.add({type:"colorMask",colorMask:a,canBundle:!1}))}execute(t){this.renderer.colorMask.setMask(t.colorMask)}destroy(){this.colorStack=null}}Zm.extension={type:[L.WebGLPipes,L.WebGPUPipes,L.CanvasPipes],name:"colorMask"};var ue=(s=>(s[s.DISABLED=0]="DISABLED",s[s.RENDERING_MASK_ADD=1]="RENDERING_MASK_ADD",s[s.MASK_ACTIVE=2]="MASK_ACTIVE",s[s.RENDERING_MASK_REMOVE=3]="RENDERING_MASK_REMOVE",s[s.NONE=4]="NONE",s))(ue||{});class Jm{constructor(t){this.maskStackHash={},this.maskHash=new WeakMap,this.renderer=t}push(t,e,i){const r=this.renderer;r.renderPipes.batch.break(i),i.add({type:"stencilMask",action:"pushMaskBegin",mask:t,canBundle:!1});const n=t.mask;n.includeInBuild=!0,this.maskHash.has(t)||this.maskHash.set(t,{instructionsStart:0,instructionsLength:0});const a=this.maskHash.get(t);a.instructionsStart=i.instructionSize,ha(n,i,r.renderPipes),n.includeInBuild=!1,r.renderPipes.batch.break(i),i.add({type:"stencilMask",action:"pushMaskEnd",mask:t,canBundle:!1});const o=i.instructionSize-a.instructionsStart-1;a.instructionsLength=o,this.maskStackHash[e.uid]===void 0&&(this.maskStackHash[e.uid]=0),this.maskStackHash[e.uid]++}pop(t,e,i){const r=this.renderer;this.maskStackHash[e.uid]--,r.renderPipes.batch.break(i),i.add({type:"stencilMask",action:"popMaskBegin",canBundle:!1});const n=this.maskHash.get(t);if(this.maskStackHash[e.uid])for(let a=0;a<n.instructionsLength;a++)i.instructions[i.instructionSize++]=i.instructions[n.instructionsStart++];i.add({type:"stencilMask",action:"popMaskEnd",canBundle:!1})}execute(t){const e=this.renderer,i=e.renderTarget.renderTarget.uid;let r=this.maskStackHash[i]??0;t.action==="pushMaskBegin"?(r++,e.stencil.setStencilMode(ue.RENDERING_MASK_ADD,r),e.colorMask.setMask(0)):t.action==="pushMaskEnd"?(e.stencil.setStencilMode(ue.MASK_ACTIVE,r),e.colorMask.setMask(15)):t.action==="popMaskBegin"?(r--,r!==0&&(e.stencil.setStencilMode(ue.RENDERING_MASK_REMOVE,r),e.colorMask.setMask(0))):t.action==="popMaskEnd"&&(r===0?e.stencil.setStencilMode(ue.DISABLED,r):e.stencil.setStencilMode(ue.MASK_ACTIVE,r),e.colorMask.setMask(15)),this.maskStackHash[i]=r}destroy(){this.renderer=null,this.maskStackHash=null,this.maskHash=null}}Jm.extension={type:[L.WebGLPipes,L.WebGPUPipes,L.CanvasPipes],name:"stencilMask"};class Qm{execute(t,e){const i=t.renderer,r=e.view,n=t.state;n.blendMode=e.layerBlendMode;const a=t.localUniforms;a.uniforms.transformMatrix=e.layerTransform,a.update(),Do(e.layerColor,a.uniforms.color,0);let o=r._shader;o||(o=t.meshShader,o.texture=r.texture),o.groups[0]=i.globalUniforms.bindGroup,o.groups[1]=t.localUniformsBindGroup,i.encoder.draw({geometry:r._geometry,shader:o,state:n})}}Qm.extension={type:[L.WebGLPipesAdaptor],name:"mesh"};class tg{execute(t,e){const i=t.renderer,r=e.view,n=t.state;n.blendMode=e.layerBlendMode;const a=t.localUniforms;a.uniforms.transformMatrix=e.layerTransform,a.update(),Do(e.layerColor,a.uniforms.color,0);let o=r._shader;o||(o=t.meshShader,o.groups[2]=i.texture.getTextureBindGroup(r.texture)),o.groups[0]=i.globalUniforms.bindGroup,o.groups[1]=i.renderPipes.uniformBatch.getUniformBindGroup(a,!0),i.encoder.draw({geometry:r._geometry,shader:o,state:n})}}tg.extension={type:[L.WebGPUPipesAdaptor],name:"mesh"};class jw{constructor(){this.batcher=null,this.batch=null}get blendMode(){return this.renderable.layerBlendMode}reset(){this.renderable=null,this.texture=null,this.batcher=null,this.batch=null}packIndex(t,e,i){const r=this.renderable.view.geometry.indices;for(let n=0;n<r.length;n++)t[e++]=r[n]+i}packAttributes(t,e,i,r){const n=this.renderable,a=this.renderable.view.geometry,o=n.layerTransform,h=o.a,l=o.b,c=o.c,u=o.d,d=o.tx,f=o.ty,p=a.positions,m=a.uvs,g=n.layerColor;for(let x=0;x<p.length;x+=2){const y=p[x],b=p[x+1];t[i++]=h*y+c*b+d,t[i++]=l*y+u*b+f,t[i++]=m[x],t[i++]=m[x+1],e[i++]=g,t[i++]=r}}get vertexSize(){return this.renderable.view.geometry.positions.length/2}get indexSize(){return this.renderable.view.geometry.indices.length}}class qw extends W{constructor(t){super({view:new ao(t),label:"Mesh",...t})}get texture(){return this.view.texture}set texture(t){this.view.texture=t}get geometry(){return this.view.geometry}set geometry(t){this.view.geometry=t}}var Kw=`in vec2 vTextureCoord;
in vec4 vColor;

uniform sampler2D uTexture;

out vec4 outColor;

void main(void){
   outColor = texture(uTexture, vTextureCoord) * vColor;
}`,Zw=`
in vec2 aPosition;
in vec2 aUV;

uniform globalUniforms {
  mat3 projectionMatrix;
  mat3 worldTransformMatrix;
  float worldAlpha;
};

uniform mat3 transformMatrix;
uniform vec4 color;

out vec2 vTextureCoord;
out vec4 vColor;

void main(void){
    gl_Position = vec4((projectionMatrix * worldTransformMatrix * transformMatrix * vec3(aPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aUV;
    
    vColor = vec4(color.rgb * color.a, color.a) * worldAlpha;
}`,pd=`struct GlobalUniforms {
  projectionMatrix:mat3x3<f32>,
  worldTransformMatrix:mat3x3<f32>,
  worldAlpha: f32
}

struct LocalUniforms {
  transformMatrix:mat3x3<f32>,
  color:vec4<f32>
}


@group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;
@group(1) @binding(0) var<uniform> localUniforms: LocalUniforms;

@group(2) @binding(0) var uTexture: texture_2d<f32>;
@group(2) @binding(1) var uSampler: sampler;



struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>,
    @location(1) color : vec4<f32>,
  };

  
@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
  @location(1) aUV : vec2<f32>,
) -> VSOutput {

    var  mvpMatrix = globalUniforms.projectionMatrix * globalUniforms.worldTransformMatrix * localUniforms.transformMatrix;

    var  colorOut = localUniforms.color;

    colorOut.r *= colorOut.a;
    colorOut.g *= colorOut.a;
    colorOut.b *= colorOut.a;
    
  return VSOutput(
    vec4<f32>((mvpMatrix * vec3<f32>(aPosition, 1.0)).xy, 0.0, 1.0),
    aUV,
    colorOut,
  );
};


@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
  @location(1) color:vec4<f32>,
) -> @location(0) vec4<f32> {

  return textureSample(uTexture, uSampler, uv) * color;
  
}`;class Jw extends As{constructor(t){const e=as.from({vertex:Zw,fragment:Kw,name:"mesh-default"}),i=os.from({vertex:{source:pd,entryPoint:"mainVertex"},fragment:{source:pd,entryPoint:"mainFragment"}});super({glProgram:e,gpuProgram:i,resources:{uTexture:t.texture.source,uSampler:t.texture.style}})}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture=t,this.resources.uTexture=t.source,this.resources.uSampler=t.style)}}class eg{constructor(t,e){this.localUniforms=new re({transformMatrix:{value:new it,type:"mat3x3<f32>"},color:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"}}),this.localUniformsBindGroup=new Ni({0:this.localUniforms}),this.meshShader=new Jw({texture:j.EMPTY}),this.state=Es.for2d(),this.renderableHash={},this.gpuBatchableMeshHash={},this.renderer=t,this.adaptor=e}validateRenderable(t){const e=this.getRenderableData(t),i=e.batched,r=t.view.batched;if(e.batched=r,i!==r)return!0;if(r){const n=t.view._geometry;if(n.indices.length!==e.indexSize||n.positions.length!==e.vertexSize)return e.indexSize=n.indices.length,e.vertexSize=n.positions.length,!0;const a=this.getBatchableMesh(t),o=t.view.texture;if(a.texture._source!==o._source&&a.texture._source!==o._source)return a.batcher.checkAndUpdateTexture(a,o)}return!1}addRenderable(t,e){const i=this.renderer.renderPipes.batch,{batched:r}=this.getRenderableData(t);if(r){const n=this.getBatchableMesh(t);n.texture=t.view._texture,i.addToBatch(n,e)}else i.break(e),e.add({type:"mesh",renderable:t})}updateRenderable(t){if(t.view.batched){const e=this.gpuBatchableMeshHash[t.uid];e.texture=t.view._texture,e.batcher.updateElement(e)}}destroyRenderable(t){this.renderableHash[t.uid]=null;const e=this.gpuBatchableMeshHash[t.uid];Ft.return(e),this.gpuBatchableMeshHash[t.uid]=null}execute({renderable:t}){t.isRenderable&&this.adaptor.execute(this,t)}getRenderableData(t){return this.renderableHash[t.uid]||this.initRenderableData(t)}initRenderableData(t){const e=t.view;return this.renderableHash[t.uid]={batched:e.batched,indexSize:e._geometry.indices.length,vertexSize:e._geometry.positions.length},t.on("destroyed",()=>{this.destroyRenderable(t)}),this.renderableHash[t.uid]}getBatchableMesh(t){return this.gpuBatchableMeshHash[t.uid]||this.initBatchableMesh(t)}initBatchableMesh(t){const e=Ft.get(jw);return e.renderable=t,e.texture=t.view._texture,this.gpuBatchableMeshHash[t.uid]=e,e.renderable=t,e}destroy(){for(const t in this.gpuBatchableMeshHash)this.gpuBatchableMeshHash[t]&&Ft.return(this.gpuBatchableMeshHash[t]);this.gpuBatchableMeshHash=null,this.renderableHash=null,this.localUniforms=null,this.localUniformsBindGroup=null,this.meshShader.destroy(),this.meshShader=null,this.adaptor=null,this.renderer=null,this.state=null}}eg.extension={type:[L.WebGLPipes,L.WebGPUPipes,L.CanvasPipes],name:"mesh"};var Ga=(s=>(s[s.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",s[s.ARRAY_BUFFER=34962]="ARRAY_BUFFER",s[s.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",s))(Ga||{});class Qw{constructor(t,e){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0,this.type=e}}class ig{constructor(t){this._gpuBuffers={},this.renderer=t,this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.destroyAll(!0),this.gl=this.renderer.gl}getGlBuffer(t){return this._gpuBuffers[t.uid]||this.createGLBuffer(t)}bind(t){const{gl:e}=this,i=this.getGlBuffer(t);e.bindBuffer(i.type,i.buffer)}bindBufferBase(t,e){const{gl:i}=this;if(this.boundBufferBases[e]!==t){const r=this.getGlBuffer(t);this.boundBufferBases[e]=t,i.bindBufferBase(i.UNIFORM_BUFFER,e,r.buffer)}}bindBufferRange(t,e,i){const{gl:r}=this;i=i||0;const n=this.getGlBuffer(t);r.bindBufferRange(r.UNIFORM_BUFFER,e||0,n.buffer,i*256,256)}updateBuffer(t){const{gl:e}=this,i=this.getGlBuffer(t);if(t._updateID===i.updateID)return i;if(i.updateID=t._updateID,e.bindBuffer(i.type,i.buffer),i.byteLength>=t.data.byteLength)e.bufferSubData(i.type,0,t.data,0,t._updateSize/4);else{const r=t.descriptor.usage&wt.STATIC?e.STATIC_DRAW:e.DYNAMIC_DRAW;i.byteLength=t.data.byteLength,e.bufferData(i.type,t.data,r)}return i}destroyAll(t){const e=this.gl;if(!t)for(const i in this._gpuBuffers)e.deleteBuffer(this._gpuBuffers[i].buffer);this._gpuBuffers={}}onBufferDestroy(t,e){const i=this._gpuBuffers[t.uid],r=this.gl;e||r.deleteBuffer(i.buffer),this._gpuBuffers[t.uid]=null}createGLBuffer(t){const{gl:e}=this;let i=Ga.ARRAY_BUFFER;t.descriptor.usage&wt.INDEX?i=Ga.ELEMENT_ARRAY_BUFFER:t.descriptor.usage&wt.UNIFORM&&(i=Ga.UNIFORM_BUFFER);const r=new Qw(e.createBuffer(),i);return this._gpuBuffers[t.uid]=r,t.on("destroy",this.onBufferDestroy,this),r}}ig.extension={type:[L.WebGLSystem],name:"buffer"};class $c{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,t.isContextLost()&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").restoreContext()}init(t){if(t!=null&&t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,i=t.premultipliedAlpha??!0;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:i,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.runners.contextChange.emit(t);const e=this.renderer.view.element;e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}initFromOptions(t){const e=this.createContext(this.renderer.view.element,t);this.initFromContext(e)}createContext(t,e){const i=t.getContext("webgl2",e);return this.webGLVersion=2,this.gl=i,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault()}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view.element;this.renderer=null,t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){}validateContext(t){const e=t.getContextAttributes(),i="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;i&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const r=i||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=r,r||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}$c.extension={type:[L.WebGLSystem],name:"context"};$c.defaultOptions={context:null,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"};var Nl=(s=>(s[s.RGBA=6408]="RGBA",s[s.RGB=6407]="RGB",s[s.RG=33319]="RG",s[s.RED=6403]="RED",s[s.RGBA_INTEGER=36249]="RGBA_INTEGER",s[s.RGB_INTEGER=36248]="RGB_INTEGER",s[s.RG_INTEGER=33320]="RG_INTEGER",s[s.RED_INTEGER=36244]="RED_INTEGER",s[s.ALPHA=6406]="ALPHA",s[s.LUMINANCE=6409]="LUMINANCE",s[s.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",s[s.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",s[s.DEPTH_STENCIL=34041]="DEPTH_STENCIL",s))(Nl||{}),sg=(s=>(s[s.TEXTURE_2D=3553]="TEXTURE_2D",s[s.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",s[s.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",s[s.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",s[s.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",s[s.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",s[s.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",s[s.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",s[s.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",s))(sg||{}),bt=(s=>(s[s.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",s[s.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",s[s.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",s[s.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",s[s.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",s[s.UNSIGNED_INT=5125]="UNSIGNED_INT",s[s.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",s[s.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",s[s.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",s[s.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",s[s.BYTE=5120]="BYTE",s[s.SHORT=5122]="SHORT",s[s.INT=5124]="INT",s[s.FLOAT=5126]="FLOAT",s[s.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",s[s.HALF_FLOAT=36193]="HALF_FLOAT",s))(bt||{});const md={uint8x2:{type:bt.UNSIGNED_BYTE,size:2,normalised:!1},uint8x4:{type:bt.UNSIGNED_BYTE,size:4,normalised:!1},sint8x2:{type:bt.BYTE,size:2,normalised:!1},sint8x4:{type:bt.BYTE,size:4,normalised:!1},unorm8x2:{type:bt.UNSIGNED_BYTE,size:2,normalised:!0},unorm8x4:{type:bt.UNSIGNED_BYTE,size:4,normalised:!0},snorm8x2:{type:bt.BYTE,size:2,normalised:!0},snorm8x4:{type:bt.BYTE,size:4,normalised:!0},uint16x2:{type:bt.UNSIGNED_SHORT,size:2,normalised:!1},uint16x4:{type:bt.UNSIGNED_SHORT,size:4,normalised:!1},sint16x2:{type:bt.SHORT,size:2,normalised:!1},sint16x4:{type:bt.SHORT,size:4,normalised:!1},unorm16x2:{type:bt.UNSIGNED_SHORT,size:2,normalised:!0},unorm16x4:{type:bt.UNSIGNED_SHORT,size:4,normalised:!0},snorm16x2:{type:bt.SHORT,size:2,normalised:!0},snorm16x4:{type:bt.SHORT,size:4,normalised:!0},float16x2:{type:bt.HALF_FLOAT,size:2,normalised:!1},float16x4:{type:bt.HALF_FLOAT,size:4,normalised:!1},float32:{type:bt.FLOAT,size:1,normalised:!1},float32x2:{type:bt.FLOAT,size:2,normalised:!1},float32x3:{type:bt.FLOAT,size:3,normalised:!1},float32x4:{type:bt.FLOAT,size:4,normalised:!1},uint32:{type:bt.UNSIGNED_INT,size:1,normalised:!1},uint32x2:{type:bt.UNSIGNED_INT,size:2,normalised:!1},uint32x3:{type:bt.UNSIGNED_INT,size:3,normalised:!1},uint32x4:{type:bt.UNSIGNED_INT,size:4,normalised:!1},sint32:{type:bt.INT,size:1,normalised:!1},sint32x2:{type:bt.INT,size:2,normalised:!1},sint32x3:{type:bt.INT,size:3,normalised:!1},sint32x4:{type:bt.INT,size:4,normalised:!1}};function t1(s){return md[s]??md.float32}const Fh={5126:4,5123:2,5121:1},e1={"point-list":0,"line-list":1,"line-strip":3,"triangle-list":4,"triangle-strip":5};class rg{constructor(t){this._geometryVaoHash={},this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!0,this.managedGeometries={}}contextChange(){this.gl=this.renderer.gl}bind(t,e){const i=this.gl;this._activeGeometry=t;const r=this.getVao(t,e);this._activeVao!==r&&(this._activeVao=r,i.bindVertexArray(r)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let i=0;i<t.buffers.length;i++){const r=t.buffers[i];e.updateBuffer(r)}}checkCompatibility(t,e){const i=t.attributes,r=e.attributeData;for(const n in r)if(!i[n])throw new Error(`shader and geometry incompatible, geometry missing the "${n}" attribute`)}getSignature(t,e){const i=t.attributes,r=e.attributeData,n=["g",t.uid];for(const a in i)r[a]&&n.push(a,r[a].location);return n.join("-")}getVao(t,e){var i;return((i=this._geometryVaoHash[t.uid])==null?void 0:i[e.key])||this.initGeometryVao(t,e)}initGeometryVao(t,e,i=!0){const r=this.renderer.gl,n=this.renderer.buffer;this.renderer.shader.getProgramData(e),this.checkCompatibility(t,e);const a=this.getSignature(t,e);this._geometryVaoHash[t.uid]||(this._geometryVaoHash[t.uid]={},t.on("destroy",this.onGeometryDestroy,this));const o=this._geometryVaoHash[t.uid];let h=o[a];if(h)return o[e.key]=h,h;const l=t.buffers,c=t.attributes,u={},d={};for(const f in l)u[f]=0,d[f]=0;for(const f in c)!c[f].size&&e.attributeData[f]?c[f].size=e.attributeData[f].size:c[f].size||console.warn(`PIXI Geometry attribute '${f}' size cannot be determined (likely the bound shader does not have the attribute)`),u[c[f].buffer.uid]+=c[f].size*Fh[c[f].type];for(const f in c){const p=c[f],m=p.size;p.stride===void 0&&(u[p.buffer.uid]===m*Fh[p.type]?p.stride=0:p.stride=u[p.buffer.uid]),p.start===void 0&&(p.start=d[p.buffer.uid],d[p.buffer.uid]+=m*Fh[p.type])}h=r.createVertexArray(),r.bindVertexArray(h);for(let f=0;f<l.length;f++){const p=l[f];n.bind(p)}return this.activateVao(t,e),o[e.key]=h,o[a]=h,r.bindVertexArray(null),h}onGeometryDestroy(t,e){const i=this._geometryVaoHash[t.uid],r=this.gl;if(i){if(e)for(const n in i)this._activeVao!==i[n]&&this.unbind(),r.deleteVertexArray(i[n]);this._geometryVaoHash[t.uid]=null}}destroyAll(t=!1){const e=this.gl;for(const i in this._geometryVaoHash){if(t)for(const r in this._geometryVaoHash[i]){const n=this._geometryVaoHash[i];this._activeVao!==n&&this.unbind(),e.deleteVertexArray(n[r])}this._geometryVaoHash[i]=null}}activateVao(t,e){const i=this.renderer.gl,r=this.renderer.buffer,n=t.attributes;t.indexBuffer&&r.bind(t.indexBuffer);let a=null;for(const o in n){const h=n[o],l=h.buffer,c=r.getGlBuffer(l);if(e.attributeData[o]){a!==c&&(r.bind(l),a=c);const u=e.attributeData[o].location;i.enableVertexAttribArray(u);const d=t1(h.format);if(i.vertexAttribPointer(u,d.size,d.type,d.normalised,h.stride,h.offset),h.instance)if(this.hasInstance)i.vertexAttribDivisor(u,1);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,e,i,r){const{gl:n}=this.renderer,a=this._activeGeometry,o=e1[a.topology||t];if(a.indexBuffer){const h=a.indexBuffer.data.BYTES_PER_ELEMENT,l=h===2?n.UNSIGNED_SHORT:n.UNSIGNED_INT;a.instanced?n.drawElementsInstanced(o,e||a.indexBuffer.data.length,l,(i||0)*h,a.instanceCount||1):n.drawElements(o,e||a.indexBuffer.data.length,l,(i||0)*h)}else a.instanced?n.drawArraysInstanced(o,i,e||a.getSize(),r||1):n.drawArrays(o,i,e||a.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}rg.extension={type:[L.WebGLSystem],name:"geometry"};const i1=new as({vertex:`
        out vec2 vUv;

        void main() {
            vUv = vec2((gl_VertexID << 1) & 2, (gl_VertexID & 2));

            gl_Position = vec4(vUv * 2.0f + -1.0f, 0.0f, 1.0f);

            // flip dem UVs
            vUv.y = 1.0f - vUv.y;
        }`,fragment:`
        in vec2 vUv;
        out vec4 fragColor;

        uniform sampler2D uTexture;

        void main() {
            fragColor = texture(uTexture, vUv);
        }`,name:"big-triangle"}),gd=new As({glProgram:i1,resources:{uTexture:j.WHITE.source}});class ng{constructor(t){this.useBackBuffer=!1,this.renderer=t}init({useBackBuffer:t}={}){this.useBackBuffer=t}renderStart({target:t,clear:e}){if(this.useBackBuffer){const i=this.renderer.renderTarget.getRenderTarget(t);this.targetTexture=i.colorTexture,t=this._getBackBufferTexture(i.colorTexture)}this.renderer.renderTarget.start(t,e,this.renderer.background.colorRgba)}renderEnd(){this._presentBackBuffer()}_presentBackBuffer(){if(!this.useBackBuffer)return;const t=this.renderer,e=t.gl;t.renderTarget.finishRenderPass(),t.renderTarget.bind(this.targetTexture,!1),gd.resources.uTexture=this.backBufferTexture.source,t.shader.bind(gd,!1),t.state.set(Es.for2d()),e.drawArrays(e.TRIANGLES,0,3)}_getBackBufferTexture(t){const e=t.source;return this.backBufferTexture=this.backBufferTexture||new j({source:new vi({width:1,height:1,resolution:1,antialias:!1})}),this.backBufferTexture.source.resize(e.width,e.height,e._resolution),this.backBufferTexture}destroy(){}}ng.extension={type:[L.WebGLSystem],name:"backBuffer"};class ag{constructor(t){this.colorMaskCache=15,this.renderer=t}setMask(t){this.colorMaskCache!==t&&(this.colorMaskCache=t,this.renderer.gl.colorMask(!!(t&8),!!(t&4),!!(t&2),!!(t&1)))}destroy(){}}ag.extension={type:[L.WebGLSystem],name:"colorMask"};class og{constructor(t){this.commandFinished=Promise.resolve(),this.renderer=t}start(){}beginRenderPass(t,e){this.setViewport(t.viewport)}setViewport(t){}setScissor(t){t.fit(this.renderer.renderTarget.renderTarget.viewport)}clearScissor(){}setGeometry(t,e){this.renderer.geometry.bind(t,e.glProgram)}setShaderBindGroups(t,e){}syncBindGroup(t){}draw(t){const e=this.renderer,{geometry:i,shader:r,state:n,skipSync:a,topology:o,size:h,start:l,instanceCount:c}=t;e.shader.bind(r,a),e.geometry.bind(i,e.shader.activeProgram),n&&e.state.set(n),e.geometry.draw(o,h,l,c)}finishRenderPass(){}finish(){}restoreRenderPass(){}destroy(){}}og.extension={type:[L.WebGLSystem],name:"encoder"};class s1{constructor(){this.width=-1,this.height=-1,this.msaaRenderBuffer=[],this.msaa=!1,this.dirtyId=-1}}function hg(s){const t=s.colorTexture.source.resource;return t instanceof HTMLCanvasElement&&document.body.contains(t)}function r1(s,t,e,i,r,n){const a=n?1:-1;return s.identity(),s.a=1/i*2,s.d=a*(1/r*2),s.tx=-1-t*s.a,s.ty=-a-e*s.d,s}let n1=0;const lg=class{constructor(s={}){if(this.uid=n1++,this.width=0,this.height=0,this.resolution=1,this.colorTextures=[],this.clearColor=0,this.dirtyId=0,this.isRoot=!1,this._projectionMatrix=new it,s={...lg.defaultDescriptor,...s},this.width=s.width,this.height=s.height,this.resolution=s.resolution,this.stencil=s.stencil,this._viewport=new Zt(0,0,this.width,this.height),typeof s.colorTextures=="number")for(let t=0;t<s.colorTextures;t++)this.colorTextures.push(new j({source:new vi({width:this.width,height:this.height,resolution:s.resolution,antialias:s.antialias})}));else{this.colorTextures=[...s.colorTextures];const t=this.colorTexture.source;this.resize(t.width,t.height,t._resolution)}this.colorTexture.source.on("resize",this.onSourceResize,this),s.depthTexture&&(this.depthTexture=new j({source:new vi({width:this.width,height:this.height,resolution:this.resolution,format:"stencil8"})}))}get pixelWidth(){return this.width*this.resolution}get pixelHeight(){return this.height*this.resolution}get colorTexture(){return this.colorTextures[0]}get projectionMatrix(){const s=this.colorTexture;return r1(this._projectionMatrix,0,0,s.frameWidth,s.frameHeight,!this.isRoot),this._projectionMatrix}get viewport(){const s=this.colorTexture,t=s.source,e=t.pixelWidth,i=t.pixelHeight,r=this._viewport,n=s.layout.frame;return r.x=n.x*e|0,r.y=n.y*i|0,r.width=n.width*e|0,r.height=n.height*i|0,r}onSourceResize(s){this.resize(s.width,s.height,s._resolution,!0)}resize(s,t,e=this.resolution,i=!1){this.width=s,this.height=t,this.resolution=e,this.dirtyId++,this.colorTextures.forEach((r,n)=>{i&&n===0||r.source.resize(s,t,e)}),this.depthTexture&&this.depthTexture.source.resize(s,t,e)}destroy(){throw new Error("Method not implemented.")}};let Hn=lg;Hn.defaultDescriptor={width:0,height:0,resolution:1,colorTextures:1,stencil:!0,antialias:!1};class Wc{constructor(t){this.items=[],this._name=t}emit(t,e,i,r,n,a,o,h){const{name:l,items:c}=this;for(let u=0,d=c.length;u<d;u++)c[u][l](t,e,i,r,n,a,o,h);return this}add(t){return t[this._name]&&(this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return e!==-1&&this.items.splice(e,1),this}contains(t){return this.items.indexOf(t)!==-1}removeAll(){return this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}class a1 extends vi{constructor(t){t.resource||(t.resource=Tt.ADAPTER.createCanvas()),t.width||(t.width=t.resource.width,t.autoDensity||(t.width/=t.resolution)),t.height||(t.height=t.resource.height,t.autoDensity||(t.height/=t.resolution)),super(t),this.type="image",this.alphaMode=0,this.autoDensity=t.autoDensity;const e=t.resource;(this.pixelWidth!==e.width||this.pixelWidth!==e.height)&&this.resizeCanvas()}resizeCanvas(){this.autoDensity&&(this.resource.style.width=`${this.width}px`,this.resource.style.height=`${this.height}px`),this.resource.width=this.pixelWidth,this.resource.height=this.pixelHeight}resize(t=this.width,e=this.height,i=this._resolution){super.resize(t,e,i),this.resizeCanvas()}}const Uh=new Map;function Yc(s,t){if(!Uh.has(s)){const e=new j({source:new a1({resource:s,...t})});Uh.set(s,e)}return Uh.get(s)}class cg{constructor(t){this.onRenderTargetChange=new Wc("onRenderTargetChange"),this.renderSurfaceToRenderTargetHash=new Map,this.gpuRenderTargetHash={},this.renderTargetStack=[],this.defaultClearColor=[0,0,0,0],this.clearColorCache=[0,0,0,0],this.viewPortCache={x:0,y:0,width:0,height:0},this.rootProjectionMatrix=new it,this.renderer=t}contextChange(t){this.gl=t}start(t,e=!0,i){this.renderTargetStack.length=0;const r=this.getRenderTarget(t);this.rootRenderTarget=r,this.renderingToScreen=hg(this.rootRenderTarget),this.rootProjectionMatrix=r.projectionMatrix,this.push(r,e,i)}renderEnd(){this.finish()}bind(t,e=!0,i){const r=this.getRenderTarget(t);this.renderTarget=r;const n=this.getGpuRenderTarget(r);r.dirtyId!==n.dirtyId&&(n.dirtyId=r.dirtyId,this.resizeGpuRenderTarget(r));const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,n.framebuffer),r.colorTextures.forEach(c=>{this.renderer.texture.unbind(c)});const o=r.viewport;let h=o.y;r.isRoot&&(h=this.renderer.view.element.height-o.height);const l=this.viewPortCache;if((l.x!==o.x||l.y!==h||l.width!==o.width||l.height!==o.height)&&(l.x=o.x,l.y=h,l.width=o.width,l.height=o.height,a.viewport(o.x,h,o.width,o.height)),e){const c=this.gl;if(e){i=i??this.defaultClearColor;const u=this.clearColorCache;(u[0]!==i[0]||u[1]!==i[1]||u[2]!==i[2]||u[3]!==i[3])&&(u[0]=i[0],u[1]=i[1],u[2]=i[2],u[3]=i[3],c.clearColor(i[0],i[1],i[2],i[3])),c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT|c.STENCIL_BUFFER_BIT)}}return this.onRenderTargetChange.emit(r),r}getGpuColorTexture(t){return t.colorTexture}push(t,e=!0,i){const r=this.bind(t,e,i);return this.renderTargetStack.push(r),r}pop(){this.renderTargetStack.pop(),this.bind(this.renderTargetStack[this.renderTargetStack.length-1],!1)}getRenderTarget(t){return this.renderSurfaceToRenderTargetHash.get(t)??this.initRenderTarget(t)}initRenderTarget(t){let e=null;return t instanceof HTMLCanvasElement&&(t=Yc(t)),t instanceof Hn?e=t:t instanceof j&&(e=new Hn({colorTextures:[t]}),t.source.resource instanceof HTMLCanvasElement&&(e.isRoot=!0),t.source.on("destroy",()=>{e.destroy()})),this.renderSurfaceToRenderTargetHash.set(t,e),e}finishRenderPass(){const t=this.getGpuRenderTarget(this.renderTarget);if(!t.msaa)return;const e=this.renderer.gl;e.bindFramebuffer(e.FRAMEBUFFER,t.resolveTargetFramebuffer),e.bindFramebuffer(e.READ_FRAMEBUFFER,t.framebuffer),e.blitFramebuffer(0,0,t.width,t.height,0,0,t.width,t.height,e.COLOR_BUFFER_BIT,e.NEAREST),e.bindFramebuffer(e.FRAMEBUFFER,t.framebuffer),e.bindFramebuffer(e.READ_FRAMEBUFFER,null)}finish(){}copyToTexture(t,e,i,r){const n=this.renderer,a=n.renderTarget.getGpuColorTexture(t);n.renderTarget.bind(a,!1),n.texture.bind(e,0);const o=n.gl;return o.copyTexSubImage2D(o.TEXTURE_2D,0,0,0,i.x,i.y,r.width,r.height),e}getGpuRenderTarget(t){return this.gpuRenderTargetHash[t.uid]||this.initGpuRenderTarget(t)}initGpuRenderTarget(t){const i=this.renderer.gl,r=new s1;return t.colorTexture.source.resource instanceof HTMLCanvasElement?(this.gpuRenderTargetHash[t.uid]=r,r.framebuffer=null,r):(this.initColor(t,r),t.stencil&&this.initStencil(r),i.bindFramebuffer(i.FRAMEBUFFER,null),this.gpuRenderTargetHash[t.uid]=r,r)}resizeGpuRenderTarget(t){if(t.isRoot)return;const e=this.getGpuRenderTarget(t);this.resizeColor(t,e),t.stencil&&this.resizeStencil(e)}initColor(t,e){const i=this.renderer,r=i.gl,n=r.createFramebuffer();if(e.resolveTargetFramebuffer=n,r.bindFramebuffer(r.FRAMEBUFFER,n),e.width=t.colorTexture.source.pixelWidth,e.height=t.colorTexture.source.pixelHeight,t.colorTextures.forEach((a,o)=>{const h=a.source;h.antialias&&(e.msaa=!0),i.texture.bindSource(h,0);const c=i.texture.getGlSource(h).texture;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+o,3553,c,0)}),e.msaa){const a=r.createFramebuffer();e.framebuffer=a,r.bindFramebuffer(r.FRAMEBUFFER,a),t.colorTextures.forEach((o,h)=>{const l=r.createRenderbuffer();e.msaaRenderBuffer[h]=l})}else e.framebuffer=n}resizeColor(t,e){const i=t.colorTexture.source;if(e.width=i.pixelWidth,e.height=i.pixelHeight,t.colorTextures.forEach((r,n)=>{n!==0&&r.source.resize(i.width,i.height,i._resolution)}),e.msaa){const r=this.renderer,n=r.gl,a=e.framebuffer;n.bindFramebuffer(n.FRAMEBUFFER,a),t.colorTextures.forEach((o,h)=>{const l=o.source;r.texture.bindSource(l,0);const u=r.texture.getGlSource(l).internalFormat,d=e.msaaRenderBuffer[h];n.bindRenderbuffer(n.RENDERBUFFER,d),n.renderbufferStorageMultisample(n.RENDERBUFFER,4,u,l.pixelWidth,l.pixelHeight),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+h,n.RENDERBUFFER,d)})}}initStencil(t){const e=this.renderer.gl,i=e.createRenderbuffer();t.depthStencilRenderBuffer=i,e.bindRenderbuffer(e.RENDERBUFFER,i),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,i)}resizeStencil(t){const e=this.renderer.gl;e.bindRenderbuffer(e.RENDERBUFFER,t.depthStencilRenderBuffer),t.msaa?e.renderbufferStorageMultisample(e.RENDERBUFFER,4,e.DEPTH24_STENCIL8,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height)}destroy(){}}cg.extension={type:[L.WebGLSystem],name:"renderTarget"};const is=[];is[ue.NONE]=void 0;is[ue.DISABLED]={format:"stencil8",depthCompare:"always",depthWriteEnabled:!1,stencilWriteMask:0,stencilReadMask:0,stencilBack:{compare:"always",passOp:"keep"}};is[ue.RENDERING_MASK_ADD]={format:"stencil8",depthCompare:"always",depthWriteEnabled:!1,stencilBack:{compare:"always",passOp:"increment-clamp"}};is[ue.RENDERING_MASK_ADD]={format:"stencil8",depthCompare:"always",depthWriteEnabled:!1,stencilBack:{compare:"always",passOp:"increment-clamp"}};is[ue.RENDERING_MASK_REMOVE]={format:"stencil8",depthCompare:"always",depthWriteEnabled:!1,stencilBack:{compare:"always",passOp:"decrement-clamp"}};is[ue.MASK_ACTIVE]={format:"stencil8",depthCompare:"always",depthWriteEnabled:!1,stencilWriteMask:0,stencilBack:{compare:"equal",passOp:"keep"}};class ug{constructor(t){this.stencilCache={enabled:!1,stencilReference:0},this.renderTargetStencilState={},t.renderTarget.onRenderTargetChange.add(this)}contextChange(t){this.gl=t,this.comparisonFuncMapping={always:t.ALWAYS,never:t.NEVER,equal:t.EQUAL,"not-equal":t.NOTEQUAL,less:t.LESS,"less-equal":t.LEQUAL,greater:t.GREATER,"greater-equal":t.GEQUAL},this.stencilOpsMapping={keep:t.KEEP,zero:t.ZERO,replace:t.REPLACE,invert:t.INVERT,"increment-clamp":t.INCR,"decrement-clamp":t.DECR,"increment-wrap":t.INCR_WRAP,"decrement-wrap":t.DECR_WRAP}}onRenderTargetChange(t){this.activeRenderTarget=t;let e=this.renderTargetStencilState[t.uid];e||(e=this.renderTargetStencilState[t.uid]={stencilMode:ue.DISABLED,stencilReference:0}),this.setStencilMode(e.stencilMode,e.stencilReference)}setStencilMode(t,e){const i=this.renderTargetStencilState[this.activeRenderTarget.uid];i.stencilMode=t,i.stencilReference=e;const r=is[t],n=this.gl;if(t===ue.DISABLED){this.stencilCache.enabled&&(this.stencilCache.enabled=!1,n.disable(n.STENCIL_TEST));return}this.stencilCache.enabled||(this.stencilCache.enabled=!0,n.enable(n.STENCIL_TEST)),n.stencilFunc(this.comparisonFuncMapping[r.stencilBack.compare],e,255),n.stencilOp(n.KEEP,n.KEEP,this.stencilOpsMapping[r.stencilBack.passOp])}destroy(){}}ug.extension={type:[L.WebGLSystem],name:"stencil"};class o1{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBlockBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBlockBindings=null,this.program=null}}let jc=class extends Rt{constructor({buffer:t,offset:e,size:i}){super(),this.uid=Ur(),this.resourceType="bufferResource",this.resourceId=Ur(),this.bufferResource=!0,this.buffer=t,this.offset=e,this.size=i,this.buffer.on("change",this.onBufferChange,this)}onBufferChange(){this.resourceId=Ur(),this.emit("change",this)}destroy(t=!1){t&&this.buffer.destroy(),this.buffer=null}};function bd(s,t,e){const i=s.createShader(t);return s.shaderSource(i,e),s.compileShader(i),i}function Lh(s){const t=new Array(s);for(let e=0;e<t.length;e++)t[e]=!1;return t}function dg(s,t){switch(s){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return Lh(2*t);case"bvec3":return Lh(3*t);case"bvec4":return Lh(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const h1={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function l1(s){return h1[s]}let va=null;const yd={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function fg(s,t){if(!va){const e=Object.keys(yd);va={};for(let i=0;i<e.length;++i){const r=e[i];va[s[r]]=yd[r]}}return va[t]}function c1(s,t){const e={},i=t.getProgramParameter(s,t.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const n=t.getActiveAttrib(s,r);if(n.name.startsWith("gl_"))continue;const a=fg(t,n.type),o={type:a,name:n.name,size:l1(a),location:t.getAttribLocation(s,n.name)};e[n.name]=o}return e}function u1(s,t){const e={},i=t.getProgramParameter(s,t.ACTIVE_UNIFORM_BLOCKS);for(let r=0;r<i;r++){const n=t.getActiveUniformBlockName(s,r),a=t.getUniformBlockIndex(s,n),o=t.getActiveUniformBlockParameter(s,r,t.UNIFORM_BLOCK_DATA_SIZE);e[n]={name:n,index:a,size:o}}return e}function d1(s,t){const e={},i=t.getProgramParameter(s,t.ACTIVE_UNIFORMS);for(let r=0;r<i;r++){const n=t.getActiveUniform(s,r),a=n.name.replace(/\[.*?\]$/,""),o=!!n.name.match(/\[.*?\]$/),h=fg(t,n.type);e[a]={name:a,index:r,type:h,size:n.size,isArray:o,value:dg(h,n.size)}}return e}function xd(s,t){const e=s.getShaderSource(t).split(`
`).map((l,c)=>`${c}: ${l}`),i=s.getShaderInfoLog(t),r=i.split(`
`),n={},a=r.map(l=>parseFloat(l.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(l=>l&&!n[l]?(n[l]=!0,!0):!1),o=[""];a.forEach(l=>{e[l-1]=`%c${e[l-1]}%c`,o.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const h=e.join(`
`);o[0]=h,console.error(i),console.groupCollapsed("click to view full shader code"),console.warn(...o),console.groupEnd()}function f1(s,t,e,i){s.getProgramParameter(t,s.LINK_STATUS)||(s.getShaderParameter(e,s.COMPILE_STATUS)||xd(s,e),s.getShaderParameter(i,s.COMPILE_STATUS)||xd(s,i),console.error("PixiJS Error: Could not initialize shader."),s.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",s.getProgramInfoLog(t)))}function p1(s,t){const e=bd(s,s.VERTEX_SHADER,t.vertex),i=bd(s,s.FRAGMENT_SHADER,t.fragment),r=s.createProgram();s.attachShader(r,e),s.attachShader(r,i);const n=t.transformFeedbackVaryings;n&&(typeof s.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):s.transformFeedbackVaryings(r,n.names,n.bufferMode==="separate"?s.SEPARATE_ATTRIBS:s.INTERLEAVED_ATTRIBS)),s.linkProgram(r),s.getProgramParameter(r,s.LINK_STATUS)||f1(s,r,e,i),t.attributeData=c1(r,s),t.uniformData=d1(r,s),t.uniformBlockData=u1(r,s),s.deleteShader(e),s.deleteShader(i);const a={};for(const h in t.uniformData){const l=t.uniformData[h];a[h]={location:s.getUniformLocation(r,h),value:dg(l.type,l.size)}}return new o1(r,a)}const Bs={textureCount:0,blockIndex:0};class pg{constructor(t){this.programDataHash={},this.activeProgram=null,this.nextIndex=0,this.boundUniformsIdsToIndexHash={},this.boundIndexToUniformsHash={},this.renderer=t}contextChange(t){this.gl=t,this.maxBindings=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS)}bind(t,e){if(this.setProgram(t.glProgram),e)return;Bs.textureCount=0,Bs.blockIndex=0;const i=this.gl,r=this.getProgramData(t.glProgram);for(const n in t.groups){const a=t.groups[n];for(const o in a.resources){const h=a.resources[o];if(h instanceof re)h.ubo?this.bindUniformBlock(h,t.uniformBindMap[n][o],Bs.blockIndex++):this.updateUniformGroup(h);else if(h instanceof jc)this.bindUniformBlock(h,t.uniformBindMap[n][o],Bs.blockIndex++);else if(h instanceof vi){this.renderer.texture.bind(h,Bs.textureCount);const l=t.uniformBindMap[n][o],c=r.uniformData[l];c&&i.uniform1i(c.location,Bs.textureCount++)}}}}updateUniformGroup(t){this.renderer.uniformGroup.updateUniformGroup(t,this.activeProgram,Bs)}bindUniformBlock(t,e,i=0){const r=this.renderer.buffer,n=this.getProgramData(this.activeProgram),a=t.bufferResource;a&&this.renderer.uniformBuffer.updateUniformGroup(t),r.updateBuffer(t.buffer);let o=this.boundUniformsIdsToIndexHash[t.uid];if(o===void 0){const c=this.nextIndex++%this.maxBindings,u=this.boundIndexToUniformsHash[c];u&&(this.boundUniformsIdsToIndexHash[u.uid]=void 0),o=this.boundUniformsIdsToIndexHash[t.uid]=c,this.boundIndexToUniformsHash[c]=t,a?r.bindBufferRange(t.buffer,c,t.offset):r.bindBufferBase(t.buffer,c)}const h=this.gl,l=this.activeProgram.uniformBlockData[e].index;n.uniformBlockBindings[i]!==o&&(n.uniformBlockBindings[i]=o,h.uniformBlockBinding(n.program,l,o))}setProgram(t){if(this.activeProgram===t)return;this.activeProgram=t;const e=this.getProgramData(t);this.gl.useProgram(e.program)}getProgramData(t){const e=t.key;return this.programDataHash[e]||this.createProgramData(t)}createProgramData(t){const e=t.key;return this.programDataHash[e]=p1(this.gl,t),this.programDataHash[e]}}pg.extension={type:[L.WebGLSystem],name:"shader"};let dn;function m1(){if(typeof dn=="boolean")return dn;try{dn=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{dn=!1}return dn}const Oh=[{test:s=>s.type==="float"&&s.size===1&&!s.isArray,code:s=>`
            if(uv["${s}"] !== ud["${s}"].value)
            {
                ud["${s}"].value = uv["${s}"]
                gl.uniform1f(ud["${s}"].location, uv["${s}"])
            }
            `},{test:(s,t)=>(s.type==="sampler2D"||s.type==="samplerCube"||s.type==="sampler2DArray")&&s.size===1&&!s.isArray&&(t==null||t instanceof j),code:s=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${s}"], t);

            if(ud["${s}"].value !== t)
            {
                ud["${s}"].value = t;
                gl.uniform1i(ud["${s}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(s,t)=>s.type==="mat3"&&s.size===1&&!s.isArray&&t.a!==void 0,code:s=>`
            gl.uniformMatrix3fv(ud["${s}"].location, false, uv["${s}"].toArray(true));
            `},{test:(s,t)=>s.type==="vec2"&&s.size===1&&!s.isArray&&t.x!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${s}"].location, v.x, v.y);
                }`},{test:s=>s.type==="vec2"&&s.size===1&&!s.isArray,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${s}"].location, v[0], v[1]);
                }
            `},{test:(s,t)=>s.type==="vec4"&&s.size===1&&!s.isArray&&t.width!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${s}"].location, v.x, v.y, v.width, v.height)
                }`},{test:(s,t)=>s.type==="vec4"&&s.size===1&&!s.isArray&&t.red!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${s}"].location, v.red, v.green, v.blue, v.alpha)
                }`},{test:(s,t)=>s.type==="vec3"&&s.size===1&&!s.isArray&&t.red!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${s}"].location, v.red, v.green, v.blue)
                }`},{test:s=>s.type==="vec4"&&s.size===1&&!s.isArray,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${s}"].location, v[0], v[1], v[2], v[3])
                }`}],g1={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},b1={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function y1(s,t){const e=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const i in s.uniforms){const r=t[i];if(!r){s.uniforms[i]instanceof re?s.uniforms[i].ubo?e.push(`
                        renderer.shader.bindUniformBlock(uv.${i}, "${i}");
                    `):e.push(`
                        renderer.shader.updateUniformGroup(uv.${i});
                    `):s.uniforms[i]instanceof jc&&e.push(`
                        renderer.shader.bindBufferResource(uv.${i}, "${i}");
                    `);continue}const n=s.uniforms[i];let a=!1;for(let o=0;o<Oh.length;o++)if(Oh[o].test(r,n)){e.push(Oh[o].code(i,n)),a=!0;break}if(!a){const h=(r.size===1&&!r.isArray?g1:b1)[r.type].replace("location",`ud["${i}"].location`);e.push(`
            cu = ud["${i}"];
            cv = cu.value;
            v = uv["${i}"];
            ${h};`)}}return new Function("ud","uv","renderer","syncData",e.join(`
`))}class mg{constructor(t){this.destroyed=!1,this.cache={},this.uniformGroupSyncHash={},this.renderer=t,this.systemCheck(),this.gl=null,this.cache={}}systemCheck(){if(!m1())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t}updateUniformGroup(t,e,i){const r=this.renderer.shader.getProgramData(e);(!t.isStatic||t.dirtyId!==r.uniformDirtyGroups[t.uid])&&(r.uniformDirtyGroups[t.uid]=t.dirtyId,this.getUniformSyncFunction(t,e)(r.uniformData,t.uniforms,this.renderer,i))}getUniformSyncFunction(t,e){var i;return((i=this.uniformGroupSyncHash[t.signature])==null?void 0:i[e.key])||this.createUniformSyncFunction(t,e)}createUniformSyncFunction(t,e){const i=this.uniformGroupSyncHash[t.signature]||(this.uniformGroupSyncHash[t.signature]={}),r=this.getSignature(t,e.uniformData,"u");return this.cache[r]||(this.cache[r]=y1(t,e.uniformData)),i[e.key]=this.cache[r],i[e.key]}getSignature(t,e,i){const r=t.uniforms,n=[`${i}-`];for(const a in r)n.push(a),e[a]&&n.push(e[a].type);return n.join("-")}destroy(){this.renderer=null,this.destroyed=!0}}mg.extension={type:[L.WebGLSystem],name:"uniformGroup"};function x1(s){const t={};return t.normal=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t.add=[s.ONE,s.ONE],t.multiply=[s.DST_COLOR,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA],t.screen=[s.ONE,s.ONE_MINUS_SRC_COLOR,s.ONE,s.ONE_MINUS_SRC_ALPHA],t.none=[0,0],t["normal-npm"]=[s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA],t["add-npm"]=[s.SRC_ALPHA,s.ONE,s.ONE,s.ONE],t["screen-npm"]=[s.SRC_ALPHA,s.ONE_MINUS_SRC_COLOR,s.ONE,s.ONE_MINUS_SRC_ALPHA],t}const v1=0,_1=1,w1=2,T1=3,S1=4,C1=5,Dl=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode="none",this._blendEq=!1,this.map=[],this.map[v1]=this.setBlend,this.map[_1]=this.setOffset,this.map[w1]=this.setCullFace,this.map[T1]=this.setDepthTest,this.map[S1]=this.setFrontFace,this.map[C1]=this.setDepthMask,this.checks=[],this.defaultState=new Es,this.defaultState.blend=!0}contextChange(s){this.gl=s,this.blendModesMap=x1(s),this.set(this.defaultState),this.reset()}set(s){if(s=s||this.defaultState,this.stateId!==s.data){let t=this.stateId^s.data,e=0;for(;t;)t&1&&this.map[e].call(this,!!(s.data&1<<e)),t=t>>1,e++;this.stateId=s.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,s)}forceState(s){s=s||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(s.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,s);this.stateId=s.data}setBlend(s){this.updateCheck(Dl.checkBlendMode,s),this.gl[s?"enable":"disable"](this.gl.BLEND)}setOffset(s){this.updateCheck(Dl.checkPolygonOffset,s),this.gl[s?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(s){this.gl[s?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(s){this.gl.depthMask(s)}setCullFace(s){this.gl[s?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(s){this.gl.frontFace(this.gl[s?"CW":"CCW"])}setBlendMode(s){if(this.blendModesMap[s]||(s="normal"),s===this.blendMode)return;this.blendMode=s;const t=this.blendModesMap[s],e=this.gl;t.length===2?e.blendFunc(t[0],t[1]):e.blendFuncSeparate(t[0],t[1],t[2],t[3]),t.length===6?(this._blendEq=!0,e.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD))}setPolygonOffset(s,t){this.gl.polygonOffset(s,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode="",this.setBlendMode("normal")}updateCheck(s,t){const e=this.checks.indexOf(s);t&&e===-1?this.checks.push(s):!t&&e!==-1&&this.checks.splice(e,1)}static checkBlendMode(s,t){s.setBlendMode(t.blendMode)}static checkPolygonOffset(s,t){s.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}};let gg=Dl;gg.extension={type:[L.WebGLSystem],name:"state"};class A1{constructor(t){this.target=sg.TEXTURE_2D,this.texture=t,this.width=-1,this.height=-1,this.type=bt.UNSIGNED_BYTE,this.internalFormat=Nl.RGBA,this.format=Nl.RGBA,this.samplerType=0}}const E1={type:"image",upload(s,t,e){t.width===s.width||t.height===s.height?e.texSubImage2D(e.TEXTURE_2D,0,0,0,t.format,t.type,s.resource):e.texImage2D(t.target,0,t.internalFormat,s.width,s.height,0,t.format,t.type,s.resource),t.width=s.width,t.height=s.height}},P1={type:"image",upload(s,t,e){e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.alphaMode!==0),t.width===s.width||t.height===s.height?e.texSubImage2D(e.TEXTURE_2D,0,0,0,t.format,t.type,s.resource):e.texImage2D(t.target,0,t.internalFormat,s.pixelWidth,s.pixelHeight,0,t.format,t.type,s.resource),t.width=s.pixelWidth,t.height=s.pixelHeight}};function M1(s){return{r8unorm:s.RED,r8snorm:s.RED,r8uint:s.RED,r8sint:s.RED,r16uint:s.RED,r16sint:s.RED,r16float:s.RED,rg8unorm:s.RG,rg8snorm:s.RG,rg8uint:s.RG,rg8sint:s.RG,r32uint:s.RED,r32sint:s.RED,r32float:s.RED,rg16uint:s.RG,rg16sint:s.RG,rg16float:s.RG,rgba8unorm:s.RGBA,"rgba8unorm-srgb":s.RGBA,rgba8snorm:s.RGBA,rgba8uint:s.RGBA,rgba8sint:s.RGBA,bgra8unorm:s.RGBA,"bgra8unorm-srgb":s.RGBA,rgb9e5ufloat:s.RGB,rgb10a2unorm:s.RGBA,rg11b10ufloat:s.RGB,rg32uint:s.RG,rg32sint:s.RG,rg32float:s.RG,rgba16uint:s.RGBA,rgba16sint:s.RGBA,rgba16float:s.RGBA,rgba32uint:s.RGBA,rgba32sint:s.RGBA,rgba32float:s.RGBA,stencil8:s.STENCIL_INDEX8,depth16unorm:s.DEPTH_COMPONENT,depth24plus:s.DEPTH_COMPONENT,"depth24plus-stencil8":s.DEPTH_STENCIL,depth32float:s.DEPTH_COMPONENT,"depth32float-stencil8":s.DEPTH_STENCIL}}function k1(s){return{r8unorm:s.R8,r8snorm:s.R8_SNORM,r8uint:s.R8UI,r8sint:s.R8I,r16uint:s.R16UI,r16sint:s.R16I,r16float:s.R16F,rg8unorm:s.RG8,rg8snorm:s.RG8_SNORM,rg8uint:s.RG8UI,rg8sint:s.RG8I,r32uint:s.R32UI,r32sint:s.R32I,r32float:s.R32F,rg16uint:s.RG16UI,rg16sint:s.RG16I,rg16float:s.RG16F,rgba8unorm:s.RGBA,"rgba8unorm-srgb":s.SRGB8_ALPHA8,rgba8snorm:s.RGBA8_SNORM,rgba8uint:s.RGBA8UI,rgba8sint:s.RGBA8I,bgra8unorm:s.RGBA8,"bgra8unorm-srgb":s.SRGB8_ALPHA8,rgb9e5ufloat:s.RGB9_E5,rgb10a2unorm:s.RGB10_A2,rg11b10ufloat:s.R11F_G11F_B10F,rg32uint:s.RG32UI,rg32sint:s.RG32I,rg32float:s.RG32F,rgba16uint:s.RGBA16UI,rgba16sint:s.RGBA16I,rgba16float:s.RGBA16F,rgba32uint:s.RGBA32UI,rgba32sint:s.RGBA32I,rgba32float:s.RGBA32F,stencil8:s.STENCIL_INDEX8,depth16unorm:s.DEPTH_COMPONENT16,depth24plus:s.DEPTH_COMPONENT24,"depth24plus-stencil8":s.DEPTH24_STENCIL8,depth32float:s.DEPTH_COMPONENT32F,"depth32float-stencil8":s.DEPTH32F_STENCIL8}}function R1(s){return{r8unorm:s.UNSIGNED_BYTE,r8snorm:s.BYTE,r8uint:s.UNSIGNED_BYTE,r8sint:s.BYTE,r16uint:s.UNSIGNED_SHORT,r16sint:s.SHORT,r16float:s.HALF_FLOAT,rg8unorm:s.UNSIGNED_BYTE,rg8snorm:s.BYTE,rg8uint:s.UNSIGNED_BYTE,rg8sint:s.BYTE,r32uint:s.UNSIGNED_INT,r32sint:s.INT,r32float:s.FLOAT,rg16uint:s.UNSIGNED_SHORT,rg16sint:s.SHORT,rg16float:s.HALF_FLOAT,rgba8unorm:s.UNSIGNED_BYTE,"rgba8unorm-srgb":s.UNSIGNED_BYTE,rgba8snorm:s.BYTE,rgba8uint:s.UNSIGNED_BYTE,rgba8sint:s.BYTE,bgra8unorm:s.UNSIGNED_BYTE,"bgra8unorm-srgb":s.UNSIGNED_BYTE,rgb9e5ufloat:s.UNSIGNED_INT_5_9_9_9_REV,rgb10a2unorm:s.UNSIGNED_INT_2_10_10_10_REV,rg11b10ufloat:s.UNSIGNED_INT_10F_11F_11F_REV,rg32uint:s.UNSIGNED_INT,rg32sint:s.INT,rg32float:s.FLOAT,rgba16uint:s.UNSIGNED_SHORT,rgba16sint:s.SHORT,rgba16float:s.HALF_FLOAT,rgba32uint:s.UNSIGNED_INT,rgba32sint:s.INT,rgba32float:s.FLOAT,stencil8:s.UNSIGNED_BYTE,depth16unorm:s.UNSIGNED_SHORT,depth24plus:s.UNSIGNED_INT,"depth24plus-stencil8":s.UNSIGNED_INT_24_8,depth32float:s.FLOAT,"depth32float-stencil8":s.FLOAT_32_UNSIGNED_INT_24_8_REV}}const vd={linear:9729,nearest:9728},B1={linear:{linear:9987,nearest:9985},nearest:{linear:9986,nearest:9984}},Nh={"clamp-to-edge":33071,repeat:10497,"mirror-repeat":33648},I1={never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519};class bg{constructor(t){this.glTextures={},this.glSamplers={},this.boundTextures=[],this.boundTexturesSamplers=[],this.activeTextureLocation=-1,this.boundSamplers={},this.managedTextureSources={},this.uploads={image:P1,buffer:E1},this.renderer=t}contextChange(t){this.gl=t,this.mapFormatToInternalFormat||(this.mapFormatToInternalFormat=k1(t),this.mapFormatToType=R1(t),this.mapFormatToFormat=M1(t));for(let e=0;e<16;e++)this.bind(j.EMPTY,e)}bind(t,e=0){t?(this.bindSource(t.source,e),this.bindSampler(t.style,e)):(this.bindSource(null,e),this.bindSampler(null,e))}bindSource(t,e=0){const i=this.gl;if(this.boundTextures[e]!==t){this.boundTextures[e]=t,this.activateLocation(e),t=t||j.EMPTY.source;const r=this.getGlSource(t);i.bindTexture(r.target,r.texture)}}bindSampler(t,e=0){const i=this.gl;if(!t){this.boundSamplers[e]=null,i.bindSampler(e,null);return}const r=this.getGlSampler(t);this.boundSamplers[e]!==r&&(this.boundSamplers[e]=r,i.bindSampler(e,r))}unbind(t){const e=t.source,i=this.boundTextures,r=this.gl;for(let n=0;n<i.length;n++)if(i[n]===e){this.activateLocation(n);const a=this.getGlSource(e);r.bindTexture(a.target,null),i[n]=null}}activateLocation(t){this.activeTextureLocation!==t&&(this.activeTextureLocation=t,this.gl.activeTexture(this.gl.TEXTURE0+t))}initSource(t){const e=this.gl,i=new A1(e.createTexture());if(i.type=this.mapFormatToType[t.format],i.internalFormat=this.mapFormatToInternalFormat[t.format],i.format=this.mapFormatToFormat[t.format],t.autoGenerateMipmaps){const r=Math.max(t.width,t.height);t.mipLevelCount=Math.floor(Math.log2(r))+1}return this.glTextures[t.uid]=i,t.on("update",this.onSourceUpdate,this),t.on("destroy",this.onSourceDestroy,this),this.onSourceUpdate(t),i}onSourceUpdate(t){const e=this.gl,i=this.glTextures[t.uid];e.bindTexture(e.TEXTURE_2D,i.texture),this.boundTextures[this.activeTextureLocation]=t,this.uploads[t.type]?(this.uploads[t.type].upload(t,i,this.gl),t.autoGenerateMipmaps&&t.mipLevelCount>1&&e.generateMipmap(i.target)):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t.pixelWidth,t.pixelHeight,0,e.RGBA,e.UNSIGNED_BYTE,null)}onSourceDestroy(t){const e=this.gl;t.off("destroy",this.onSourceDestroy,this),t.off("update",this.onSourceUpdate,this);const i=this.glTextures[t.uid];delete this.glTextures[t.uid],e.deleteTexture(i.target)}initSampler(t){const e=this.gl,i=this.gl.createSampler();if(this.glSamplers[t.resourceId]=i,e.samplerParameteri(i,e.TEXTURE_WRAP_S,Nh[t.addressModeU]),e.samplerParameteri(i,e.TEXTURE_WRAP_T,Nh[t.addressModeV]),e.samplerParameteri(i,e.TEXTURE_WRAP_R,Nh[t.addressModeW]),e.samplerParameteri(i,e.TEXTURE_MAG_FILTER,vd[t.minFilter]),this.boundTextures[this.activeTextureLocation].mipLevelCount>1){const n=B1[t.minFilter][t.mipmapFilter];e.samplerParameteri(i,e.TEXTURE_MIN_FILTER,n)}else e.samplerParameteri(i,e.TEXTURE_MIN_FILTER,vd[t.magFilter]);const r=this.renderer.context.extensions.anisotropicFiltering;if(r&&t.maxAnisotropy>1){const n=Math.min(t.maxAnisotropy,e.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT));e.samplerParameteri(i,r.TEXTURE_MAX_ANISOTROPY_EXT,n)}return t.compare&&e.samplerParameteri(i,e.TEXTURE_COMPARE_FUNC,I1[t.compare]),this.glSamplers[t.resourceId]}getGlSampler(t){return this.glSamplers[t.resourceId]||this.initSampler(t)}getGlSource(t){return this.glTextures[t.uid]||this.initSource(t)}destroy(){throw new Error("Method not implemented.")}}bg.extension={type:[L.WebGLSystem],name:"texture"};const F1=["init","destroy","contextChange","reset","renderEnd","renderStart","render","update","postrender","prerender"];class yg{constructor(t){this.runners={},this.renderPipes={},this._systemsHash={},this.type=t.type;const e=[...F1,...t.runners??[]];this.addRunners(...e),this.addSystems(t.systems),this.addPipes(t.renderPipes,t.renderPipeAdaptors)}async init(t={}){for(const e in this._systemsHash)t={...this._systemsHash[e].constructor.defaultOptions,...t};for(let e=0;e<this.runners.init.items.length;e++)await this.runners.init.items[e].init(t)}render(t){t instanceof W&&(Am("8","passing Container as argument is deprecated, please use render options instead"),t={container:t,target:arguments[1]}),t.target=t.target||this.view.texture,this._lastObjectRendered=t.container,this.runners.prerender.emit(t),this.runners.renderStart.emit(t),this.runners.render.emit(t),this.runners.renderEnd.emit(t),this.runners.postrender.emit(t)}resize(t,e,i){this.view.resize(t,e,i)}get resolution(){return this.view.resolution}set resolution(t){this.view.resolution=t}get width(){return this.view.texture.frameWidth}get height(){return this.view.texture.frameHeight}get element(){return this.view.element}get lastObjectRendered(){return this._lastObjectRendered}get renderingToScreen(){return this.renderTarget.renderingToScreen}addRunners(...t){t.forEach(e=>{this.runners[e]=new Wc(e)})}addSystems(t){let e;for(e in t){const i=t[e];this.addSystem(i.value,i.name)}}addSystem(t,e){const i=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=i,this._systemsHash[e]=i;for(const r in this.runners)this.runners[r].add(i);return this}addPipes(t,e){const i=e.reduce((r,n)=>(r[n.name]=n.value,r),{});t.forEach(r=>{const n=r.value,a=r.name,o=i[a];this.renderPipes[a]=new n(this,o?new o:null)})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash=null,this.renderPipes=null,this.runners=null}}class Gl extends Rt{constructor({original:t,view:e}){super(),this.uid=om(),this.didViewUpdate=!1,this.view=e,t&&this.init(t)}init(t){this.original=t,this.layerTransform=t.layerTransform}get layerColor(){return this.original.layerColor}get layerBlendMode(){return this.original.layerBlendMode}get layerVisibleRenderable(){return this.original.layerVisibleRenderable}get isRenderable(){return this.original.isRenderable}}class xg extends Oo{constructor(){super({positions:new Float32Array([0,0,1,0,1,1,0,1]),uvs:new Float32Array([0,0,1,0,1,1,0,1]),indices:new Uint32Array([0,1,2,0,2,3])})}}var U1=`precision lowp float;

in vec2 vTextureCoord;
in vec4 vColor;

out vec4 outColor;

uniform sampler2D uTexture;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uTexture, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    outColor = texSample * vColor;
}
`,L1=`precision lowp float;

in vec2 aPosition;
in vec2 aUV;

uniform globalUniforms {
  mat3 projectionMatrix;
  mat3 worldTransformMatrix;
  float worldAlpha;
};


uniform mat3 transformMatrix;
uniform vec4 color;
uniform mat3 uTextureTransform;
uniform vec4 uSizeAnchor;

out vec2 vTextureCoord;
out vec4 vColor;

void main(void)
{
    vec2 modifiedPosition = (aPosition - uSizeAnchor.zw) * uSizeAnchor.xy;
  
    gl_Position = vec4((projectionMatrix * worldTransformMatrix * transformMatrix * vec3(modifiedPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureTransform * vec3(aUV, 1.0)).xy;

    vColor = color * worldAlpha;
}
`,_d=`struct GlobalUniforms {
projectionMatrix:mat3x3<f32>,
  worldTransformMatrix:mat3x3<f32>,
  worldAlpha: f32
};

struct LocalUniforms {
  transformMatrix:mat3x3<f32>,
  color:vec4<f32>,
};

struct TilingUniforms {
  uMapCoord:mat3x3<f32>,
  uClampFrame:vec4<f32>,
  uClampOffset:vec2<f32>,
  uTextureTransform:mat3x3<f32>,
  uSizeAnchor:vec4<f32>
};

@group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;
@group(1) @binding(0) var<uniform> localUniforms: LocalUniforms;

@group(2) @binding(0) var<uniform> tilingUniforms: TilingUniforms;
@group(2) @binding(1) var uTexture: texture_2d<f32>;
@group(2) @binding(2) var uSampler: sampler;


struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>,
    @location(1) color : vec4<f32>,
  };

  
@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
  @location(1) aUV : vec2<f32>,
) -> VSOutput {

    var modifiedPosition = (aPosition - tilingUniforms.uSizeAnchor.zw) * tilingUniforms.uSizeAnchor.xy;
  
    var  mvpMatrix = globalUniforms.projectionMatrix * globalUniforms.worldTransformMatrix * localUniforms.transformMatrix;

    var  colorOut = localUniforms.color;

    colorOut.r *= colorOut.a;
    colorOut.g *= colorOut.a;
    colorOut.b *= colorOut.a;
    
  return VSOutput(
    vec4<f32>((mvpMatrix * vec3<f32>(modifiedPosition, 1.0)).xy, 0.0, 1.0),
    (tilingUniforms.uTextureTransform * vec3(aUV, 1.0)).xy,
    colorOut,
  );
};


@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
  @location(1) color:vec4<f32>,
) -> @location(0) vec4<f32> {

    var coord = uv + ceil(tilingUniforms.uClampOffset - uv);
    coord = (tilingUniforms.uMapCoord * vec3(coord, 1.0)).xy;
    var unclamped = coord;
    coord = clamp(coord, tilingUniforms.uClampFrame.xy, tilingUniforms.uClampFrame.zw);

    var bias = 0.;

    if(unclamped.x == coord.x && unclamped.y == coord.y)
    {
      bias = -32.;
    } 
    

    var finalColor = textureSampleBias(uTexture, uSampler, coord, bias);
    
   return finalColor * color;

}`;class O1 extends As{constructor(t){const e=as.from({vertex:L1,fragment:U1,name:"tiling-sprite"}),i=os.from({vertex:{source:_d,entryPoint:"mainVertex"},fragment:{source:_d,entryPoint:"mainFragment"}}),r=new re({uMapCoord:{value:new it,type:"mat3x3<f32>"},uClampFrame:{value:new Float32Array([0,0,1,1]),type:"vec4<f32>"},uClampOffset:{value:new Float32Array([0,0]),type:"vec2<f32>"},uTextureTransform:{value:new it,type:"mat3x3<f32>"},uSizeAnchor:{value:new Float32Array([100,200,.5,.5]),type:"vec4<f32>"}});super({glProgram:e,gpuProgram:i,resources:{tilingUniforms:r,uTexture:t.texture.source,uSampler:t.texture.style}})}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture=t,this.resources.uTexture=t.source,this.resources.uSampler=t.style)}}const N1=new xg;class vg{constructor(t){this.renderableHash={},this.gpuBatchedTilingSprite={},this.gpuTilingSprite={},this.renderer=t}validateRenderable(t){const e=t.view.texture.textureMatrix;let i=!1;const r=this.getRenderableData(t);return r.batched!==e.isSimple&&(r.batched=e.isSimple,i=!0),i}addRenderable(t,e){t.view.didUpdate&&(t.view.didUpdate=!1,this.rebuild(t));const{batched:i}=this.getRenderableData(t);if(i){const r=this.getBatchedTilingSprite(t);this.renderer.renderPipes.mesh.addRenderable(r,e)}else{const r=this.getGpuTilingSprite(t);this.renderer.renderPipes.mesh.addRenderable(r.meshRenderable,e)}}updateRenderable(t){t.view.didUpdate&&(t.view.didUpdate=!1,this.rebuild(t));const{batched:e}=this.getRenderableData(t);if(e){const i=this.getBatchedTilingSprite(t);this.renderer.renderPipes.mesh.updateRenderable(i)}else{const i=this.getGpuTilingSprite(t);this.renderer.renderPipes.mesh.updateRenderable(i.meshRenderable)}}destroyRenderable(t){this.renderableHash[t.uid]=null,this.gpuTilingSprite[t.uid]=null,this.gpuBatchedTilingSprite[t.uid]=null}getRenderableData(t){return this.renderableHash[t.uid]||this.initRenderableData(t)}initRenderableData(t){const e={batched:!0};return this.renderableHash[t.uid]=e,this.validateRenderable(t),t.on("destroyed",()=>{this.destroyRenderable(t)}),e}rebuild(t){const e=this.getRenderableData(t),i=t.view,r=i.texture.textureMatrix;if(e.batched){const n=this.getBatchedTilingSprite(t);n.view.texture=i.texture,i.texture.style.addressMode="repeat",i.texture.style.update(),this.updateBatchPositions(t),this.updateBatchUvs(t)}else{const n=this.getGpuTilingSprite(t),{meshRenderable:a}=n,o=a.view;o.shader.texture=i.texture;const h=o.shader.resources.tilingUniforms,l=i.width,c=i.height,u=i.texture.width,d=i.texture.height,f=i.tileTransform.matrix,p=h.uniforms.uTextureTransform;p.set(f.a*u/l,f.b*u/c,f.c*d/l,f.d*d/c,f.tx/l,f.ty/c),p.invert(),h.uniforms.uMapCoord=r.mapCoord,h.uniforms.uClampFrame=r.uClampFrame,h.uniforms.uClampOffset=r.uClampOffset,h.uniforms.uTextureTransform=p,h.uniforms.uSizeAnchor[0]=l,h.uniforms.uSizeAnchor[1]=c,h.uniforms.uSizeAnchor[2]=t.view.anchor.x,h.uniforms.uSizeAnchor[3]=t.view.anchor.y,h.update()}}getGpuTilingSprite(t){return this.gpuTilingSprite[t.uid]||this.initGpuTilingSprite(t)}initGpuTilingSprite(t){const e=t.view;e.texture.style.addressMode="repeat",e.texture.style.update();const i=new ao({geometry:N1,shader:new O1({texture:e.texture})}),r=new Gl({original:t,view:i}),n=new it,a={meshRenderable:r,textureMatrix:n};return this.gpuTilingSprite[t.uid]=a,a}getBatchedTilingSprite(t){return this.gpuBatchedTilingSprite[t.uid]||this.initBatchedTilingSprite(t)}initBatchedTilingSprite(t){const e=new ao({geometry:new xg,texture:t.view.texture}),i=new Gl({original:t,view:e});return this.gpuBatchedTilingSprite[t.uid]=i,i}updateBatchPositions(t){const e=this.getBatchedTilingSprite(t),i=t.view,n=e.view.geometry.getBuffer("aPosition").data,a=i.anchor.x,o=i.anchor.y;n[0]=-a*i.width,n[1]=-o*i.height,n[2]=(1-a)*i.width,n[3]=-o*i.height,n[4]=(1-a)*i.width,n[5]=(1-o)*i.height,n[6]=-a*i.width,n[7]=(1-o)*i.height}updateBatchUvs(t){const e=t.view,i=e.texture.frameWidth,r=e.texture.frameHeight,o=this.getBatchedTilingSprite(t).view.geometry.getBuffer("aUV").data;let h=0,l=0;e.applyAnchorToTexture&&(h=e.anchor.x,l=e.anchor.y),o[0]=o[6]=-h,o[2]=o[4]=1-h,o[1]=o[3]=-l,o[5]=o[7]=1-l;const c=it.shared;c.copyFrom(e.tileTransform.matrix),c.tx/=e.width,c.ty/=e.height,c.invert(),c.scale(e.width/i,e.height/r),D1(o,2,0,c)}destroy(){this.renderableHash=null,this.gpuTilingSprite=null,this.gpuBatchedTilingSprite=null,this.renderer=null}}vg.extension={type:[L.WebGLPipes,L.WebGPUPipes,L.CanvasPipes],name:"tilingSprite"};function D1(s,t,e,i){let r=0;const n=s.length/(t||2),a=i.a,o=i.b,h=i.c,l=i.d,c=i.tx,u=i.ty;for(e*=t;r<n;){const d=s[e],f=s[e+1];s[e]=a*d+h*f+c,s[e+1]=o*d+l*f+u,e+=t,r++}}function _g(s,t){const e=s.instructionSet,i=e.instructions;for(let r=0;r<e.instructionSize;r++){const n=i[r];t[n.type].execute(n)}}class wg{constructor(t){this.renderer=t}addLayerGroup(t,e){this.renderer.renderPipes.batch.break(e),e.add(t)}execute(t){t.isRenderable&&(this.renderer.globalUniforms.push({projectionMatrix:this.renderer.renderTarget.renderTarget.projectionMatrix,worldTransformMatrix:t.worldTransform,worldColor:t.worldColor}),_g(t,this.renderer.renderPipes),this.renderer.globalUniforms.pop())}destroy(){this.renderer=null}}wg.extension={type:[L.WebGLPipes,L.WebGPUPipes,L.CanvasPipes],name:"layer"};function Tg(s,t=[]){t.push(s);for(let e=0;e<s.layerGroupChildren.length;e++)Tg(s.layerGroupChildren[e],t);return t}const G1=new W;function Sg(s,t=!1){V1(s);const e=s.childrenToUpdate,i=s.updateTick;s.updateTick++;for(const r in e){const n=e[r],a=n.list,o=n.index;for(let h=0;h<o;h++)Cg(a[h],i,0);n.index=0}if(t)for(let r=0;r<s.layerGroupChildren.length;r++)Sg(s.layerGroupChildren[r],t)}function V1(s){s.layerGroupParent?(s.worldTransform.appendFrom(s.root.layerTransform,s.layerGroupParent.worldTransform),s.worldColor=zc(s.root.layerColor,s.layerGroupParent.worldColor)):(s.worldTransform.copyFrom(s.root.layerTransform),s.worldColor=s.root.localColor)}function Cg(s,t,e){if(t===s.updateTick)return;s.updateTick=t,s.didChange=!1;const i=s.localTransform;er(i,s);const r=s.parent;if(r&&!r.isLayerRoot?(e=e|s.updateFlags,s.layerTransform.appendFrom(i,r.layerTransform),e&&wd(s,r,e)):(e=s.updateFlags,s.layerTransform.copyFrom(i),e&&wd(s,G1,e)),!s.isLayerRoot){const n=s.children,a=n.length;for(let h=0;h<a;h++)Cg(n[h],t,e);const o=s.layerGroup;s.view&&!o.structureDidChange&&o.updateRenderable(s)}}function wd(s,t,e){e&kl&&(s.layerColor=zc(s.localColor,t.layerColor)),e&hm&&(s.layerBlendMode=s.localBlendMode==="inherit"?t.layerBlendMode:s.localBlendMode),e&Rl&&(s.layerVisibleRenderable=s.localVisibleRenderable&t.layerVisibleRenderable),s.updateFlags=0}function z1(s,t){const{list:e,index:i}=s.childrenRenderablesToUpdate;let r=!1;for(let n=0;n<i;n++){const a=e[n],o=a.view;if(r=t[o.type].validateRenderable(a),r)break}return s.structureDidChange=r,r&&(s.childrenRenderablesToUpdate.index=0),r}class Ag{constructor(t){this.renderer=t}render({container:t}){t.layer=!0;const e=this.renderer,i=Tg(t.layerGroup,[]),r=e.renderPipes;for(let n=0;n<i.length;n++){const a=i[n];a.runOnRender(),a.instructionSet.renderPipes=r,a.structureDidChange||z1(a,r),Sg(a),a.structureDidChange?(a.structureDidChange=!1,zw(a,r)):H1(a),e.renderPipes.batch.upload(a.instructionSet)}e.globalUniforms.start({projectionMatrix:e.renderTarget.rootProjectionMatrix,worldTransformMatrix:t.layerGroup.worldTransform}),_g(t.layerGroup,r),r.uniformBatch&&(r.uniformBatch.renderEnd(),r.uniformBuffer.renderEnd())}destroy(){}}Ag.extension={type:[L.WebGLSystem,L.WebGPUSystem,L.CanvasSystem],name:"layer"};function H1(s){const{list:t,index:e}=s.childrenRenderablesToUpdate;for(let i=0;i<e;i++){const r=t[i];r.didViewUpdate&&s.updateRenderable(r)}s.childrenRenderablesToUpdate.index=0}class Eg{constructor(){this.vertexSize=4,this.indexSize=6,this.location=0,this.batcher=null,this.batch=null}get blendMode(){return this.sprite.layerBlendMode}packAttributes(t,e,i,r){const n=this.sprite,a=this.texture,o=n.layerTransform,h=o.a,l=o.b,c=o.c,u=o.d,d=o.tx,f=o.ty,p=this.bounds,m=p[0],g=p[1],x=p[2],y=p[3],b=a._layout.uvs,v=n.layerColor;t[i++]=h*g+c*y+d,t[i++]=u*y+l*g+f,t[i++]=b.x0,t[i++]=b.y0,e[i++]=v,t[i++]=r,t[i++]=h*m+c*y+d,t[i++]=u*y+l*m+f,t[i++]=b.x1,t[i++]=b.y1,e[i++]=v,t[i++]=r,t[i++]=h*m+c*x+d,t[i++]=u*x+l*m+f,t[i++]=b.x2,t[i++]=b.y2,e[i++]=v,t[i++]=r,t[i++]=h*g+c*x+d,t[i++]=u*x+l*g+f,t[i++]=b.x3,t[i++]=b.y3,e[i++]=v,t[i++]=r}packIndex(t,e,i){t[e++]=i+0,t[e++]=i+1,t[e++]=i+2,t[e++]=i+0,t[e++]=i+2,t[e++]=i+3}reset(){this.sprite=null,this.texture=null,this.batcher=null,this.batch=null,this.bounds=null}}let fr;class Pg{constructor(t){this.gpuSpriteHash={},this.renderer=t,fr=this.gpuSpriteHash}addRenderable(t,e){const i=this.getGpuSprite(t);t.view.didUpdate&&this.updateBatchableSprite(t,i),this.renderer.renderPipes.batch.addToBatch(i,e)}updateRenderable(t){const e=fr[t.uid];t.view.didUpdate&&this.updateBatchableSprite(t,e),e.batcher.updateElement(e)}validateRenderable(t){const e=t.view._texture,i=this.getGpuSprite(t);return i.texture._source!==e._source?!i.batcher.checkAndUpdateTexture(i,e):!1}destroyRenderable(t){const e=fr[t.uid];Ft.return(e),fr[t.uid]=null}updateBatchableSprite(t,e){const i=t.view;i.didUpdate=!1,e.bounds=i.bounds,e.texture=i._texture}getGpuSprite(t){return fr[t.uid]||this.initGPUSprite(t)}initGPUSprite(t){const e=Ft.get(Eg);return e.sprite=t,e.texture=t.view._texture,e.bounds=t.view.bounds,fr[t.uid]=e,t.view.didUpdate=!1,t.on("destroyed",()=>{this.destroyRenderable(t)}),e}destroy(){for(const t in this.gpuSpriteHash)Ft.return(this.gpuSpriteHash[t]);this.gpuSpriteHash=null,this.renderer=null}}Pg.extension={type:[L.WebGLPipes,L.WebGPUPipes,L.CanvasPipes],name:"sprite"};var X1=`in vec2 vTextureCoord;
in vec4 vColor;
in float vTextureId;

uniform sampler2D uSamplers[%count%];
uniform float distance;

out vec4 finalColor;

void main(void){
    vec4 outColor;
    %forloop%


    // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.
   outColor.rgb = outColor.rgb / outColor.a;

    // MSDF
    float median = outColor.r + outColor.g + outColor.b -
                    min(outColor.r, min(outColor.g, outColor.b)) -
                    max(outColor.r, max(outColor.g, outColor.b));
   
    // SDF
    median = min(median, outColor.a);

    float screenPxDistance = distance * (median - 0.5);
    float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);
    if (median < 0.01) {
        alpha = 0.0;
    } else if (median > 0.99) {
        alpha = 1.0;
    }

    finalColor =  vec4(vColor.rgb * alpha, alpha);
}
`,$1=`precision highp float;
in vec2 aPosition;
in vec2 aUV;
in vec4 aColor;
in float aTextureId;

uniform globalUniforms {
  mat3 projectionMatrix;
  mat3 worldTransformMatrix;
  float worldAlpha;
};

uniform mat3 transformMatrix;
uniform vec4 color;

out vec2 vTextureCoord;
out vec4 vColor;
out float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * worldTransformMatrix * transformMatrix * vec3(aPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aUV;
    vTextureId = aTextureId;

    vColor = vec4(aColor.rgb * aColor.a, aColor.a)  * worldAlpha;
}
`;function W1(s){return Oc({vertexSrc:$1,fragmentSrc:X1,maxTextures:s,name:"sdf"})}var Td=`struct GlobalUniforms {
  projectionMatrix:mat3x3<f32>,
  worldTransformMatrix:mat3x3<f32>,
  worldAlpha: f32
}

struct LocalUniforms {
  color:vec4<f32>,
  transformMatrix:mat3x3<f32>,
  distance: f32
}

// struct DistanceUniforms {
//   distance: f32,
// }

@group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;
%bindings%
@group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;
//@group(3) @binding(0) var<uniform> distanceUniforms : DistanceUniforms;


struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>,
    @location(1) color : vec4<f32>,
    @location(2) @interpolate(flat) textureId : u32,
  };

  
@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
  @location(1) aUV : vec2<f32>,
  @location(2) aColor : vec4<f32>,
  @location(3) aTexture : f32,
) -> VSOutput {

  var  mvpMatrix = globalUniforms.projectionMatrix * globalUniforms.worldTransformMatrix * localUniforms.transformMatrix;

  var  colorOut = aColor.bgra * localUniforms.color.rgba;

  var alpha = vec4<f32>(
    colorOut.a * globalUniforms.worldAlpha,
    colorOut.a * globalUniforms.worldAlpha,
    colorOut.a * globalUniforms.worldAlpha,
    globalUniforms.worldAlpha
  );

  colorOut *= alpha;


  return VSOutput(
    vec4<f32>((mvpMatrix * vec3<f32>(aPosition, 1.0)).xy, 0.0, 1.0),
    aUV,
    colorOut,
    u32(aTexture)
  );
};


@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
  @location(1) color:vec4<f32>,
  @location(2) @interpolate(flat) textureId: u32,
) -> @location(0) vec4<f32> {


    var uvDx = dpdx(uv);
    var uvDy = dpdy(uv);

    var outColor:vec4<f32>;
    
    %forloop%
  
    var dist = outColor.r;

    // MSDF
  var median = outColor.r + outColor.g + outColor.b -
      min(outColor.r, min(outColor.g, outColor.b)) -
      max(outColor.r, max(outColor.g, outColor.b));
  // SDF
  median = min(median, outColor.a);

  // on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange
  
  var screenPxDistance = localUniforms.distance * (median - 0.5);
  var alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);
  if (median < 0.01) {
    alpha = 0.0;
  } else if (median > 0.99) {
    alpha = 1.0;
  }

  return vec4(color.rgb * alpha, alpha);
};
`;function Y1(s){return Dc({vertex:{source:Td,entryPoint:"mainVertex"},fragment:{source:Td,entryPoint:"mainFragment"},maxTextures:s})}class j1 extends nr{constructor(){const t=new re({color:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},transformMatrix:{value:new it,type:"mat3x3<f32>"},distance:{value:4,type:"f32"}});super({glProgram:W1(_i),gpuProgram:Y1(_i),resources:{localUniforms:t,batchSamplers:Nc}})}}function qc(s,t=[]){return t[0]=(s>>16&255)/255,t[1]=(s>>8&255)/255,t[2]=(s&255)/255,t}function q1(s){let t=s.toString(16);return t="000000".substring(0,6-t.length)+t,`#${t}`}class K1{constructor(t){this.poolKeyHash={},this.canvasPool={},this.canvasOptions=t||{},this.enableFullScreen=!1}createCanvasAndContext(t,e){const i=Tt.ADAPTER.createCanvas();i.width=t,i.height=e;const r=i.getContext("2d");return{canvas:i,context:r}}getOptimalCanvasAndContext(t,e,i=1){t=Math.ceil(t*i-1e-6),e=Math.ceil(e*i-1e-6),t=jr(t),e=jr(e);const r=(t<<17)+(e<<1);this.canvasPool[r]||(this.canvasPool[r]=[]);let n=this.canvasPool[r].pop();return n||(n=this.createCanvasAndContext(t,e)),n}returnCanvasAndContext(t){const{width:e,height:i}=t.canvas,r=(e<<17)+(i<<1);this.canvasPool[r].push(t)}clear(){this.canvasPool={}}}const ho=new K1;var Mg=(s=>(s[s.NPM=0]="NPM",s[s.UNPACK=1]="UNPACK",s[s.PMA=2]="PMA",s[s.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",s[s.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",s[s.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",s))(Mg||{});const Z1=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function lo(s){const t=typeof s.fontSize=="number"?`${s.fontSize}px`:s.fontSize;let e=s.fontFamily;Array.isArray(s.fontFamily)||(e=s.fontFamily.split(","));for(let i=e.length-1;i>=0;i--){let r=e[i].trim();!/([\"\'])[^\'\"]+\1/.test(r)&&!Z1.includes(r)&&(r=`"${r}"`),e[i]=r}return`${s.fontStyle} ${s.fontVariant} ${s.fontWeight} ${t} ${e.join(",")}`}const Dh={willReadFrequently:!0},J=class{static get experimentalLetterSpacingSupported(){let s=J._experimentalLetterSpacingSupported;if(s!==void 0){const t=Tt.ADAPTER.getCanvasRenderingContext2D().prototype;s=J._experimentalLetterSpacingSupported="letterSpacing"in t||"textLetterSpacing"in t}return s}constructor(s,t,e,i,r,n,a,o,h){this.text=s,this.style=t,this.width=e,this.height=i,this.lines=r,this.lineWidths=n,this.lineHeight=a,this.maxLineWidth=o,this.fontProperties=h}static measureText(s=" ",t,e=J._canvas,i=t.wordWrap){var x;const r=`${s}:${t.styleKey}`;if(J._measurementCache[r])return J._measurementCache[r];const n=lo(t),a=J.measureFont(n);a.fontSize===0&&(a.fontSize=t.fontSize,a.ascent=t.fontSize);const o=J.__context;o.font=n;const l=(i?J.wordWrap(s,t,e):s).split(/(?:\r\n|\r|\n)/),c=new Array(l.length);let u=0;for(let y=0;y<l.length;y++){const b=J._measureText(l[y],t.letterSpacing,o);c[y]=b,u=Math.max(u,b)}const d=((x=t.stroke)==null?void 0:x.width)||0;let f=u+d;t.dropShadow&&(f+=t.dropShadow.distance);const p=t.lineHeight||a.fontSize+d;let m=Math.max(p,a.fontSize+d*2)+(l.length-1)*(p+t.leading);return t.dropShadow&&(m+=t.dropShadow.distance),new J(s,t,f,m,l,c,p+t.leading,u,a)}static _measureText(s,t,e){let i=!1;J.experimentalLetterSpacingSupported&&(J.experimentalLetterSpacing?(e.letterSpacing=`${t}px`,e.textLetterSpacing=`${t}px`,i=!0):(e.letterSpacing="0px",e.textLetterSpacing="0px"));let r=e.measureText(s).width;return r>0&&(i?r-=t:r+=(J.graphemeSegmenter(s).length-1)*t),r}static wordWrap(s,t,e=J._canvas){const i=e.getContext("2d",Dh);let r=0,n="",a="";const o=Object.create(null),{letterSpacing:h,whiteSpace:l}=t,c=J.collapseSpaces(l),u=J.collapseNewlines(l);let d=!c;const f=t.wordWrapWidth+h,p=J.tokenize(s);for(let m=0;m<p.length;m++){let g=p[m];if(J.isNewline(g)){if(!u){a+=J.addLine(n),d=!c,n="",r=0;continue}g=" "}if(c){const y=J.isBreakingSpace(g),b=J.isBreakingSpace(n[n.length-1]);if(y&&b)continue}const x=J.getFromCache(g,h,o,i);if(x>f)if(n!==""&&(a+=J.addLine(n),n="",r=0),J.canBreakWords(g,t.breakWords)){const y=J.wordWrapSplit(g);for(let b=0;b<y.length;b++){let v=y[b],_=v,w=1;for(;y[b+w];){const S=y[b+w];if(!J.canBreakChars(_,S,g,b,t.breakWords))v+=S;else break;_=S,w++}b+=w-1;const T=J.getFromCache(v,h,o,i);T+r>f&&(a+=J.addLine(n),d=!1,n="",r=0),n+=v,r+=T}}else{n.length>0&&(a+=J.addLine(n),n="",r=0);const y=m===p.length-1;a+=J.addLine(g,!y),d=!1,n="",r=0}else x+r>f&&(d=!1,a+=J.addLine(n),n="",r=0),(n.length>0||!J.isBreakingSpace(g)||d)&&(n+=g,r+=x)}return a+=J.addLine(n,!1),a}static addLine(s,t=!0){return s=J.trimRight(s),s=t?`${s}
`:s,s}static getFromCache(s,t,e,i){let r=e[s];return typeof r!="number"&&(r=J._measureText(s,t,i)+t,e[s]=r),r}static collapseSpaces(s){return s==="normal"||s==="pre-line"}static collapseNewlines(s){return s==="normal"}static trimRight(s){if(typeof s!="string")return"";for(let t=s.length-1;t>=0;t--){const e=s[t];if(!J.isBreakingSpace(e))break;s=s.slice(0,-1)}return s}static isNewline(s){return typeof s!="string"?!1:J._newlines.includes(s.charCodeAt(0))}static isBreakingSpace(s,t){return typeof s!="string"?!1:J._breakingSpaces.includes(s.charCodeAt(0))}static tokenize(s){const t=[];let e="";if(typeof s!="string")return t;for(let i=0;i<s.length;i++){const r=s[i],n=s[i+1];if(J.isBreakingSpace(r,n)||J.isNewline(r)){e!==""&&(t.push(e),e=""),t.push(r);continue}e+=r}return e!==""&&t.push(e),t}static canBreakWords(s,t){return t}static canBreakChars(s,t,e,i,r){return!0}static wordWrapSplit(s){return J.graphemeSegmenter(s)}static measureFont(s){if(J._fonts[s])return J._fonts[s];const t=J._context;t.font=s;const e=t.measureText(J.METRICS_STRING+J.BASELINE_SYMBOL),i={ascent:e.actualBoundingBoxAscent,descent:e.actualBoundingBoxDescent,fontSize:e.actualBoundingBoxAscent+e.actualBoundingBoxDescent};return J._fonts[s]=i,i}static clearMetrics(s=""){s?delete J._fonts[s]:J._fonts={}}static get _canvas(){if(!J.__canvas){let s;try{const t=new OffscreenCanvas(0,0),e=t.getContext("2d",Dh);if(e!=null&&e.measureText)return J.__canvas=t,t;s=Tt.ADAPTER.createCanvas()}catch{s=Tt.ADAPTER.createCanvas()}s.width=s.height=10,J.__canvas=s}return J.__canvas}static get _context(){return J.__context||(J.__context=J._canvas.getContext("2d",Dh)),J.__context}};let se=J;se.METRICS_STRING="|ÉqÅ";se.BASELINE_SYMBOL="M";se.BASELINE_MULTIPLIER=1.4;se.HEIGHT_MULTIPLIER=2;se.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const s=new Intl.Segmenter;return t=>[...s.segment(t)].map(e=>e.segment)}return s=>[...s]})();se.experimentalLetterSpacing=!1;se._fonts={};se._newlines=[10,13];se._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];se._measurementCache={};function co(s,t){if(s.texture===j.WHITE&&!s.fill)return Cl(s.color);if(s.fill){if(s.fill instanceof Rc){const e=s.fill,i=t.createPattern(e.texture.source.resource,"repeat"),r=e.transform.copyTo(it.shared);return r.scale(e.texture.frameWidth,e.texture.frameHeight),i.setTransform(r),i}else if(s.fill instanceof Dn){const e=s.fill;if(e.type==="linear"){const i=t.createLinearGradient(e.x0,e.y0,e.x1,e.y1);return e.gradientStops.forEach(r=>{i.addColorStop(r.offset,Cl(r.color))}),i}}}else{const e=t.createPattern(s.texture.source.resource,"repeat"),i=s.matrix.copyTo(it.shared);return i.scale(s.texture.frameWidth,s.texture.frameHeight),e.setTransform(i),e}return console.warn("[PixiJS] FillStyle not recognised",s),"red"}const Sd=["fontFamily","fontStyle","fontVariant","fontWeight","breakWords","align","leading","letterSpacing","lineHeight","textBaseline","whiteSpace","wordWrap","wordWrapWidth","padding"],vr=class extends Rt{constructor(s={}){super();const t={...vr.defaultTextStyle,...s};for(const e in vr.defaultTextStyle){const i=e;this[i]=t[e]}this.dropShadow=null,typeof t.fill=="string"?this.fontSize=parseInt(t.fontSize,10):this.fontSize=t.fontSize,s.dropShadow&&(s.dropShadow instanceof Boolean?s.dropShadow===!0&&(this.dropShadow={...vr.defaultTextStyle.dropShadow}):this.dropShadow={...vr.defaultTextStyle.dropShadow,...s.dropShadow}),this.update()}generateKey(){const s=[];let t=0;for(let e=0;e<Sd.length;e++){const i=Sd[e];s[t++]=this[i]}return t=kg(this._fill,s,t),t=J1(this._stroke,s,t),this._styleKey=s.join("-"),this._styleKey}update(){this._styleKey=null,this.emit("update",this)}get fill(){return this._originalFill}set fill(s){s!==this._fill&&(this._originalFill=s,this._fill=io(s,Fi.defaultFillStyle))}get stroke(){return this._originalStroke}set stroke(s){s!==this._fill&&(this._originalFill=s,this._stroke=io(s,Fi.defaultStrokeStyle))}get styleKey(){return this._styleKey||this.generateKey()}clone(){return new vr({align:this.align,breakWords:this.breakWords,dropShadow:this.dropShadow,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,leading:this.leading,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,textBaseline:this.textBaseline,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth})}destroy(s=!1){var e,i,r,n;if(this.removeAllListeners(),typeof s=="boolean"?s:s==null?void 0:s.texture){const a=typeof s=="boolean"?s:s==null?void 0:s.textureSource;(e=this._fill)!=null&&e.texture&&this._fill.texture.destroy(a),(i=this._originalFill)!=null&&i.texture&&this._originalFill.texture.destroy(a),(r=this._stroke)!=null&&r.texture&&this._stroke.texture.destroy(a),(n=this._originalStroke)!=null&&n.texture&&this._originalStroke.texture.destroy(a)}this._fill=null,this._stroke=null,this.dropShadow=null,this._originalStroke=null,this._originalFill=null}};let Ys=vr;Ys.defaultTextStyle={align:"left",breakWords:!1,dropShadow:{alpha:1,angle:Math.PI/6,blur:0,color:"black",distance:5},fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,padding:0,stroke:null,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};function kg(s,t,e){var i;return s&&(t[e++]=s.color,t[e++]=s.alpha,t[e++]=(i=s.fill)==null?void 0:i.uid),e}function J1(s,t,e){return s&&(e=kg(s,t,e),t[e++]=s.width,t[e++]=s.alignment,t[e++]=s.cap,t[e++]=s.join,t[e++]=s.miterLimit),e}function Q1(s){typeof s=="string"&&(s=[s]);const t=[];for(let e=0,i=s.length;e<i;e++){const r=s[e];if(Array.isArray(r)){if(r.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${r.length}.`);const n=r[0].charCodeAt(0),a=r[1].charCodeAt(0);if(a<n)throw new Error("[BitmapFont]: Invalid character range.");for(let o=n,h=a;o<=h;o++)t.push(String.fromCharCode(o))}else t.push(...Array.from(r))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}class tT extends Rt{constructor(t){super(),this.baseRenderedFontSize=100,this.baseMeasurementFontSize=100,this.padding=4,this.baseLineOffset=0,this.pages=[],this.chars={},this.lineHeight=0,this.measureCache={},this.currentChars=[],this.dynamic=!0,this.currentX=0,this.currentY=0,this.currentPageIndex=-1,this.resolution=1,this.distanceField={fieldType:"none",distanceRange:0},this.pages=[];const e=t;this.dynamic=!0;let i;e.style instanceof Ys?i=e.style.clone():i=new Ys(e.style),i.fontSize=this.baseMeasurementFontSize,e.overrideFill&&(i._fill.color=16777215,i._fill.alpha=1,i._fill.texture=j.WHITE,i._fill.fill=null),this.style=i;const r=lo(i);this.fontMetrics=se.measureFont(r),this.lineHeight=i.lineHeight||this.fontMetrics.fontSize||i.fontSize}ensureCharacters(t){var m,g;const e=Q1(t).filter(x=>!this.currentChars.includes(x)).filter((x,y,b)=>b.indexOf(x)===y);if(!e.length)return;this.currentChars=[...this.currentChars,...e];let i;this.currentPageIndex===-1?i=this.nextPage():i=this.pages[this.currentPageIndex];let{canvas:r,context:n}=i.canvasAndContext,a=i.texture.source;const o=this.style;let h=this.currentX,l=this.currentY;const c=this.baseRenderedFontSize/this.baseMeasurementFontSize,u=this.padding*c,d=o.fontStyle==="italic"?2:1;let f=0,p=!1;for(let x=0;x<e.length;x++){const y=e[x],b=se.measureText(y,o,r,!1),v=d*b.width*c,_=b.height*c,w=v+u*2,T=_+u*2;if(p=!1,y!==`
`&&y!=="\r"&&y!=="	"&&y!==" "&&(p=!0,f=Math.ceil(Math.max(T,f))),h+w>512&&(l+=f,f=T,h=0,l+f>512)){a.update();const C=this.nextPage();r=C.canvasAndContext.canvas,n=C.canvasAndContext.context,a=C.texture.source,l=0}const S=v/c-(((m=o.dropShadow)==null?void 0:m.distance)??0)-(((g=o._stroke)==null?void 0:g.width)??0);if(this.chars[y]={id:y.codePointAt(0),xOffset:-this.padding,yOffset:-this.padding,xAdvance:S,kerning:{}},p){this.drawGlyph(n,b,h+u,l+u,c,o);const C=a.width*c,E=a.height*c,M=new Zt(h/C,l/E,w/C,T/E);this.chars[y].texture=new j({source:a,layout:{frame:M}}),h+=Math.ceil(w)}}a.update(),this.currentX=h,this.currentY=l,this.applyKerning(e,n)}applyKerning(t,e){const i=this.measureCache;for(let r=0;r<t.length;r++){const n=t[r];for(let a=0;a<this.currentChars.length;a++){const o=this.currentChars[a];let h=i[n];h||(h=i[n]=e.measureText(n).width);let l=i[o];l||(l=i[o]=e.measureText(o).width);let c=e.measureText(n+o).width,u=c-(h+l);u&&(this.chars[n].kerning[o]=u),c=e.measureText(n+o).width,u=c-(h+l),u&&(this.chars[o].kerning[n]=u)}}}nextPage(){this.currentPageIndex++;const t=this.resolution,e=ho.getOptimalCanvasAndContext(512,512,t);this.setupContext(e.context,this.style,t);const i=t*(this.baseRenderedFontSize/this.baseMeasurementFontSize),r=new j({source:new Ro({resource:e.canvas,resolution:i,alphaMode:Mg.PMA})}),n={canvasAndContext:e,texture:r};return this.pages[this.currentPageIndex]=n,n}setupContext(t,e,i){e.fontSize=this.baseRenderedFontSize,t.scale(i,i),t.font=lo(e),e.fontSize=this.baseMeasurementFontSize,t.textBaseline=e.textBaseline;const r=e._stroke,n=(r==null?void 0:r.width)??0;if(r&&(t.lineWidth=n,t.lineJoin=r.join,t.miterLimit=r.miterLimit,t.strokeStyle=co(r,t)),e._fill&&(t.fillStyle=co(e._fill,t)),e.dropShadow){const a=e.dropShadow,o=ki(a.color),h=qc(o),l=a.blur*i,c=a.distance*i;t.shadowColor=`rgba(${h[0]*255},${h[1]*255},${h[2]*255},${a.alpha})`,t.shadowBlur=l,t.shadowOffsetX=Math.cos(a.angle)*c,t.shadowOffsetY=Math.sin(a.angle)*c}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0}drawGlyph(t,e,i,r,n,a){const o=e.text,h=e.fontProperties,l=a._stroke,c=((l==null?void 0:l.width)??0)*n,u=i+c/2,d=r-c/2,f=h.descent*n,p=e.lineHeight*n;a.stroke&&c&&t.strokeText(o,u,d+p-f),a._fill&&t.fillText(o,u,d+p-f)}destroy(){this.emit("destroy",this),this.removeAllListeners();for(const t in this.chars)this.chars[t].texture.destroy();this.chars=null;for(let t=0;t<this.pages.length;t++){const{canvasAndContext:e,texture:i}=this.pages[t];ho.returnCanvasAndContext(e),i.destroy(!0)}this.pages=null}}function Rg(s,t,e){const i={width:0,height:0,offsetY:0,scale:t.fontSize/e.baseMeasurementFontSize,lines:[{width:0,charPositions:[],spaceWidth:0,spacesIndex:[],chars:[]}]};i.offsetY=e.baseLineOffset;let r=i.lines[0],n=null,a=!0;const o={spaceWord:!1,width:0,start:0,index:0,positions:[],chars:[]},h=f=>{const p=r.width;for(let m=0;m<o.index;m++){const g=f.positions[m];r.chars.push(f.chars[m]),r.charPositions.push(g+p)}r.width+=f.width,a=!1,o.width=0,o.index=0,o.chars.length=0},l=()=>{let f=r.chars.length-1,p=r.chars[f];for(;p===" ";)r.width-=e.chars[p].xAdvance,p=r.chars[--f];i.width=Math.max(i.width,r.width),r={width:0,charPositions:[],chars:[],spaceWidth:0,spacesIndex:[]},a=!0,i.lines.push(r),i.height+=e.lineHeight},c=e.baseMeasurementFontSize/t.fontSize,u=t.letterSpacing*c,d=t.wordWrapWidth*c;for(let f=0;f<s.length+1;f++){let p;const m=f===s.length;m||(p=s[f]);const g=e.chars[p];if(/(?:\s)/.test(p)||p==="\r"||p===`
`||m){if(!a&&t.wordWrap&&r.width+o.width-u>d?(l(),h(o),m||r.charPositions.push(0)):(o.start=r.width,h(o),m||r.charPositions.push(0)),p==="\r"||p===`
`)r.width!==0&&l();else if(!m){const v=g.xAdvance+(g.kerning[n]||0)+u;r.width+=v,r.spaceWidth=v,r.spacesIndex.push(r.charPositions.length),r.chars.push(p)}}else{const b=g.kerning[n]||0,v=g.xAdvance+b+u;o.positions[o.index++]=o.width+b,o.chars.push(p),o.width+=v}n=p}return l(),t.align==="center"?eT(i):t.align==="right"?iT(i):t.align==="justify"&&sT(i),i}function eT(s){for(let t=0;t<s.lines.length;t++){const e=s.lines[t],i=s.width/2-e.width/2;for(let r=0;r<e.charPositions.length;r++)e.charPositions[r]+=i}}function iT(s){for(let t=0;t<s.lines.length;t++){const e=s.lines[t],i=s.width-e.width;for(let r=0;r<e.charPositions.length;r++)e.charPositions[r]+=i}}function sT(s){const t=s.width;for(let e=0;e<s.lines.length;e++){const i=s.lines[e];let r=0,n=i.spacesIndex[r++],a=0;const o=i.spacesIndex.length,l=(t-i.width)/o;for(let c=0;c<i.charPositions.length;c++)c===n&&(n=i.spacesIndex[r++],a+=l),i.charPositions[c]+=a}}class rT{getFont(t,e){var a;let i=e.fontFamily,r=!0;e._fill.fill&&(i+=e._fill.fill.uid,r=!1),je.has(i)||je.set(i,new tT({style:e,overrideFill:r}));const n=je.get(i);return(a=n.ensureCharacters)==null||a.call(n,t),n}getLayout(t,e){const i=this.getFont(t,e);return Rg(t.split(""),e,i)}measureText(t,e){return this.getLayout(t,e)}}const Bg=new rT;class nT extends Gl{constructor(){super({view:new Wm})}}class Ig{constructor(t){this.gpuBitmapText={},this.renderer=t}validateRenderable(t){const e=this.getGpuBitmapText(t);return this.updateContext(t,e.view.context),this.renderer.renderPipes.graphics.validateRenderable(e)}addRenderable(t,e){const i=this.getGpuBitmapText(t);this.renderer.renderPipes.batch.break(e),this.renderer.renderPipes.graphics.addRenderable(i,e),i.view.context.customShader&&this.updateDistanceField(t)}destroyRenderable(t){this.destroyRenderableByUid(t.uid)}destroyRenderableByUid(t){Ft.return(this.gpuBitmapText[t]),this.gpuBitmapText[t]=null}updateRenderable(t){const e=this.getGpuBitmapText(t);this.renderer.renderPipes.graphics.updateRenderable(e),e.view.context.customShader&&this.updateDistanceField(t)}updateContext(t,e){var p;const i=t.view,r=Bg.getFont(i.text,i._style);e.clear(),r.distanceField.fieldType!=="none"&&(e.customShader||(this.sdfShader||(this.sdfShader=new j1),e.customShader=this.sdfShader));const n=Array.from(i.text),a=i._style;let o=(((p=a._stroke)==null?void 0:p.width)||0)/2;o+=r.baseLineOffset;const h=Rg(n,a,r);let l=0;const c=a.fontSize/r.baseMeasurementFontSize;e.scale(c,c);const u=-i.anchor.x*h.width,d=-i.anchor.y*h.height;e.translate(u,d);const f=a._fill.color;for(let m=0;m<h.lines.length;m++){const g=h.lines[m];for(let x=0;x<g.charPositions.length;x++){const y=n[l++],b=r.chars[y];b!=null&&b.texture&&e.texture(b.texture,f,Math.round(g.charPositions[x]+b.xOffset),Math.round(o+b.yOffset))}o+=r.lineHeight}}getGpuBitmapText(t){return this.gpuBitmapText[t.uid]||this.initGpuText(t)}initGpuText(t){t.view._style.update();const e=Ft.get(nT,t);return this.gpuBitmapText[t.uid]=e,this.updateContext(t,e.view.context),t.on("destroyed",()=>{this.destroyRenderable(t)}),this.gpuBitmapText[t.uid]}updateDistanceField(t){const e=this.getGpuBitmapText(t).view.context,i=t.view,r=i._style.fontFamily,n=je.get(r),{a,b:o,c:h,d:l}=t.layerTransform,c=Math.sqrt(a*a+o*o),u=Math.sqrt(h*h+l*l),d=(Math.abs(c)+Math.abs(u))/2,f=n.baseRenderedFontSize/i._style.fontSize,p=1,m=d*n.distanceField.distanceRange*(1/f)*p;e.customShader.resources.localUniforms.uniforms.distance=m}destroy(){var t;for(const e in this.gpuBitmapText)this.destroyRenderableByUid(e);this.gpuBitmapText=null,(t=this.sdfShader)==null||t.destroy(!0),this.sdfShader=null,this.renderer=null}}Ig.extension={type:[L.WebGLPipes,L.WebGPUPipes,L.CanvasPipes],name:"bitmapText"};class Fg{constructor(t){this.gpuText={},this.renderer=t}validateRenderable(t){const e=this.getGpuText(t),i=t.view._getKey();if(e.currentKey!==i){const r=t.view,n=r._autoResolution?this.renderer.view.resolution:r._resolution,{width:a,height:o}=this.renderer.canvasText.getTextureSize(r.text,n,r._style);return!(this.renderer.canvasText.getReferenceCount(e.currentKey)===1&&a===e.texture._source.width&&o===e.texture._source.height)}return!1}addRenderable(t,e){const r=this.getGpuText(t).batchableSprite;t.view.didUpdate&&this.updateText(t),this.renderer.renderPipes.batch.addToBatch(r,e)}updateRenderable(t){const i=this.getGpuText(t).batchableSprite;t.view.didUpdate&&this.updateText(t),i.batcher.updateElement(i)}destroyRenderable(t){this.destroyRenderableById(t.uid)}destroyRenderableById(t){const e=this.gpuText[t];this.renderer.canvasText.decreaseReferenceCount(e.currentKey),Ft.return(e.batchableSprite),this.gpuText[t]=null}updateText(t){const e=t.view._getKey(),i=this.getGpuText(t),r=i.batchableSprite;i.currentKey!==e&&this.updateGpuText(t),t.view.didUpdate=!1,aT(r.bounds,t.view.anchor,r.texture)}updateGpuText(t){const e=this.getGpuText(t),i=e.batchableSprite,r=t.view;e.texture&&this.renderer.canvasText.decreaseReferenceCount(e.currentKey);const n=r._autoResolution?this.renderer.view.resolution:r._resolution;e.texture=i.texture=this.renderer.canvasText.getTexture(r.text,n,r._style,r._getKey()),e.currentKey=r._getKey(),i.texture=e.texture,e.needsTextureUpdate=!1}getGpuText(t){return this.gpuText[t.uid]||this.initGpuText(t)}initGpuText(t){t.view._style.update();const i={texture:null,currentKey:"--",batchableSprite:Ft.get(Eg),needsTextureUpdate:!0};return i.batchableSprite.sprite=t,i.batchableSprite.bounds=[0,1,0,0],this.gpuText[t.uid]=i,this.updateText(t),t.on("destroyed",()=>{this.destroyRenderable(t)}),i}destroy(){for(const t in this.gpuText)this.destroyRenderableById(t);this.gpuText=null,this.renderer=null}}Fg.extension={type:[L.WebGLPipes,L.WebGPUPipes,L.CanvasPipes],name:"text"};function aT(s,t,e){const i=e._source,r=e.layout,n=r.orig,a=r.trim,o=i.width,h=i.height,l=o*n.width,c=h*n.height;if(a){const u=o*a.width,d=h*a.height;s[1]=a.x*o-t._x*l,s[0]=s[1]+u,s[3]=a.y*h-t._y*c,s[2]=s[3]+d}else s[1]=-t._x*l,s[0]=s[1]+l,s[3]=-t._y*c,s[2]=s[3]+c}const oT=new Ti;class Ug{constructor(){this.activeTextures={}}getTextureSize(t,e,i){const r=se.measureText(t||" ",i);let n=Math.ceil(Math.ceil(Math.max(1,r.width)+i.padding*2)*e),a=Math.ceil(Math.ceil(Math.max(1,r.height)+i.padding*2)*e);return n=Math.ceil(n-1e-6),a=Math.ceil(a-1e-6),n=jr(n),a=jr(a),{width:n,height:a}}getTexture(t,e,i,r){if(this.activeTextures[r])return this.increaseReferenceCount(r),this.activeTextures[r].texture;const n=se.measureText(t||" ",i),a=Math.ceil(Math.ceil(Math.max(1,n.width)+i.padding*2)*e),o=Math.ceil(Math.ceil(Math.max(1,n.height)+i.padding*2)*e),h=ho.getOptimalCanvasAndContext(a,o),{canvas:l}=h;this.renderTextToCanvas(t,i,e,h);const c=oT;c.minX=0,c.minY=0,c.maxX=l.width/e|0,c.maxY=l.height/e|0;const u=li.getOptimalTexture(c.width,c.height,e,!1);return u.source.type="image",u.source.resource=l,u.frameWidth=n.width,u.frameHeight=n.height,u.source.update(),u.layout.updateUvs(),this.activeTextures[r]={canvasAndContext:h,texture:u,usageCount:1},u}increaseReferenceCount(t){this.activeTextures[t].usageCount++}decreaseReferenceCount(t){const e=this.activeTextures[t];e.usageCount--,e.usageCount===0&&(ho.returnCanvasAndContext(e.canvasAndContext),li.returnTexture(e.texture),e.texture.source.resource=null,e.texture.source.type="unknown",this.activeTextures[t]=null)}getReferenceCount(t){return this.activeTextures[t].usageCount}renderTextToCanvas(t,e,i,r){var y,b,v;const{canvas:n,context:a}=r,o=lo(e),h=se.measureText(t||" ",e),l=h.lines,c=h.lineHeight,u=h.lineWidths,d=h.maxLineWidth,f=h.fontProperties,p=n.height;a.resetTransform(),a.scale(i,i),a.clearRect(0,0,h.width,h.height),a.font=o;let m,g;const x=e.dropShadow?2:1;for(let _=0;_<x;++_){const w=e.dropShadow&&_===0,T=w?Math.ceil(Math.max(1,p)+e.padding*2):0,S=T*i;if(w){a.fillStyle="black",a.strokeStyle="black";const M=e.dropShadow,N=ki(M.color),R=qc(N),I=M.blur*i,k=M.distance*i;a.shadowColor=`rgba(${R[0]*255},${R[1]*255},${R[2]*255},${M.alpha})`,a.shadowBlur=I,a.shadowOffsetX=Math.cos(M.angle)*k,a.shadowOffsetY=Math.sin(M.angle)*k+S}else{if(a.globalAlpha=((y=e._fill)==null?void 0:y.alpha)??1,a.fillStyle=e._fill?co(e._fill,a):null,(b=e._stroke)!=null&&b.width){const M=e._stroke;a.strokeStyle=co(e._stroke,a),a.lineWidth=M.width,a.miterLimit=M.miterLimit,a.lineJoin=M.join,a.lineCap=M.cap}a.shadowColor="black",a.shadowBlur=0,a.shadowOffsetX=0,a.shadowOffsetY=0}let C=(c-f.fontSize)/2;c-f.fontSize<0&&(C=0);const E=((v=e.stroke)==null?void 0:v.width)??0;for(let M=0;M<l.length;M++)m=E/2,g=E/2+M*c+f.ascent+C,e.align==="right"?m+=d-u[M]:e.align==="center"&&(m+=(d-u[M])/2),e._stroke&&this.drawLetterSpacing(l[M],e,r,m+e.padding,g+e.padding-T,!0),e._fill!==void 0&&this.drawLetterSpacing(l[M],e,r,m+e.padding,g+e.padding-T)}}drawLetterSpacing(t,e,i,r,n,a=!1){const{context:o}=i,h=e.letterSpacing;let l=!1;if(se.experimentalLetterSpacingSupported&&(se.experimentalLetterSpacing?(o.letterSpacing=`${h}px`,o.textLetterSpacing=`${h}px`,l=!0):(o.letterSpacing="0px",o.textLetterSpacing="0px")),h===0||l){a?o.strokeText(t,r,n):o.fillText(t,r,n);return}let c=r;const u=se.graphemeSegmenter(t);let d=o.measureText(t).width,f=0;for(let p=0;p<u.length;++p){const m=u[p];a?o.strokeText(m,c,n):o.fillText(m,c,n);let g="";for(let x=p+1;x<u.length;++x)g+=u[x];f=o.measureText(g).width,c+=d-f+h,d=f}}destroy(){}}Ug.extension={type:[L.WebGLSystem,L.WebGPUSystem,L.CanvasSystem],name:"canvasText"};const hT={alpha:1,color:0,clearBeforeRender:!0};let Kc=class{constructor(){this.clearBeforeRender=!0,this._backgroundColor=0,this._backgroundColorRgba=[0,0,0,1],this._backgroundColorRgbaObject={r:0,g:0,b:0,a:1},this._backgroundColorString="#000000",this.color=this._backgroundColor,this.alpha=1}init(t){t={...hT,...t},this.clearBeforeRender=t.clearBeforeRender,this.color=t.backgroundColor||this._backgroundColor,this.alpha=t.backgroundAlpha}get color(){return this._backgroundColor}set color(t){this._backgroundColor=t,this._backgroundColorString=q1(t);const e=this._backgroundColorRgbaObject,i=this._backgroundColorRgba;qc(t,i),e.r=i[0],e.g=i[1],e.b=i[2],e.a=i[3]}get alpha(){return this._backgroundColorRgba[3]}set alpha(t){this._backgroundColorRgba[3]=t}get colorRgba(){return this._backgroundColorRgba}get colorRgbaObject(){return this._backgroundColorRgbaObject}get colorString(){return this._backgroundColorString}destroy(){}};Kc.extension={type:[L.WebGLSystem,L.WebGPUSystem,L.CanvasSystem],name:"background",priority:0};Kc.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0};class lT extends jt{constructor(){super({gl:{functions:`
                ${Gc}

                vec3 blendColor(vec3 base, vec3 blend,  float opacity)
                {
                    return (setLuminosity(blend, getLuminosity(base)) * opacity + base * (1.0 - opacity));
                }
                `,main:`
                fragColor = vec4(blendColor(back.rgb, front.rgb, front.a), uBlend);
                `},gpu:{functions:`
                ${Vc}

                fn blendColorOpacity(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    return (setLuminosity(blend, getLuminosity(base)) * opacity + base * (1.0 - opacity));
                }
                `,main:`
                out = vec4<f32>(blendColorOpacity(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
                `}})}}class cT extends jt{constructor(){super({gl:{functions:`
                float colorBurn(float base, float blend)
                {
                    return max((1.0 - ((1.0 - base) / blend)), 0.0);
                }

                vec3 blendColorBurn(vec3 base, vec3 blend, float opacity)
                {
                    vec3 blended = vec3(
                        colorBurn(base.r, blend.r),
                        colorBurn(base.g, blend.g),
                        colorBurn(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
            `,main:`
                fragColor = vec4(blendColorBurn(back.rgb, front.rgb, front.a), uBlend);
            `},gpu:{functions:`
                fn colorBurn(base:f32, blend:f32) -> f32
                {
                    return max((1.0-((1.0-base)/blend)),0.0);
                }

                fn blendColorBurn(base: vec3<f32>, blend: vec3<f32>, opacity: f32) -> vec3<f32>
                {
                    let blended = vec3<f32>(
                        colorBurn(base.r, blend.r),
                        colorBurn(base.g, blend.g),
                        colorBurn(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
            `,main:`
                out = vec4<f32>(blendColorBurn(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
            `}})}}class uT extends jt{constructor(){super({gl:{functions:`
                float colorDodge(float base, float blend)
                {
                    return base / (1.0 - blend);
                }

                vec3 blendColorDodge(vec3 base, vec3 blend, float opacity)
                {
                    vec3 blended = vec3(
                        colorDodge(base.r, blend.r),
                        colorDodge(base.g, blend.g),
                        colorDodge(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                fragColor = vec4(blendColorDodge(back.rgb, front.rgb, front.a), uBlend);
                `},gpu:{functions:`
                fn colorDodge(base: f32, blend: f32) -> f32
                {
                    return base / (1.0 - blend);
                }

                fn blendColorDodge(base: vec3<f32>, blend: vec3<f32>, opacity: f32) -> vec3<f32>
                {
                    let blended = vec3<f32>(
                        colorDodge(base.r, blend.r),
                        colorDodge(base.g, blend.g),
                        colorDodge(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                    out = vec4<f32>(blendColorDodge(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
                `}})}}class dT extends jt{constructor(){super({gl:{functions:`
                vec3 blendDarken(vec3 base, vec3 blend, float opacity)
                {
                    return (min(base, blend) * opacity + base * (1.0 - opacity));
                }
                `,main:`
                fragColor = vec4(blendDarken(back.rgb, front.rgb, front.a), uBlend);
                `},gpu:{functions:`
                fn blendDarken(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    return (min(blend,base) * opacity + base * (1.0 - opacity));
                }
                `,main:`
                out = vec4<f32>(blendDarken(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
                `}})}}class fT extends jt{constructor(){super({gl:{functions:`
                vec3 blendDifference(vec3 base, vec3 blend,  float opacity)
                {
                    return (abs(blend - base) * opacity + base * (1.0 - opacity));
                }
            `,main:`
                fragColor = vec4(blendDifference(back.rgb, front.rgb, front.a), uBlend);
            `},gpu:{functions:`
                fn blendDifference(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    return (abs(blend - base) * opacity + base * (1.0 - opacity));
                }
            `,main:`
                out = vec4<f32>(blendDifference(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
            `}})}}class pT extends jt{constructor(){super({gl:{functions:`
                float divide(float base, float blend)
                {
                    return (blend > 0.0) ? clamp(base / blend, 0.0, 1.0) : 1.0;
                }

                vec3 blendDivide(vec3 base, vec3 blend, float opacity)
                {
                    vec3 blended = vec3(
                        divide(base.r, blend.r),
                        divide(base.g, blend.g),
                        divide(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                fragColor = vec4(blendDivide(back.rgb, front.rgb, front.a), uBlend);
                `},gpu:{functions:`
                fn divide(base: f32, blend: f32) -> f32
                {
                    return select(1.0, clamp(base / blend, 0.0, 1.0), blend > 0.0);
                }

                fn blendDivide(base: vec3<f32>, blend: vec3<f32>, opacity: f32) -> vec3<f32>
                {
                    let blended = vec3<f32>(
                        divide(base.r, blend.r),
                        divide(base.g, blend.g),
                        divide(base.b, blend.b)
                    );
                    return (blended * opacity + base * (1.0 - opacity));
                }
            `,main:`
                out = vec4<f32>(blendDivide(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
            `}})}}class mT extends jt{constructor(){super({gl:{functions:`
                vec3 exclusion(vec3 base, vec3 blend)
                {
                    return base + blend - 2.0 * base * blend;
                }

                vec3 blendExclusion(vec3 base, vec3 blend, float opacity)
                {
                    return (exclusion(base, blend) * opacity + base * (1.0 - opacity));
                }
                `,main:`
                fragColor = vec4(blendExclusion(back.rgb, front.rgb, front.a), uBlend);
                `},gpu:{functions:`
                fn exclusion(base: vec3<f32>, blend: vec3<f32>) -> vec3<f32>
                {
                    return base+blend-2.0*base*blend;
                }

                fn blendExclusion(base: vec3<f32>, blend: vec3<f32>, opacity: f32) -> vec3<f32>
                {
                    return (exclusion(base, blend) * opacity + base * (1.0 - opacity));
                }
            `,main:`
                out = vec4<f32>(blendExclusion(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
            `}})}}class gT extends jt{constructor(){super({gl:{functions:`
                float hardLight(float base, float blend)
                {
                    return (blend < 0.5) ? 2.0 * base * blend : 1.0 - 2.0 * (1.0 - base) * (1.0 - blend);
                }

                vec3 blendHardLight(vec3 base, vec3 blend, float opacity)
                {
                    vec3 blended = vec3(
                        hardLight(base.r, blend.r),
                        hardLight(base.g, blend.g),
                        hardLight(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
            `,main:`
                fragColor = vec4(blendHardLight(back.rgb, front.rgb, front.a), uBlend);
            `},gpu:{functions:`
                fn hardLight(base: f32, blend: f32) -> f32
                {
                    return select(1.0 - 2.0 * (1.0 - base) * (1.0 - blend), 2.0 * base * blend, blend < 0.5);
                }

                fn blendHardLight(base: vec3<f32>, blend: vec3<f32>, opacity: f32) -> vec3<f32>
                {
                    let blended = vec3<f32>(
                        hardLight(base.r, blend.r),
                        hardLight(base.g, blend.g),
                        hardLight(base.b, blend.b)
                    );
                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                out = vec4<f32>(blendHardLight(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
                `}})}}class bT extends jt{constructor(){super({gl:{functions:`
                float hardMix(float base, float blend)
                {
                    return (base + blend >= 1.0) ? 1.0 : 0.0;
                }

                vec3 blendHardMix(vec3 base, vec3 blend,  float opacity)
                {
                    vec3 blended = vec3(
                        hardMix(base.r, blend.r),
                        hardMix(base.g, blend.g),
                        hardMix(base.b, blend.b)
                    );
                    return (blended * opacity + base * (1.0 - opacity));
                }
            `,main:`
                fragColor = vec4(blendHardMix(back.rgb, front.rgb, front.a), uBlend);
            `},gpu:{functions:`
                fn hardMix(base: f32, blend: f32) -> f32
                {
                    return select(0.0, 1.0, base + blend >= 1.0);
                }

                fn blendHardMix(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    let blended: vec3<f32> = vec3<f32>(
                        hardMix(base.r, blend.r),
                        hardMix(base.g, blend.g),
                        hardMix(base.b, blend.b)
                    );
                    return (blended * opacity + base * (1.0 - opacity));
                }
            `,main:`
                out = vec4<f32>(blendHardMix(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
            `}})}}class yT extends jt{constructor(){super({gl:{functions:`
                vec3 blendLighten(vec3 base, vec3 blend, float opacity)
                {
                    return (max(base, blend) * opacity + base * (1.0 - opacity));
                }
                `,main:`
                fragColor = vec4(blendLighten(back.rgb, front.rgb, front.a), uBlend);
                `},gpu:{functions:`
                fn blendLighten(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    return (max(base, blend) * opacity + base * (1.0 - opacity));
                }
            `,main:`
                out = vec4<f32>(blendLighten(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
            `}})}}class xT extends jt{constructor(){super({gl:{functions:`
                float linearBurn(float base, float blend)
                {
                    return max(0.0, base + blend - 1.0);
                }

                vec3 blendLinearBurn(vec3 base, vec3 blend, float opacity)
                {
                    vec3 blended = vec3(
                        linearBurn(base.r, blend.r),
                        linearBurn(base.g, blend.g),
                        linearBurn(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                fragColor = vec4(blendLinearBurn(back.rgb, front.rgb, front.a), uBlend);
                `},gpu:{functions:`
                fn linearBurn(base: f32, blend: f32) -> f32
                {
                    return max(0.0, base + blend - 1.0);
                }

                fn blendLinearBurn(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    let blended = vec3<f32>(
                        linearBurn(base.r, blend.r),
                        linearBurn(base.g, blend.g),
                        linearBurn(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                out = vec4<f32>(blendLinearBurn(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
                `}})}}class vT extends jt{constructor(){super({gl:{functions:`
                float linearDodge(float base, float blend) {
                    return min(1.0, base + blend);
                }

                vec3 blendLinearDodge(vec3 base, vec3 blend, float opacity) {
                    vec3 blended = vec3(
                        linearDodge(base.r, blend.r),
                        linearDodge(base.g, blend.g),
                        linearDodge(base.b, blend.b)
                    );
                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                fragColor = vec4(blendLinearDodge(back.rgb, front.rgb, front.a), uBlend);
                `},gpu:{functions:`
                fn linearDodge(base: f32, blend: f32) -> f32
                {
                    return min(1, base + blend);
                }

                fn blendLinearDodge(base:vec3<f32>, blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    let blended = vec3<f32>(
                        linearDodge(base.r, blend.r),
                        linearDodge(base.g, blend.g),
                        linearDodge(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
            `,main:`
                out = vec4<f32>(blendLinearDodge(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
            `}})}}class _T extends jt{constructor(){super({gl:{functions:`
                float linearBurn(float base, float blend) {
                    return max(0.0, base + blend - 1.0);
                }

                float linearDodge(float base, float blend) {
                    return min(1.0, base + blend);
                }

                float linearLight(float base, float blend) {
                    return (blend <= 0.5) ? linearBurn(base,2.0*blend) : linearBurn(base,2.0*(blend-0.5));
                }

                vec3 blendLinearLight(vec3 base, vec3 blend, float opacity) {
                    vec3 blended = vec3(
                        linearLight(base.r, blend.r),
                        linearLight(base.g, blend.g),
                        linearLight(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
            `,main:`
                fragColor = vec4(blendLinearLight(back.rgb, front.rgb, front.a), uBlend);
                `},gpu:{functions:`
                fn linearBurn(base: f32, blend: f32) -> f32
                {
                    return max(0.0, base + blend - 1.0);
                }

                fn linearDodge(base: f32, blend: f32) -> f32
                {
                    return min(1.0, base + blend);
                }

                fn linearLight(base: f32, blend: f32) -> f32
                {
                    return select(linearBurn(base,2.0*(blend-0.5)), linearBurn(base,2.0*blend), blend <= 0.5);
                }

                fn blendLinearLightOpacity(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    let blended = vec3<f32>(
                        linearLight(base.r, blend.r),
                        linearLight(base.g, blend.g),
                        linearLight(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
            `,main:`
                out = vec4<f32>(blendLinearLightOpacity(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
            `}})}}class wT extends jt{constructor(){super({gl:{functions:`
                ${Gc}

                vec3 blendLuminosity(vec3 base, vec3 blend,  float opacity)
                {
                    vec3 blendLuminosity = setLuminosity(base, getLuminosity(blend));
                    return (blendLuminosity * opacity + base * (1.0 - opacity));
                }
                `,main:`
                fragColor = vec4(blendLuminosity(back.rgb, front.rgb, front.a), uBlend);
                `},gpu:{functions:`
                ${Vc}

                fn blendLuminosity(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    let blendLuminosity: vec3<f32> = setLuminosity(base, getLuminosity(blend));
                    return (blendLuminosity * opacity + base * (1.0 - opacity));
                }
            `,main:`
                out = vec4<f32>(blendLuminosity(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
            `}})}}class TT extends jt{constructor(){super({gl:{functions:`
                vec3 negation(vec3 base, vec3 blend)
                {
                    return 1.0-abs(1.0-base-blend);
                }

                vec3 blendNegation(vec3 base, vec3 blend, float opacity)
                {
                    return (negation(base, blend) * opacity + base * (1.0 - opacity));
                }
                `,main:`
                fragColor = vec4(blendNegation(back.rgb, front.rgb, front.a), uBlend);
                `},gpu:{functions:`
                fn blendNegation(base: vec3<f32>, blend: vec3<f32>) -> vec3<f32>
                {
                    return 1.0-abs(1.0-base-blend);
                }

                fn blendNegationOpacity(base: vec3<f32>, blend: vec3<f32>, opacity: f32) -> vec3<f32>
                {
                    return (blendNegation(base, blend) * opacity + base * (1.0 - opacity));
                }
            `,main:`
                out = vec4<f32>(blendNegationOpacity(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
            `}})}}class ST extends jt{constructor(){super({gl:{functions:`
                float overlay(float base, float blend)
                {
                    return (blend < 0.5) ? (2.0*base*blend) : (1.0-2.0*(1.0-base)*(1.0-blend));
                }

                vec3 blendOverlay(vec3 base, vec3 blend, float opacity)
                {
                    vec3 blended = vec3(
                        overlay(base.r, blend.r),
                        overlay(base.g, blend.g),
                        overlay(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                fragColor = vec4(blendOverlay(back.rgb, front.rgb, front.a), uBlend);
                `},gpu:{functions:`
                fn overlay(base: f32, blend: f32) -> f32
                {
                    return select((1.0-2.0*(1.0-base)*(1.0-blend)), (2.0*base*blend), base < 0.5);
                }

                fn blendOverlay(base: vec3<f32>, blend: vec3<f32>, opacity: f32) -> vec3<f32>
                {
                    let blended = vec3<f32>(
                        overlay(base.r, blend.r),
                        overlay(base.g, blend.g),
                        overlay(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                out = vec4<f32>(blendOverlay(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
                `}})}}class CT extends jt{constructor(){super({gl:{functions:`
                float pinLight(float base, float blend)
                {
                    return (blend <= 0.5) ? min(base, 2.0 * blend) : max(base, 2.0 * (blend - 0.5));
                }

                vec3 blendPinLight(vec3 base, vec3 blend, float opacity)
                {
                    vec3 blended = vec3(
                        pinLight(base.r, blend.r),
                        pinLight(base.g, blend.g),
                        pinLight(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
            `,main:`
                fragColor = vec4(blendPinLight(back.rgb, front.rgb, front.a), uBlend);
                `},gpu:{functions:`
                fn pinLight(base: f32, blend: f32) -> f32
                {
                    return select(max(base,2.0*(blend-0.5)), min(base,2.0*blend), blend <= 0.5);
                }

                fn blendPinLight(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    let blended = vec3<f32>(
                        pinLight(base.r, blend.r),
                        pinLight(base.g, blend.g),
                        pinLight(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                out = vec4<f32>(blendPinLight(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
                `}})}}class AT extends jt{constructor(){super({gl:{functions:`
                ${Gc}

                vec3 blendSaturation(vec3 base, vec3 blend,  float opacity)
                {
                    vec3 blendSaturation = setLuminosity(setSaturation(base, getSaturation(blend)), getLuminosity(base));
                    return (blendSaturation * opacity + base * (1.0 - opacity));
                }
            `,main:`
                fragColor = vec4(blendSaturation(back.rgb, front.rgb, front.a), uBlend);
            `},gpu:{functions:`
                ${Vc}

                fn blendSaturation(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    let blendSaturation = setLuminosity(setSaturation(base, getSaturation(blend)), getLuminosity(base));
                    return (blendSaturation * opacity + base * (1.0 - opacity));
                }
            `,main:`
                out = vec4<f32>(blendSaturation(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
            `}})}}class ET extends jt{constructor(){super({gl:{functions:`
                float softLight(float base, float blend)
                {
                    return (blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend));
                }

                vec3 blendSoftLight(vec3 base, vec3 blend, float opacity)
                {
                    vec3 blended = vec3(
                        softLight(base.r, blend.r),
                        softLight(base.g, blend.g),
                        softLight(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                fragColor = vec4(blendSoftLight(back.rgb, front.rgb, front.a), uBlend);
                `},gpu:{functions:`
                fn softLight(base: f32, blend: f32) -> f32
                {
                    return select(2.0 * base * blend + base * base * (1.0 - 2.0 * blend), sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend), blend < 0.5);
                }

                fn blendSoftLight(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    let blended: vec3<f32> = vec3<f32>(
                        softLight(base.r, blend.r),
                        softLight(base.g, blend.g),
                        softLight(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                out = vec4<f32>(blendSoftLight(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
                `}})}}class PT extends jt{constructor(){super({gl:{functions:`
                float subtract(float base, float blend)
                {
                    return max(0.0, base - blend);
                }

                vec3 blendSubtract(vec3 base, vec3 blend, float opacity)
                {
                    vec3 blended = vec3(
                        subtract(base.r, blend.r),
                        subtract(base.g, blend.g),
                        subtract(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                fragColor = vec4(blendSubtract(back.rgb, front.rgb, front.a), uBlend);
                `},gpu:{functions:`
                fn subtract(base: f32, blend: f32) -> f32
                {
                    return max(0, base - blend);
                }

                fn blendSubtract(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    let blended = vec3<f32>(
                        subtract(base.r, blend.r),
                        subtract(base.g, blend.g),
                        subtract(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                out = vec4<f32>(blendSubtract(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
                `}})}}class MT extends jt{constructor(){super({gl:{functions:`
                float colorBurn(float base, float blend)
                {
                    return max((1.0-((1.0-base)/blend)),0.0);
                }

                float colorDodge(float base, float blend)
                {
                    return min(1.0, base / (1.0-blend));
                }

                float vividLight(float base, float blend)
                {
                    return (blend < 0.5) ? colorBurn(base,(2.0*blend)) : colorDodge(base,(2.0*(blend-0.5)));
                }

                vec3 blendVividLight(vec3 base, vec3 blend, float opacity)
                {
                    vec3 blended = vec3(
                        vividLight(base.r, blend.r),
                        vividLight(base.g, blend.g),
                        vividLight(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
            `,main:`
                fragColor = vec4(blendVividLight(back.rgb, front.rgb, front.a), uBlend);
            `},gpu:{functions:`
                fn colorBurn(base:f32, blend:f32) -> f32
                {
                    return max((1.0-((1.0-base)/blend)),0.0);
                }

                fn colorDodge(base: f32, blend: f32) -> f32
                {
                    return min(1.0, base / (1.0-blend));
                }

                fn vividLight(base: f32, blend: f32) -> f32
                {
                    return select(colorDodge(base,(2.0*(blend-0.5))), colorBurn(base,(2.0*blend)), blend<0.5);
                }

                fn blendVividLight(base: vec3<f32>, blend: vec3<f32>, opacity: f32) -> vec3<f32>
                {
                    let blended: vec3<f32> = vec3<f32>(
                        vividLight(base.r, blend.r),
                        vividLight(base.g, blend.g),
                        vividLight(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                out = vec4<f32>(blendVividLight(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
                `}})}}const Gh={color:lT,"color-burn":cT,"color-dodge":uT,darken:dT,difference:fT,divide:pT,exclusion:mT,"hard-light":gT,"hard-mix":bT,lighten:yT,"linear-burn":xT,"linear-dodge":vT,"linear-light":_T,luminosity:wT,negation:TT,overlay:ST,"pin-light":CT,saturation:AT,"soft-light":ET,subtract:PT,"vivid-light":MT};class Lg{constructor(t){this.isAdvanced=!1,this.filterHash={},this.renderer=t}setBlendMode(t,e,i){if(this.activeBlendMode===e){this.isAdvanced&&this.renderableList.push(t);return}this.activeBlendMode=e,this.isAdvanced&&this.endAdvancedBlendMode(i),this.isAdvanced=!!Gh[e],this.isAdvanced&&(this.beginAdvancedBlendMode(i),this.renderableList.push(t))}beginAdvancedBlendMode(t){this.renderer.renderPipes.batch.break(t);const e=this.activeBlendMode;if(!Gh[e]){console.warn(`Unable to assign 'BLEND_MODES.${e}' using the blend mode pipeline`);return}this.filterHash[e]||(this.filterHash[e]=new Uc({filters:[new Gh[e]]}));const i={type:"filter",action:"pushFilter",renderables:[],filterEffect:this.filterHash[e],canBundle:!1};this.renderableList=i.renderables,t.add(i)}endAdvancedBlendMode(t){this.renderableList=null,this.renderer.renderPipes.batch.break(t),t.add({type:"filter",action:"popFilter",canBundle:!1})}buildStart(){this.isAdvanced=!1}buildEnd(t){this.isAdvanced&&this.endAdvancedBlendMode(t)}destroy(){this.renderer=null,this.renderableList=null;for(const t in this.filterHash)this.filterHash[t].destroy();this.filterHash=null}}Lg.extension={type:[L.WebGLPipes,L.WebGPUPipes,L.CanvasPipes],name:"blendMode"};class Og{constructor(t){this.stackIndex=0,this.globalUniformDataStack=[],this.uniformsPool=[],this.activeUniforms=[],this.bindGroupPool=[],this.activeBindGroups=[],this.renderer=t}reset(){this.stackIndex=0;for(let t=0;t<this.activeUniforms.length;t++)this.uniformsPool.push(this.activeUniforms[t]);for(let t=0;t<this.activeBindGroups.length;t++)this.bindGroupPool.push(this.activeBindGroups[t]);this.activeUniforms.length=0,this.activeBindGroups.length=0}start(t){this.reset(),this.push(t)}bind({projectionMatrix:t,worldTransformMatrix:e,worldColor:i,offset:r}){const n=this.stackIndex?this.globalUniformDataStack[this.stackIndex-1]:{projectionMatrix:this.renderer.renderTarget.renderTarget.projectionMatrix,worldTransformMatrix:new it,worldColor:4294967295,offset:new It},a={projectionMatrix:t||this.renderer.renderTarget.renderTarget.projectionMatrix,worldTransformMatrix:e||n.worldTransformMatrix,worldColor:i||n.worldColor,offset:r||n.offset,bindGroup:null},o=this.uniformsPool.pop()||this.createUniforms();this.activeUniforms.push(o);const h=o.uniforms;h.projectionMatrix=a.projectionMatrix,h.worldTransformMatrix.copyFrom(a.worldTransformMatrix),h.worldTransformMatrix.tx-=a.offset.x,h.worldTransformMatrix.ty-=a.offset.y,h.worldAlpha=(a.worldColor>>24&255)/255,o.update();let l;this.renderer.renderPipes.uniformBatch?l=this.renderer.renderPipes.uniformBatch.getUniformBindGroup(o,!1):(this.renderer.uniformBuffer.updateUniformGroup(o),l=this.bindGroupPool.pop()||new Ni,this.activeBindGroups.push(l),l.setResource(o,0)),a.bindGroup=l,this.currentGlobalUniformData=a}push(t){this.bind(t),this.globalUniformDataStack[this.stackIndex++]=this.currentGlobalUniformData}pop(){this.currentGlobalUniformData=this.globalUniformDataStack[--this.stackIndex-1]}get bindGroup(){return this.currentGlobalUniformData.bindGroup}get uniformGroup(){return this.currentGlobalUniformData.bindGroup.resources[0]}createUniforms(){return new re({projectionMatrix:{value:new it,type:"mat3x3<f32>"},worldTransformMatrix:{value:new it,type:"mat3x3<f32>"},worldAlpha:{value:1,type:"f32"}},{ubo:!0,isStatic:!0})}destroy(){}}Og.extension={type:[L.WebGLSystem,L.WebGPUSystem,L.CanvasSystem],name:"globalUniforms"};const Ng={f32:4,"vec2<f32>":8,"vec3<f32>":12,"vec4<f32>":16,"mat2x2<f32>":16*3,"mat3x3<f32>":16*3,"mat4x4<f32>":16*4};function kT(s){const t=s.map(n=>({data:n,offset:0,size:0}));let e=0,i=0,r=0;for(let n=0;n<t.length;n++){const a=t[n];if(e=Ng[a.data.type],!e)throw new Error(`Unknown type ${a.data.type}`);if(a.data.size>1&&(e=Math.max(e,16)*a.data.size),a.size=e,i%e!==0&&i<16){const o=i%e%16;i+=o,r+=o}i+e>16?(r=Math.ceil(r/16)*16,a.offset=r,r+=e,i=e):(a.offset=r,i+=e,r+=e)}return r=Math.ceil(r/16)*16,{uboElements:t,size:r}}const Vh=[{type:"mat3x3<f32>",test:s=>s.value.a!==void 0,code:s=>`
                var ${s}_matrix = uv.${s}.toArray(true);

                data[offset] = ${s}_matrix[0];
                data[offset+1] = ${s}_matrix[1];
                data[offset+2] = ${s}_matrix[2];

                data[offset + 4] = ${s}_matrix[3];
                data[offset + 5] = ${s}_matrix[4];
                data[offset + 6] = ${s}_matrix[5];

                data[offset + 8] = ${s}_matrix[6];
                data[offset + 9] = ${s}_matrix[7];
                data[offset + 10] = ${s}_matrix[8];
            `},{type:"vec4<f32>",test:s=>s.type==="vec4<f32>"&&s.size===1&&s.value.width!==void 0,code:s=>`
                        v = uv.${s};

                        data[offset] = v.x;
                        data[offset+1] = v.y;
                        data[offset+2] = v.width;
                        data[offset+3] = v.height;
                    `},{type:"vec2<f32>",test:s=>s.type==="vec2<f32>"&&s.size===1&&s.value.x!==void 0,code:s=>`
                    v = uv.${s};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                `}],RT={f32:`
        data[offset] = v;
    `,"vec2<f32>":`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,"vec3<f32>":`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,"vec4<f32>":`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,"mat2x2<f32>":`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,"mat3x3<f32>":`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,"mat4x4<f32>":`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `};function BT(s){const t=[`
        var v = null;
        var v2 = null;
        var t = 0;
        var index = 0;
    `];let e=0;for(let r=0;r<s.length;r++){const n=s[r],a=n.data.name;let o=!1,h=0;for(let l=0;l<Vh.length;l++)if(Vh[l].test(n.data)){h=n.offset/4,t.push(`offset += ${h-e};`,Vh[l].code(a)),o=!0;break}if(!o)if(n.data.size>1){const l=Math.max(Ng[n.data.type]/16,1),c=n.data.value.length/n.data.size,u=(4-c%4)%4;h=n.offset/4,t.push(`
                    v = uv.${a};
                    offset += ${h-e};

                    t = 0;

                    for(var i=0; i < ${n.data.size*l}; i++)
                    {
                        for(var j = 0; j < ${c}; j++)
                        {
                            data[offset++] = v[t++];
                        }
                        offset += ${u};
                    }
                `)}else{const l=RT[n.data.type];h=n.offset/4,t.push(`
                    v = uv.${a};
                    offset += ${h-e};
                    ${l};
                `)}e=h}const i=t.join(`
`);return new Function("uv","data","offset",i)}class Dg{constructor(t){this._syncFunctionHash={},this.renderer=t}ensureUniformGroup(t){t._syncFunction||this.initUniformGroup(t)}initUniformGroup(t){const e=t.signature;let i=this._syncFunctionHash[e];if(!i){const r=Object.keys(t.uniformStructures).map(o=>t.uniformStructures[o]),n=kT(r),a=BT(n.uboElements);i=this._syncFunctionHash[e]={layout:n,syncFunction:a}}return t._syncFunction=i.syncFunction,t.buffer=new Qe({data:new Float32Array(i.layout.size/4),usage:wt.UNIFORM|wt.COPY_DST}),t._syncFunction}syncUniformGroup(t,e,i){const r=t._syncFunction||this.initUniformGroup(t);return e||(e=t.buffer.data),i||(i=0),r(t.uniforms,e,i),!0}updateUniformGroup(t){if(t.isStatic&&!t.dirtyId)return!1;t.dirtyId=0;const e=this.syncUniformGroup(t);return t.buffer.update(),e}destroy(){throw new Error("Method not implemented.")}}Dg.extension={type:[L.WebGLSystem,L.WebGPUSystem,L.CanvasSystem],name:"uniformBuffer"};let Cd=!1;const Ad="8.0.0-alpha.1";function IT(s){if(!Cd){if(Tt.ADAPTER.getNavigator().userAgent.toLowerCase().indexOf("chrome")>-1){const t=[`%c  %c  %c  %c  %c PixiJS %c v${Ad} (${s}) http://www.pixijs.com/

`,"background: #E72264; padding:5px 0;","background: #6CA2EA; padding:5px 0;","background: #B5D33D; padding:5px 0;","background: #FED23F; padding:5px 0;","color: #FFFFFF; background: #E72264; padding:5px 0;","color: #E72264; background: #FFFFFF; padding:5px 0;"];globalThis.console.log(...t)}else globalThis.console&&globalThis.console.log(`PixiJS ${Ad} - ${s} - http://www.pixijs.com/`);Cd=!0}}class Zc{constructor(t){this.renderer=t}init(t){t.hello&&IT(this.renderer.type)}}Zc.extension={type:[L.WebGLSystem,L.WebGPUSystem,L.CanvasSystem],name:"hello",priority:0};Zc.defaultOptions={hello:!1};let Jc=class{constructor(t){this.renderer=t}get resolution(){return this.texture.source._resolution}set resolution(t){this.texture.source.resize(this.texture.source.width,this.texture.source.height,t)}init(t){this.element=t.element||Tt.ADAPTER.createCanvas(),this.antialias=!!t.antialias,this.texture=Yc(this.element,t),this.multiView=!!t.multiView,this.autoDensity&&(this.element.style.width=`${this.texture.width}px`,this.element.style.height=`${this.texture.height}px`)}resize(t,e,i){this.texture.source.resize(t,e,i),this.autoDensity&&(this.element.style.width=`${t}px`,this.element.style.height=`${e}px`)}destroy(t){t&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null}};Jc.extension={type:[L.WebGLSystem,L.WebGPUSystem,L.CanvasSystem],name:"view",priority:0};Jc.defaultOptions={width:800,height:600,resolution:Tt.RESOLUTION,autoDensity:!0,antialias:!1};const Gg=[Kc,Dm,jm,Og,Zc,Jc,Ug,Ag,Dg],Vg=[Lg,Um,Pg,wg,eg,qm,Fg,Ig,vg,Nm,Km,Jm,Zm],FT=[...Gg,ng,$c,ig,bg,cg,rg,mg,pg,og,gg,ug,ag],UT=[...Vg],LT=[km,Qm,Gm],zg=[],Hg=[],Xg=[];$t.handleByNamedList(L.WebGLSystem,zg);$t.handleByNamedList(L.WebGLPipes,Hg);$t.handleByNamedList(L.WebGLPipesAdaptor,Xg);$t.add(...FT,...UT,...LT);class OT extends yg{constructor(){const t={type:"webgl2",systems:zg,renderPipes:Hg,renderPipeAdaptors:Xg};super(t)}}const NT=Object.freeze(Object.defineProperty({__proto__:null,WebGLRenderer:OT},Symbol.toStringTag,{value:"Module"}));class $g{constructor(t){this.hash={},this.renderer=t}contextChange(t){this.gpu=t}getBindGroup(t,e,i){return t.updateKey(),this.hash[t.key]||this.createBindGroup(t,e,i)}createBindGroup(t,e,i){const r=this.gpu.device,n=e.layout[i],a=[];for(const h in n){const l=t.resources[h]??t.resources[n[h]];let c;if(l.resourceType==="uniformGroup"){const u=l;this.renderer.uniformBuffer.updateUniformGroup(u);const d=u.buffer;c={buffer:this.renderer.buffer.getGPUBuffer(d),offset:0,size:d.descriptor.size}}else if(l.resourceType==="buffer"){const u=l;c={buffer:this.renderer.buffer.getGPUBuffer(u),offset:0,size:u.descriptor.size}}else if(l.resourceType==="bufferResource"){const u=l;c={buffer:this.renderer.buffer.getGPUBuffer(u.buffer),offset:u.offset,size:u.size}}else if(l.resourceType==="textureSampler"){const u=l;c=this.renderer.texture.getGpuSampler(u)}else if(l.resourceType==="textureSource"){const u=l;c=this.renderer.texture.getGpuSource(u).createView({})}a.push({binding:n[h],resource:c})}const o=r.createBindGroup({layout:e._gpuLayout.bindGroups[i],entries:a});return this.hash[t.key]=o,o}destroy(){}}$g.extension={type:[L.WebGPUSystem],name:"bindGroup"};let Wg=class{constructor(){this._gpuBuffers={}}contextChange(t){this.gpu=t}getGPUBuffer(t){return this._gpuBuffers[t.uid]||this.createGPUBuffer(t)}updateBuffer(t){const e=this._gpuBuffers[t.uid]||this.createGPUBuffer(t);return t._updateID&&t.data&&(t._updateID=0,this.gpu.device.queue.writeBuffer(e,0,t.data.buffer,0,t._updateSize)),e}destroyAll(){for(const t in this._gpuBuffers)this._gpuBuffers[t].destroy();this._gpuBuffers={}}createGPUBuffer(t){const e=this.gpu.device.createBuffer(t.descriptor);return t._updateID=0,t.data&&(Fl(t.data.buffer,e.getMappedRange()),e.unmap()),this._gpuBuffers[t.uid]=e,t.on("update",this.updateBuffer,this),t.on("change",this.onBufferChange,this),t.on("destroy",this.onBufferDestroy,this),e}onBufferChange(t){let e=this._gpuBuffers[t.uid];e.destroy(),e=this.createGPUBuffer(t),t._updateID=0}onBufferDestroy(t){this._gpuBuffers[t.uid].destroy(),this._gpuBuffers[t.uid]=null}destroy(){throw new Error("Method not implemented.")}};Wg.extension={type:[L.WebGPUSystem],name:"buffer"};class DT{constructor({minUniformOffsetAlignment:t}){this.minUniformOffsetAlignment=256,this.byteIndex=0,this.minUniformOffsetAlignment=t,this.data=new Float32Array(65535)}clear(){this.byteIndex=0}addEmptyGroup(t){if(t>this.minUniformOffsetAlignment/4)throw new Error(`UniformBufferBatch: array is too large: ${t*4}`);const e=this.byteIndex;let i=e+t*4;if(i=Math.ceil(i/this.minUniformOffsetAlignment)*this.minUniformOffsetAlignment,i>this.data.length*4)throw new Error("UniformBufferBatch: ubo batch got too big");return this.byteIndex=i,e}addGroup(t){const e=this.addEmptyGroup(t.length);for(let i=0;i<t.length;i++)this.data[e/4+i]=t[i];return e}upload(){}destroy(){this.buffer.destroy(),this.buffer=null,this.data=null}}class Yg{constructor(t){this.colorMaskCache=15,this.renderer=t}setMask(t){this.colorMaskCache!==t&&(this.colorMaskCache=t,this.renderer.pipeline.setColorMask(t))}destroy(){}}Yg.extension={type:[L.WebGPUSystem],name:"colorMask"};class jg{constructor(t){this._renderer=t}async init(){return this._initPromise?this._initPromise:(this._initPromise=this.createDeviceAndAdaptor({}).then(t=>{this.gpu=t,this._renderer.runners.contextChange.emit(this.gpu)}),this._initPromise)}contextChange(t){this._renderer.gpu=t}async createDeviceAndAdaptor(t){const e=await navigator.gpu.requestAdapter(t),i=await e.requestDevice();return{adapter:e,device:i}}destroy(){this._renderer=null}}jg.extension={type:[L.WebGPUSystem],name:"device"};class qg{constructor(t){this.boundBindGroup={},this.boundVertexBuffer={},this.renderer=t}start(){this.commandFinished=new Promise(t=>{this.resolveCommandFinished=t}),this.commandEncoder=this.renderer.gpu.device.createCommandEncoder()}beginRenderPass(t,e){this.renderPassEncoder&&this.renderPassEncoder.end(),this.clearCache(),this.renderPassEncoder=this.commandEncoder.beginRenderPass(e.descriptor),this.setViewport(t.viewport)}setViewport(t){this.renderPassEncoder.setViewport(t.x,t.y,t.width,t.height,0,1)}setScissor(t){t.fit(this.renderer.renderTarget.renderTarget.viewport),this.renderPassEncoder.setScissorRect(t.minX,t.minY,t.width,t.height)}clearScissor(){const t=this.renderer.renderTarget.renderTarget.viewport;this.renderPassEncoder.setScissorRect(t.x,t.y,t.width,t.height)}setPipelineFromGeometryProgramAndState(t,e,i,r){const n=this.renderer.pipeline.getPipeline(t,e,i,r);this.setPipeline(n)}setPipeline(t){this.boundPipeline!==t&&(this.boundPipeline=t,this.renderPassEncoder.setPipeline(t))}setVertexBuffer(t,e){this.boundVertexBuffer[t]!==e&&(this.boundVertexBuffer[t]=e,this.renderPassEncoder.setVertexBuffer(t,this.renderer.buffer.updateBuffer(e)))}setIndexBuffer(t){this.boundIndexBuffer!==t&&(this.boundIndexBuffer=t,this.renderPassEncoder.setIndexBuffer(this.renderer.buffer.updateBuffer(t),"uint32"))}setBindGroup(t,e,i){if(this.boundBindGroup[t]===e)return;this.boundBindGroup[t]=e;const r=this.renderer.bindGroup.getBindGroup(e,i,t);this.renderPassEncoder.setBindGroup(t,r)}setGeometry(t){for(const e in t.attributes){const i=t.attributes[e];this.setVertexBuffer(i.shaderLocation,i.buffer)}t.indexBuffer&&this.setIndexBuffer(t.indexBuffer)}setShaderBindGroups(t,e){for(const i in t.groups){const r=t.groups[i];e||this.syncBindGroup(r),this.setBindGroup(i,r,t.gpuProgram)}}syncBindGroup(t){for(const e in t.resources){const i=t.resources[e];i.isUniformGroup&&this.renderer.uniformBuffer.updateUniformGroup(i)}}draw(t){const{geometry:e,shader:i,state:r,topology:n,size:a,start:o,instanceCount:h,skipSync:l}=t;this.setPipelineFromGeometryProgramAndState(e,i.gpuProgram,r,n),this.setGeometry(e),this.setShaderBindGroups(i,l),e.indexBuffer?this.renderPassEncoder.drawIndexed(a||e.indexBuffer.data.length,h||1,o||0):this.renderPassEncoder.draw(a||e.getSize(),h||1,o||0)}finishRenderPass(){this.renderPassEncoder&&(this.renderPassEncoder.end(),this.renderPassEncoder=null)}postrender(){this.finishRenderPass(),this.gpu.device.queue.submit([this.commandEncoder.finish()]),this.resolveCommandFinished()}restoreRenderPass(){const t=this.renderer.renderTarget.getDescriptor(this.renderer.renderTarget.renderTarget,!1,[0,0,0,1]);this.renderPassEncoder=this.commandEncoder.beginRenderPass(t);const e=this.boundPipeline,i={...this.boundVertexBuffer},r=this.boundIndexBuffer,n={...this.boundBindGroup};this.clearCache();const a=this.renderer.renderTarget.renderTarget.viewport;this.renderPassEncoder.setViewport(a.x,a.y,a.width,a.height,0,1),this.setPipeline(e);for(const o in i)this.setVertexBuffer(o,i[o]);for(const o in n)this.setBindGroup(o,n[o],null);this.setIndexBuffer(r)}clearCache(){for(let t=0;t<16;t++)this.boundBindGroup[t]=null,this.boundVertexBuffer[t]=null;this.boundIndexBuffer=null,this.boundPipeline=null}destroy(){}contextChange(t){this.gpu=t}}qg.extension={type:[L.WebGPUSystem],name:"encoder"};class Kg{constructor(t){this.renderTargetStencilState={},this.renderer=t,t.renderTarget.onRenderTargetChange.add(this)}onRenderTargetChange(t){let e=this.renderTargetStencilState[t.uid];e||(e=this.renderTargetStencilState[t.uid]={stencilMode:ue.DISABLED,stencilReference:0}),this.activeRenderTarget=t,this.setStencilMode(e.stencilMode,e.stencilReference)}setStencilMode(t,e){const i=this.renderTargetStencilState[this.activeRenderTarget.uid];i.stencilMode=t,i.stencilReference=e;const r=this.renderer;r.pipeline.setStencilMode(t),r.encoder.renderPassEncoder.setStencilReference(e)}destroy(){}}Kg.extension={type:[L.WebGPUSystem],name:"stencil"};const ls=128;class Zg{constructor(t){this.bindGroupHash={},this.buffers=[],this.bindGroups=[],this.bufferResources=[],this.renderer=t,this.batchBuffer=new DT({minUniformOffsetAlignment:ls});const e=256/ls;for(let i=0;i<e;i++){let r=wt.UNIFORM|wt.COPY_DST;i===0&&(r|=wt.COPY_SRC),this.buffers.push(new Qe({data:this.batchBuffer.data,usage:r}))}}renderEnd(){this.uploadBindGroups(),this.resetBindGroups()}resetBindGroups(){for(const t in this.bindGroupHash)this.bindGroupHash[t]=null;this.batchBuffer.clear()}getUniformBindGroup(t,e){if(!e&&this.bindGroupHash[t.uid])return this.bindGroupHash[t.uid];this.renderer.uniformBuffer.ensureUniformGroup(t);const i=t.buffer.data,r=this.batchBuffer.addEmptyGroup(i.length);return this.renderer.uniformBuffer.syncUniformGroup(t,this.batchBuffer.data,r/4),this.bindGroupHash[t.uid]=this.getBindGroup(r/ls),this.bindGroupHash[t.uid]}getUniformBufferResource(t){this.renderer.uniformBuffer.updateUniformGroup(t);const e=t.buffer.data,i=this.batchBuffer.addGroup(e);return this.getBufferResource(i/ls)}getArrayBindGroup(t){const e=this.batchBuffer.addGroup(t);return this.getBindGroup(e/ls)}getArrayBufferResource(t){const i=this.batchBuffer.addGroup(t)/ls;return this.getBufferResource(i)}getBufferResource(t){if(!this.bufferResources[t]){const e=this.buffers[t%2];this.bufferResources[t]=new jc({buffer:e,offset:(t/2|0)*256,size:ls})}return this.bufferResources[t]}getBindGroup(t){if(!this.bindGroups[t]){const e=new Ni({0:this.getBufferResource(t)});this.bindGroups[t]=e}return this.bindGroups[t]}uploadBindGroups(){const t=this.renderer.buffer,e=this.buffers[0];e.update(this.batchBuffer.byteIndex),t.updateBuffer(e);const i=this.renderer.gpu.device.createCommandEncoder();for(let r=1;r<this.buffers.length;r++){const n=this.buffers[r];i.copyBufferToBuffer(t.getGPUBuffer(e),ls,t.getGPUBuffer(n),0,this.batchBuffer.byteIndex)}this.renderer.gpu.device.queue.submit([i.finish()])}destroy(){for(let t=0;t<this.bindGroups.length;t++)this.bindGroups[t].destroy();this.bindGroups=null,this.bindGroupHash=null;for(let t=0;t<this.buffers.length;t++)this.buffers[t].destroy();this.buffers=null;for(let t=0;t<this.bufferResources.length;t++)this.bufferResources[t].destroy();this.bufferResources=null,this.batchBuffer.destroy(),this.bindGroupHash=null,this.renderer=null}}Zg.extension={type:[L.WebGPUPipes],name:"uniformBatch"};class GT extends Ni{constructor(){super({0:new Qe({data:new Float32Array(128),usage:wt.UNIFORM|wt.COPY_DST})})}get buffer(){return this.resources[0]}get data(){return this.resources[0].data}}class Jg{constructor(t){this.activeBindGroups=[],this.activeBindGroupIndex=0,this.renderer=t}getUniformBindGroup(t){const e=this.renderer;e.uniformBuffer.ensureUniformGroup(t);const i=Ft.get(GT);return e.uniformBuffer.syncUniformGroup(t,i.data,0),i.buffer.update(t.buffer.data.byteLength),this.activeBindGroups[this.activeBindGroupIndex++]=i,i}renderEnd(){for(let t=0;t<this.activeBindGroupIndex;t++)Ft.return(this.activeBindGroups[t]);this.activeBindGroupIndex=0}}Jg.extension={type:[L.WebGPUPipes],name:"uniformBuffer"};const VT={"point-list":0,"line-list":1,"line-strip":2,"triangle-list":3,"triangle-strip":4};function zT(s,t,e,i,r,n,a,o){return s<<26|t<<18|a<<14|e<<8|i<<3|o<<1|r<<4|n}class Qg{constructor(t){this._moduleCache={},this._bufferLayoutsCache={},this._pipeCache={},this.colorMask=15,this.multisampleCount=1,this.renderer=t}contextChange(t){this.gpu=t,this.setStencilMode(ue.DISABLED)}setMultisampleCount(t){this.multisampleCount=t}setColorMask(t){this.colorMask=t}setStencilMode(t){this.stencilMode=t,this.stencilState=is[t]}setPipeline(t,e,i,r){const n=this.getPipeline(t,e,i);r.setPipeline(n)}getPipeline(t,e,i,r){t._layoutKey||this.generateBufferKey(t),e._layoutKey||(this.generateProgramKey(e),this.renderer.shader.createProgramLayout(e)),r=r||t.topology;const n=zT(t._layoutKey,e._layoutKey,i.data,i._blendModeId,this.stencilMode,this.multisampleCount,this.colorMask,VT[r]);return this._pipeCache[n]?this._pipeCache[n]:(this._pipeCache[n]=this.createPipeline(t,e,i,r),this._pipeCache[n])}createPipeline(t,e,i,r){const n=this.gpu.device,a=this.createVertexBufferLayouts(t),o=this.renderer.state.getColorTargets(i);let h=this.stencilState;h=is[this.stencilMode],o[0].writeMask=this.stencilMode===ue.RENDERING_MASK_ADD?0:this.colorMask;const l={vertex:{module:this.getModule(e.vertex.source),entryPoint:e.vertex.entryPoint,buffers:a},fragment:{module:this.getModule(e.fragment.source),entryPoint:e.fragment.entryPoint,targets:o},primitive:{topology:r,cullMode:i.cullMode},layout:e._gpuLayout.pipeline,multisample:{count:this.multisampleCount},depthStencil:h,label:"PIXI Pipeline"};return n.createRenderPipeline(l)}getModule(t){return this._moduleCache[t]||this.createModule(t)}createModule(t){const e=this.gpu.device;return this._moduleCache[t]=e.createShaderModule({code:t}),this._moduleCache[t]}generateProgramKey(t){const{vertex:e,fragment:i}=t,r=e.source+i.source+e.entryPoint+i.entryPoint;return t._layoutKey=Tl(r,"program"),t._layoutKey}generateBufferKey(t){const e=[];let i=0;const r=Object.keys(t.attributes).sort();for(let a=0;a<r.length;a++){const o=t.attributes[r[a]];e[i++]=o.shaderLocation,e[i++]=o.offset,e[i++]=o.format,e[i++]=o.stride}const n=e.join("");return t._layoutKey=Tl(n,"geometry"),t._layoutKey}createVertexBufferLayouts(t){if(this._bufferLayoutsCache[t._layoutKey])return this._bufferLayoutsCache[t._layoutKey];const e=[];return t.buffers.forEach(i=>{const r={arrayStride:0,stepMode:"vertex",attributes:[]},n=r.attributes;for(const a in t.attributes){const o=t.attributes[a];o.buffer===i&&(r.arrayStride=o.stride,n.push({shaderLocation:o.shaderLocation,offset:o.offset,format:o.format}))}n.length&&e.push(r)}),this._bufferLayoutsCache[t._layoutKey]=e,e}destroy(){throw new Error("Method not implemented.")}}Qg.extension={type:[L.WebGPUSystem],name:"pipeline"};class HT{constructor(){this.contexts=[],this.msaaTextures=[],this.msaaSamples=1}}const XT=[0,0,0,0];class t0{constructor(t){this.rootProjectionMatrix=new it,this.onRenderTargetChange=new Wc("onRenderTargetChange"),this.renderSurfaceToRenderTargetHash=new Map,this.gpuRenderTargetHash={},this.renderTargetStack=[],this.renderer=t}renderStart({target:t,clear:e,clearColor:i}){this.rootRenderTarget=this.getRenderTarget(t),this.rootProjectionMatrix=this.rootRenderTarget.projectionMatrix,this.renderingToScreen=hg(this.rootRenderTarget),this.renderTargetStack.length=0,this.renderer.encoder.start(),this.push(this.rootRenderTarget,e,i??this.renderer.background.colorRgba)}contextChange(t){this.gpu=t}bind(t,e=!0,i){const r=this.getRenderTarget(t);this.renderTarget=r;const n=this.getGpuRenderTarget(r);(r.width!==n.width||r.height!==n.height)&&this.resizeGpuRenderTarget(r);const a=this.getDescriptor(r,e,i);return n.descriptor=a,this.renderer.encoder.beginRenderPass(r,n),this.renderer.pipeline.setMultisampleCount(n.msaaSamples),this.onRenderTargetChange.emit(r),r}getGpuColorTexture(t){const e=this.getGpuRenderTarget(t);return e.contexts[0]?e.contexts[0].getCurrentTexture():this.renderer.texture.getGpuSource(t.colorTextures[0].source)}getDescriptor(t,e,i){const r=this.getGpuRenderTarget(t),n=e?"clear":"load",a=t.colorTextures.map((l,c)=>{const u=r.contexts[c];let d,f;return u?d=u.getCurrentTexture().createView():d=this.renderer.texture.getTextureView(l),r.msaaTextures[c]&&(f=d,d=this.renderer.texture.getTextureView(r.msaaTextures[c])),{view:d,resolveTarget:f,clearValue:i||XT,storeOp:"store",loadOp:n}});let o;return t.depthTexture&&(o={view:this.renderer.texture.getGpuSource(t.depthTexture.source).createView(),stencilStoreOp:"store",stencilLoadOp:n}),{colorAttachments:a,depthStencilAttachment:o}}push(t,e=!0,i){const r=this.bind(t,e,i);return this.renderTargetStack.push(r),r}pop(){this.renderTargetStack.pop(),this.bind(this.renderTargetStack[this.renderTargetStack.length-1],!1)}getRenderTarget(t){return this.renderSurfaceToRenderTargetHash.get(t)??this.initRenderTarget(t)}copyToTexture(t,e,i,r){const n=this.renderer,a=n.renderTarget.getGpuColorTexture(t),o=n.texture.getGpuSource(e.source);return n.encoder.commandEncoder.copyTextureToTexture({texture:a,origin:i},{texture:o},r),e}restart(){this.bind(this.rootRenderTarget,!1)}destroy(){}initRenderTarget(t){let e=null;return t instanceof HTMLCanvasElement&&(t=Yc(t)),t instanceof Hn?e=t:t instanceof j&&(e=new Hn({colorTextures:[t],depthTexture:t.source.depthStencil})),e.isRoot=!0,this.renderSurfaceToRenderTargetHash.set(t,e),e}getGpuRenderTarget(t){return this.gpuRenderTargetHash[t.uid]||this.initGpuRenderTarget(t)}initGpuRenderTarget(t){t.isRoot=!0;const e=new HT;return t.colorTextures.forEach((i,r)=>{if(i.source.resource instanceof HTMLCanvasElement){const n=t.colorTexture.source.resource.getContext("webgpu");try{n.configure({device:this.gpu.device,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,format:"bgra8unorm",alphaMode:"opaque"})}catch(a){console.error(a)}e.contexts[r]=n}if(e.msaa=i.source.antialias,i.source.antialias){const n=new vi({width:0,height:0,sampleCount:4});e.msaaTextures[r]=n}}),e.msaa&&(e.msaaSamples=4,t.depthTexture&&(t.depthTexture.source.sampleCount=4)),this.gpuRenderTargetHash[t.uid]=e,e}resizeGpuRenderTarget(t){const e=this.getGpuRenderTarget(t);e.width=t.width,e.height=t.height,e.msaa&&t.colorTextures.forEach((i,r)=>{const n=e.msaaTextures[r];n==null||n.resize(i.source.width,i.source.height,i.source._resolution)})}}t0.extension={type:[L.WebGPUSystem],name:"renderTarget"};class e0{constructor(t){this.renderer=t}contextChange(t){this.gpu=t}createProgramLayout(t){const e=this.gpu.device;if(!t._gpuLayout)if(t.gpuLayout){const i=t.gpuLayout.map(n=>e.createBindGroupLayout({entries:n})),r={bindGroupLayouts:i};t._gpuLayout={bindGroups:i,pipeline:e.createPipelineLayout(r)}}else t._gpuLayout={bindGroups:null,pipeline:"auto"}}updateData(t){for(let e=0;e<t.gpuProgram.layout.length;e++){const i=t.groups[e],r=t.gpuProgram.layout[e];for(const n in r){const a=i.resources[n]??i.resources[r[n]];if(a instanceof re){const o=a;this.renderer.uniformBuffer.updateUniformGroup(o)}}}}destroy(){throw new Error("Method not implemented.")}}e0.extension={type:[L.WebGPUSystem],name:"shader"};const wi={};wi.normal={alpha:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"}};wi.add={alpha:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one",operation:"add"}};wi.multiply={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"dst",dstFactor:"one-minus-src-alpha",operation:"add"}};wi.screen={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one-minus-src",operation:"add"}};wi.overlay={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one-minus-src",operation:"add"}};wi.none={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"zero",dstFactor:"zero",operation:"add"}};wi["normal-npm"]={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"}};wi["add-npm"]={alpha:{srcFactor:"one",dstFactor:"one",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one",operation:"add"}};wi["screen-npm"]={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one-minus-src",operation:"add"}};class i0{constructor(){this.defaultState=new Es,this.defaultState.blend=!0}contextChange(t){this.gpu=t}getColorTargets(t){return[{format:"bgra8unorm",writeMask:0,blend:wi[t.blendMode]||wi.normal}]}destroy(){this.gpu=null}}i0.extension={type:[L.WebGPUSystem],name:"state"};const $T={type:"image",upload(s,t,e){const i=s.resource,r=(s.pixelWidth|0)*(s.pixelHeight|0),n=i.byteLength/r;e.device.queue.writeTexture({texture:t},i,{offset:0,rowsPerImage:s.pixelWidth,bytesPerRow:s.pixelWidth*n},{width:s.pixelWidth,height:s.pixelHeight,depthOrArrayLayers:1})}},WT={type:"image",upload(s,t,e){var a,o;const i=s.resource;if(!i)return;const r=((a=s.resource)==null?void 0:a.width)||s.pixelWidth,n=((o=s.resource)==null?void 0:o.height)||s.pixelHeight;e.device.queue.copyExternalImageToTexture({source:i},{texture:t},{width:r,height:n})}};class YT{constructor(t){this.device=t,this.sampler=t.createSampler({minFilter:"linear"}),this.pipelines={}}getMipmapPipeline(t){let e=this.pipelines[t];return e||(this.mipmapShaderModule||(this.mipmapShaderModule=this.device.createShaderModule({code:`
                        var<private> pos : array<vec2<f32>, 3> = array<vec2<f32>, 3>(
                        vec2<f32>(-1.0, -1.0), vec2<f32>(-1.0, 3.0), vec2<f32>(3.0, -1.0));

                        struct VertexOutput {
                        @builtin(position) position : vec4<f32>,
                        @location(0) texCoord : vec2<f32>,
                        };

                        @vertex
                        fn vertexMain(@builtin(vertex_index) vertexIndex : u32) -> VertexOutput {
                        var output : VertexOutput;
                        output.texCoord = pos[vertexIndex] * vec2<f32>(0.5, -0.5) + vec2<f32>(0.5);
                        output.position = vec4<f32>(pos[vertexIndex], 0.0, 1.0);
                        return output;
                        }

                        @group(0) @binding(0) var imgSampler : sampler;
                        @group(0) @binding(1) var img : texture_2d<f32>;

                        @fragment
                        fn fragmentMain(@location(0) texCoord : vec2<f32>) -> @location(0) vec4<f32> {
                        return textureSample(img, imgSampler, texCoord);
                        }
                    `})),e=this.device.createRenderPipeline({layout:"auto",vertex:{module:this.mipmapShaderModule,entryPoint:"vertexMain"},fragment:{module:this.mipmapShaderModule,entryPoint:"fragmentMain",targets:[{format:t}]}}),this.pipelines[t]=e),e}generateMipmap(t){const e=this.getMipmapPipeline(t.format);if(t.dimension==="3d"||t.dimension==="1d")throw new Error("Generating mipmaps for non-2d textures is currently unsupported!");let i=t;const r=t.depthOrArrayLayers||1,n=t.usage&GPUTextureUsage.RENDER_ATTACHMENT;if(!n){const h={size:{width:Math.ceil(t.width/2),height:Math.ceil(t.height/2),depthOrArrayLayers:r},format:t.format,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC|GPUTextureUsage.RENDER_ATTACHMENT,mipLevelCount:t.mipLevelCount-1};i=this.device.createTexture(h)}const a=this.device.createCommandEncoder({}),o=e.getBindGroupLayout(0);for(let h=0;h<r;++h){let l=t.createView({baseMipLevel:0,mipLevelCount:1,dimension:"2d",baseArrayLayer:h,arrayLayerCount:1}),c=n?1:0;for(let u=1;u<t.mipLevelCount;++u){const d=i.createView({baseMipLevel:c++,mipLevelCount:1,dimension:"2d",baseArrayLayer:h,arrayLayerCount:1}),f=a.beginRenderPass({colorAttachments:[{view:d,storeOp:"store",loadOp:"clear",clearValue:{r:0,g:0,b:0,a:0}}]}),p=this.device.createBindGroup({layout:o,entries:[{binding:0,resource:this.sampler},{binding:1,resource:l}]});f.setPipeline(e),f.setBindGroup(0,p),f.draw(3,1,0,0),f.end(),l=d}}if(!n){const h={width:Math.ceil(t.width/2),height:Math.ceil(t.height/2),depthOrArrayLayers:r};for(let l=1;l<t.mipLevelCount;++l)a.copyTextureToTexture({texture:i,mipLevel:l-1},{texture:t,mipLevel:l},h),h.width=Math.ceil(h.width/2),h.height=Math.ceil(h.height/2)}return this.device.queue.submit([a.finish()]),n||i.destroy(),t}}class s0{constructor(){this.gpuSources={},this.gpuSamplers={},this.bindGroupHash={},this.textureViewHash={},this.managedTextureSources={},this.uploads={image:WT,buffer:$T}}contextChange(t){this.gpu=t}initSource(t){if(t.autoGenerateMipmaps){const r=Math.max(t.pixelWidth,t.pixelHeight);t.mipLevelCount=Math.floor(Math.log2(r))+1}const e={size:{width:t.pixelWidth,height:t.pixelHeight},format:t.format,sampleCount:t.sampleCount,mipLevelCount:t.mipLevelCount,dimension:t.dimension,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC},i=this.gpu.device.createTexture(e);return this.gpuSources[t.uid]=i,this.managedTextureSources[t.uid]=t,t.on("update",this.onSourceUpdate,this),t.on("destroy",this.onSourceDestroy,this),t.on("resize",this.onSourceResize,this),this.onSourceUpdate(t),i}onSourceUpdate(t){const e=this.gpuSources[t.uid];e&&(this.uploads[t.type]&&this.uploads[t.type].upload(t,e,this.gpu),t.autoGenerateMipmaps&&t.mipLevelCount>1&&(this.mipmapGenerator||(this.mipmapGenerator=new YT(this.gpu.device)),this.mipmapGenerator.generateMipmap(e)))}onSourceDestroy(t){t.off("update",this.onSourceUpdate,this),t.off("destroy",this.onSourceDestroy,this),t.off("resize",this.onSourceResize,this);const e=this.gpuSources[t.uid];delete this.gpuSources[t.uid],e.destroy()}onSourceResize(t){const e=this.gpuSources[t.uid];(e.width!==t.pixelWidth||e.height!==t.pixelHeight)&&(this.gpuSources[t.uid].destroy(),this.gpuSources[t.uid]=null,this.initSource(t))}initSampler(t){return this.gpuSamplers[t.resourceId]=this.gpu.device.createSampler(t),this.gpuSamplers[t.resourceId]}getGpuSampler(t){return this.gpuSamplers[t.resourceId]||this.initSampler(t)}getGpuSource(t){return this.gpuSources[t.uid]||this.initSource(t)}getTextureBindGroup(t){return this.bindGroupHash[t.id]??this.createTextureBindGroup(t)}createTextureBindGroup(t){const e=t.id;return this.bindGroupHash[e]=new Ni({0:t.source,1:t.style}),this.bindGroupHash[e]}getTextureView(t){const e=t.source;return this.textureViewHash[e.uid]??this.createTextureView(e)}createTextureView(t){return this.textureViewHash[t.uid]=this.getGpuSource(t).createView(),this.textureViewHash[t.uid]}destroy(){throw new Error("Method not implemented.")}}s0.extension={type:[L.WebGPUSystem],name:"texture"};const jT=[...Gg,jg,Wg,s0,t0,qg,e0,i0,Qg,Yg,Kg,$g],qT=[...Vg,Zg,Jg],KT=[Im,tg,Vm],r0=[],n0=[],a0=[];$t.handleByNamedList(L.WebGPUSystem,r0);$t.handleByNamedList(L.WebGPUPipes,n0);$t.handleByNamedList(L.WebGPUPipesAdaptor,a0);$t.add(...jT,...qT,...KT);class ZT extends yg{constructor(){const t={type:"webgpu",systems:r0,renderPipes:n0,renderPipeAdaptors:a0};super(t)}}const JT=Object.freeze(Object.defineProperty({__proto__:null,WebGPURenderer:ZT},Symbol.toStringTag,{value:"Module"}));let QT=0;const tS={canvas:"text",html:"text",bitmap:"bitmapText"},Va=class{constructor(s){this.uid=QT++,this.batched=!0,this.type="text",this.owner=oa,this._bounds=[0,1,0,0],this.boundsDirty=!0,this._autoResolution=Va.defaultAutoResolution,this._resolution=Va.defaultResolution,this.didUpdate=!0,this.text=s.text??"",this._style=s.style instanceof Ys?s.style:new Ys(s.style);const t=s.renderMode??this.detectRenderType(this._style);this.type=tS[t],this.anchor=new ye(this,0,0),this._resolution=s.resolution??Va.defaultResolution}set text(s){s=s.toString(),this._text!==s&&(this._text=s,this.onUpdate())}get text(){return this._text}get style(){return this._style}set style(s){var t;s=s||{},(t=this._style)==null||t.off("update",this.onUpdate,this),s instanceof Ys?this._style=s:this._style=new Ys(s),this._style.on("update",this.onUpdate,this),this.onUpdate()}set resolution(s){this._resolution=s}get resolution(){return this._resolution}get bounds(){return this.boundsDirty&&(this.updateBounds(),this.boundsDirty=!1),this._bounds}updateBounds(){const s=this._bounds;if(this.type==="bitmapText"){const t=Bg.measureText(this.text,this._style),e=t.scale,i=t.offsetY*e;s[0]=0,s[1]=i,s[2]=t.width*e,s[3]=t.height*e+i}else{const t=se.measureText(this.text,this._style);s[0]=0,s[1]=0,s[2]=t.width,s[3]=t.height}}addBounds(s){const t=this.bounds;s.addFrame(t[0],t[1],t[2],t[3])}onUpdate(){this.didUpdate=!0,this.boundsDirty=!0,this.owner.onViewUpdate()}_getKey(){return`${this.text}:${this._style.styleKey}`}containsPoint(s){const t=this.bounds[2],e=this.bounds[3],i=-t*this.anchor.x;let r=0;return s.x>=i&&s.x<i+t&&(r=-e*this.anchor.y,s.y>=r&&s.y<r+e)}detectRenderType(s){return je.has(s.fontFamily)?"bitmap":"canvas"}destroy(s=!1){this.owner=null,this._bounds=null,this.anchor=null,this._style.destroy(s),this._style=null,this._text=null}};let Qc=Va;Qc.defaultResolution=1;Qc.defaultAutoResolution=!0;class qr extends W{constructor(t){super({view:new Qc(t),label:"Text",...t})}get anchor(){return this.view.anchor}set text(t){this.view.text=t}get text(){return this.view.text}set style(t){this.view.style=t}get style(){return this.view.style}}var zh=/iPhone/i,Ed=/iPod/i,Pd=/iPad/i,Md=/\biOS-universal(?:.+)Mac\b/i,Hh=/\bAndroid(?:.+)Mobile\b/i,kd=/Android/i,pr=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,_a=/Silk/i,Xi=/Windows Phone/i,Rd=/\bWindows(?:.+)ARM\b/i,Bd=/BlackBerry/i,Id=/BB10/i,Fd=/Opera Mini/i,Ud=/\b(CriOS|Chrome)(?:.+)Mobile/i,Ld=/Mobile(?:.+)Firefox\b/i,Od=function(s){return typeof s<"u"&&s.platform==="MacIntel"&&typeof s.maxTouchPoints=="number"&&s.maxTouchPoints>1&&typeof MSStream>"u"};function eS(s){return function(t){return t.test(s)}}function Nd(s){var t={userAgent:"",platform:"",maxTouchPoints:0};!s&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof s=="string"?t.userAgent=s:s&&s.userAgent&&(t={userAgent:s.userAgent,platform:s.platform,maxTouchPoints:s.maxTouchPoints||0});var e=t.userAgent,i=e.split("[FBAN");typeof i[1]<"u"&&(e=i[0]),i=e.split("Twitter"),typeof i[1]<"u"&&(e=i[0]);var r=eS(e),n={apple:{phone:r(zh)&&!r(Xi),ipod:r(Ed),tablet:!r(zh)&&(r(Pd)||Od(t))&&!r(Xi),universal:r(Md),device:(r(zh)||r(Ed)||r(Pd)||r(Md)||Od(t))&&!r(Xi)},amazon:{phone:r(pr),tablet:!r(pr)&&r(_a),device:r(pr)||r(_a)},android:{phone:!r(Xi)&&r(pr)||!r(Xi)&&r(Hh),tablet:!r(Xi)&&!r(pr)&&!r(Hh)&&(r(_a)||r(kd)),device:!r(Xi)&&(r(pr)||r(_a)||r(Hh)||r(kd))||r(/\bokhttp\b/i)},windows:{phone:r(Xi),tablet:r(Rd),device:r(Xi)||r(Rd)},other:{blackberry:r(Bd),blackberry10:r(Id),opera:r(Fd),firefox:r(Ld),chrome:r(Ud),device:r(Bd)||r(Id)||r(Fd)||r(Ld)||r(Ud)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}const iS=Nd.default??Nd,za=iS(globalThis.navigator);let sS=class{constructor({matrix:t,observer:e}={}){this.dirty=!0,this._matrix=t??new it,this.observer=e,this.position=new ye(this,0,0),this.scale=new ye(this,1,1),this.pivot=new ye(this,0,0),this.skew=new ye(this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1}get matrix(){const t=this._matrix;return this.dirty&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this.dirty=!1),t}onUpdate(t){var e;this.dirty=!0,t===this.skew&&this.updateSkew(),(e=this.observer)==null||e.onUpdate(this)}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this.dirty=!0}toString(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}setFromMatrix(t){t.decompose(this),this.dirty=!0}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())}},rS=0;const o0=class{constructor(s){this.batched=!0,this.owner=oa,this.uid=rS++,this.type="tilingSprite",this.onRenderableUpdate=eo,this._bounds=[0,1,0,0],this.boundsDirty=!0,s={...o0.defaultOptions,...s},this.anchor=new ye(this,0,0),this.applyAnchorToTexture=s.applyAnchorToTexture,this.texture=s.texture,this._width=s.width,this._height=s.height,this.tileTransform=new sS({observer:this})}get bounds(){return this.boundsDirty&&(this.updateBounds(),this.boundsDirty=!1),this._bounds}updateBounds(){const s=this._bounds,t=this.anchor,e=this._width,i=this._height;s[1]=-t._x*e,s[0]=s[1]+e,s[3]=-t._y*i,s[2]=s[3]+i}addBounds(s){const t=this.bounds;s.addFrame(t[0],t[2],t[1],t[3])}set texture(s){this._texture!==s&&(this._texture=s,this.onUpdate())}get texture(){return this._texture}set width(s){this._width=s,this.onUpdate()}get width(){return this._width}set height(s){this._height=s,this.onUpdate()}get height(){return this._height}onUpdate(){this.boundsDirty=!0,this.didUpdate=!0,this.owner.onViewUpdate()}containsPoint(s){const t=this.bounds[2],e=this.bounds[3],i=-t*this.anchor.x;let r=0;return s.x>=i&&s.x<i+t&&(r=-e*this.anchor.y,s.y>=r&&s.y<r+e)}destroy(s=!1){if(this.onRenderableUpdate=eo,this.anchor=null,this.tileTransform=null,this._bounds=null,typeof s=="boolean"?s:s==null?void 0:s.texture){const e=typeof s=="boolean"?s:s==null?void 0:s.textureSource;this._texture.destroy(e)}this._texture=null}};let h0=o0;h0.defaultOptions={texture:j.WHITE,width:256,height:256,applyAnchorToTexture:!1};class nS extends W{constructor(t){super({view:new h0(t),label:"TilingSprite",...t})}set texture(t){this.view.texture=t}get texture(){return this.view.texture}get anchor(){return this.view.anchor}get width(){return this.view.width}set width(t){this.view.width=t}get height(){return this.view.height}set height(t){this.view.height=t}get tilePosition(){return this.view.tileTransform.position}set tilePosition(t){this.view.tileTransform.position.copyFrom(t)}get tileScale(){return this.view.tileTransform.scale}set tileScale(t){this.view.tileTransform.scale.copyFrom(t)}set tileRotation(t){this.view.tileTransform.rotation=t}get tileRotation(){return this.view.tileTransform.rotation}get tileTransform(){return this.view.tileTransform}}const ji=class extends Sy{constructor(e){super(e.resource);A(this,"texture");this.texture=j.from(e)}static from(e){return ji.textureMap.has(e)?ji.textureMap.get(e):new ji(e)}setFilters(e,i){this.texture.style.minFilter=ji.toPixiTextureFilter(e),this.texture.style.magFilter=ji.toPixiTextureFilter(i)}setWraps(e,i){this.texture.style.addressModeU=ji.toPixiTextureWrap(e),this.texture.style.addressModeV=ji.toPixiTextureWrap(i)}dispose(){this.texture.destroy()}static toPixiTextureFilter(e){switch(e){case Ye.Nearest:case Ye.MipMapNearestLinear:case Ye.MipMapNearestNearest:return"nearest";case Ye.Linear:case Ye.MipMapLinearLinear:case Ye.MipMapLinearNearest:return"linear";default:throw new Error(`Unknown texture filter: ${String(e)}`)}}static toPixiTextureWrap(e){switch(e){case Qi.ClampToEdge:return"clamp-to-edge";case Qi.MirroredRepeat:return"mirror-repeat";case Qi.Repeat:return"repeat";default:throw new Error(`Unknown texture wrap: ${String(e)}`)}}static toPixiBlending(e){switch(e){case ms.Normal:return"normal";case ms.Additive:return"add";case ms.Multiply:return"multiply";case ms.Screen:return"screen";default:throw new Error(`Unknown blendMode: ${String(e)}`)}}};let Lr=ji;A(Lr,"textureMap",new Map);const aS={extension:L.Asset,loader:{extension:{type:L.LoadParser,priority:zi.Normal,name:"spineTextureAtlasLoader"},test(s){return Ii(s,".atlas")},async load(s){return await(await Tt.ADAPTER.fetch(s)).text()},testParse(s,t){const e=Ii(t.src,".atlas"),i=typeof s=="string";return Promise.resolve(e&&i)},unload(s){s.dispose()},async parse(s,t,e){const i=t.data||{};let r=de.dirname(t.src);r&&r.lastIndexOf("/")!==r.length-1&&(r+="/");const n=new Ay(s);if(i.images instanceof vi||typeof i.images=="string"){const o=i.images;i.images={},i.images[n.pages[0].name]=o}const a=[];for(const o of n.pages){const h=o.name,l=i!=null&&i.images?i.images[h]:void 0;if(l instanceof vi)o.setTexture(Lr.from(l));else{const c=l??de.normalize([...r.split(de.sep),h].join(de.sep)),u=e.load({src:c,data:i.imageMetadata}).then(d=>{o.setTexture(Lr.from(d.source))});a.push(u)}}return await Promise.all(a),console.log("GOT HITS FAR!s"),n}}};$t.add(aS);function oS(s){return s.hasOwnProperty("bones")}function hS(s){return s instanceof Uint8Array}const lS={extension:L.Asset,loader:{extension:{type:L.LoadParser,priority:zi.Normal},test(s){return Ii(s,".skel")},async load(s){const t=await Tt.ADAPTER.fetch(s),e=new Uint8Array(await t.arrayBuffer());return console.log("<>>>"),e},testParse(s,t){const e=Ii(t.src,".json")&&oS(s),i=Ii(t.src,".skel")&&hS(s);return Promise.resolve(e||i)}}};$t.add(lS);if(window.PIXI){let s=window.require;window.require=t=>{if(s)return s(t);if(t.startsWith("@pixi/"))return window.PIXI}}const Rr=class extends qw{constructor(){const e=new Oo;console.log("NEW MESH BABY!");super({geometry:e,texture:j.EMPTY});A(this,"name","");A(this,"warnedTwoTint",!1)}updateFromSpineData(e,i,r,n,a,o,h,l){var d,f;this.texture=e.texture;const c=a/(l?12:8)*2;((d=this.geometry.getBuffer("aUV").data)==null?void 0:d.length)!==c&&(this.geometry.getBuffer("aUV").data=new Float32Array(c)),((f=this.geometry.getBuffer("aPosition").data)==null?void 0:f.length)!==c&&(this.geometry.getBuffer("aPosition").data=new Float32Array(c));let u=0;for(let p=0;p<a;p+=l?12:8){let m=p;this.geometry.getBuffer("aPosition").data[u]=n[m++],this.geometry.getBuffer("aPosition").data[u+1]=n[m++],m+=4,this.geometry.getBuffer("aUV").data[u]=n[m++],this.geometry.getBuffer("aUV").data[u+1]=n[m++],u+=2}if(l&&!this.warnedTwoTint&&(console.warn("DarkTint is not enabled by default. To enable use a DarkSlotMesh factory while creating the Spine object."),this.warnedTwoTint=!0),Rr.auxColor[0]=n[2],Rr.auxColor[1]=n[3],Rr.auxColor[2]=n[4],Rr.auxColor[3]=n[5],this.tint=16777215,this.blendMode=Lr.toPixiBlending(i),this.geometry.indexBuffer.data.length!==o.length)this.geometry.indexBuffer.data=new Uint32Array(o);else for(let p=0;p<h;p++)this.geometry.indexBuffer.data[p]=o[p];this.name=r,this.geometry.getBuffer("aPosition").update(),this.geometry.getBuffer("aUV").update(),this.geometry.indexBuffer.update()}};let Ha=Rr;A(Ha,"auxColor",[0,0,0,0]);const Ot=class extends W{constructor(e,i){super();A(this,"skeleton");A(this,"state");A(this,"_debug");A(this,"slotMeshFactory");A(this,"autoUpdateWarned",!1);A(this,"_autoUpdate",!0);A(this,"meshesCache",new Map);A(this,"lightColor",new tt);A(this,"darkColor",new tt);A(this,"verticesCache",Y.newFloatArray(1024));this.skeleton=new na(e);const r=new Ty(e);this.state=new Ir(r),this.autoUpdate=(i==null?void 0:i.autoUpdate)??!0,this.slotMeshFactory=(i==null?void 0:i.slotMeshFactory)??(()=>new Ha),this.onRender=()=>{this.updateTransform()}}get debug(){return this._debug}set debug(e){this._debug&&this._debug.unregisterSpine(this),e&&e.registerSpine(this),this._debug=e}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e?(ts.shared.add(this.internalUpdate,this),this.autoUpdateWarned=!1):ts.shared.remove(this.internalUpdate,this),this._autoUpdate=e}update(e){this.autoUpdate&&!this.autoUpdateWarned&&(console.warn("You are calling update on a Spine instance that has autoUpdate set to true. This is probably not what you want."),this.autoUpdateWarned=!0),this.internalUpdate(0,e)}internalUpdate(e,i){this.state.update(i??ts.shared.deltaMS/1e3)}updateTransform(){var e;this.updateSpineTransform(),(e=this.debug)==null||e.renderDebug(this)}updateSpineTransform(){this.state.apply(this.skeleton),this.skeleton.updateWorldTransform(),this.updateGeometry()}destroy(e){for(const[,i]of this.meshesCache)i==null||i.destroy();this.state.clearListeners(),this.debug=void 0,this.meshesCache.clear(),super.destroy(e)}resetMeshes(){for(const[,e]of this.meshesCache)e.zIndex=-1,e.visible=!1}getMeshForSlot(e){if(!this.meshesCache.has(e)){const r=this.slotMeshFactory();return this.addChild(r),this.meshesCache.set(e,r),r}const i=this.meshesCache.get(e);return i.visible=!0,i}updateGeometry(){var n,a;this.resetMeshes();let e=null,i=null;const r=this.skeleton.drawOrder;for(let o=0,h=r.length;o<h;o++){const l=r[o],c=l.darkColor!=null,u=Ot.clipper.isClipping()?2:c?Ot.DARK_VERTEX_SIZE:Ot.VERTEX_SIZE;if(!l.bone.active){Ot.clipper.clipEndWithSlot(l);continue}const d=l.getAttachment();let f,p,m=0;if(d instanceof ct){const g=d;f=g.color,m=u*4,g.computeWorldVertices(l,this.verticesCache,0,u),e=Ot.QUAD_TRIANGLES,i=g.uvs,p=(n=g.region)==null?void 0:n.texture}else if(d instanceof Qs){const g=d;f=g.color,m=(g.worldVerticesLength>>1)*u,m>this.verticesCache.length&&(this.verticesCache=Y.newFloatArray(m)),g.computeWorldVertices(l,0,g.worldVerticesLength,this.verticesCache,0,u),e=g.triangles,i=g.uvs,p=(a=g.region)==null?void 0:a.texture}else if(d instanceof ko){Ot.clipper.clipStart(l,d);continue}else{Ot.clipper.clipEndWithSlot(l);continue}if(p!=null){const x=l.bone.skeleton.color,y=l.color,b=x.a*y.a*f.a;this.lightColor.set(x.r*y.r*f.r,x.g*y.g*f.g,x.b*y.b*f.b,b),l.darkColor!=null?this.darkColor.setFromColor(l.darkColor):this.darkColor.set(0,0,0,0);let v,_,w,T;if(Ot.clipper.isClipping())Ot.clipper.clipTriangles(this.verticesCache,m,e,e.length,i,this.lightColor,this.darkColor,c),v=Ot.clipper.clippedVertices,_=v.length,w=Ot.clipper.clippedTriangles,T=w.length;else{const C=this.verticesCache;for(let E=2,M=0,N=m;E<N;E+=u,M+=2){let R=E;C[R++]=this.lightColor.r,C[R++]=this.lightColor.g,C[R++]=this.lightColor.b,C[R++]=this.lightColor.a,C[R++]=i[M],C[R++]=i[M+1],c&&(C[R++]=this.darkColor.r,C[R++]=this.darkColor.g,C[R++]=this.darkColor.b)}v=this.verticesCache,_=m,w=e,T=e.length}if(_==0||T==0){Ot.clipper.clipEndWithSlot(l);continue}const S=this.getMeshForSlot(l);S.zIndex=o,S.updateFromSpineData(p,l.data.blendMode,l.data.name,v,_,w,T,c)}Ot.clipper.clipEndWithSlot(l)}Ot.clipper.clipEnd()}setBonePosition(e,i){const r=e;if(typeof e=="string"&&(e=this.skeleton.findBone(e)),!e)throw Error(`Cant set bone position, bone ${String(r)} not found`);if(Ot.vectorAux.set(i.x,i.y),e.parent){const n=e.parent.worldToLocal(Ot.vectorAux);e.x=n.x,e.y=n.y}else e.x=Ot.vectorAux.x,e.y=Ot.vectorAux.y}getBonePosition(e,i){const r=e;return typeof e=="string"&&(e=this.skeleton.findBone(e)),e?(i||(i={x:0,y:0}),i.x=e.worldX,i.y=e.worldY,i):(console.error(`Cant set bone position! Bone ${String(r)} not found`),i)}static from(e,i,r){const n=`${e}-${i}-${(r==null?void 0:r.scale)??1}`;let a=Ot.skeletonCache[n];if(a)return new Ot(a,r);const o=Ri.get(e),h=Ri.get(i),l=new My(h),c=o instanceof Uint8Array?new Iy(l):new rx(l);return c.scale=(r==null?void 0:r.scale)??1,a=c.readSkeletonData(o),Ot.skeletonCache[n]=a,new this(a,r)}};let Ei=Ot;A(Ei,"vectorAux",new Ja),A(Ei,"clipper",new to),A(Ei,"QUAD_TRIANGLES",[0,1,2,2,3,0]),A(Ei,"VERTEX_SIZE",2+2+4),A(Ei,"DARK_VERTEX_SIZE",2+2+4+4),A(Ei,"skeletonCache",Object.create(null));na.yDown=!0;let Xa={bundles:[]};const Vl=[];function cS(s){return!!Xa.bundles.find(t=>t.name===s)}async function l0(s){typeof s=="string"&&(s=[s]);for(const e of s)if(!cS(e))throw new Error(`[Assets] Invalid bundle: ${e}`);const t=s.filter(e=>!Vl.includes(e));t.length&&(console.log("[Assets] Load:",t.join(", ")),await Ri.loadBundle(t),Vl.push(...t))}function uS(s){for(const t of s)if(!Vl.includes(t))return!1;return!0}async function dS(s){const e=await(await fetch(s)).json();if(!e.bundles)throw new Error("[Assets] Invalid assets manifest");return e}async function fS(){Xa=await dS("assets/assets-manifest.json"),await Ri.init({manifest:Xa,basePath:"assets"}),await l0("preload");const s=Xa.bundles.map(t=>t.name);Ri.backgroundLoadBundle(s)}class pS{constructor(t){A(this,"ctor");A(this,"list",[]);this.ctor=t}get(){return this.list.pop()??new this.ctor}giveBack(t){this.list.includes(t)||this.list.push(t)}}class mS{constructor(){A(this,"map",new Map)}get(t){let e=this.map.get(t);return e||(e=new pS(t),this.map.set(t,e)),e.get()}giveBack(t){const e=this.map.get(t.constructor);e&&e.giveBack(t)}}const ci=new mS;class gS{constructor(){A(this,"container",new W);A(this,"width",0);A(this,"height",0);A(this,"background");A(this,"currentScreen");A(this,"currentPopup")}setBackground(t){this.background=new t,this.addAndShowScreen(this.background)}async addAndShowScreen(t){this.container.parent||Ct.stage.addChild(this.container),this.container.addChild(t),t.prepare&&t.prepare(),t.resize&&t.resize(this.width,this.height),t.update&&Ct.ticker.add(t.update,t),t.show&&(t.interactiveChildren=!1,await t.show(),t.interactiveChildren=!0)}async hideAndRemoveScreen(t){t.interactiveChildren=!1,t.hide&&await t.hide(),t.update&&Ct.ticker.remove(t.update,t),t.parent&&t.parent.removeChild(t),t.reset&&t.reset()}async showScreen(t){this.currentScreen&&(this.currentScreen.interactiveChildren=!1),t.assetBundles&&!uS(t.assetBundles)&&await l0(t.assetBundles),this.currentScreen&&await this.hideAndRemoveScreen(this.currentScreen),this.currentScreen=ci.get(t),await this.addAndShowScreen(this.currentScreen)}resize(t,e){var i,r,n,a,o,h;this.width=t,this.height=e,(r=(i=this.currentScreen)==null?void 0:i.resize)==null||r.call(i,t,e),(a=(n=this.currentPopup)==null?void 0:n.resize)==null||a.call(n,t,e),(h=(o=this.background)==null?void 0:o.resize)==null||h.call(o,t,e)}async presentPopup(t){var e,i;this.currentScreen&&(this.currentScreen.interactiveChildren=!1,await((i=(e=this.currentScreen).pause)==null?void 0:i.call(e))),this.currentPopup&&await this.hideAndRemoveScreen(this.currentPopup),this.currentPopup=new t,await this.addAndShowScreen(this.currentPopup)}async dismissPopup(){var e,i;if(!this.currentPopup)return;const t=this.currentPopup;this.currentPopup=void 0,await this.hideAndRemoveScreen(t),this.currentScreen&&(this.currentScreen.interactiveChildren=!0,(i=(e=this.currentScreen).resume)==null||i.call(e))}blur(){var t,e,i,r,n,a;(e=(t=this.currentScreen)==null?void 0:t.blur)==null||e.call(t),(r=(i=this.currentPopup)==null?void 0:i.blur)==null||r.call(i),(a=(n=this.background)==null?void 0:n.blur)==null||a.call(n)}focus(){var t,e,i,r,n,a;(e=(t=this.currentScreen)==null?void 0:t.focus)==null||e.call(t),(r=(i=this.currentPopup)==null?void 0:i.focus)==null||r.call(i),(a=(n=this.background)==null?void 0:n.focus)==null||a.call(n)}}const et=new gS;function Yi(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function c0(s,t){s.prototype=Object.create(t.prototype),s.prototype.constructor=s,s.__proto__=t}/*!
 * GSAP 3.11.4
 * https://greensock.com
 *
 * @license Copyright 2008-2022, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var De={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},Kr={duration:.5,overwrite:!1,delay:0},tu,xe,Kt,qe=1e8,kt=1/qe,zl=Math.PI*2,bS=zl/4,yS=0,u0=Math.sqrt,xS=Math.cos,vS=Math.sin,oe=function(t){return typeof t=="string"},Xt=function(t){return typeof t=="function"},ss=function(t){return typeof t=="number"},eu=function(t){return typeof t>"u"},Di=function(t){return typeof t=="object"},ke=function(t){return t!==!1},d0=function(){return typeof window<"u"},wa=function(t){return Xt(t)||oe(t)},f0=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},ve=Array.isArray,Hl=/(?:-?\.?\d|\.)+/gi,p0=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,Ar=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,Xh=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,m0=/[+-]=-?[.\d]+/,g0=/[^,'"\[\]\s]+/gi,_S=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,Gt,Xe,Xl,iu,Ge={},uo={},b0,y0=function(t){return(uo=sr(t,Ge))&&Ve},su=function(t,e){return console.warn("Invalid property",t,"set to",e,"Missing plugin? gsap.registerPlugin()")},fo=function(t,e){return!e&&console.warn(t)},x0=function(t,e){return t&&(Ge[t]=e)&&uo&&(uo[t]=e)||Ge},Xn=function(){return 0},wS={suppressEvents:!0,isStart:!0,kill:!1},$a={suppressEvents:!0,kill:!1},TS={suppressEvents:!0},ru={},_s=[],$l={},v0,Oe={},$h={},Dd=30,Wa=[],nu="",au=function(t){var e=t[0],i,r;if(Di(e)||Xt(e)||(t=[t]),!(i=(e._gsap||{}).harness)){for(r=Wa.length;r--&&!Wa[r].targetTest(e););i=Wa[r]}for(r=t.length;r--;)t[r]&&(t[r]._gsap||(t[r]._gsap=new z0(t[r],i)))||t.splice(r,1);return t},Ks=function(t){return t._gsap||au(Ke(t))[0]._gsap},_0=function(t,e,i){return(i=t[e])&&Xt(i)?t[e]():eu(i)&&t.getAttribute&&t.getAttribute(e)||i},Re=function(t,e){return(t=t.split(",")).forEach(e)||t},Wt=function(t){return Math.round(t*1e5)/1e5||0},ce=function(t){return Math.round(t*1e7)/1e7||0},Or=function(t,e){var i=e.charAt(0),r=parseFloat(e.substr(2));return t=parseFloat(t),i==="+"?t+r:i==="-"?t-r:i==="*"?t*r:t/r},SS=function(t,e){for(var i=e.length,r=0;t.indexOf(e[r])<0&&++r<i;);return r<i},po=function(){var t=_s.length,e=_s.slice(0),i,r;for($l={},_s.length=0,i=0;i<t;i++)r=e[i],r&&r._lazy&&(r.render(r._lazy[0],r._lazy[1],!0)._lazy=0)},w0=function(t,e,i,r){_s.length&&!xe&&po(),t.render(e,i,r||xe&&e<0&&(t._initted||t._startAt)),_s.length&&!xe&&po()},T0=function(t){var e=parseFloat(t);return(e||e===0)&&(t+"").match(g0).length<2?e:oe(t)?t.trim():t},S0=function(t){return t},ei=function(t,e){for(var i in e)i in t||(t[i]=e[i]);return t},CS=function(t){return function(e,i){for(var r in i)r in e||r==="duration"&&t||r==="ease"||(e[r]=i[r])}},sr=function(t,e){for(var i in e)t[i]=e[i];return t},Gd=function s(t,e){for(var i in e)i!=="__proto__"&&i!=="constructor"&&i!=="prototype"&&(t[i]=Di(e[i])?s(t[i]||(t[i]={}),e[i]):e[i]);return t},mo=function(t,e){var i={},r;for(r in t)r in e||(i[r]=t[r]);return i},Rn=function(t){var e=t.parent||Gt,i=t.keyframes?CS(ve(t.keyframes)):ei;if(ke(t.inherit))for(;e;)i(t,e.vars.defaults),e=e.parent||e._dp;return t},AS=function(t,e){for(var i=t.length,r=i===e.length;r&&i--&&t[i]===e[i];);return i<0},C0=function(t,e,i,r,n){i===void 0&&(i="_first"),r===void 0&&(r="_last");var a=t[r],o;if(n)for(o=e[n];a&&a[n]>o;)a=a._prev;return a?(e._next=a._next,a._next=e):(e._next=t[i],t[i]=e),e._next?e._next._prev=e:t[r]=e,e._prev=a,e.parent=e._dp=t,e},zo=function(t,e,i,r){i===void 0&&(i="_first"),r===void 0&&(r="_last");var n=e._prev,a=e._next;n?n._next=a:t[i]===e&&(t[i]=a),a?a._prev=n:t[r]===e&&(t[r]=n),e._next=e._prev=e.parent=null},Ts=function(t,e){t.parent&&(!e||t.parent.autoRemoveChildren)&&t.parent.remove(t),t._act=0},Zs=function(t,e){if(t&&(!e||e._end>t._dur||e._start<0))for(var i=t;i;)i._dirty=1,i=i.parent;return t},ES=function(t){for(var e=t.parent;e&&e.parent;)e._dirty=1,e.totalDuration(),e=e.parent;return t},Wl=function(t,e,i,r){return t._startAt&&(xe?t._startAt.revert($a):t.vars.immediateRender&&!t.vars.autoRevert||t._startAt.render(e,!0,r))},PS=function s(t){return!t||t._ts&&s(t.parent)},Vd=function(t){return t._repeat?Zr(t._tTime,t=t.duration()+t._rDelay)*t:0},Zr=function(t,e){var i=Math.floor(t/=e);return t&&i===t?i-1:i},go=function(t,e){return(t-e._start)*e._ts+(e._ts>=0?0:e._dirty?e.totalDuration():e._tDur)},Ho=function(t){return t._end=ce(t._start+(t._tDur/Math.abs(t._ts||t._rts||kt)||0))},Xo=function(t,e){var i=t._dp;return i&&i.smoothChildTiming&&t._ts&&(t._start=ce(i._time-(t._ts>0?e/t._ts:((t._dirty?t.totalDuration():t._tDur)-e)/-t._ts)),Ho(t),i._dirty||Zs(i,t)),t},A0=function(t,e){var i;if((e._time||e._initted&&!e._dur)&&(i=go(t.rawTime(),e),(!e._dur||la(0,e.totalDuration(),i)-e._tTime>kt)&&e.render(i,!0)),Zs(t,e)._dp&&t._initted&&t._time>=t._dur&&t._ts){if(t._dur<t.duration())for(i=t;i._dp;)i.rawTime()>=0&&i.totalTime(i._tTime),i=i._dp;t._zTime=-kt}},Mi=function(t,e,i,r){return e.parent&&Ts(e),e._start=ce((ss(i)?i:i||t!==Gt?He(t,i,e):t._time)+e._delay),e._end=ce(e._start+(e.totalDuration()/Math.abs(e.timeScale())||0)),C0(t,e,"_first","_last",t._sort?"_start":0),Yl(e)||(t._recent=e),r||A0(t,e),t._ts<0&&Xo(t,t._tTime),t},E0=function(t,e){return(Ge.ScrollTrigger||su("scrollTrigger",e))&&Ge.ScrollTrigger.create(e,t)},P0=function(t,e,i,r,n){if(hu(t,e,n),!t._initted)return 1;if(!i&&t._pt&&!xe&&(t._dur&&t.vars.lazy!==!1||!t._dur&&t.vars.lazy)&&v0!==Ne.frame)return _s.push(t),t._lazy=[n,r],1},MS=function s(t){var e=t.parent;return e&&e._ts&&e._initted&&!e._lock&&(e.rawTime()<0||s(e))},Yl=function(t){var e=t.data;return e==="isFromStart"||e==="isStart"},kS=function(t,e,i,r){var n=t.ratio,a=e<0||!e&&(!t._start&&MS(t)&&!(!t._initted&&Yl(t))||(t._ts<0||t._dp._ts<0)&&!Yl(t))?0:1,o=t._rDelay,h=0,l,c,u;if(o&&t._repeat&&(h=la(0,t._tDur,e),c=Zr(h,o),t._yoyo&&c&1&&(a=1-a),c!==Zr(t._tTime,o)&&(n=1-a,t.vars.repeatRefresh&&t._initted&&t.invalidate())),a!==n||xe||r||t._zTime===kt||!e&&t._zTime){if(!t._initted&&P0(t,e,r,i,h))return;for(u=t._zTime,t._zTime=e||(i?kt:0),i||(i=e&&!u),t.ratio=a,t._from&&(a=1-a),t._time=0,t._tTime=h,l=t._pt;l;)l.r(a,l.d),l=l._next;e<0&&Wl(t,e,i,!0),t._onUpdate&&!i&&Ze(t,"onUpdate"),h&&t._repeat&&!i&&t.parent&&Ze(t,"onRepeat"),(e>=t._tDur||e<0)&&t.ratio===a&&(a&&Ts(t,1),!i&&!xe&&(Ze(t,a?"onComplete":"onReverseComplete",!0),t._prom&&t._prom()))}else t._zTime||(t._zTime=e)},RS=function(t,e,i){var r;if(i>e)for(r=t._first;r&&r._start<=i;){if(r.data==="isPause"&&r._start>e)return r;r=r._next}else for(r=t._last;r&&r._start>=i;){if(r.data==="isPause"&&r._start<e)return r;r=r._prev}},Jr=function(t,e,i,r){var n=t._repeat,a=ce(e)||0,o=t._tTime/t._tDur;return o&&!r&&(t._time*=a/t._dur),t._dur=a,t._tDur=n?n<0?1e10:ce(a*(n+1)+t._rDelay*n):a,o>0&&!r&&Xo(t,t._tTime=t._tDur*o),t.parent&&Ho(t),i||Zs(t.parent,t),t},zd=function(t){return t instanceof Pe?Zs(t):Jr(t,t._dur)},BS={_start:0,endTime:Xn,totalDuration:Xn},He=function s(t,e,i){var r=t.labels,n=t._recent||BS,a=t.duration()>=qe?n.endTime(!1):t._dur,o,h,l;return oe(e)&&(isNaN(e)||e in r)?(h=e.charAt(0),l=e.substr(-1)==="%",o=e.indexOf("="),h==="<"||h===">"?(o>=0&&(e=e.replace(/=/,"")),(h==="<"?n._start:n.endTime(n._repeat>=0))+(parseFloat(e.substr(1))||0)*(l?(o<0?n:i).totalDuration()/100:1)):o<0?(e in r||(r[e]=a),r[e]):(h=parseFloat(e.charAt(o-1)+e.substr(o+1)),l&&i&&(h=h/100*(ve(i)?i[0]:i).totalDuration()),o>1?s(t,e.substr(0,o-1),i)+h:a+h)):e==null?a:+e},Bn=function(t,e,i){var r=ss(e[1]),n=(r?2:1)+(t<2?0:1),a=e[n],o,h;if(r&&(a.duration=e[1]),a.parent=i,t){for(o=a,h=i;h&&!("immediateRender"in o);)o=h.vars.defaults||{},h=ke(h.vars.inherit)&&h.parent;a.immediateRender=ke(o.immediateRender),t<2?a.runBackwards=1:a.startAt=e[n-1]}return new ee(e[0],a,e[n+1])},Ps=function(t,e){return t||t===0?e(t):e},la=function(t,e,i){return i<t?t:i>e?e:i},be=function(t,e){return!oe(t)||!(e=_S.exec(t))?"":e[1]},IS=function(t,e,i){return Ps(i,function(r){return la(t,e,r)})},jl=[].slice,M0=function(t,e){return t&&Di(t)&&"length"in t&&(!e&&!t.length||t.length-1 in t&&Di(t[0]))&&!t.nodeType&&t!==Xe},FS=function(t,e,i){return i===void 0&&(i=[]),t.forEach(function(r){var n;return oe(r)&&!e||M0(r,1)?(n=i).push.apply(n,Ke(r)):i.push(r)})||i},Ke=function(t,e,i){return Kt&&!e&&Kt.selector?Kt.selector(t):oe(t)&&!i&&(Xl||!Qr())?jl.call((e||iu).querySelectorAll(t),0):ve(t)?FS(t,i):M0(t)?jl.call(t,0):t?[t]:[]},ql=function(t){return t=Ke(t)[0]||fo("Invalid scope")||{},function(e){var i=t.current||t.nativeElement||t;return Ke(e,i.querySelectorAll?i:i===t?fo("Invalid scope")||iu.createElement("div"):t)}},k0=function(t){return t.sort(function(){return .5-Math.random()})},R0=function(t){if(Xt(t))return t;var e=Di(t)?t:{each:t},i=Js(e.ease),r=e.from||0,n=parseFloat(e.base)||0,a={},o=r>0&&r<1,h=isNaN(r)||o,l=e.axis,c=r,u=r;return oe(r)?c=u={center:.5,edges:.5,end:1}[r]||0:!o&&h&&(c=r[0],u=r[1]),function(d,f,p){var m=(p||e).length,g=a[m],x,y,b,v,_,w,T,S,C;if(!g){if(C=e.grid==="auto"?0:(e.grid||[1,qe])[1],!C){for(T=-qe;T<(T=p[C++].getBoundingClientRect().left)&&C<m;);C--}for(g=a[m]=[],x=h?Math.min(C,m)*c-.5:r%C,y=C===qe?0:h?m*u/C-.5:r/C|0,T=0,S=qe,w=0;w<m;w++)b=w%C-x,v=y-(w/C|0),g[w]=_=l?Math.abs(l==="y"?v:b):u0(b*b+v*v),_>T&&(T=_),_<S&&(S=_);r==="random"&&k0(g),g.max=T-S,g.min=S,g.v=m=(parseFloat(e.amount)||parseFloat(e.each)*(C>m?m-1:l?l==="y"?m/C:C:Math.max(C,m/C))||0)*(r==="edges"?-1:1),g.b=m<0?n-m:n,g.u=be(e.amount||e.each)||0,i=i&&m<0?D0(i):i}return m=(g[d]-g.min)/g.max||0,ce(g.b+(i?i(m):m)*g.v)+g.u}},Kl=function(t){var e=Math.pow(10,((t+"").split(".")[1]||"").length);return function(i){var r=ce(Math.round(parseFloat(i)/t)*t*e);return(r-r%1)/e+(ss(i)?0:be(i))}},B0=function(t,e){var i=ve(t),r,n;return!i&&Di(t)&&(r=i=t.radius||qe,t.values?(t=Ke(t.values),(n=!ss(t[0]))&&(r*=r)):t=Kl(t.increment)),Ps(e,i?Xt(t)?function(a){return n=t(a),Math.abs(n-a)<=r?n:a}:function(a){for(var o=parseFloat(n?a.x:a),h=parseFloat(n?a.y:0),l=qe,c=0,u=t.length,d,f;u--;)n?(d=t[u].x-o,f=t[u].y-h,d=d*d+f*f):d=Math.abs(t[u]-o),d<l&&(l=d,c=u);return c=!r||l<=r?t[c]:a,n||c===a||ss(a)?c:c+be(a)}:Kl(t))},I0=function(t,e,i,r){return Ps(ve(t)?!e:i===!0?!!(i=0):!r,function(){return ve(t)?t[~~(Math.random()*t.length)]:(i=i||1e-5)&&(r=i<1?Math.pow(10,(i+"").length-2):1)&&Math.floor(Math.round((t-i/2+Math.random()*(e-t+i*.99))/i)*i*r)/r})},US=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return function(r){return e.reduce(function(n,a){return a(n)},r)}},LS=function(t,e){return function(i){return t(parseFloat(i))+(e||be(i))}},OS=function(t,e,i){return U0(t,e,0,1,i)},F0=function(t,e,i){return Ps(i,function(r){return t[~~e(r)]})},NS=function s(t,e,i){var r=e-t;return ve(t)?F0(t,s(0,t.length),e):Ps(i,function(n){return(r+(n-t)%r)%r+t})},DS=function s(t,e,i){var r=e-t,n=r*2;return ve(t)?F0(t,s(0,t.length-1),e):Ps(i,function(a){return a=(n+(a-t)%n)%n||0,t+(a>r?n-a:a)})},$n=function(t){for(var e=0,i="",r,n,a,o;~(r=t.indexOf("random(",e));)a=t.indexOf(")",r),o=t.charAt(r+7)==="[",n=t.substr(r+7,a-r-7).match(o?g0:Hl),i+=t.substr(e,r-e)+I0(o?n:+n[0],o?0:+n[1],+n[2]||1e-5),e=a+1;return i+t.substr(e,t.length-e)},U0=function(t,e,i,r,n){var a=e-t,o=r-i;return Ps(n,function(h){return i+((h-t)/a*o||0)})},GS=function s(t,e,i,r){var n=isNaN(t+e)?0:function(f){return(1-f)*t+f*e};if(!n){var a=oe(t),o={},h,l,c,u,d;if(i===!0&&(r=1)&&(i=null),a)t={p:t},e={p:e};else if(ve(t)&&!ve(e)){for(c=[],u=t.length,d=u-2,l=1;l<u;l++)c.push(s(t[l-1],t[l]));u--,n=function(p){p*=u;var m=Math.min(d,~~p);return c[m](p-m)},i=e}else r||(t=sr(ve(t)?[]:{},t));if(!c){for(h in e)ou.call(o,t,h,"get",e[h]);n=function(p){return uu(p,o)||(a?t.p:t)}}}return Ps(i,n)},Hd=function(t,e,i){var r=t.labels,n=qe,a,o,h;for(a in r)o=r[a]-e,o<0==!!i&&o&&n>(o=Math.abs(o))&&(h=a,n=o);return h},Ze=function(t,e,i){var r=t.vars,n=r[e],a=Kt,o=t._ctx,h,l,c;if(n)return h=r[e+"Params"],l=r.callbackScope||t,i&&_s.length&&po(),o&&(Kt=o),c=h?n.apply(l,h):n.call(l),Kt=a,c},Sn=function(t){return Ts(t),t.scrollTrigger&&t.scrollTrigger.kill(!!xe),t.progress()<1&&Ze(t,"onInterrupt"),t},Er,VS=function(t){t=!t.name&&t.default||t;var e=t.name,i=Xt(t),r=e&&!i&&t.init?function(){this._props=[]}:t,n={init:Xn,render:uu,add:ou,kill:sC,modifier:iC,rawVars:0},a={targetTest:0,get:0,getSetter:cu,aliases:{},register:0};if(Qr(),t!==r){if(Oe[e])return;ei(r,ei(mo(t,n),a)),sr(r.prototype,sr(n,mo(t,a))),Oe[r.prop=e]=r,t.targetTest&&(Wa.push(r),ru[e]=1),e=(e==="css"?"CSS":e.charAt(0).toUpperCase()+e.substr(1))+"Plugin"}x0(e,r),t.register&&t.register(Ve,r,Be)},Mt=255,Cn={aqua:[0,Mt,Mt],lime:[0,Mt,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,Mt],navy:[0,0,128],white:[Mt,Mt,Mt],olive:[128,128,0],yellow:[Mt,Mt,0],orange:[Mt,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[Mt,0,0],pink:[Mt,192,203],cyan:[0,Mt,Mt],transparent:[Mt,Mt,Mt,0]},Wh=function(t,e,i){return t+=t<0?1:t>1?-1:0,(t*6<1?e+(i-e)*t*6:t<.5?i:t*3<2?e+(i-e)*(2/3-t)*6:e)*Mt+.5|0},L0=function(t,e,i){var r=t?ss(t)?[t>>16,t>>8&Mt,t&Mt]:0:Cn.black,n,a,o,h,l,c,u,d,f,p;if(!r){if(t.substr(-1)===","&&(t=t.substr(0,t.length-1)),Cn[t])r=Cn[t];else if(t.charAt(0)==="#"){if(t.length<6&&(n=t.charAt(1),a=t.charAt(2),o=t.charAt(3),t="#"+n+n+a+a+o+o+(t.length===5?t.charAt(4)+t.charAt(4):"")),t.length===9)return r=parseInt(t.substr(1,6),16),[r>>16,r>>8&Mt,r&Mt,parseInt(t.substr(7),16)/255];t=parseInt(t.substr(1),16),r=[t>>16,t>>8&Mt,t&Mt]}else if(t.substr(0,3)==="hsl"){if(r=p=t.match(Hl),!e)h=+r[0]%360/360,l=+r[1]/100,c=+r[2]/100,a=c<=.5?c*(l+1):c+l-c*l,n=c*2-a,r.length>3&&(r[3]*=1),r[0]=Wh(h+1/3,n,a),r[1]=Wh(h,n,a),r[2]=Wh(h-1/3,n,a);else if(~t.indexOf("="))return r=t.match(p0),i&&r.length<4&&(r[3]=1),r}else r=t.match(Hl)||Cn.transparent;r=r.map(Number)}return e&&!p&&(n=r[0]/Mt,a=r[1]/Mt,o=r[2]/Mt,u=Math.max(n,a,o),d=Math.min(n,a,o),c=(u+d)/2,u===d?h=l=0:(f=u-d,l=c>.5?f/(2-u-d):f/(u+d),h=u===n?(a-o)/f+(a<o?6:0):u===a?(o-n)/f+2:(n-a)/f+4,h*=60),r[0]=~~(h+.5),r[1]=~~(l*100+.5),r[2]=~~(c*100+.5)),i&&r.length<4&&(r[3]=1),r},O0=function(t){var e=[],i=[],r=-1;return t.split(ws).forEach(function(n){var a=n.match(Ar)||[];e.push.apply(e,a),i.push(r+=a.length+1)}),e.c=i,e},Xd=function(t,e,i){var r="",n=(t+r).match(ws),a=e?"hsla(":"rgba(",o=0,h,l,c,u;if(!n)return t;if(n=n.map(function(d){return(d=L0(d,e,1))&&a+(e?d[0]+","+d[1]+"%,"+d[2]+"%,"+d[3]:d.join(","))+")"}),i&&(c=O0(t),h=i.c,h.join(r)!==c.c.join(r)))for(l=t.replace(ws,"1").split(Ar),u=l.length-1;o<u;o++)r+=l[o]+(~h.indexOf(o)?n.shift()||a+"0,0,0,0)":(c.length?c:n.length?n:i).shift());if(!l)for(l=t.split(ws),u=l.length-1;o<u;o++)r+=l[o]+n[o];return r+l[u]},ws=function(){var s="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",t;for(t in Cn)s+="|"+t+"\\b";return new RegExp(s+")","gi")}(),zS=/hsl[a]?\(/,N0=function(t){var e=t.join(" "),i;if(ws.lastIndex=0,ws.test(e))return i=zS.test(e),t[1]=Xd(t[1],i),t[0]=Xd(t[0],i,O0(t[1])),!0},Wn,Ne=function(){var s=Date.now,t=500,e=33,i=s(),r=i,n=1e3/240,a=n,o=[],h,l,c,u,d,f,p=function m(g){var x=s()-r,y=g===!0,b,v,_,w;if(x>t&&(i+=x-e),r+=x,_=r-i,b=_-a,(b>0||y)&&(w=++u.frame,d=_-u.time*1e3,u.time=_=_/1e3,a+=b+(b>=n?4:n-b),v=1),y||(h=l(m)),v)for(f=0;f<o.length;f++)o[f](_,d,w,g)};return u={time:0,frame:0,tick:function(){p(!0)},deltaRatio:function(g){return d/(1e3/(g||60))},wake:function(){b0&&(!Xl&&d0()&&(Xe=Xl=window,iu=Xe.document||{},Ge.gsap=Ve,(Xe.gsapVersions||(Xe.gsapVersions=[])).push(Ve.version),y0(uo||Xe.GreenSockGlobals||!Xe.gsap&&Xe||{}),c=Xe.requestAnimationFrame),h&&u.sleep(),l=c||function(g){return setTimeout(g,a-u.time*1e3+1|0)},Wn=1,p(2))},sleep:function(){(c?Xe.cancelAnimationFrame:clearTimeout)(h),Wn=0,l=Xn},lagSmoothing:function(g,x){t=g||1/0,e=Math.min(x||33,t)},fps:function(g){n=1e3/(g||240),a=u.time*1e3+n},add:function(g,x,y){var b=x?function(v,_,w,T){g(v,_,w,T),u.remove(b)}:g;return u.remove(g),o[y?"unshift":"push"](b),Qr(),b},remove:function(g,x){~(x=o.indexOf(g))&&o.splice(x,1)&&f>=x&&f--},_listeners:o},u}(),Qr=function(){return!Wn&&Ne.wake()},pt={},HS=/^[\d.\-M][\d.\-,\s]/,XS=/["']/g,$S=function(t){for(var e={},i=t.substr(1,t.length-3).split(":"),r=i[0],n=1,a=i.length,o,h,l;n<a;n++)h=i[n],o=n!==a-1?h.lastIndexOf(","):h.length,l=h.substr(0,o),e[r]=isNaN(l)?l.replace(XS,"").trim():+l,r=h.substr(o+1).trim();return e},WS=function(t){var e=t.indexOf("(")+1,i=t.indexOf(")"),r=t.indexOf("(",e);return t.substring(e,~r&&r<i?t.indexOf(")",i+1):i)},YS=function(t){var e=(t+"").split("("),i=pt[e[0]];return i&&e.length>1&&i.config?i.config.apply(null,~t.indexOf("{")?[$S(e[1])]:WS(t).split(",").map(T0)):pt._CE&&HS.test(t)?pt._CE("",t):i},D0=function(t){return function(e){return 1-t(1-e)}},G0=function s(t,e){for(var i=t._first,r;i;)i instanceof Pe?s(i,e):i.vars.yoyoEase&&(!i._yoyo||!i._repeat)&&i._yoyo!==e&&(i.timeline?s(i.timeline,e):(r=i._ease,i._ease=i._yEase,i._yEase=r,i._yoyo=e)),i=i._next},Js=function(t,e){return t&&(Xt(t)?t:pt[t]||YS(t))||e},ar=function(t,e,i,r){i===void 0&&(i=function(h){return 1-e(1-h)}),r===void 0&&(r=function(h){return h<.5?e(h*2)/2:1-e((1-h)*2)/2});var n={easeIn:e,easeOut:i,easeInOut:r},a;return Re(t,function(o){pt[o]=Ge[o]=n,pt[a=o.toLowerCase()]=i;for(var h in n)pt[a+(h==="easeIn"?".in":h==="easeOut"?".out":".inOut")]=pt[o+"."+h]=n[h]}),n},V0=function(t){return function(e){return e<.5?(1-t(1-e*2))/2:.5+t((e-.5)*2)/2}},Yh=function s(t,e,i){var r=e>=1?e:1,n=(i||(t?.3:.45))/(e<1?e:1),a=n/zl*(Math.asin(1/r)||0),o=function(c){return c===1?1:r*Math.pow(2,-10*c)*vS((c-a)*n)+1},h=t==="out"?o:t==="in"?function(l){return 1-o(1-l)}:V0(o);return n=zl/n,h.config=function(l,c){return s(t,l,c)},h},jh=function s(t,e){e===void 0&&(e=1.70158);var i=function(a){return a?--a*a*((e+1)*a+e)+1:0},r=t==="out"?i:t==="in"?function(n){return 1-i(1-n)}:V0(i);return r.config=function(n){return s(t,n)},r};Re("Linear,Quad,Cubic,Quart,Quint,Strong",function(s,t){var e=t<5?t+1:t;ar(s+",Power"+(e-1),t?function(i){return Math.pow(i,e)}:function(i){return i},function(i){return 1-Math.pow(1-i,e)},function(i){return i<.5?Math.pow(i*2,e)/2:1-Math.pow((1-i)*2,e)/2})});pt.Linear.easeNone=pt.none=pt.Linear.easeIn;ar("Elastic",Yh("in"),Yh("out"),Yh());(function(s,t){var e=1/t,i=2*e,r=2.5*e,n=function(o){return o<e?s*o*o:o<i?s*Math.pow(o-1.5/t,2)+.75:o<r?s*(o-=2.25/t)*o+.9375:s*Math.pow(o-2.625/t,2)+.984375};ar("Bounce",function(a){return 1-n(1-a)},n)})(7.5625,2.75);ar("Expo",function(s){return s?Math.pow(2,10*(s-1)):0});ar("Circ",function(s){return-(u0(1-s*s)-1)});ar("Sine",function(s){return s===1?1:-xS(s*bS)+1});ar("Back",jh("in"),jh("out"),jh());pt.SteppedEase=pt.steps=Ge.SteppedEase={config:function(t,e){t===void 0&&(t=1);var i=1/t,r=t+(e?0:1),n=e?1:0,a=1-kt;return function(o){return((r*la(0,a,o)|0)+n)*i}}};Kr.ease=pt["quad.out"];Re("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(s){return nu+=s+","+s+"Params,"});var z0=function(t,e){this.id=yS++,t._gsap=this,this.target=t,this.harness=e,this.get=e?e.get:_0,this.set=e?e.getSetter:cu},tn=function(){function s(e){this.vars=e,this._delay=+e.delay||0,(this._repeat=e.repeat===1/0?-2:e.repeat||0)&&(this._rDelay=e.repeatDelay||0,this._yoyo=!!e.yoyo||!!e.yoyoEase),this._ts=1,Jr(this,+e.duration,1,1),this.data=e.data,Kt&&(this._ctx=Kt,Kt.data.push(this)),Wn||Ne.wake()}var t=s.prototype;return t.delay=function(i){return i||i===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+i-this._delay),this._delay=i,this):this._delay},t.duration=function(i){return arguments.length?this.totalDuration(this._repeat>0?i+(i+this._rDelay)*this._repeat:i):this.totalDuration()&&this._dur},t.totalDuration=function(i){return arguments.length?(this._dirty=0,Jr(this,this._repeat<0?i:(i-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},t.totalTime=function(i,r){if(Qr(),!arguments.length)return this._tTime;var n=this._dp;if(n&&n.smoothChildTiming&&this._ts){for(Xo(this,i),!n._dp||n.parent||A0(n,this);n&&n.parent;)n.parent._time!==n._start+(n._ts>=0?n._tTime/n._ts:(n.totalDuration()-n._tTime)/-n._ts)&&n.totalTime(n._tTime,!0),n=n.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&i<this._tDur||this._ts<0&&i>0||!this._tDur&&!i)&&Mi(this._dp,this,this._start-this._delay)}return(this._tTime!==i||!this._dur&&!r||this._initted&&Math.abs(this._zTime)===kt||!i&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=i),w0(this,i,r)),this},t.time=function(i,r){return arguments.length?this.totalTime(Math.min(this.totalDuration(),i+Vd(this))%(this._dur+this._rDelay)||(i?this._dur:0),r):this._time},t.totalProgress=function(i,r){return arguments.length?this.totalTime(this.totalDuration()*i,r):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.ratio},t.progress=function(i,r){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-i:i)+Vd(this),r):this.duration()?Math.min(1,this._time/this._dur):this.ratio},t.iteration=function(i,r){var n=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(i-1)*n,r):this._repeat?Zr(this._tTime,n)+1:1},t.timeScale=function(i){if(!arguments.length)return this._rts===-kt?0:this._rts;if(this._rts===i)return this;var r=this.parent&&this._ts?go(this.parent._time,this):this._tTime;return this._rts=+i||0,this._ts=this._ps||i===-kt?0:this._rts,this.totalTime(la(-this._delay,this._tDur,r),!0),Ho(this),ES(this)},t.paused=function(i){return arguments.length?(this._ps!==i&&(this._ps=i,i?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Qr(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==kt&&(this._tTime-=kt)))),this):this._ps},t.startTime=function(i){if(arguments.length){this._start=i;var r=this.parent||this._dp;return r&&(r._sort||!this.parent)&&Mi(r,this,i-this._delay),this}return this._start},t.endTime=function(i){return this._start+(ke(i)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},t.rawTime=function(i){var r=this.parent||this._dp;return r?i&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?go(r.rawTime(i),this):this._tTime:this._tTime},t.revert=function(i){i===void 0&&(i=TS);var r=xe;return xe=i,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(i),this.totalTime(-.01,i.suppressEvents)),this.data!=="nested"&&i.kill!==!1&&this.kill(),xe=r,this},t.globalTime=function(i){for(var r=this,n=arguments.length?i:r.rawTime();r;)n=r._start+n/(r._ts||1),r=r._dp;return!this.parent&&this._sat?this._sat.vars.immediateRender?-1:this._sat.globalTime(i):n},t.repeat=function(i){return arguments.length?(this._repeat=i===1/0?-2:i,zd(this)):this._repeat===-2?1/0:this._repeat},t.repeatDelay=function(i){if(arguments.length){var r=this._time;return this._rDelay=i,zd(this),r?this.time(r):this}return this._rDelay},t.yoyo=function(i){return arguments.length?(this._yoyo=i,this):this._yoyo},t.seek=function(i,r){return this.totalTime(He(this,i),ke(r))},t.restart=function(i,r){return this.play().totalTime(i?-this._delay:0,ke(r))},t.play=function(i,r){return i!=null&&this.seek(i,r),this.reversed(!1).paused(!1)},t.reverse=function(i,r){return i!=null&&this.seek(i||this.totalDuration(),r),this.reversed(!0).paused(!1)},t.pause=function(i,r){return i!=null&&this.seek(i,r),this.paused(!0)},t.resume=function(){return this.paused(!1)},t.reversed=function(i){return arguments.length?(!!i!==this.reversed()&&this.timeScale(-this._rts||(i?-kt:0)),this):this._rts<0},t.invalidate=function(){return this._initted=this._act=0,this._zTime=-kt,this},t.isActive=function(){var i=this.parent||this._dp,r=this._start,n;return!!(!i||this._ts&&this._initted&&i.isActive()&&(n=i.rawTime(!0))>=r&&n<this.endTime(!0)-kt)},t.eventCallback=function(i,r,n){var a=this.vars;return arguments.length>1?(r?(a[i]=r,n&&(a[i+"Params"]=n),i==="onUpdate"&&(this._onUpdate=r)):delete a[i],this):a[i]},t.then=function(i){var r=this;return new Promise(function(n){var a=Xt(i)?i:S0,o=function(){var l=r.then;r.then=null,Xt(a)&&(a=a(r))&&(a.then||a===r)&&(r.then=l),n(a),r.then=l};r._initted&&r.totalProgress()===1&&r._ts>=0||!r._tTime&&r._ts<0?o():r._prom=o})},t.kill=function(){Sn(this)},s}();ei(tn.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-kt,_prom:0,_ps:!1,_rts:1});var Pe=function(s){c0(t,s);function t(i,r){var n;return i===void 0&&(i={}),n=s.call(this,i)||this,n.labels={},n.smoothChildTiming=!!i.smoothChildTiming,n.autoRemoveChildren=!!i.autoRemoveChildren,n._sort=ke(i.sortChildren),Gt&&Mi(i.parent||Gt,Yi(n),r),i.reversed&&n.reverse(),i.paused&&n.paused(!0),i.scrollTrigger&&E0(Yi(n),i.scrollTrigger),n}var e=t.prototype;return e.to=function(r,n,a){return Bn(0,arguments,this),this},e.from=function(r,n,a){return Bn(1,arguments,this),this},e.fromTo=function(r,n,a,o){return Bn(2,arguments,this),this},e.set=function(r,n,a){return n.duration=0,n.parent=this,Rn(n).repeatDelay||(n.repeat=0),n.immediateRender=!!n.immediateRender,new ee(r,n,He(this,a),1),this},e.call=function(r,n,a){return Mi(this,ee.delayedCall(0,r,n),a)},e.staggerTo=function(r,n,a,o,h,l,c){return a.duration=n,a.stagger=a.stagger||o,a.onComplete=l,a.onCompleteParams=c,a.parent=this,new ee(r,a,He(this,h)),this},e.staggerFrom=function(r,n,a,o,h,l,c){return a.runBackwards=1,Rn(a).immediateRender=ke(a.immediateRender),this.staggerTo(r,n,a,o,h,l,c)},e.staggerFromTo=function(r,n,a,o,h,l,c,u){return o.startAt=a,Rn(o).immediateRender=ke(o.immediateRender),this.staggerTo(r,n,o,h,l,c,u)},e.render=function(r,n,a){var o=this._time,h=this._dirty?this.totalDuration():this._tDur,l=this._dur,c=r<=0?0:ce(r),u=this._zTime<0!=r<0&&(this._initted||!l),d,f,p,m,g,x,y,b,v,_,w,T;if(this!==Gt&&c>h&&r>=0&&(c=h),c!==this._tTime||a||u){if(o!==this._time&&l&&(c+=this._time-o,r+=this._time-o),d=c,v=this._start,b=this._ts,x=!b,u&&(l||(o=this._zTime),(r||!n)&&(this._zTime=r)),this._repeat){if(w=this._yoyo,g=l+this._rDelay,this._repeat<-1&&r<0)return this.totalTime(g*100+r,n,a);if(d=ce(c%g),c===h?(m=this._repeat,d=l):(m=~~(c/g),m&&m===c/g&&(d=l,m--),d>l&&(d=l)),_=Zr(this._tTime,g),!o&&this._tTime&&_!==m&&(_=m),w&&m&1&&(d=l-d,T=1),m!==_&&!this._lock){var S=w&&_&1,C=S===(w&&m&1);if(m<_&&(S=!S),o=S?0:l,this._lock=1,this.render(o||(T?0:ce(m*g)),n,!l)._lock=0,this._tTime=c,!n&&this.parent&&Ze(this,"onRepeat"),this.vars.repeatRefresh&&!T&&(this.invalidate()._lock=1),o&&o!==this._time||x!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(l=this._dur,h=this._tDur,C&&(this._lock=2,o=S?l:-1e-4,this.render(o,!0),this.vars.repeatRefresh&&!T&&this.invalidate()),this._lock=0,!this._ts&&!x)return this;G0(this,T)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(y=RS(this,ce(o),ce(d)),y&&(c-=d-(d=y._start))),this._tTime=c,this._time=d,this._act=!b,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=r,o=0),!o&&d&&!n&&(Ze(this,"onStart"),this._tTime!==c))return this;if(d>=o&&r>=0)for(f=this._first;f;){if(p=f._next,(f._act||d>=f._start)&&f._ts&&y!==f){if(f.parent!==this)return this.render(r,n,a);if(f.render(f._ts>0?(d-f._start)*f._ts:(f._dirty?f.totalDuration():f._tDur)+(d-f._start)*f._ts,n,a),d!==this._time||!this._ts&&!x){y=0,p&&(c+=this._zTime=-kt);break}}f=p}else{f=this._last;for(var E=r<0?r:d;f;){if(p=f._prev,(f._act||E<=f._end)&&f._ts&&y!==f){if(f.parent!==this)return this.render(r,n,a);if(f.render(f._ts>0?(E-f._start)*f._ts:(f._dirty?f.totalDuration():f._tDur)+(E-f._start)*f._ts,n,a||xe&&(f._initted||f._startAt)),d!==this._time||!this._ts&&!x){y=0,p&&(c+=this._zTime=E?-kt:kt);break}}f=p}}if(y&&!n&&(this.pause(),y.render(d>=o?0:-kt)._zTime=d>=o?1:-1,this._ts))return this._start=v,Ho(this),this.render(r,n,a);this._onUpdate&&!n&&Ze(this,"onUpdate",!0),(c===h&&this._tTime>=this.totalDuration()||!c&&o)&&(v===this._start||Math.abs(b)!==Math.abs(this._ts))&&(this._lock||((r||!l)&&(c===h&&this._ts>0||!c&&this._ts<0)&&Ts(this,1),!n&&!(r<0&&!o)&&(c||o||!h)&&(Ze(this,c===h&&r>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(c<h&&this.timeScale()>0)&&this._prom())))}return this},e.add=function(r,n){var a=this;if(ss(n)||(n=He(this,n,r)),!(r instanceof tn)){if(ve(r))return r.forEach(function(o){return a.add(o,n)}),this;if(oe(r))return this.addLabel(r,n);if(Xt(r))r=ee.delayedCall(0,r);else return this}return this!==r?Mi(this,r,n):this},e.getChildren=function(r,n,a,o){r===void 0&&(r=!0),n===void 0&&(n=!0),a===void 0&&(a=!0),o===void 0&&(o=-qe);for(var h=[],l=this._first;l;)l._start>=o&&(l instanceof ee?n&&h.push(l):(a&&h.push(l),r&&h.push.apply(h,l.getChildren(!0,n,a)))),l=l._next;return h},e.getById=function(r){for(var n=this.getChildren(1,1,1),a=n.length;a--;)if(n[a].vars.id===r)return n[a]},e.remove=function(r){return oe(r)?this.removeLabel(r):Xt(r)?this.killTweensOf(r):(zo(this,r),r===this._recent&&(this._recent=this._last),Zs(this))},e.totalTime=function(r,n){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=ce(Ne.time-(this._ts>0?r/this._ts:(this.totalDuration()-r)/-this._ts))),s.prototype.totalTime.call(this,r,n),this._forcing=0,this):this._tTime},e.addLabel=function(r,n){return this.labels[r]=He(this,n),this},e.removeLabel=function(r){return delete this.labels[r],this},e.addPause=function(r,n,a){var o=ee.delayedCall(0,n||Xn,a);return o.data="isPause",this._hasPause=1,Mi(this,o,He(this,r))},e.removePause=function(r){var n=this._first;for(r=He(this,r);n;)n._start===r&&n.data==="isPause"&&Ts(n),n=n._next},e.killTweensOf=function(r,n,a){for(var o=this.getTweensOf(r,a),h=o.length;h--;)gs!==o[h]&&o[h].kill(r,n);return this},e.getTweensOf=function(r,n){for(var a=[],o=Ke(r),h=this._first,l=ss(n),c;h;)h instanceof ee?SS(h._targets,o)&&(l?(!gs||h._initted&&h._ts)&&h.globalTime(0)<=n&&h.globalTime(h.totalDuration())>n:!n||h.isActive())&&a.push(h):(c=h.getTweensOf(o,n)).length&&a.push.apply(a,c),h=h._next;return a},e.tweenTo=function(r,n){n=n||{};var a=this,o=He(a,r),h=n,l=h.startAt,c=h.onStart,u=h.onStartParams,d=h.immediateRender,f,p=ee.to(a,ei({ease:n.ease||"none",lazy:!1,immediateRender:!1,time:o,overwrite:"auto",duration:n.duration||Math.abs((o-(l&&"time"in l?l.time:a._time))/a.timeScale())||kt,onStart:function(){if(a.pause(),!f){var g=n.duration||Math.abs((o-(l&&"time"in l?l.time:a._time))/a.timeScale());p._dur!==g&&Jr(p,g,0,1).render(p._time,!0,!0),f=1}c&&c.apply(p,u||[])}},n));return d?p.render(0):p},e.tweenFromTo=function(r,n,a){return this.tweenTo(n,ei({startAt:{time:He(this,r)}},a))},e.recent=function(){return this._recent},e.nextLabel=function(r){return r===void 0&&(r=this._time),Hd(this,He(this,r))},e.previousLabel=function(r){return r===void 0&&(r=this._time),Hd(this,He(this,r),1)},e.currentLabel=function(r){return arguments.length?this.seek(r,!0):this.previousLabel(this._time+kt)},e.shiftChildren=function(r,n,a){a===void 0&&(a=0);for(var o=this._first,h=this.labels,l;o;)o._start>=a&&(o._start+=r,o._end+=r),o=o._next;if(n)for(l in h)h[l]>=a&&(h[l]+=r);return Zs(this)},e.invalidate=function(r){var n=this._first;for(this._lock=0;n;)n.invalidate(r),n=n._next;return s.prototype.invalidate.call(this,r)},e.clear=function(r){r===void 0&&(r=!0);for(var n=this._first,a;n;)a=n._next,this.remove(n),n=a;return this._dp&&(this._time=this._tTime=this._pTime=0),r&&(this.labels={}),Zs(this)},e.totalDuration=function(r){var n=0,a=this,o=a._last,h=qe,l,c,u;if(arguments.length)return a.timeScale((a._repeat<0?a.duration():a.totalDuration())/(a.reversed()?-r:r));if(a._dirty){for(u=a.parent;o;)l=o._prev,o._dirty&&o.totalDuration(),c=o._start,c>h&&a._sort&&o._ts&&!a._lock?(a._lock=1,Mi(a,o,c-o._delay,1)._lock=0):h=c,c<0&&o._ts&&(n-=c,(!u&&!a._dp||u&&u.smoothChildTiming)&&(a._start+=c/a._ts,a._time-=c,a._tTime-=c),a.shiftChildren(-c,!1,-1/0),h=0),o._end>n&&o._ts&&(n=o._end),o=l;Jr(a,a===Gt&&a._time>n?a._time:n,1,1),a._dirty=0}return a._tDur},t.updateRoot=function(r){if(Gt._ts&&(w0(Gt,go(r,Gt)),v0=Ne.frame),Ne.frame>=Dd){Dd+=De.autoSleep||120;var n=Gt._first;if((!n||!n._ts)&&De.autoSleep&&Ne._listeners.length<2){for(;n&&!n._ts;)n=n._next;n||Ne.sleep()}}},t}(tn);ei(Pe.prototype,{_lock:0,_hasPause:0,_forcing:0});var jS=function(t,e,i,r,n,a,o){var h=new Be(this._pt,t,e,0,1,j0,null,n),l=0,c=0,u,d,f,p,m,g,x,y;for(h.b=i,h.e=r,i+="",r+="",(x=~r.indexOf("random("))&&(r=$n(r)),a&&(y=[i,r],a(y,t,e),i=y[0],r=y[1]),d=i.match(Xh)||[];u=Xh.exec(r);)p=u[0],m=r.substring(l,u.index),f?f=(f+1)%5:m.substr(-5)==="rgba("&&(f=1),p!==d[c++]&&(g=parseFloat(d[c-1])||0,h._pt={_next:h._pt,p:m||c===1?m:",",s:g,c:p.charAt(1)==="="?Or(g,p)-g:parseFloat(p)-g,m:f&&f<4?Math.round:0},l=Xh.lastIndex);return h.c=l<r.length?r.substring(l,r.length):"",h.fp=o,(m0.test(r)||x)&&(h.e=0),this._pt=h,h},ou=function(t,e,i,r,n,a,o,h,l,c){Xt(r)&&(r=r(n||0,t,a));var u=t[e],d=i!=="get"?i:Xt(u)?l?t[e.indexOf("set")||!Xt(t["get"+e.substr(3)])?e:"get"+e.substr(3)](l):t[e]():u,f=Xt(u)?l?QS:W0:lu,p;if(oe(r)&&(~r.indexOf("random(")&&(r=$n(r)),r.charAt(1)==="="&&(p=Or(d,r)+(be(d)||0),(p||p===0)&&(r=p))),!c||d!==r||Zl)return!isNaN(d*r)&&r!==""?(p=new Be(this._pt,t,e,+d||0,r-(d||0),typeof u=="boolean"?eC:Y0,0,f),l&&(p.fp=l),o&&p.modifier(o,this,t),this._pt=p):(!u&&!(e in t)&&su(e,r),jS.call(this,t,e,d,r,f,h||De.stringFilter,l))},qS=function(t,e,i,r,n){if(Xt(t)&&(t=In(t,n,e,i,r)),!Di(t)||t.style&&t.nodeType||ve(t)||f0(t))return oe(t)?In(t,n,e,i,r):t;var a={},o;for(o in t)a[o]=In(t[o],n,e,i,r);return a},H0=function(t,e,i,r,n,a){var o,h,l,c;if(Oe[t]&&(o=new Oe[t]).init(n,o.rawVars?e[t]:qS(e[t],r,n,a,i),i,r,a)!==!1&&(i._pt=h=new Be(i._pt,n,t,0,1,o.render,o,0,o.priority),i!==Er))for(l=i._ptLookup[i._targets.indexOf(n)],c=o._props.length;c--;)l[o._props[c]]=h;return o},gs,Zl,hu=function s(t,e,i){var r=t.vars,n=r.ease,a=r.startAt,o=r.immediateRender,h=r.lazy,l=r.onUpdate,c=r.onUpdateParams,u=r.callbackScope,d=r.runBackwards,f=r.yoyoEase,p=r.keyframes,m=r.autoRevert,g=t._dur,x=t._startAt,y=t._targets,b=t.parent,v=b&&b.data==="nested"?b.vars.targets:y,_=t._overwrite==="auto"&&!tu,w=t.timeline,T,S,C,E,M,N,R,I,k,B,z,Z,G;if(w&&(!p||!n)&&(n="none"),t._ease=Js(n,Kr.ease),t._yEase=f?D0(Js(f===!0?n:f,Kr.ease)):0,f&&t._yoyo&&!t._repeat&&(f=t._yEase,t._yEase=t._ease,t._ease=f),t._from=!w&&!!r.runBackwards,!w||p&&!r.stagger){if(I=y[0]?Ks(y[0]).harness:0,Z=I&&r[I.prop],T=mo(r,ru),x&&(x._zTime<0&&x.progress(1),e<0&&d&&o&&!m?x.render(-1,!0):x.revert(d&&g?$a:wS),x._lazy=0),a){if(Ts(t._startAt=ee.set(y,ei({data:"isStart",overwrite:!1,parent:b,immediateRender:!0,lazy:!x&&ke(h),startAt:null,delay:0,onUpdate:l,onUpdateParams:c,callbackScope:u,stagger:0},a))),t._startAt._dp=0,t._startAt._sat=t,e<0&&(xe||!o&&!m)&&t._startAt.revert($a),o&&g&&e<=0&&i<=0){e&&(t._zTime=e);return}}else if(d&&g&&!x){if(e&&(o=!1),C=ei({overwrite:!1,data:"isFromStart",lazy:o&&!x&&ke(h),immediateRender:o,stagger:0,parent:b},T),Z&&(C[I.prop]=Z),Ts(t._startAt=ee.set(y,C)),t._startAt._dp=0,t._startAt._sat=t,e<0&&(xe?t._startAt.revert($a):t._startAt.render(-1,!0)),t._zTime=e,!o)s(t._startAt,kt,kt);else if(!e)return}for(t._pt=t._ptCache=0,h=g&&ke(h)||h&&!g,S=0;S<y.length;S++){if(M=y[S],R=M._gsap||au(y)[S]._gsap,t._ptLookup[S]=B={},$l[R.id]&&_s.length&&po(),z=v===y?S:v.indexOf(M),I&&(k=new I).init(M,Z||T,t,z,v)!==!1&&(t._pt=E=new Be(t._pt,M,k.name,0,1,k.render,k,0,k.priority),k._props.forEach(function(O){B[O]=E}),k.priority&&(N=1)),!I||Z)for(C in T)Oe[C]&&(k=H0(C,T,t,z,M,v))?k.priority&&(N=1):B[C]=E=ou.call(t,M,C,"get",T[C],z,v,0,r.stringFilter);t._op&&t._op[S]&&t.kill(M,t._op[S]),_&&t._pt&&(gs=t,Gt.killTweensOf(M,B,t.globalTime(e)),G=!t.parent,gs=0),t._pt&&h&&($l[R.id]=1)}N&&q0(t),t._onInit&&t._onInit(t)}t._onUpdate=l,t._initted=(!t._op||t._pt)&&!G,p&&e<=0&&w.render(qe,!0,!0)},KS=function(t,e,i,r,n,a,o){var h=(t._pt&&t._ptCache||(t._ptCache={}))[e],l,c,u,d;if(!h)for(h=t._ptCache[e]=[],u=t._ptLookup,d=t._targets.length;d--;){if(l=u[d][e],l&&l.d&&l.d._pt)for(l=l.d._pt;l&&l.p!==e&&l.fp!==e;)l=l._next;if(!l)return Zl=1,t.vars[e]="+=0",hu(t,o),Zl=0,1;h.push(l)}for(d=h.length;d--;)c=h[d],l=c._pt||c,l.s=(r||r===0)&&!n?r:l.s+(r||0)+a*l.c,l.c=i-l.s,c.e&&(c.e=Wt(i)+be(c.e)),c.b&&(c.b=l.s+be(c.b))},ZS=function(t,e){var i=t[0]?Ks(t[0]).harness:0,r=i&&i.aliases,n,a,o,h;if(!r)return e;n=sr({},e);for(a in r)if(a in n)for(h=r[a].split(","),o=h.length;o--;)n[h[o]]=n[a];return n},JS=function(t,e,i,r){var n=e.ease||r||"power1.inOut",a,o;if(ve(e))o=i[t]||(i[t]=[]),e.forEach(function(h,l){return o.push({t:l/(e.length-1)*100,v:h,e:n})});else for(a in e)o=i[a]||(i[a]=[]),a==="ease"||o.push({t:parseFloat(t),v:e[a],e:n})},In=function(t,e,i,r,n){return Xt(t)?t.call(e,i,r,n):oe(t)&&~t.indexOf("random(")?$n(t):t},X0=nu+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",$0={};Re(X0+",id,stagger,delay,duration,paused,scrollTrigger",function(s){return $0[s]=1});var ee=function(s){c0(t,s);function t(i,r,n,a){var o;typeof r=="number"&&(n.duration=r,r=n,n=null),o=s.call(this,a?r:Rn(r))||this;var h=o.vars,l=h.duration,c=h.delay,u=h.immediateRender,d=h.stagger,f=h.overwrite,p=h.keyframes,m=h.defaults,g=h.scrollTrigger,x=h.yoyoEase,y=r.parent||Gt,b=(ve(i)||f0(i)?ss(i[0]):"length"in r)?[i]:Ke(i),v,_,w,T,S,C,E,M;if(o._targets=b.length?au(b):fo("GSAP target "+i+" not found. https://greensock.com",!De.nullTargetWarn)||[],o._ptLookup=[],o._overwrite=f,p||d||wa(l)||wa(c)){if(r=o.vars,v=o.timeline=new Pe({data:"nested",defaults:m||{},targets:y&&y.data==="nested"?y.vars.targets:b}),v.kill(),v.parent=v._dp=Yi(o),v._start=0,d||wa(l)||wa(c)){if(T=b.length,E=d&&R0(d),Di(d))for(S in d)~X0.indexOf(S)&&(M||(M={}),M[S]=d[S]);for(_=0;_<T;_++)w=mo(r,$0),w.stagger=0,x&&(w.yoyoEase=x),M&&sr(w,M),C=b[_],w.duration=+In(l,Yi(o),_,C,b),w.delay=(+In(c,Yi(o),_,C,b)||0)-o._delay,!d&&T===1&&w.delay&&(o._delay=c=w.delay,o._start+=c,w.delay=0),v.to(C,w,E?E(_,C,b):0),v._ease=pt.none;v.duration()?l=c=0:o.timeline=0}else if(p){Rn(ei(v.vars.defaults,{ease:"none"})),v._ease=Js(p.ease||r.ease||"none");var N=0,R,I,k;if(ve(p))p.forEach(function(B){return v.to(b,B,">")}),v.duration();else{w={};for(S in p)S==="ease"||S==="easeEach"||JS(S,p[S],w,p.easeEach);for(S in w)for(R=w[S].sort(function(B,z){return B.t-z.t}),N=0,_=0;_<R.length;_++)I=R[_],k={ease:I.e,duration:(I.t-(_?R[_-1].t:0))/100*l},k[S]=I.v,v.to(b,k,N),N+=k.duration;v.duration()<l&&v.to({},{duration:l-v.duration()})}}l||o.duration(l=v.duration())}else o.timeline=0;return f===!0&&!tu&&(gs=Yi(o),Gt.killTweensOf(b),gs=0),Mi(y,Yi(o),n),r.reversed&&o.reverse(),r.paused&&o.paused(!0),(u||!l&&!p&&o._start===ce(y._time)&&ke(u)&&PS(Yi(o))&&y.data!=="nested")&&(o._tTime=-kt,o.render(Math.max(0,-c)||0)),g&&E0(Yi(o),g),o}var e=t.prototype;return e.render=function(r,n,a){var o=this._time,h=this._tDur,l=this._dur,c=r<0,u=r>h-kt&&!c?h:r<kt?0:r,d,f,p,m,g,x,y,b,v;if(!l)kS(this,r,n,a);else if(u!==this._tTime||!r||a||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==c){if(d=u,b=this.timeline,this._repeat){if(m=l+this._rDelay,this._repeat<-1&&c)return this.totalTime(m*100+r,n,a);if(d=ce(u%m),u===h?(p=this._repeat,d=l):(p=~~(u/m),p&&p===u/m&&(d=l,p--),d>l&&(d=l)),x=this._yoyo&&p&1,x&&(v=this._yEase,d=l-d),g=Zr(this._tTime,m),d===o&&!a&&this._initted)return this._tTime=u,this;p!==g&&(b&&this._yEase&&G0(b,x),this.vars.repeatRefresh&&!x&&!this._lock&&(this._lock=a=1,this.render(ce(m*p),!0).invalidate()._lock=0))}if(!this._initted){if(P0(this,c?r:d,a,n,u))return this._tTime=0,this;if(o!==this._time)return this;if(l!==this._dur)return this.render(r,n,a)}if(this._tTime=u,this._time=d,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=y=(v||this._ease)(d/l),this._from&&(this.ratio=y=1-y),d&&!o&&!n&&(Ze(this,"onStart"),this._tTime!==u))return this;for(f=this._pt;f;)f.r(y,f.d),f=f._next;b&&b.render(r<0?r:!d&&x?-kt:b._dur*b._ease(d/this._dur),n,a)||this._startAt&&(this._zTime=r),this._onUpdate&&!n&&(c&&Wl(this,r,n,a),Ze(this,"onUpdate")),this._repeat&&p!==g&&this.vars.onRepeat&&!n&&this.parent&&Ze(this,"onRepeat"),(u===this._tDur||!u)&&this._tTime===u&&(c&&!this._onUpdate&&Wl(this,r,!0,!0),(r||!l)&&(u===this._tDur&&this._ts>0||!u&&this._ts<0)&&Ts(this,1),!n&&!(c&&!o)&&(u||o||x)&&(Ze(this,u===h?"onComplete":"onReverseComplete",!0),this._prom&&!(u<h&&this.timeScale()>0)&&this._prom()))}return this},e.targets=function(){return this._targets},e.invalidate=function(r){return(!r||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(r),s.prototype.invalidate.call(this,r)},e.resetTo=function(r,n,a,o){Wn||Ne.wake(),this._ts||this.play();var h=Math.min(this._dur,(this._dp._time-this._start)*this._ts),l;return this._initted||hu(this,h),l=this._ease(h/this._dur),KS(this,r,n,a,o,l,h)?this.resetTo(r,n,a,o):(Xo(this,0),this.parent||C0(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},e.kill=function(r,n){if(n===void 0&&(n="all"),!r&&(!n||n==="all"))return this._lazy=this._pt=0,this.parent?Sn(this):this;if(this.timeline){var a=this.timeline.totalDuration();return this.timeline.killTweensOf(r,n,gs&&gs.vars.overwrite!==!0)._first||Sn(this),this.parent&&a!==this.timeline.totalDuration()&&Jr(this,this._dur*this.timeline._tDur/a,0,1),this}var o=this._targets,h=r?Ke(r):o,l=this._ptLookup,c=this._pt,u,d,f,p,m,g,x;if((!n||n==="all")&&AS(o,h))return n==="all"&&(this._pt=0),Sn(this);for(u=this._op=this._op||[],n!=="all"&&(oe(n)&&(m={},Re(n,function(y){return m[y]=1}),n=m),n=ZS(o,n)),x=o.length;x--;)if(~h.indexOf(o[x])){d=l[x],n==="all"?(u[x]=n,p=d,f={}):(f=u[x]=u[x]||{},p=n);for(m in p)g=d&&d[m],g&&((!("kill"in g.d)||g.d.kill(m)===!0)&&zo(this,g,"_pt"),delete d[m]),f!=="all"&&(f[m]=1)}return this._initted&&!this._pt&&c&&Sn(this),this},t.to=function(r,n){return new t(r,n,arguments[2])},t.from=function(r,n){return Bn(1,arguments)},t.delayedCall=function(r,n,a,o){return new t(n,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:r,onComplete:n,onReverseComplete:n,onCompleteParams:a,onReverseCompleteParams:a,callbackScope:o})},t.fromTo=function(r,n,a){return Bn(2,arguments)},t.set=function(r,n){return n.duration=0,n.repeatDelay||(n.repeat=0),new t(r,n)},t.killTweensOf=function(r,n,a){return Gt.killTweensOf(r,n,a)},t}(tn);ei(ee.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});Re("staggerTo,staggerFrom,staggerFromTo",function(s){ee[s]=function(){var t=new Pe,e=jl.call(arguments,0);return e.splice(s==="staggerFromTo"?5:4,0,0),t[s].apply(t,e)}});var lu=function(t,e,i){return t[e]=i},W0=function(t,e,i){return t[e](i)},QS=function(t,e,i,r){return t[e](r.fp,i)},tC=function(t,e,i){return t.setAttribute(e,i)},cu=function(t,e){return Xt(t[e])?W0:eu(t[e])&&t.setAttribute?tC:lu},Y0=function(t,e){return e.set(e.t,e.p,Math.round((e.s+e.c*t)*1e6)/1e6,e)},eC=function(t,e){return e.set(e.t,e.p,!!(e.s+e.c*t),e)},j0=function(t,e){var i=e._pt,r="";if(!t&&e.b)r=e.b;else if(t===1&&e.e)r=e.e;else{for(;i;)r=i.p+(i.m?i.m(i.s+i.c*t):Math.round((i.s+i.c*t)*1e4)/1e4)+r,i=i._next;r+=e.c}e.set(e.t,e.p,r,e)},uu=function(t,e){for(var i=e._pt;i;)i.r(t,i.d),i=i._next},iC=function(t,e,i,r){for(var n=this._pt,a;n;)a=n._next,n.p===r&&n.modifier(t,e,i),n=a},sC=function(t){for(var e=this._pt,i,r;e;)r=e._next,e.p===t&&!e.op||e.op===t?zo(this,e,"_pt"):e.dep||(i=1),e=r;return!i},rC=function(t,e,i,r){r.mSet(t,e,r.m.call(r.tween,i,r.mt),r)},q0=function(t){for(var e=t._pt,i,r,n,a;e;){for(i=e._next,r=n;r&&r.pr>e.pr;)r=r._next;(e._prev=r?r._prev:a)?e._prev._next=e:n=e,(e._next=r)?r._prev=e:a=e,e=i}t._pt=n},Be=function(){function s(e,i,r,n,a,o,h,l,c){this.t=i,this.s=n,this.c=a,this.p=r,this.r=o||Y0,this.d=h||this,this.set=l||lu,this.pr=c||0,this._next=e,e&&(e._prev=this)}var t=s.prototype;return t.modifier=function(i,r,n){this.mSet=this.mSet||this.set,this.set=rC,this.m=i,this.mt=n,this.tween=r},s}();Re(nu+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(s){return ru[s]=1});Ge.TweenMax=Ge.TweenLite=ee;Ge.TimelineLite=Ge.TimelineMax=Pe;Gt=new Pe({sortChildren:!1,defaults:Kr,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});De.stringFilter=N0;var en=[],Ya={},nC=[],$d=0,qh=function(t){return(Ya[t]||nC).map(function(e){return e()})},Jl=function(){var t=Date.now(),e=[];t-$d>2&&(qh("matchMediaInit"),en.forEach(function(i){var r=i.queries,n=i.conditions,a,o,h,l;for(o in r)a=Xe.matchMedia(r[o]).matches,a&&(h=1),a!==n[o]&&(n[o]=a,l=1);l&&(i.revert(),h&&e.push(i))}),qh("matchMediaRevert"),e.forEach(function(i){return i.onMatch(i)}),$d=t,qh("matchMedia"))},K0=function(){function s(e,i){this.selector=i&&ql(i),this.data=[],this._r=[],this.isReverted=!1,e&&this.add(e)}var t=s.prototype;return t.add=function(i,r,n){Xt(i)&&(n=r,r=i,i=Xt);var a=this,o=function(){var l=Kt,c=a.selector,u;return l&&l!==a&&l.data.push(a),n&&(a.selector=ql(n)),Kt=a,u=r.apply(a,arguments),Xt(u)&&a._r.push(u),Kt=l,a.selector=c,a.isReverted=!1,u};return a.last=o,i===Xt?o(a):i?a[i]=o:o},t.ignore=function(i){var r=Kt;Kt=null,i(this),Kt=r},t.getTweens=function(){var i=[];return this.data.forEach(function(r){return r instanceof s?i.push.apply(i,r.getTweens()):r instanceof ee&&!(r.parent&&r.parent.data==="nested")&&i.push(r)}),i},t.clear=function(){this._r.length=this.data.length=0},t.kill=function(i,r){var n=this;if(i){var a=this.getTweens();this.data.forEach(function(h){h.data==="isFlip"&&(h.revert(),h.getChildren(!0,!0,!1).forEach(function(l){return a.splice(a.indexOf(l),1)}))}),a.map(function(h){return{g:h.globalTime(0),t:h}}).sort(function(h,l){return l.g-h.g||-1}).forEach(function(h){return h.t.revert(i)}),this.data.forEach(function(h){return!(h instanceof tn)&&h.revert&&h.revert(i)}),this._r.forEach(function(h){return h(i,n)}),this.isReverted=!0}else this.data.forEach(function(h){return h.kill&&h.kill()});if(this.clear(),r){var o=en.indexOf(this);~o&&en.splice(o,1)}},t.revert=function(i){this.kill(i||{})},s}(),aC=function(){function s(e){this.contexts=[],this.scope=e}var t=s.prototype;return t.add=function(i,r,n){Di(i)||(i={matches:i});var a=new K0(0,n||this.scope),o=a.conditions={},h,l,c;this.contexts.push(a),r=a.add("onMatch",r),a.queries=i;for(l in i)l==="all"?c=1:(h=Xe.matchMedia(i[l]),h&&(en.indexOf(a)<0&&en.push(a),(o[l]=h.matches)&&(c=1),h.addListener?h.addListener(Jl):h.addEventListener("change",Jl)));return c&&r(a),this},t.revert=function(i){this.kill(i||{})},t.kill=function(i){this.contexts.forEach(function(r){return r.kill(i,!0)})},s}(),bo={registerPlugin:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];e.forEach(function(r){return VS(r)})},timeline:function(t){return new Pe(t)},getTweensOf:function(t,e){return Gt.getTweensOf(t,e)},getProperty:function(t,e,i,r){oe(t)&&(t=Ke(t)[0]);var n=Ks(t||{}).get,a=i?S0:T0;return i==="native"&&(i=""),t&&(e?a((Oe[e]&&Oe[e].get||n)(t,e,i,r)):function(o,h,l){return a((Oe[o]&&Oe[o].get||n)(t,o,h,l))})},quickSetter:function(t,e,i){if(t=Ke(t),t.length>1){var r=t.map(function(c){return Ve.quickSetter(c,e,i)}),n=r.length;return function(c){for(var u=n;u--;)r[u](c)}}t=t[0]||{};var a=Oe[e],o=Ks(t),h=o.harness&&(o.harness.aliases||{})[e]||e,l=a?function(c){var u=new a;Er._pt=0,u.init(t,i?c+i:c,Er,0,[t]),u.render(1,u),Er._pt&&uu(1,Er)}:o.set(t,h);return a?l:function(c){return l(t,h,i?c+i:c,o,1)}},quickTo:function(t,e,i){var r,n=Ve.to(t,sr((r={},r[e]="+=0.1",r.paused=!0,r),i||{})),a=function(h,l,c){return n.resetTo(e,h,l,c)};return a.tween=n,a},isTweening:function(t){return Gt.getTweensOf(t,!0).length>0},defaults:function(t){return t&&t.ease&&(t.ease=Js(t.ease,Kr.ease)),Gd(Kr,t||{})},config:function(t){return Gd(De,t||{})},registerEffect:function(t){var e=t.name,i=t.effect,r=t.plugins,n=t.defaults,a=t.extendTimeline;(r||"").split(",").forEach(function(o){return o&&!Oe[o]&&!Ge[o]&&fo(e+" effect requires "+o+" plugin.")}),$h[e]=function(o,h,l){return i(Ke(o),ei(h||{},n),l)},a&&(Pe.prototype[e]=function(o,h,l){return this.add($h[e](o,Di(h)?h:(l=h)&&{},this),l)})},registerEase:function(t,e){pt[t]=Js(e)},parseEase:function(t,e){return arguments.length?Js(t,e):pt},getById:function(t){return Gt.getById(t)},exportRoot:function(t,e){t===void 0&&(t={});var i=new Pe(t),r,n;for(i.smoothChildTiming=ke(t.smoothChildTiming),Gt.remove(i),i._dp=0,i._time=i._tTime=Gt._time,r=Gt._first;r;)n=r._next,(e||!(!r._dur&&r instanceof ee&&r.vars.onComplete===r._targets[0]))&&Mi(i,r,r._start-r._delay),r=n;return Mi(Gt,i,0),i},context:function(t,e){return t?new K0(t,e):Kt},matchMedia:function(t){return new aC(t)},matchMediaRefresh:function(){return en.forEach(function(t){var e=t.conditions,i,r;for(r in e)e[r]&&(e[r]=!1,i=1);i&&t.revert()})||Jl()},addEventListener:function(t,e){var i=Ya[t]||(Ya[t]=[]);~i.indexOf(e)||i.push(e)},removeEventListener:function(t,e){var i=Ya[t],r=i&&i.indexOf(e);r>=0&&i.splice(r,1)},utils:{wrap:NS,wrapYoyo:DS,distribute:R0,random:I0,snap:B0,normalize:OS,getUnit:be,clamp:IS,splitColor:L0,toArray:Ke,selector:ql,mapRange:U0,pipe:US,unitize:LS,interpolate:GS,shuffle:k0},install:y0,effects:$h,ticker:Ne,updateRoot:Pe.updateRoot,plugins:Oe,globalTimeline:Gt,core:{PropTween:Be,globals:x0,Tween:ee,Timeline:Pe,Animation:tn,getCache:Ks,_removeLinkedListItem:zo,reverting:function(){return xe},context:function(t){return t&&Kt&&(Kt.data.push(t),t._ctx=Kt),Kt},suppressOverwrites:function(t){return tu=t}}};Re("to,from,fromTo,delayedCall,set,killTweensOf",function(s){return bo[s]=ee[s]});Ne.add(Pe.updateRoot);Er=bo.to({},{duration:0});var oC=function(t,e){for(var i=t._pt;i&&i.p!==e&&i.op!==e&&i.fp!==e;)i=i._next;return i},hC=function(t,e){var i=t._targets,r,n,a;for(r in e)for(n=i.length;n--;)a=t._ptLookup[n][r],a&&(a=a.d)&&(a._pt&&(a=oC(a,r)),a&&a.modifier&&a.modifier(e[r],t,i[n],r))},Kh=function(t,e){return{name:t,rawVars:1,init:function(r,n,a){a._onInit=function(o){var h,l;if(oe(n)&&(h={},Re(n,function(c){return h[c]=1}),n=h),e){h={};for(l in n)h[l]=e(n[l]);n=h}hC(o,n)}}}},Ve=bo.registerPlugin({name:"attr",init:function(t,e,i,r,n){var a,o,h;this.tween=i;for(a in e)h=t.getAttribute(a)||"",o=this.add(t,"setAttribute",(h||0)+"",e[a],r,n,0,0,a),o.op=a,o.b=h,this._props.push(a)},render:function(t,e){for(var i=e._pt;i;)xe?i.set(i.t,i.p,i.b,i):i.r(t,i.d),i=i._next}},{name:"endArray",init:function(t,e){for(var i=e.length;i--;)this.add(t,i,t[i]||0,e[i],0,0,0,0,0,1)}},Kh("roundProps",Kl),Kh("modifiers"),Kh("snap",B0))||bo;ee.version=Pe.version=Ve.version="3.11.4";b0=1;d0()&&Qr();pt.Power0;pt.Power1;pt.Power2;pt.Power3;pt.Power4;pt.Linear;pt.Quad;pt.Cubic;pt.Quart;pt.Quint;pt.Strong;pt.Elastic;pt.Back;pt.SteppedEase;pt.Bounce;pt.Sine;pt.Expo;pt.Circ;/*!
 * CSSPlugin 3.11.4
 * https://greensock.com
 *
 * Copyright 2008-2022, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var Wd,bs,Nr,du,js,Yd,fu,lC=function(){return typeof window<"u"},rs={},Vs=180/Math.PI,Dr=Math.PI/180,mr=Math.atan2,jd=1e8,pu=/([A-Z])/g,cC=/(left|right|width|margin|padding|x)/i,uC=/[\s,\(]\S/,Ki={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},Ql=function(t,e){return e.set(e.t,e.p,Math.round((e.s+e.c*t)*1e4)/1e4+e.u,e)},dC=function(t,e){return e.set(e.t,e.p,t===1?e.e:Math.round((e.s+e.c*t)*1e4)/1e4+e.u,e)},fC=function(t,e){return e.set(e.t,e.p,t?Math.round((e.s+e.c*t)*1e4)/1e4+e.u:e.b,e)},pC=function(t,e){var i=e.s+e.c*t;e.set(e.t,e.p,~~(i+(i<0?-.5:.5))+e.u,e)},Z0=function(t,e){return e.set(e.t,e.p,t?e.e:e.b,e)},J0=function(t,e){return e.set(e.t,e.p,t!==1?e.b:e.e,e)},mC=function(t,e,i){return t.style[e]=i},gC=function(t,e,i){return t.style.setProperty(e,i)},bC=function(t,e,i){return t._gsap[e]=i},yC=function(t,e,i){return t._gsap.scaleX=t._gsap.scaleY=i},xC=function(t,e,i,r,n){var a=t._gsap;a.scaleX=a.scaleY=i,a.renderTransform(n,a)},vC=function(t,e,i,r,n){var a=t._gsap;a[e]=i,a.renderTransform(n,a)},zt="transform",bi=zt+"Origin",_C=function(t,e){var i=this,r=this.target,n=r.style;if(t in rs){if(this.tfm=this.tfm||{},t!=="transform"&&(t=Ki[t]||t,~t.indexOf(",")?t.split(",").forEach(function(a){return i.tfm[a]=qi(r,a)}):this.tfm[t]=r._gsap.x?r._gsap[t]:qi(r,t)),this.props.indexOf(zt)>=0)return;r._gsap.svg&&(this.svgo=r.getAttribute("data-svg-origin"),this.props.push(bi,e,"")),t=zt}(n||e)&&this.props.push(t,e,n[t])},Q0=function(t){t.translate&&(t.removeProperty("translate"),t.removeProperty("scale"),t.removeProperty("rotate"))},wC=function(){var t=this.props,e=this.target,i=e.style,r=e._gsap,n,a;for(n=0;n<t.length;n+=3)t[n+1]?e[t[n]]=t[n+2]:t[n+2]?i[t[n]]=t[n+2]:i.removeProperty(t[n].replace(pu,"-$1").toLowerCase());if(this.tfm){for(a in this.tfm)r[a]=this.tfm[a];r.svg&&(r.renderTransform(),e.setAttribute("data-svg-origin",this.svgo||"")),n=fu(),n&&!n.isStart&&!i[zt]&&(Q0(i),r.uncache=1)}},tb=function(t,e){var i={target:t,props:[],revert:wC,save:_C};return e&&e.split(",").forEach(function(r){return i.save(r)}),i},eb,tc=function(t,e){var i=bs.createElementNS?bs.createElementNS((e||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),t):bs.createElement(t);return i.style?i:bs.createElement(t)},Ui=function s(t,e,i){var r=getComputedStyle(t);return r[e]||r.getPropertyValue(e.replace(pu,"-$1").toLowerCase())||r.getPropertyValue(e)||!i&&s(t,sn(e)||e,1)||""},qd="O,Moz,ms,Ms,Webkit".split(","),sn=function(t,e,i){var r=e||js,n=r.style,a=5;if(t in n&&!i)return t;for(t=t.charAt(0).toUpperCase()+t.substr(1);a--&&!(qd[a]+t in n););return a<0?null:(a===3?"ms":a>=0?qd[a]:"")+t},ec=function(){lC()&&window.document&&(Wd=window,bs=Wd.document,Nr=bs.documentElement,js=tc("div")||{style:{}},tc("div"),zt=sn(zt),bi=zt+"Origin",js.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",eb=!!sn("perspective"),fu=Ve.core.reverting,du=1)},Zh=function s(t){var e=tc("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),i=this.parentNode,r=this.nextSibling,n=this.style.cssText,a;if(Nr.appendChild(e),e.appendChild(this),this.style.display="block",t)try{a=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=s}catch{}else this._gsapBBox&&(a=this._gsapBBox());return i&&(r?i.insertBefore(this,r):i.appendChild(this)),Nr.removeChild(e),this.style.cssText=n,a},Kd=function(t,e){for(var i=e.length;i--;)if(t.hasAttribute(e[i]))return t.getAttribute(e[i])},ib=function(t){var e;try{e=t.getBBox()}catch{e=Zh.call(t,!0)}return e&&(e.width||e.height)||t.getBBox===Zh||(e=Zh.call(t,!0)),e&&!e.width&&!e.x&&!e.y?{x:+Kd(t,["x","cx","x1"])||0,y:+Kd(t,["y","cy","y1"])||0,width:0,height:0}:e},sb=function(t){return!!(t.getCTM&&(!t.parentNode||t.ownerSVGElement)&&ib(t))},Yn=function(t,e){if(e){var i=t.style;e in rs&&e!==bi&&(e=zt),i.removeProperty?((e.substr(0,2)==="ms"||e.substr(0,6)==="webkit")&&(e="-"+e),i.removeProperty(e.replace(pu,"-$1").toLowerCase())):i.removeAttribute(e)}},ys=function(t,e,i,r,n,a){var o=new Be(t._pt,e,i,0,1,a?J0:Z0);return t._pt=o,o.b=r,o.e=n,t._props.push(i),o},Zd={deg:1,rad:1,turn:1},TC={grid:1,flex:1},Ss=function s(t,e,i,r){var n=parseFloat(i)||0,a=(i+"").trim().substr((n+"").length)||"px",o=js.style,h=cC.test(e),l=t.tagName.toLowerCase()==="svg",c=(l?"client":"offset")+(h?"Width":"Height"),u=100,d=r==="px",f=r==="%",p,m,g,x;return r===a||!n||Zd[r]||Zd[a]?n:(a!=="px"&&!d&&(n=s(t,e,i,"px")),x=t.getCTM&&sb(t),(f||a==="%")&&(rs[e]||~e.indexOf("adius"))?(p=x?t.getBBox()[h?"width":"height"]:t[c],Wt(f?n/p*u:n/100*p)):(o[h?"width":"height"]=u+(d?a:r),m=~e.indexOf("adius")||r==="em"&&t.appendChild&&!l?t:t.parentNode,x&&(m=(t.ownerSVGElement||{}).parentNode),(!m||m===bs||!m.appendChild)&&(m=bs.body),g=m._gsap,g&&f&&g.width&&h&&g.time===Ne.time&&!g.uncache?Wt(n/g.width*u):((f||a==="%")&&!TC[Ui(m,"display")]&&(o.position=Ui(t,"position")),m===t&&(o.position="static"),m.appendChild(js),p=js[c],m.removeChild(js),o.position="absolute",h&&f&&(g=Ks(m),g.time=Ne.time,g.width=m[c]),Wt(d?p*n/u:p&&n?u/p*n:0))))},qi=function(t,e,i,r){var n;return du||ec(),e in Ki&&e!=="transform"&&(e=Ki[e],~e.indexOf(",")&&(e=e.split(",")[0])),rs[e]&&e!=="transform"?(n=qn(t,r),n=e!=="transformOrigin"?n[e]:n.svg?n.origin:xo(Ui(t,bi))+" "+n.zOrigin+"px"):(n=t.style[e],(!n||n==="auto"||r||~(n+"").indexOf("calc("))&&(n=yo[e]&&yo[e](t,e,i)||Ui(t,e)||_0(t,e)||(e==="opacity"?1:0))),i&&!~(n+"").trim().indexOf(" ")?Ss(t,e,n,i)+i:n},SC=function(t,e,i,r){if(!i||i==="none"){var n=sn(e,t,1),a=n&&Ui(t,n,1);a&&a!==i?(e=n,i=a):e==="borderColor"&&(i=Ui(t,"borderTopColor"))}var o=new Be(this._pt,t.style,e,0,1,j0),h=0,l=0,c,u,d,f,p,m,g,x,y,b,v,_;if(o.b=i,o.e=r,i+="",r+="",r==="auto"&&(t.style[e]=r,r=Ui(t,e)||r,t.style[e]=i),c=[i,r],N0(c),i=c[0],r=c[1],d=i.match(Ar)||[],_=r.match(Ar)||[],_.length){for(;u=Ar.exec(r);)g=u[0],y=r.substring(h,u.index),p?p=(p+1)%5:(y.substr(-5)==="rgba("||y.substr(-5)==="hsla(")&&(p=1),g!==(m=d[l++]||"")&&(f=parseFloat(m)||0,v=m.substr((f+"").length),g.charAt(1)==="="&&(g=Or(f,g)+v),x=parseFloat(g),b=g.substr((x+"").length),h=Ar.lastIndex-b.length,b||(b=b||De.units[e]||v,h===r.length&&(r+=b,o.e+=b)),v!==b&&(f=Ss(t,e,m,b)||0),o._pt={_next:o._pt,p:y||l===1?y:",",s:f,c:x-f,m:p&&p<4||e==="zIndex"?Math.round:0});o.c=h<r.length?r.substring(h,r.length):""}else o.r=e==="display"&&r==="none"?J0:Z0;return m0.test(r)&&(o.e=0),this._pt=o,o},Jd={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},CC=function(t){var e=t.split(" "),i=e[0],r=e[1]||"50%";return(i==="top"||i==="bottom"||r==="left"||r==="right")&&(t=i,i=r,r=t),e[0]=Jd[i]||i,e[1]=Jd[r]||r,e.join(" ")},AC=function(t,e){if(e.tween&&e.tween._time===e.tween._dur){var i=e.t,r=i.style,n=e.u,a=i._gsap,o,h,l;if(n==="all"||n===!0)r.cssText="",h=1;else for(n=n.split(","),l=n.length;--l>-1;)o=n[l],rs[o]&&(h=1,o=o==="transformOrigin"?bi:zt),Yn(i,o);h&&(Yn(i,zt),a&&(a.svg&&i.removeAttribute("transform"),qn(i,1),a.uncache=1,Q0(r)))}},yo={clearProps:function(t,e,i,r,n){if(n.data!=="isFromStart"){var a=t._pt=new Be(t._pt,e,i,0,0,AC);return a.u=r,a.pr=-10,a.tween=n,t._props.push(i),1}}},jn=[1,0,0,1,0,0],rb={},nb=function(t){return t==="matrix(1, 0, 0, 1, 0, 0)"||t==="none"||!t},Qd=function(t){var e=Ui(t,zt);return nb(e)?jn:e.substr(7).match(p0).map(Wt)},mu=function(t,e){var i=t._gsap||Ks(t),r=t.style,n=Qd(t),a,o,h,l;return i.svg&&t.getAttribute("transform")?(h=t.transform.baseVal.consolidate().matrix,n=[h.a,h.b,h.c,h.d,h.e,h.f],n.join(",")==="1,0,0,1,0,0"?jn:n):(n===jn&&!t.offsetParent&&t!==Nr&&!i.svg&&(h=r.display,r.display="block",a=t.parentNode,(!a||!t.offsetParent)&&(l=1,o=t.nextElementSibling,Nr.appendChild(t)),n=Qd(t),h?r.display=h:Yn(t,"display"),l&&(o?a.insertBefore(t,o):a?a.appendChild(t):Nr.removeChild(t))),e&&n.length>6?[n[0],n[1],n[4],n[5],n[12],n[13]]:n)},ic=function(t,e,i,r,n,a){var o=t._gsap,h=n||mu(t,!0),l=o.xOrigin||0,c=o.yOrigin||0,u=o.xOffset||0,d=o.yOffset||0,f=h[0],p=h[1],m=h[2],g=h[3],x=h[4],y=h[5],b=e.split(" "),v=parseFloat(b[0])||0,_=parseFloat(b[1])||0,w,T,S,C;i?h!==jn&&(T=f*g-p*m)&&(S=v*(g/T)+_*(-m/T)+(m*y-g*x)/T,C=v*(-p/T)+_*(f/T)-(f*y-p*x)/T,v=S,_=C):(w=ib(t),v=w.x+(~b[0].indexOf("%")?v/100*w.width:v),_=w.y+(~(b[1]||b[0]).indexOf("%")?_/100*w.height:_)),r||r!==!1&&o.smooth?(x=v-l,y=_-c,o.xOffset=u+(x*f+y*m)-x,o.yOffset=d+(x*p+y*g)-y):o.xOffset=o.yOffset=0,o.xOrigin=v,o.yOrigin=_,o.smooth=!!r,o.origin=e,o.originIsAbsolute=!!i,t.style[bi]="0px 0px",a&&(ys(a,o,"xOrigin",l,v),ys(a,o,"yOrigin",c,_),ys(a,o,"xOffset",u,o.xOffset),ys(a,o,"yOffset",d,o.yOffset)),t.setAttribute("data-svg-origin",v+" "+_)},qn=function(t,e){var i=t._gsap||new z0(t);if("x"in i&&!e&&!i.uncache)return i;var r=t.style,n=i.scaleX<0,a="px",o="deg",h=getComputedStyle(t),l=Ui(t,bi)||"0",c,u,d,f,p,m,g,x,y,b,v,_,w,T,S,C,E,M,N,R,I,k,B,z,Z,G,O,X,V,$,H,K;return c=u=d=m=g=x=y=b=v=0,f=p=1,i.svg=!!(t.getCTM&&sb(t)),h.translate&&((h.translate!=="none"||h.scale!=="none"||h.rotate!=="none")&&(r[zt]=(h.translate!=="none"?"translate3d("+(h.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(h.rotate!=="none"?"rotate("+h.rotate+") ":"")+(h.scale!=="none"?"scale("+h.scale.split(" ").join(",")+") ":"")+(h[zt]!=="none"?h[zt]:"")),r.scale=r.rotate=r.translate="none"),T=mu(t,i.svg),i.svg&&(i.uncache?(Z=t.getBBox(),l=i.xOrigin-Z.x+"px "+(i.yOrigin-Z.y)+"px",z=""):z=!e&&t.getAttribute("data-svg-origin"),ic(t,z||l,!!z||i.originIsAbsolute,i.smooth!==!1,T)),_=i.xOrigin||0,w=i.yOrigin||0,T!==jn&&(M=T[0],N=T[1],R=T[2],I=T[3],c=k=T[4],u=B=T[5],T.length===6?(f=Math.sqrt(M*M+N*N),p=Math.sqrt(I*I+R*R),m=M||N?mr(N,M)*Vs:0,y=R||I?mr(R,I)*Vs+m:0,y&&(p*=Math.abs(Math.cos(y*Dr))),i.svg&&(c-=_-(_*M+w*R),u-=w-(_*N+w*I))):(K=T[6],$=T[7],O=T[8],X=T[9],V=T[10],H=T[11],c=T[12],u=T[13],d=T[14],S=mr(K,V),g=S*Vs,S&&(C=Math.cos(-S),E=Math.sin(-S),z=k*C+O*E,Z=B*C+X*E,G=K*C+V*E,O=k*-E+O*C,X=B*-E+X*C,V=K*-E+V*C,H=$*-E+H*C,k=z,B=Z,K=G),S=mr(-R,V),x=S*Vs,S&&(C=Math.cos(-S),E=Math.sin(-S),z=M*C-O*E,Z=N*C-X*E,G=R*C-V*E,H=I*E+H*C,M=z,N=Z,R=G),S=mr(N,M),m=S*Vs,S&&(C=Math.cos(S),E=Math.sin(S),z=M*C+N*E,Z=k*C+B*E,N=N*C-M*E,B=B*C-k*E,M=z,k=Z),g&&Math.abs(g)+Math.abs(m)>359.9&&(g=m=0,x=180-x),f=Wt(Math.sqrt(M*M+N*N+R*R)),p=Wt(Math.sqrt(B*B+K*K)),S=mr(k,B),y=Math.abs(S)>2e-4?S*Vs:0,v=H?1/(H<0?-H:H):0),i.svg&&(z=t.getAttribute("transform"),i.forceCSS=t.setAttribute("transform","")||!nb(Ui(t,zt)),z&&t.setAttribute("transform",z))),Math.abs(y)>90&&Math.abs(y)<270&&(n?(f*=-1,y+=m<=0?180:-180,m+=m<=0?180:-180):(p*=-1,y+=y<=0?180:-180)),e=e||i.uncache,i.x=c-((i.xPercent=c&&(!e&&i.xPercent||(Math.round(t.offsetWidth/2)===Math.round(-c)?-50:0)))?t.offsetWidth*i.xPercent/100:0)+a,i.y=u-((i.yPercent=u&&(!e&&i.yPercent||(Math.round(t.offsetHeight/2)===Math.round(-u)?-50:0)))?t.offsetHeight*i.yPercent/100:0)+a,i.z=d+a,i.scaleX=Wt(f),i.scaleY=Wt(p),i.rotation=Wt(m)+o,i.rotationX=Wt(g)+o,i.rotationY=Wt(x)+o,i.skewX=y+o,i.skewY=b+o,i.transformPerspective=v+a,(i.zOrigin=parseFloat(l.split(" ")[2])||0)&&(r[bi]=xo(l)),i.xOffset=i.yOffset=0,i.force3D=De.force3D,i.renderTransform=i.svg?PC:eb?ab:EC,i.uncache=0,i},xo=function(t){return(t=t.split(" "))[0]+" "+t[1]},Jh=function(t,e,i){var r=be(e);return Wt(parseFloat(e)+parseFloat(Ss(t,"x",i+"px",r)))+r},EC=function(t,e){e.z="0px",e.rotationY=e.rotationX="0deg",e.force3D=0,ab(t,e)},Is="0deg",fn="0px",Fs=") ",ab=function(t,e){var i=e||this,r=i.xPercent,n=i.yPercent,a=i.x,o=i.y,h=i.z,l=i.rotation,c=i.rotationY,u=i.rotationX,d=i.skewX,f=i.skewY,p=i.scaleX,m=i.scaleY,g=i.transformPerspective,x=i.force3D,y=i.target,b=i.zOrigin,v="",_=x==="auto"&&t&&t!==1||x===!0;if(b&&(u!==Is||c!==Is)){var w=parseFloat(c)*Dr,T=Math.sin(w),S=Math.cos(w),C;w=parseFloat(u)*Dr,C=Math.cos(w),a=Jh(y,a,T*C*-b),o=Jh(y,o,-Math.sin(w)*-b),h=Jh(y,h,S*C*-b+b)}g!==fn&&(v+="perspective("+g+Fs),(r||n)&&(v+="translate("+r+"%, "+n+"%) "),(_||a!==fn||o!==fn||h!==fn)&&(v+=h!==fn||_?"translate3d("+a+", "+o+", "+h+") ":"translate("+a+", "+o+Fs),l!==Is&&(v+="rotate("+l+Fs),c!==Is&&(v+="rotateY("+c+Fs),u!==Is&&(v+="rotateX("+u+Fs),(d!==Is||f!==Is)&&(v+="skew("+d+", "+f+Fs),(p!==1||m!==1)&&(v+="scale("+p+", "+m+Fs),y.style[zt]=v||"translate(0, 0)"},PC=function(t,e){var i=e||this,r=i.xPercent,n=i.yPercent,a=i.x,o=i.y,h=i.rotation,l=i.skewX,c=i.skewY,u=i.scaleX,d=i.scaleY,f=i.target,p=i.xOrigin,m=i.yOrigin,g=i.xOffset,x=i.yOffset,y=i.forceCSS,b=parseFloat(a),v=parseFloat(o),_,w,T,S,C;h=parseFloat(h),l=parseFloat(l),c=parseFloat(c),c&&(c=parseFloat(c),l+=c,h+=c),h||l?(h*=Dr,l*=Dr,_=Math.cos(h)*u,w=Math.sin(h)*u,T=Math.sin(h-l)*-d,S=Math.cos(h-l)*d,l&&(c*=Dr,C=Math.tan(l-c),C=Math.sqrt(1+C*C),T*=C,S*=C,c&&(C=Math.tan(c),C=Math.sqrt(1+C*C),_*=C,w*=C)),_=Wt(_),w=Wt(w),T=Wt(T),S=Wt(S)):(_=u,S=d,w=T=0),(b&&!~(a+"").indexOf("px")||v&&!~(o+"").indexOf("px"))&&(b=Ss(f,"x",a,"px"),v=Ss(f,"y",o,"px")),(p||m||g||x)&&(b=Wt(b+p-(p*_+m*T)+g),v=Wt(v+m-(p*w+m*S)+x)),(r||n)&&(C=f.getBBox(),b=Wt(b+r/100*C.width),v=Wt(v+n/100*C.height)),C="matrix("+_+","+w+","+T+","+S+","+b+","+v+")",f.setAttribute("transform",C),y&&(f.style[zt]=C)},MC=function(t,e,i,r,n){var a=360,o=oe(n),h=parseFloat(n)*(o&&~n.indexOf("rad")?Vs:1),l=h-r,c=r+l+"deg",u,d;return o&&(u=n.split("_")[1],u==="short"&&(l%=a,l!==l%(a/2)&&(l+=l<0?a:-a)),u==="cw"&&l<0?l=(l+a*jd)%a-~~(l/a)*a:u==="ccw"&&l>0&&(l=(l-a*jd)%a-~~(l/a)*a)),t._pt=d=new Be(t._pt,e,i,r,l,dC),d.e=c,d.u="deg",t._props.push(i),d},tf=function(t,e){for(var i in e)t[i]=e[i];return t},kC=function(t,e,i){var r=tf({},i._gsap),n="perspective,force3D,transformOrigin,svgOrigin",a=i.style,o,h,l,c,u,d,f,p;r.svg?(l=i.getAttribute("transform"),i.setAttribute("transform",""),a[zt]=e,o=qn(i,1),Yn(i,zt),i.setAttribute("transform",l)):(l=getComputedStyle(i)[zt],a[zt]=e,o=qn(i,1),a[zt]=l);for(h in rs)l=r[h],c=o[h],l!==c&&n.indexOf(h)<0&&(f=be(l),p=be(c),u=f!==p?Ss(i,h,l,p):parseFloat(l),d=parseFloat(c),t._pt=new Be(t._pt,o,h,u,d-u,Ql),t._pt.u=p||0,t._props.push(h));tf(o,r)};Re("padding,margin,Width,Radius",function(s,t){var e="Top",i="Right",r="Bottom",n="Left",a=(t<3?[e,i,r,n]:[e+n,e+i,r+i,r+n]).map(function(o){return t<2?s+o:"border"+o+s});yo[t>1?"border"+s:s]=function(o,h,l,c,u){var d,f;if(arguments.length<4)return d=a.map(function(p){return qi(o,p,l)}),f=d.join(" "),f.split(d[0]).length===5?d[0]:f;d=(c+"").split(" "),f={},a.forEach(function(p,m){return f[p]=d[m]=d[m]||d[(m-1)/2|0]}),o.init(h,f,u)}});var ob={name:"css",register:ec,targetTest:function(t){return t.style&&t.nodeType},init:function(t,e,i,r,n){var a=this._props,o=t.style,h=i.vars.startAt,l,c,u,d,f,p,m,g,x,y,b,v,_,w,T,S;du||ec(),this.styles=this.styles||tb(t),S=this.styles.props,this.tween=i;for(m in e)if(m!=="autoRound"&&(c=e[m],!(Oe[m]&&H0(m,e,i,r,t,n)))){if(f=typeof c,p=yo[m],f==="function"&&(c=c.call(i,r,t,n),f=typeof c),f==="string"&&~c.indexOf("random(")&&(c=$n(c)),p)p(this,t,m,c,i)&&(T=1);else if(m.substr(0,2)==="--")l=(getComputedStyle(t).getPropertyValue(m)+"").trim(),c+="",ws.lastIndex=0,ws.test(l)||(g=be(l),x=be(c)),x?g!==x&&(l=Ss(t,m,l,x)+x):g&&(c+=g),this.add(o,"setProperty",l,c,r,n,0,0,m),a.push(m),S.push(m,0,o[m]);else if(f!=="undefined"){if(h&&m in h?(l=typeof h[m]=="function"?h[m].call(i,r,t,n):h[m],oe(l)&&~l.indexOf("random(")&&(l=$n(l)),be(l+"")||(l+=De.units[m]||be(qi(t,m))||""),(l+"").charAt(1)==="="&&(l=qi(t,m))):l=qi(t,m),d=parseFloat(l),y=f==="string"&&c.charAt(1)==="="&&c.substr(0,2),y&&(c=c.substr(2)),u=parseFloat(c),m in Ki&&(m==="autoAlpha"&&(d===1&&qi(t,"visibility")==="hidden"&&u&&(d=0),S.push("visibility",0,o.visibility),ys(this,o,"visibility",d?"inherit":"hidden",u?"inherit":"hidden",!u)),m!=="scale"&&m!=="transform"&&(m=Ki[m],~m.indexOf(",")&&(m=m.split(",")[0]))),b=m in rs,b){if(this.styles.save(m),v||(_=t._gsap,_.renderTransform&&!e.parseTransform||qn(t,e.parseTransform),w=e.smoothOrigin!==!1&&_.smooth,v=this._pt=new Be(this._pt,o,zt,0,1,_.renderTransform,_,0,-1),v.dep=1),m==="scale")this._pt=new Be(this._pt,_,"scaleY",_.scaleY,(y?Or(_.scaleY,y+u):u)-_.scaleY||0,Ql),this._pt.u=0,a.push("scaleY",m),m+="X";else if(m==="transformOrigin"){S.push(bi,0,o[bi]),c=CC(c),_.svg?ic(t,c,0,w,0,this):(x=parseFloat(c.split(" ")[2])||0,x!==_.zOrigin&&ys(this,_,"zOrigin",_.zOrigin,x),ys(this,o,m,xo(l),xo(c)));continue}else if(m==="svgOrigin"){ic(t,c,1,w,0,this);continue}else if(m in rb){MC(this,_,m,d,y?Or(d,y+c):c);continue}else if(m==="smoothOrigin"){ys(this,_,"smooth",_.smooth,c);continue}else if(m==="force3D"){_[m]=c;continue}else if(m==="transform"){kC(this,c,t);continue}}else m in o||(m=sn(m)||m);if(b||(u||u===0)&&(d||d===0)&&!uC.test(c)&&m in o)g=(l+"").substr((d+"").length),u||(u=0),x=be(c)||(m in De.units?De.units[m]:g),g!==x&&(d=Ss(t,m,l,x)),this._pt=new Be(this._pt,b?_:o,m,d,(y?Or(d,y+u):u)-d,!b&&(x==="px"||m==="zIndex")&&e.autoRound!==!1?pC:Ql),this._pt.u=x||0,g!==x&&x!=="%"&&(this._pt.b=l,this._pt.r=fC);else if(m in o)SC.call(this,t,m,l,y?y+c:c);else if(m in t)this.add(t,m,l||t[m],y?y+c:c,r,n);else if(m!=="parseTransform"){su(m,c);continue}b||(m in o?S.push(m,0,o[m]):S.push(m,1,l||t[m])),a.push(m)}}T&&q0(this)},render:function(t,e){if(e.tween._time||!fu())for(var i=e._pt;i;)i.r(t,i.d),i=i._next;else e.styles.revert()},get:qi,aliases:Ki,getSetter:function(t,e,i){var r=Ki[e];return r&&r.indexOf(",")<0&&(e=r),e in rs&&e!==bi&&(t._gsap.x||qi(t,"x"))?i&&Yd===i?e==="scale"?yC:bC:(Yd=i||{})&&(e==="scale"?xC:vC):t.style&&!eu(t.style[e])?mC:~e.indexOf("-")?gC:cu(t,e)},core:{_removeProperty:Yn,_getMatrix:mu}};Ve.utils.checkPrefix=sn;Ve.core.getStyleSaver=tb;(function(s,t,e,i){var r=Re(s+","+t+","+e,function(n){rs[n]=1});Re(t,function(n){De.units[n]="deg",rb[n]=1}),Ki[r[13]]=s+","+t,Re(i,function(n){var a=n.split(":");Ki[a[1]]=r[a[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");Re("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(s){De.units[s]="px"});Ve.registerPlugin(ob);var P=Ve.registerPlugin(ob)||Ve;P.core.Tween;function hb(s=6,t=6,e){const i=[];for(let r=0;r<s;r++)for(let n=0;n<t;n++){let a=ef(e);const o=[];for(;BC(i,{row:r,column:n},a);)o.push(a),a=ef(e,o);i[r]||(i[r]=[]),i[r][n]=a}return i}function RC(s){const t=[];for(const e of s)t.push(e.slice());return t}function BC(s,t,e){var l,c,u,d;const i=(l=s==null?void 0:s[t.row])==null?void 0:l[t.column-1],r=(c=s==null?void 0:s[t.row])==null?void 0:c[t.column-2],n=e===i&&e===r,a=(u=s==null?void 0:s[t.row-1])==null?void 0:u[t.column],o=(d=s==null?void 0:s[t.row-2])==null?void 0:d[t.column];return n||e===a&&e===o}function ef(s,t){let e=[...s];t&&(e=s.filter(r=>!t.includes(r)));const i=Math.floor(Math.random()*e.length);return e[i]}function sc(s,t,e){const i=mi(s,t),r=mi(s,e);i!==void 0&&r!==void 0&&(vo(s,t,r),vo(s,e,i))}function vo(s,t,e){s[t.row][t.column]=e}function mi(s,t){var e;return(e=s==null?void 0:s[t.row])==null?void 0:e[t.column]}function sf(s,t){const e=s.length,i=s[0].length;return t.row>=0&&t.row<e&&t.column>=0&&t.column<i}function rc(s,t){for(let e=0;e<s.length;e++)for(let i=0;i<s[e].length;i++)t({row:e,column:i},s[e][i])}function rf(s,t,e){const i=[],r=s.length,n=s[0].length;let a,o=[];const h=e==="horizontal"?r:n,l=e==="horizontal"?n:r;for(let c=0;c<h;c++){for(let u=0;u<l;u++){const d=e==="horizontal"?c:u,f=e==="horizontal"?u:c,p=s[d][f];p&&p===a?o.push({row:d,column:f}):(o.length>=t&&i.push(o),o=[{row:d,column:f}],a=p)}o.length>=t&&i.push(o),a=void 0,o=[]}return i}function lb(s,t){return s.row===t.row&&s.column==t.column}function IC(s,t){for(const e of s)if(lb(e,t))return!0;return!1}function Fn(s,t,e=3){const i=[...rf(s,e,"horizontal"),...rf(s,e,"vertical")];if(!t)return i;const r=[];for(const n of i){let a=!1;for(const o of n)for(const h of t)lb(o,h)&&(a=!0);a&&r.push(n)}return r}function FC(s){const t=s.length,e=s[0].length,i=[];for(let r=t-1;r>=0;r--)for(let n=0;n<e;n++){let a={row:r,column:n},o={row:r+1,column:n},h=!1;if(!sf(s,o))continue;let l=mi(s,o);for(;sf(s,o)&&l===0;)h=!0,sc(s,a,o),a={...o},o.row+=1,l=mi(s,o);h&&i.push([{row:r,column:n},a])}return i}function UC(s){const t=[],e=s.length,i=s[0].length;for(let r=0;r<e;r++)for(let n=0;n<i;n++)s[r][n]||t.push({row:r,column:n});return t}function LC(s){const t=[];for(const e of s){const i=e.map(r=>String(r).padStart(2,"0"));t.push("|"+i.join("|")+"|")}return t.join(`
`)}function OC(s,t){const e=hb(s.length,s[0].length,t),i=s.length,r=s[0].length,n=[];for(let a=0;a<i;a++)for(let o=0;o<r;o++)s[a][o]||(s[a][o]=e[a][o],n.push({row:a,column:o}));return n.reverse()}function NC(s){return s.row+":"+s.column}function DC(s){const t=s.split(":");return{row:Number(t[0]),column:Number(t[1])}}class GC{constructor(t){A(this,"match3");A(this,"freeMoves",!1);this.match3=t}setup(t){this.freeMoves=t.freeMoves}async actionMove(t,e){if(!this.match3.isPlaying())return;const i=this.match3.board.getPieceByPosition(t),r=this.match3.board.getPieceByPosition(e);if(!i||!r||i.isLocked()||r.isLocked())return;const n=this.match3.board.getTypeByPosition(t),a=this.match3.board.getTypeByPosition(e);!n||!a||(console.log("[Match3] ACTION! Move:",t,"to:",e),await this.swapPieces(i,r),this.match3.process.start())}async actionTap(t){if(!this.match3.isPlaying())return;const e=this.match3.board.getPieceByPosition(t),i=this.match3.board.getTypeByPosition(t);!e||!this.match3.special.isSpecial(i)||e.isLocked()||(console.log("[Match3] ACTION! Tap:",t),await this.match3.board.popPiece(e),this.match3.process.start())}validateMove(t,e){if(this.freeMoves)return!0;const i=mi(this.match3.board.grid,t),r=this.match3.special.isSpecial(i),n=this.match3.special.isSpecial(mi(this.match3.board.grid,e));if(r||n)return!0;const a=RC(this.match3.board.grid);return sc(a,t,e),Fn(a,[t,e]).length>=1}async swapPieces(t,e){var h,l;const i=t.getGridPosition(),r=e.getGridPosition();console.log("[Match3] Swap",i,r);const n=this.match3.board.getViewPositionByGridPosition(i),a=this.match3.board.getViewPositionByGridPosition(r),o=this.validateMove(i,r);if((l=(h=this.match3).onMove)==null||l.call(h,{from:i,to:r,valid:o}),o&&(sc(this.match3.board.grid,i,r),t.row=r.row,t.column=r.column,e.row=i.row,e.column=i.column),this.match3.board.bringToFront(t),await Promise.all([t.animateSwap(a.x,a.y),e.animateSwap(n.x,n.y)]),o)this.match3.special.isSpecial(mi(this.match3.board.grid,i))?await this.match3.board.popPiece(i):this.match3.special.isSpecial(mi(this.match3.board.grid,r))&&await this.match3.board.popPiece(r);else{const c=this.match3.board.getViewPositionByGridPosition(i),u=this.match3.board.getViewPositionByGridPosition(r);this.match3.board.bringToFront(e),await Promise.all([t.animateSwap(c.x,c.y),e.animateSwap(u.x,u.y)])}}}const nf=["test","easy","normal","hard"],af={test:["piece-dragon","piece-frog","piece-newt"],easy:["piece-dragon","piece-frog","piece-newt","piece-snake"],normal:["piece-dragon","piece-frog","piece-newt","piece-snake","piece-spider"],hard:["piece-dragon","piece-frog","piece-newt","piece-snake","piece-spider","piece-yeti"],special:["special-blast","special-row","special-column","special-colour"]},VC={rows:9,columns:7,tileSize:50,freeMoves:!1,duration:60,mode:"normal"};function cb(s={}){return{...VC,...s}}function zC(s){return[...af[s],...af.special]}/*!
 * paths 3.11.4
 * https://greensock.com
 *
 * Copyright 2008-2022, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var HC=/[achlmqstvz]|(-?\d*\.?\d*(?:e[\-+]?\d+)?)[0-9]/ig,XC=/[\+\-]?\d*\.?\d+e[\+\-]?\d+/ig,$C=Math.PI/180,Ta=Math.sin,Sa=Math.cos,Un=Math.abs,pn=Math.sqrt,WC=function(t){return typeof t=="number"},of=1e5,cs=function(t){return Math.round(t*of)/of||0};function YC(s,t,e,i,r,n,a){for(var o=s.length,h,l,c,u,d;--o>-1;)for(h=s[o],l=h.length,c=0;c<l;c+=2)u=h[c],d=h[c+1],h[c]=u*t+d*i+n,h[c+1]=u*e+d*r+a;return s._dirty=1,s}function jC(s,t,e,i,r,n,a,o,h){if(!(s===o&&t===h)){e=Un(e),i=Un(i);var l=r%360*$C,c=Sa(l),u=Ta(l),d=Math.PI,f=d*2,p=(s-o)/2,m=(t-h)/2,g=c*p+u*m,x=-u*p+c*m,y=g*g,b=x*x,v=y/(e*e)+b/(i*i);v>1&&(e=pn(v)*e,i=pn(v)*i);var _=e*e,w=i*i,T=(_*w-_*b-w*y)/(_*b+w*y);T<0&&(T=0);var S=(n===a?-1:1)*pn(T),C=S*(e*x/i),E=S*-(i*g/e),M=(s+o)/2,N=(t+h)/2,R=M+(c*C-u*E),I=N+(u*C+c*E),k=(g-C)/e,B=(x-E)/i,z=(-g-C)/e,Z=(-x-E)/i,G=k*k+B*B,O=(B<0?-1:1)*Math.acos(k/pn(G)),X=(k*Z-B*z<0?-1:1)*Math.acos((k*z+B*Z)/pn(G*(z*z+Z*Z)));isNaN(X)&&(X=d),!a&&X>0?X-=f:a&&X<0&&(X+=f),O%=f,X%=f;var V=Math.ceil(Un(X)/(f/4)),$=[],H=X/V,K=4/3*Ta(H/2)/(1+Sa(H/2)),nt=c*e,St=u*e,ut=u*-i,_t=c*i,ht;for(ht=0;ht<V;ht++)r=O+ht*H,g=Sa(r),x=Ta(r),k=Sa(r+=H),B=Ta(r),$.push(g-K*x,x+K*g,k+K*B,B-K*k,k,B);for(ht=0;ht<$.length;ht+=2)g=$[ht],x=$[ht+1],$[ht]=g*nt+x*ut+R,$[ht+1]=g*St+x*_t+I;return $[ht-2]=o,$[ht-1]=h,$}}function qC(s){var t=(s+"").replace(XC,function(C){var E=+C;return E<1e-4&&E>-1e-4?0:E}).match(HC)||[],e=[],i=0,r=0,n=2/3,a=t.length,o=0,h="ERROR: malformed path: "+s,l,c,u,d,f,p,m,g,x,y,b,v,_,w,T,S=function(E,M,N,R){y=(N-E)/3,b=(R-M)/3,m.push(E+y,M+b,N-y,R-b,N,R)};if(!s||!isNaN(t[0])||isNaN(t[1]))return console.log(h),e;for(l=0;l<a;l++)if(_=f,isNaN(t[l])?(f=t[l].toUpperCase(),p=f!==t[l]):l--,u=+t[l+1],d=+t[l+2],p&&(u+=i,d+=r),l||(g=u,x=d),f==="M")m&&(m.length<8?e.length-=1:o+=m.length),i=g=u,r=x=d,m=[u,d],e.push(m),l+=2,f="L";else if(f==="C")m||(m=[0,0]),p||(i=r=0),m.push(u,d,i+t[l+3]*1,r+t[l+4]*1,i+=t[l+5]*1,r+=t[l+6]*1),l+=6;else if(f==="S")y=i,b=r,(_==="C"||_==="S")&&(y+=i-m[m.length-4],b+=r-m[m.length-3]),p||(i=r=0),m.push(y,b,u,d,i+=t[l+3]*1,r+=t[l+4]*1),l+=4;else if(f==="Q")y=i+(u-i)*n,b=r+(d-r)*n,p||(i=r=0),i+=t[l+3]*1,r+=t[l+4]*1,m.push(y,b,i+(u-i)*n,r+(d-r)*n,i,r),l+=4;else if(f==="T")y=i-m[m.length-4],b=r-m[m.length-3],m.push(i+y,r+b,u+(i+y*1.5-u)*n,d+(r+b*1.5-d)*n,i=u,r=d),l+=2;else if(f==="H")S(i,r,i=u,r),l+=1;else if(f==="V")S(i,r,i,r=u+(p?r-i:0)),l+=1;else if(f==="L"||f==="Z")f==="Z"&&(u=g,d=x,m.closed=!0),(f==="L"||Un(i-u)>.5||Un(r-d)>.5)&&(S(i,r,u,d),f==="L"&&(l+=2)),i=u,r=d;else if(f==="A"){if(w=t[l+4],T=t[l+5],y=t[l+6],b=t[l+7],c=7,w.length>1&&(w.length<3?(b=y,y=T,c--):(b=T,y=w.substr(2),c-=2),T=w.charAt(1),w=w.charAt(0)),v=jC(i,r,+t[l+1],+t[l+2],+t[l+3],+w,+T,(p?i:0)+y*1,(p?r:0)+b*1),l+=c,v)for(c=0;c<v.length;c++)m.push(v[c]);i=m[m.length-2],r=m[m.length-1]}else console.log(h);return l=m.length,l<6?(e.pop(),l=0):m[0]===m[l-2]&&m[1]===m[l-1]&&(m.closed=!0),e.totalPoints=o+l,e}function KC(s){WC(s[0])&&(s=[s]);var t="",e=s.length,i,r,n,a;for(r=0;r<e;r++){for(a=s[r],t+="M"+cs(a[0])+","+cs(a[1])+" C",i=a.length,n=2;n<i;n++)t+=cs(a[n++])+","+cs(a[n++])+" "+cs(a[n++])+","+cs(a[n++])+" "+cs(a[n++])+","+cs(a[n])+" ";a.closed&&(t+="z")}return t}/*!
 * CustomEase 3.11.4
 * https://greensock.com
 *
 * @license Copyright 2008-2022, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var Ee,ub,db=function(){return Ee||typeof window<"u"&&(Ee=window.gsap)&&Ee.registerPlugin&&Ee},hf=function(){Ee=db(),Ee?(Ee.registerEase("_CE",rn.create),ub=1):console.warn("Please gsap.registerPlugin(CustomEase)")},ZC=1e20,Ca=function(t){return~~(t*1e3+(t<0?-.5:.5))/1e3},JC=/[-+=\.]*\d+[\.e\-\+]*\d*[e\-\+]*\d*/gi,QC=/[cLlsSaAhHvVtTqQ]/g,tA=function(t){var e=t.length,i=ZC,r;for(r=1;r<e;r+=6)+t[r]<i&&(i=+t[r]);return i},eA=function(t,e,i){!i&&i!==0&&(i=Math.max(+t[t.length-1],+t[1]));var r=+t[0]*-1,n=-i,a=t.length,o=1/(+t[a-2]+r),h=-e||(Math.abs(+t[a-1]-+t[1])<.01*(+t[a-2]-+t[0])?tA(t)+n:+t[a-1]+n),l;for(h?h=1/h:h=-o,l=0;l<a;l+=2)t[l]=(+t[l]+r)*o,t[l+1]=(+t[l+1]+n)*h},iA=function s(t,e,i,r,n,a,o,h,l,c,u){var d=(t+i)/2,f=(e+r)/2,p=(i+n)/2,m=(r+a)/2,g=(n+o)/2,x=(a+h)/2,y=(d+p)/2,b=(f+m)/2,v=(p+g)/2,_=(m+x)/2,w=(y+v)/2,T=(b+_)/2,S=o-t,C=h-e,E=Math.abs((i-o)*C-(r-h)*S),M=Math.abs((n-o)*C-(a-h)*S),N;return c||(c=[{x:t,y:e},{x:o,y:h}],u=1),c.splice(u||c.length-1,0,{x:w,y:T}),(E+M)*(E+M)>l*(S*S+C*C)&&(N=c.length,s(t,e,d,f,y,b,w,T,l,c,u),s(w,T,v,_,g,x,o,h,l,c,u+1+(c.length-N))),c},rn=function(){function s(e,i,r){ub||hf(),this.id=e,this.setData(i,r)}var t=s.prototype;return t.setData=function(i,r){r=r||{},i=i||"0,0,1,1";var n=i.match(JC),a=1,o=[],h=[],l=r.precision||1,c=l<=1,u,d,f,p,m,g,x,y,b;if(this.data=i,(QC.test(i)||~i.indexOf("M")&&i.indexOf("C")<0)&&(n=qC(i)[0]),u=n.length,u===4)n.unshift(0,0),n.push(1,1),u=8;else if((u-2)%6)throw"Invalid CustomEase";for((+n[0]!=0||+n[u-2]!=1)&&eA(n,r.height,r.originY),this.segment=n,p=2;p<u;p+=6)d={x:+n[p-2],y:+n[p-1]},f={x:+n[p+4],y:+n[p+5]},o.push(d,f),iA(d.x,d.y,+n[p],+n[p+1],+n[p+2],+n[p+3],f.x,f.y,1/(l*2e5),o,o.length-1);for(u=o.length,p=0;p<u;p++)x=o[p],y=o[p-1]||x,(x.x>y.x||y.y!==x.y&&y.x===x.x||x===y)&&x.x<=1?(y.cx=x.x-y.x,y.cy=x.y-y.y,y.n=x,y.nx=x.x,c&&p>1&&Math.abs(y.cy/y.cx-o[p-2].cy/o[p-2].cx)>2&&(c=0),y.cx<a&&(y.cx?a=y.cx:(y.cx=.001,p===u-1&&(y.x-=.001,a=Math.min(a,.001),c=0)))):(o.splice(p--,1),u--);if(u=1/a+1|0,m=1/u,g=0,x=o[0],c){for(p=0;p<u;p++)b=p*m,x.nx<b&&(x=o[++g]),d=x.y+(b-x.x)/x.cx*x.cy,h[p]={x:b,cx:m,y:d,cy:0,nx:9},p&&(h[p-1].cy=d-h[p-1].y);h[u-1].cy=o[o.length-1].y-d}else{for(p=0;p<u;p++)x.nx<p*m&&(x=o[++g]),h[p]=x;g<o.length-1&&(h[p-1]=o[o.length-2])}return this.ease=function(v){var _=h[v*u|0]||h[u-1];return _.nx<v&&(_=_.n),_.y+(v-_.x)/_.cx*_.cy},this.ease.custom=this,this.id&&Ee&&Ee.registerEase(this.id,this.ease),this},t.getSVGData=function(i){return s.getSVGData(this,i)},s.create=function(i,r,n){return new s(i,r,n).ease},s.register=function(i){Ee=i,hf()},s.get=function(i){return Ee.parseEase(i)},s.getSVGData=function(i,r){r=r||{};var n=r.width||100,a=r.height||100,o=r.x||0,h=(r.y||0)+a,l=Ee.utils.toArray(r.path)[0],c,u,d,f,p,m,g,x,y,b;if(r.invert&&(a=-a,h=0),typeof i=="string"&&(i=Ee.parseEase(i)),i.custom&&(i=i.custom),i instanceof s)c=KC(YC([i.segment],n,0,0,-a,o,h));else{for(c=[o,h],g=Math.max(5,(r.precision||1)*200),f=1/g,g+=2,x=5/g,y=Ca(o+f*n),b=Ca(h+i(f)*-a),u=(b-h)/(y-o),d=2;d<g;d++)p=Ca(o+d*f*n),m=Ca(h+i(d*f)*-a),(Math.abs((m-b)/(p-y)-u)>x||d===g-1)&&(c.push(y,b),u=(m-b)/(p-y)),y=p,b=m;c="M"+c.join(",")}return l&&l.setAttribute("d",c),c},s}();db()&&Ee.registerPlugin(rn);rn.version="3.11.4";function Lt(s,t,e=Math.random){const i=Math.min(s,t),r=Math.max(s,t);return i+(r-i)*e()}P.registerPlugin(rn);let sA=1;function or(s,t){if(t||(t="customEase"+sA++),rn.get(t))throw new Error("Custom ease already registered: "+t);return rn.create(t,s)}async function us(s){const t=P.getTweensOf(s);for(const e of t)e._prom&&e._prom();P.killTweensOf(s)}function Aa(s){const t=P.getTweensOf(s);for(const e of t)e.pause()}function Ea(s){const t=P.getTweensOf(s);for(const e of t)e.resume()}async function Gr(s,t=8,e=.5){const i={power:t};await P.to(i,{power:0,duration:e,ease:"linear",onUpdate:()=>{s&&(s.x=Lt(-i.power,i.power),s.y=Lt(-i.power,i.power))}})}const rA={name:"",type:0,size:50,highlight:!1,interactive:!1},nA=or("M0,0,C0.14,0,0.27,0.191,0.352,0.33,0.43,0.462,0.53,0.963,0.538,1,0.546,0.985,0.672,0.83,0.778,0.83,0.888,0.83,0.993,0.983,1,1");class nc extends W{constructor(){super();A(this,"area");A(this,"image");A(this,"highlight");A(this,"pressing",!1);A(this,"dragging",!1);A(this,"pressX",0);A(this,"pressY",0);A(this,"paused",!1);A(this,"row",0);A(this,"column",0);A(this,"type",0);A(this,"name","");A(this,"onMove");A(this,"onTap");A(this,"onPointerDown",e=>{this.isLocked()||(this.pressing=!0,this.dragging=!1,this.pressX=e.globalX,this.pressY=e.globalY)});A(this,"onPointerMove",e=>{var h,l,c,u;if(!this.pressing||this.isLocked())return;const i=e.globalX-this.pressX,r=e.globalY-this.pressY,n=Math.abs(i),a=Math.abs(r);if(Math.sqrt(n*n+a*a)>10){this.dragging=!0;const d={row:this.row,column:this.column},f={row:this.row,column:this.column};n>a?i<0?(f.column-=1,(h=this.onMove)==null||h.call(this,d,f)):(f.column+=1,(l=this.onMove)==null||l.call(this,d,f)):r<0?(f.row-=1,(c=this.onMove)==null||c.call(this,d,f)):(f.row+=1,(u=this.onMove)==null||u.call(this,d,f)),this.onPointerUp()}});A(this,"onPointerUp",()=>{var e;if(this.pressing&&!this.dragging&&!this.isLocked()){const i={row:this.row,column:this.column};(e=this.onTap)==null||e.call(this,i)}this.dragging=!1,this.pressing=!1});this.highlight=lt.from("highlight"),this.highlight.anchor.set(.5),this.addChild(this.highlight),this.image=new lt,this.image.anchor.set(.5),this.addChild(this.image),this.area=lt.from(j.WHITE),this.area.anchor.set(.5),this.area.alpha=0,this.addChild(this.area),this.area.on("pointerdown",this.onPointerDown),this.area.on("pointermove",this.onPointerMove),this.area.on("pointerup",this.onPointerUp),this.area.on("pointerupoutside",this.onPointerUp),this.area.on("pointercancel",this.onPointerUp),this.onRender=()=>{this.paused||(this.highlight.visible?(this.highlight.rotation+=Ct.ticker.deltaTime*.03,this.image.rotation=Math.sin(Ct.ticker.lastTime*.01)*.1):this.image.rotation=0)}}setup(e={}){const i={...rA,...e};this.killTweens(),this.paused=!1,this.pressing=!1,this.dragging=!1,this.visible=!0,this.alpha=1,this.type=i.type,this.name=i.name,this.image.alpha=1,this.scale.set(1),this.image.texture=j.from(i.name),this.image.width=i.size-(i.highlight?2:8),this.image.height=this.image.width,this.highlight.visible=i.highlight,this.highlight.width=i.size,this.highlight.height=i.size,this.highlight.alpha=.3,this.area.width=i.size,this.area.height=i.size,this.area.interactive=i.interactive,this.area.cursor="pointer",this.unlock()}async animateSwap(e,i){this.lock(),us(this);const r=.2;await P.to(this,{x:e,y:i,duration:r,ease:"quad.out"}),this.unlock()}async animateFall(e,i){this.lock(),us(this.position);const r=.5;await P.to(this.position,{x:e,y:i,duration:r,ease:nA}),this.unlock()}async animatePop(){this.lock(),us(this.image);const e=.1;await P.to(this.image,{alpha:0,duration:e,ease:"sine.out"}),this.visible=!1}async animateSpawn(){this.lock(),us(this.scale),this.scale.set(2),this.visible=!0;const e=.2;P.to(this.scale,{x:1,y:1,duration:e,ease:"back.out"}),this.unlock()}killTweens(){us(this),us(this.position),us(this.scale),us(this.image)}pause(){this.paused=!0,Aa(this),Aa(this.position),Aa(this.scale),Aa(this.image)}resume(){this.paused=!1,Ea(this),Ea(this.position),Ea(this.scale),Ea(this.image)}lock(){this.interactiveChildren=!1,this.dragging=!1,this.pressing=!1}unlock(){this.interactiveChildren=!0}isLocked(){return!this.interactiveChildren}getGridPosition(){return{row:this.row,column:this.column}}}class aA{constructor(t){A(this,"match3");A(this,"grid",[]);A(this,"pieces",[]);A(this,"piecesMask");A(this,"piecesContainer");A(this,"rows",0);A(this,"columns",0);A(this,"tileSize",0);A(this,"commonTypes",[]);A(this,"typesMap");this.match3=t,this.piecesContainer=new W,this.match3.addChild(this.piecesContainer),this.piecesMask=new kn,this.piecesMask.context.rect(-2,-2,4,4).fill({color:16711680,alpha:.5}),this.match3.addChild(this.piecesMask),this.piecesContainer.mask=this.piecesMask}setup(t){this.rows=t.rows,this.columns=t.columns,this.tileSize=t.tileSize,this.piecesMask.width=this.getWidth(),this.piecesMask.height=this.getHeight(),this.piecesContainer.visible=!0;const e=zC(t.mode);this.typesMap={};for(let i=0;i<e.length;i++){const r=e[i],n=i+1;this.match3.special.isSpecialAvailable(r)?this.match3.special.addSpecialHandler(r,n):this.commonTypes.push(n),this.typesMap[n]=r}this.grid=hb(this.rows,this.columns,this.commonTypes),rc(this.grid,(i,r)=>{this.createPiece(i,r)})}reset(){let t=this.pieces.length;for(;t--;){const e=this.pieces[t];this.disposePiece(e)}this.pieces.length=0}createPiece(t,e){const i=this.typesMap[e],r=ci.get(nc),n=this.getViewPositionByGridPosition(t);return r.onMove=(a,o)=>this.match3.actions.actionMove(a,o),r.onTap=a=>this.match3.actions.actionTap(a),r.setup({name:i,type:e,size:this.match3.config.tileSize,interactive:!0,highlight:this.match3.special.isSpecial(e)}),r.row=t.row,r.column=t.column,r.x=n.x,r.y=n.y,this.pieces.push(r),this.piecesContainer.addChild(r),r}disposePiece(t){this.pieces.includes(t)&&this.pieces.splice(this.pieces.indexOf(t),1),t.parent&&t.parent.removeChild(t),ci.giveBack(t)}async spawnPiece(t,e){const i=this.getPieceByPosition(t);if(i&&this.disposePiece(i),vo(this.grid,t,e),!e)return;await this.createPiece(t,e).animateSpawn()}async popPiece(t,e=!1){var h,l;const i=this.getPieceByPosition(t),r=mi(this.grid,t);if(!r||!i)return;const n=this.match3.special.isSpecial(r),a=this.match3.process.getProcessRound();vo(this.grid,t,0);const o={piece:i,type:r,combo:a,isSpecial:n,causedBySpecial:e};this.match3.stats.registerPop(o),(l=(h=this.match3).onPop)==null||l.call(h,o),this.pieces.includes(i)&&this.pieces.splice(this.pieces.indexOf(i),1),await i.animatePop(),this.disposePiece(i),await this.match3.special.trigger(r,t)}async popPieces(t,e=!1){const i=[];for(const r of t)i.push(this.popPiece(r,e));await Promise.all(i)}getPieceByPosition(t){for(const e of this.pieces)if(e.row===t.row&&e.column===t.column)return e;return null}getViewPositionByGridPosition(t){const e=(this.columns-1)*this.tileSize/2,i=(this.rows-1)*this.tileSize/2,r=t.column*this.tileSize-e,n=t.row*this.tileSize-i;return{x:r,y:n}}getTypeByPosition(t){return mi(this.grid,t)}getWidth(){return this.tileSize*this.columns}getHeight(){return this.tileSize*this.rows}pause(){for(const t of this.pieces)t.pause()}resume(){for(const t of this.pieces)t.resume()}bringToFront(t){this.piecesContainer.addChild(t)}}function gi(s=1){return new Promise(t=>{setTimeout(()=>t(),s*1e3)})}class oA{constructor(){A(this,"queue",[]);A(this,"paused",!1);A(this,"processing",!1)}pause(){this.paused=!0}resume(){this.paused=!1}isProcessing(){return this.processing}isPaused(){return this.processing}async add(t,e=!0){this.queue.push(t),e&&await this.process()}async process(){if(!this.processing){for(this.processing=!0;this.queue.length;)if(this.paused)await gi(.1);else{const t=this.queue.shift();t&&await t()}this.processing=!1}}clear(){this.queue.length=0,this.processing=!1,this.paused=!1}}class hA{constructor(t){A(this,"match3");A(this,"processing",!1);A(this,"round",0);A(this,"queue");this.match3=t,this.queue=new oA}isProcessing(){return this.processing}getProcessRound(){return this.round}reset(){this.processing=!1,this.round=0,this.queue.clear()}pause(){this.queue.pause()}resume(){this.queue.resume()}async start(){var t,e;this.processing||!this.match3.isPlaying()||(this.processing=!0,this.round=0,(e=(t=this.match3).onProcessStart)==null||e.call(t),console.log("[Match3] ======= PROCESSING START =========="),this.runProcessRound())}async stop(){var t,e;this.processing&&(this.processing=!1,this.queue.clear(),console.log("[Match3] Sequence rounds:",this.round),console.log("[Match3] Board pieces:",this.match3.board.pieces.length),console.log(`[Match3] Grid:
`+LC(this.match3.board.grid)),console.log("[Match3] ======= PROCESSING COMPLETE ======="),(e=(t=this.match3).onProcessComplete)==null||e.call(t))}async runProcessRound(){this.queue.add(async()=>{this.round+=1,console.log(`[Match3] -- SEQUENCE ROUND #${this.round} START`),this.updateStats()}),this.queue.add(async()=>{await this.processSpecialMatches()}),this.queue.add(async()=>{await this.processRegularMatches()}),this.queue.add(async()=>{this.applyGravity()}),this.queue.add(async()=>{await this.refillGrid()}),this.queue.add(async()=>{console.log(`[Match3] -- SEQUENCE ROUND #${this.round} FINISH`),this.processCheckpoint()})}async updateStats(){var i,r;const t=Fn(this.match3.board.grid);if(!t.length)return;console.log("[Match3] Update stats");const e={matches:t,combo:this.getProcessRound()};this.match3.stats.registerMatch(e),(r=(i=this.match3).onMatch)==null||r.call(i,e)}async processSpecialMatches(){console.log("[Match3] Process special matches"),await this.match3.special.process()}async processRegularMatches(){console.log("[Match3] Process regular matches");const t=Fn(this.match3.board.grid),e=[];for(const i of t)e.push(this.match3.board.popPieces(i));await Promise.all(e)}async applyGravity(){const t=FC(this.match3.board.grid);console.log("[Match3] Apply gravity - moved pieces:",t.length);const e=[];for(const i of t){const r=i[0],n=i[1],a=this.match3.board.getPieceByPosition(r);if(!a)continue;a.row=n.row,a.column=n.column;const o=this.match3.board.getViewPositionByGridPosition(n);e.push(a.animateFall(o.x,o.y))}await Promise.all(e)}async refillGrid(){const t=OC(this.match3.board.grid,this.match3.board.commonTypes);console.log("[Match3] Refill grid - new pieces:",t.length);const e=[],i={};for(const r of t){const n=mi(this.match3.board.grid,r),a=this.match3.board.createPiece(r,n);i[a.column]||(i[a.column]=0),i[a.column]+=1;const o=a.x,h=a.y,l=i[a.column],c=this.match3.board.getHeight();a.y=-c*.5-l*this.match3.config.tileSize,e.push(a.animateFall(o,h))}await Promise.all(e)}async processCheckpoint(){const t=Fn(this.match3.board.grid),e=UC(this.match3.board.grid);console.log("[Match3] Checkpoint - New matches:",t.length),console.log("[Match3] Checkpoint - Empty spaces:",e.length),t.length||e.length?(console.log("[Match3] Checkpoint - Another sequence run is needed"),this.runProcessRound()):(console.log("[Match3] Checkpoint - Nothing left to do, all good"),this.stop())}}class lA{constructor(t,e){A(this,"match3");A(this,"pieceType");this.match3=t,this.pieceType=e}async process(t){const e=[],i=[],r={},n=[];for(const a of t)for(const o of a)e.push({...o});for(const a of e){const o=NC(a);r[o]||(r[o]=[]);for(const h of t)IC(h,a)&&r[o].push(h)}for(let a in r)if(!(r[a].length<2)){i.push(DC(a));for(const o of r[a])n.push(this.match3.board.popPieces(o))}await Promise.all(n);for(const a of i)await this.match3.board.spawnPiece(a,this.pieceType)}async trigger(t,e){if(t!==this.pieceType)return;const i=[{row:e.row-2,column:e.column},{row:e.row-1,column:e.column-1},{row:e.row-1,column:e.column},{row:e.row-1,column:e.column+1},{row:e.row,column:e.column-2},{row:e.row,column:e.column-1},{row:e.row,column:e.column+1},{row:e.row,column:e.column+2},{row:e.row+1,column:e.column-1},{row:e.row+1,column:e.column},{row:e.row+1,column:e.column+1},{row:e.row+2,column:e.column}];await this.match3.board.popPieces(i,!0)}}class cA{constructor(t,e){A(this,"match3");A(this,"pieceType");this.match3=t,this.pieceType=e}async process(t){let e=t.length;for(;e--;){const i=t[e];if(i.length<5)continue;const r=Math.floor(i.length/2),n=i[r];await this.match3.board.popPieces(i),await this.match3.board.spawnPiece(n,this.pieceType)}}async trigger(t){if(t!==this.pieceType)return;const e={};let i=0,r=0;rc(this.match3.board.grid,(a,o)=>{this.match3.board.commonTypes.includes(o)&&(e[o]||(e[o]=0),e[o]+=1,e[o]>=r&&(r=e[o],i=o))});const n=[];rc(this.match3.board.grid,(a,o)=>{o===i&&n.push(a)}),await this.match3.board.popPieces(n,!0)}}class uA{constructor(t,e){A(this,"match3");A(this,"pieceType");this.match3=t,this.pieceType=e}async process(t){let e=t.length;for(;e--;){const i=t[e];if(i.length==4&&i[0].row===i[1].row){const r=Math.floor(i.length/2),n=i[r];await this.match3.board.popPieces(i),await this.match3.board.spawnPiece(n,this.pieceType)}}}async trigger(t,e){if(t!==this.pieceType)return;const i=this.match3.board.rows,r=[];for(let n=0;n<i;n++)r.push({row:n,column:e.column});await this.match3.board.popPieces(r,!0)}}class dA{constructor(t,e){A(this,"match3");A(this,"pieceType");this.match3=t,this.pieceType=e}async process(t){let e=t.length;for(;e--;){const i=t[e];if(i.length==4&&i[0].column===i[1].column){const r=Math.floor(i.length/2),n=i[r];await this.match3.board.popPieces(i),await this.match3.board.spawnPiece(n,this.pieceType)}}}async trigger(t,e){if(t!==this.pieceType)return;const i=this.match3.board.columns,r=[];for(let n=0;n<i;n++)r.push({row:e.row,column:n});await this.match3.board.popPieces(r,!0)}}const Qh={"special-row":dA,"special-column":uA,"special-colour":cA,"special-blast":lA};class fA{constructor(t){A(this,"match3");A(this,"specialTypes",[]);A(this,"specialHandlers",[]);this.match3=t}reset(){this.specialTypes.length=0,this.specialHandlers.length=0}isSpecialAvailable(t){return!!Qh[t]}addSpecialHandler(t,e){Qh[t]&&(this.specialTypes.push(e),this.specialHandlers.push(new Qh[t](this.match3,e)))}async process(){for(const t of this.specialHandlers){const e=Fn(this.match3.board.grid);await t.process(e)}}async trigger(t,e){if(this.isSpecial(t))for(const i of this.specialHandlers)await i.trigger(t,e)}isSpecial(t){return this.specialTypes.includes(t)}}const lf={score:0,matches:0,pops:0,specials:0,grade:0};class pA{constructor(t){A(this,"match3");A(this,"data");this.match3=t,this.data={...lf}}reset(){this.data={...lf}}registerPop(t){const e=t.causedBySpecial?3:1;this.data.score+=e,this.data.pops+=1,t.isSpecial&&(this.data.specials+=1)}registerMatch(t){for(const e of t.matches){const i=e.length+t.matches.length*t.combo;this.data.score+=i,this.data.matches+=1}}caulculateGrade(t,e){const r=e/1e3,n=t/r;let a=0;return n>8*2?a=3:n>8?a=2:n>8*.1&&(a=1),a}getScore(){return this.data.score}getGameplayPerformance(){const t=this.caulculateGrade(this.data.score,this.match3.timer.getTime());return{...this.data,grade:t}}}class mA{constructor(t){A(this,"match3");A(this,"time",0);A(this,"duration",0);A(this,"paused",!1);A(this,"running",!1);this.match3=t}reset(){this.time=0,this.duration=0,this.running=!1,this.paused=!1}setup(t){this.reset(),this.duration=Math.floor(t)}start(){this.running=!0,this.paused=!1,this.time=0}stop(){this.running=!1,this.paused=!1,this.time=this.duration}pause(){this.paused=!0}resume(){this.paused=!1}update(t){var e,i;!this.running||this.paused||(this.time+=t,this.time>=this.duration&&(this.stop(),(i=(e=this.match3).onTimesUp)==null||i.call(e)))}isPaused(){return this.paused}isRunning(){return this.running}getTime(){return this.time}getTimeRemaining(){return this.duration-this.time}}class gA extends W{constructor(){super();A(this,"config");A(this,"timer");A(this,"stats");A(this,"board");A(this,"actions");A(this,"process");A(this,"special");A(this,"onMove");A(this,"onMatch");A(this,"onPop");A(this,"onProcessStart");A(this,"onProcessComplete");A(this,"onTimesUp");this.config=cb(),this.timer=new mA(this),this.stats=new pA(this),this.board=new aA(this),this.actions=new GC(this),this.process=new hA(this),this.special=new fA(this)}setup(e){this.config=e,this.reset(),this.actions.setup(e),this.board.setup(e),this.timer.setup(e.duration*1e3)}reset(){this.interactiveChildren=!1,this.timer.reset(),this.stats.reset(),this.board.reset(),this.special.reset(),this.process.reset()}startPlaying(){this.interactiveChildren=!0,this.timer.start()}stopPlaying(){this.interactiveChildren=!1,this.timer.stop()}isPlaying(){return this.interactiveChildren}pause(){this.timer.pause(),this.board.pause(),this.process.pause()}resume(){this.timer.resume(),this.board.resume(),this.process.resume()}update(e){this.timer.update(e)}}class bA extends W{constructor(){super();A(this,"base");A(this,"shadow");this.shadow=new W,this.shadow.y=8,this.addChild(this.shadow),this.base=new W,this.addChild(this.base)}setup(e){this.reset();const i=e.rows,r=e.columns,n=e.tileSize,a=.5,o=(r-1)*n/2,h=(i-1)*n/2;for(let l=0;l<i;l++)for(let c=0;c<r;c++){const u=lt.from("shelf-block"),d=c*n-o,f=l*n-h;u.anchor.set(.5),u.width=n+a,u.height=n+a,u.x=d,u.y=f,this.base.addChild(u)}for(let l=0;l<i;l++){const u=l===0||l===i-1?"shelf-corner":"shelf-block",d=lt.from(u),f=-1*n-o,p=l*n-h;d.anchor.set(.5),d.width=n+a,d.height=n+a,d.x=f,d.y=p,this.base.addChild(d),l===i-1&&(d.rotation=-Math.PI*.5);const m=this.getBooks(l===i-1?4:l);m.scale.x=-(n/m.width),m.height=n,m.x=d.x,m.y=d.y,this.base.addChild(m)}for(let l=0;l<i;l++){const c=r,u=l===0||l===i-1?"shelf-corner":"shelf-block",d=lt.from(u),f=c*n-o,p=l*n-h;d.anchor.set(.5),d.width=n+a,d.height=n+a,d.x=f,d.y=p,this.base.addChild(d),l===0&&(d.rotation=Math.PI*.5),l===i-1&&(d.rotation=Math.PI);const m=this.getBooks(l===i-1?4:l);m.width=n,m.height=n,m.x=d.x,m.y=d.y,this.base.addChild(m)}for(let l=-1;l<=r;l++){const c=i-1,u=l===-1||l===r?"shelf-corner":"shelf-block",d=lt.from(u),f=l*n-o,p=c*n-h;d.anchor.set(.5),d.width=n,d.height=n,d.x=f,d.y=p,d.tint=0,d.alpha=.3,this.shadow.addChild(d),l===-1&&(d.rotation=-Math.PI*.5),l===r&&(d.rotation=Math.PI)}}reset(){this.shadow.removeChildren(),this.base.removeChildren()}getBooks(e){const i=["books-01","books-02","books-03","books-04","books-05"],r=i[e%i.length],n=lt.from(r);return n.anchor.set(.5),n}}function Vr(s){const t=window.location.search;return new URLSearchParams(t).get(s)}function Pa(s){const t=Vr(s);if(!t)return null;const e=Number(t);return isNaN(e)?null:e}const yA={fontFamily:"Arial Rounded MT Bold",align:"center"};class pe extends qr{constructor(t,e,i){e={...yA,...e},super({text:t,style:e}),this.anchor.set(.5)}}class xA extends W{constructor(){super();A(this,"label");this.label=new pe("5:00",{fontSize:36,fill:"white"}),this.addChild(this.label)}updateTime(e){const i=Math.floor(e/6e4),r=Math.floor(e/1e3)%60;this.label.text=String(i)+":"+String(r).padStart(2,"0"),e>1&&e<11e3?this.label.tint=Math.floor(e*.005)%2?16711680:16777215:this.label.tint=16777215}}const mt={loadingMessage:"Game Brewing",loadingDone:"We’re Ready!",pressMessage:"Press to start",playButton:"Start Game",resultTitle:"Results",resultPlay:"Play again",grade3:"Incredible!",grade2:"Well Done!",grade1:"Good!",grade0:"Not so good...",comboMessage:"Combo!",pointsSuffix:" Points",bestScorePrefix:"Best: ",newBestScore:"NEW BEST SCORE!",githubButton:`Fork me
on Github!`,urlGithub:"https://github.com/pixijs/open-games",urlPixi:"https://pixijs.com/",infoTitle:"Info",infoDone:"OK",settingsTitle:"Settings",settingsMaster:"Master Volume",settingsBgm:"BGM Volume",settingsSfx:"SFX Volume",settingsVersion:"Version",settingsDone:"OK",pauseTitle:"Paused",pauseDone:"Resume",countdownReady:"Ready?",countdownGo:"GO!",timesUp:"Time’s up!",overtime:"FINISHING",easyMode:"Easy Mode",normalMode:"Normal Mode",hardMode:"Hard Mode",testMode:"Test Mode"};var hr=(s=>(s[s.WEBGL_LEGACY=0]="WEBGL_LEGACY",s[s.WEBGL=1]="WEBGL",s[s.WEBGL2=2]="WEBGL2",s))(hr||{}),ac=(s=>(s[s.COLOR=16384]="COLOR",s[s.DEPTH=256]="DEPTH",s[s.STENCIL=1024]="STENCIL",s))(ac||{}),st=(s=>(s[s.NORMAL=0]="NORMAL",s[s.ADD=1]="ADD",s[s.MULTIPLY=2]="MULTIPLY",s[s.SCREEN=3]="SCREEN",s[s.OVERLAY=4]="OVERLAY",s[s.DARKEN=5]="DARKEN",s[s.LIGHTEN=6]="LIGHTEN",s[s.COLOR_DODGE=7]="COLOR_DODGE",s[s.COLOR_BURN=8]="COLOR_BURN",s[s.HARD_LIGHT=9]="HARD_LIGHT",s[s.SOFT_LIGHT=10]="SOFT_LIGHT",s[s.DIFFERENCE=11]="DIFFERENCE",s[s.EXCLUSION=12]="EXCLUSION",s[s.HUE=13]="HUE",s[s.SATURATION=14]="SATURATION",s[s.COLOR=15]="COLOR",s[s.LUMINOSITY=16]="LUMINOSITY",s[s.NORMAL_NPM=17]="NORMAL_NPM",s[s.ADD_NPM=18]="ADD_NPM",s[s.SCREEN_NPM=19]="SCREEN_NPM",s[s.NONE=20]="NONE",s[s.SRC_OVER=0]="SRC_OVER",s[s.SRC_IN=21]="SRC_IN",s[s.SRC_OUT=22]="SRC_OUT",s[s.SRC_ATOP=23]="SRC_ATOP",s[s.DST_OVER=24]="DST_OVER",s[s.DST_IN=25]="DST_IN",s[s.DST_OUT=26]="DST_OUT",s[s.DST_ATOP=27]="DST_ATOP",s[s.ERASE=26]="ERASE",s[s.SUBTRACT=28]="SUBTRACT",s[s.XOR=29]="XOR",s))(st||{}),_o=(s=>(s[s.POINTS=0]="POINTS",s[s.LINES=1]="LINES",s[s.LINE_LOOP=2]="LINE_LOOP",s[s.LINE_STRIP=3]="LINE_STRIP",s[s.TRIANGLES=4]="TRIANGLES",s[s.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",s[s.TRIANGLE_FAN=6]="TRIANGLE_FAN",s))(_o||{}),q=(s=>(s[s.RGBA=6408]="RGBA",s[s.RGB=6407]="RGB",s[s.RG=33319]="RG",s[s.RED=6403]="RED",s[s.RGBA_INTEGER=36249]="RGBA_INTEGER",s[s.RGB_INTEGER=36248]="RGB_INTEGER",s[s.RG_INTEGER=33320]="RG_INTEGER",s[s.RED_INTEGER=36244]="RED_INTEGER",s[s.ALPHA=6406]="ALPHA",s[s.LUMINANCE=6409]="LUMINANCE",s[s.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",s[s.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",s[s.DEPTH_STENCIL=34041]="DEPTH_STENCIL",s))(q||{}),zr=(s=>(s[s.TEXTURE_2D=3553]="TEXTURE_2D",s[s.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",s[s.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",s[s.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",s[s.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",s[s.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",s[s.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",s[s.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",s[s.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",s))(zr||{}),xt=(s=>(s[s.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",s[s.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",s[s.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",s[s.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",s[s.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",s[s.UNSIGNED_INT=5125]="UNSIGNED_INT",s[s.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",s[s.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",s[s.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",s[s.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",s[s.BYTE=5120]="BYTE",s[s.SHORT=5122]="SHORT",s[s.INT=5124]="INT",s[s.FLOAT=5126]="FLOAT",s[s.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",s[s.HALF_FLOAT=36193]="HALF_FLOAT",s))(xt||{}),oc=(s=>(s[s.FLOAT=0]="FLOAT",s[s.INT=1]="INT",s[s.UINT=2]="UINT",s))(oc||{}),Zi=(s=>(s[s.NEAREST=0]="NEAREST",s[s.LINEAR=1]="LINEAR",s))(Zi||{}),gu=(s=>(s[s.CLAMP=33071]="CLAMP",s[s.REPEAT=10497]="REPEAT",s[s.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",s))(gu||{}),rr=(s=>(s[s.OFF=0]="OFF",s[s.POW2=1]="POW2",s[s.ON=2]="ON",s[s.ON_MANUAL=3]="ON_MANUAL",s))(rr||{}),Ms=(s=>(s[s.NPM=0]="NPM",s[s.UNPACK=1]="UNPACK",s[s.PMA=2]="PMA",s[s.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",s[s.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",s[s.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",s))(Ms||{}),zs=(s=>(s[s.NO=0]="NO",s[s.YES=1]="YES",s[s.AUTO=2]="AUTO",s[s.BLEND=0]="BLEND",s[s.CLEAR=1]="CLEAR",s[s.BLIT=2]="BLIT",s))(zs||{}),bu=(s=>(s[s.AUTO=0]="AUTO",s[s.MANUAL=1]="MANUAL",s))(bu||{}),Je=(s=>(s.LOW="lowp",s.MEDIUM="mediump",s.HIGH="highp",s))(Je||{}),ae=(s=>(s[s.NONE=0]="NONE",s[s.SCISSOR=1]="SCISSOR",s[s.STENCIL=2]="STENCIL",s[s.SPRITE=3]="SPRITE",s[s.COLOR=4]="COLOR",s))(ae||{}),qt=(s=>(s[s.NONE=0]="NONE",s[s.LOW=2]="LOW",s[s.MEDIUM=4]="MEDIUM",s[s.HIGH=8]="HIGH",s))(qt||{}),Li=(s=>(s[s.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",s[s.ARRAY_BUFFER=34962]="ARRAY_BUFFER",s[s.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",s))(Li||{});const vA={createCanvas:(s,t)=>{const e=document.createElement("canvas");return e.width=s,e.height=t,e},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(s,t)=>fetch(s,t),parseXML:s=>new DOMParser().parseFromString(s,"text/xml")},ot={ADAPTER:vA,RESOLUTION:1,RENDER_OPTIONS:{view:null,antialias:!1,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,premultipliedAlpha:!0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1,hello:!1},CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var tl=/iPhone/i,cf=/iPod/i,uf=/iPad/i,df=/\biOS-universal(?:.+)Mac\b/i,el=/\bAndroid(?:.+)Mobile\b/i,ff=/Android/i,gr=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Ma=/Silk/i,$i=/Windows Phone/i,pf=/\bWindows(?:.+)ARM\b/i,mf=/BlackBerry/i,gf=/BB10/i,bf=/Opera Mini/i,yf=/\b(CriOS|Chrome)(?:.+)Mobile/i,xf=/Mobile(?:.+)Firefox\b/i,vf=function(s){return typeof s<"u"&&s.platform==="MacIntel"&&typeof s.maxTouchPoints=="number"&&s.maxTouchPoints>1&&typeof MSStream>"u"};function _A(s){return function(t){return t.test(s)}}function wA(s){var t={userAgent:"",platform:"",maxTouchPoints:0};!s&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof s=="string"?t.userAgent=s:s&&s.userAgent&&(t={userAgent:s.userAgent,platform:s.platform,maxTouchPoints:s.maxTouchPoints||0});var e=t.userAgent,i=e.split("[FBAN");typeof i[1]<"u"&&(e=i[0]),i=e.split("Twitter"),typeof i[1]<"u"&&(e=i[0]);var r=_A(e),n={apple:{phone:r(tl)&&!r($i),ipod:r(cf),tablet:!r(tl)&&(r(uf)||vf(t))&&!r($i),universal:r(df),device:(r(tl)||r(cf)||r(uf)||r(df)||vf(t))&&!r($i)},amazon:{phone:r(gr),tablet:!r(gr)&&r(Ma),device:r(gr)||r(Ma)},android:{phone:!r($i)&&r(gr)||!r($i)&&r(el),tablet:!r($i)&&!r(gr)&&!r(el)&&(r(Ma)||r(ff)),device:!r($i)&&(r(gr)||r(Ma)||r(el)||r(ff))||r(/\bokhttp\b/i)},windows:{phone:r($i),tablet:r(pf),device:r($i)||r(pf)},other:{blackberry:r(mf),blackberry10:r(gf),opera:r(bf),firefox:r(xf),chrome:r(yf),device:r(mf)||r(gf)||r(bf)||r(xf)||r(yf)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}const Pr=wA(globalThis.navigator);ot.RETINA_PREFIX=/@([0-9\.]+)x/;ot.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var wo={},TA={get exports(){return wo},set exports(s){wo=s}};/*! https://mths.be/punycode v1.3.2 by @mathias */(function(s,t){(function(e){var i=t&&!t.nodeType&&t,r=s&&!s.nodeType&&s,n=typeof uh=="object"&&uh;(n.global===n||n.window===n||n.self===n)&&(e=n);var a,o=2147483647,h=36,l=1,c=26,u=38,d=700,f=72,p=128,m="-",g=/^xn--/,x=/[^\x20-\x7E]/,y=/[\x2E\u3002\uFF0E\uFF61]/g,b={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},v=h-l,_=Math.floor,w=String.fromCharCode,T;function S(O){throw RangeError(b[O])}function C(O,X){for(var V=O.length,$=[];V--;)$[V]=X(O[V]);return $}function E(O,X){var V=O.split("@"),$="";V.length>1&&($=V[0]+"@",O=V[1]),O=O.replace(y,".");var H=O.split("."),K=C(H,X).join(".");return $+K}function M(O){for(var X=[],V=0,$=O.length,H,K;V<$;)H=O.charCodeAt(V++),H>=55296&&H<=56319&&V<$?(K=O.charCodeAt(V++),(K&64512)==56320?X.push(((H&1023)<<10)+(K&1023)+65536):(X.push(H),V--)):X.push(H);return X}function N(O){return C(O,function(X){var V="";return X>65535&&(X-=65536,V+=w(X>>>10&1023|55296),X=56320|X&1023),V+=w(X),V}).join("")}function R(O){return O-48<10?O-22:O-65<26?O-65:O-97<26?O-97:h}function I(O,X){return O+22+75*(O<26)-((X!=0)<<5)}function k(O,X,V){var $=0;for(O=V?_(O/d):O>>1,O+=_(O/X);O>v*c>>1;$+=h)O=_(O/v);return _($+(v+1)*O/(O+u))}function B(O){var X=[],V=O.length,$,H=0,K=p,nt=f,St,ut,_t,ht,At,Ut,Ht,he,Qt;for(St=O.lastIndexOf(m),St<0&&(St=0),ut=0;ut<St;++ut)O.charCodeAt(ut)>=128&&S("not-basic"),X.push(O.charCodeAt(ut));for(_t=St>0?St+1:0;_t<V;){for(ht=H,At=1,Ut=h;_t>=V&&S("invalid-input"),Ht=R(O.charCodeAt(_t++)),(Ht>=h||Ht>_((o-H)/At))&&S("overflow"),H+=Ht*At,he=Ut<=nt?l:Ut>=nt+c?c:Ut-nt,!(Ht<he);Ut+=h)Qt=h-he,At>_(o/Qt)&&S("overflow"),At*=Qt;$=X.length+1,nt=k(H-ht,$,ht==0),_(H/$)>o-K&&S("overflow"),K+=_(H/$),H%=$,X.splice(H++,0,K)}return N(X)}function z(O){var X,V,$,H,K,nt,St,ut,_t,ht,At,Ut=[],Ht,he,Qt,Te;for(O=M(O),Ht=O.length,X=p,V=0,K=f,nt=0;nt<Ht;++nt)At=O[nt],At<128&&Ut.push(w(At));for($=H=Ut.length,H&&Ut.push(m);$<Ht;){for(St=o,nt=0;nt<Ht;++nt)At=O[nt],At>=X&&At<St&&(St=At);for(he=$+1,St-X>_((o-V)/he)&&S("overflow"),V+=(St-X)*he,X=St,nt=0;nt<Ht;++nt)if(At=O[nt],At<X&&++V>o&&S("overflow"),At==X){for(ut=V,_t=h;ht=_t<=K?l:_t>=K+c?c:_t-K,!(ut<ht);_t+=h)Te=ut-ht,Qt=h-ht,Ut.push(w(I(ht+Te%Qt,0))),ut=_(Te/Qt);Ut.push(w(I(ut,0))),K=k(V,he,$==H),V=0,++$}++V,++X}return Ut.join("")}function Z(O){return E(O,function(X){return g.test(X)?B(X.slice(4).toLowerCase()):X})}function G(O){return E(O,function(X){return x.test(X)?"xn--"+z(X):X})}if(a={version:"1.3.2",ucs2:{decode:M,encode:N},decode:B,encode:z,toASCII:G,toUnicode:Z},i&&r)if(s.exports==i)r.exports=a;else for(T in a)a.hasOwnProperty(T)&&(i[T]=a[T]);else e.punycode=a})(uh)})(TA,wo);var SA={isString:function(s){return typeof s=="string"},isObject:function(s){return typeof s=="object"&&s!==null},isNull:function(s){return s===null},isNullOrUndefined:function(s){return s==null}},Kn={};function CA(s,t){return Object.prototype.hasOwnProperty.call(s,t)}var AA=function(s,t,e,i){t=t||"&",e=e||"=";var r={};if(typeof s!="string"||s.length===0)return r;var n=/\+/g;s=s.split(t);var a=1e3;i&&typeof i.maxKeys=="number"&&(a=i.maxKeys);var o=s.length;a>0&&o>a&&(o=a);for(var h=0;h<o;++h){var l=s[h].replace(n,"%20"),c=l.indexOf(e),u,d,f,p;c>=0?(u=l.substr(0,c),d=l.substr(c+1)):(u=l,d=""),f=decodeURIComponent(u),p=decodeURIComponent(d),CA(r,f)?Array.isArray(r[f])?r[f].push(p):r[f]=[r[f],p]:r[f]=p}return r},mn=function(s){switch(typeof s){case"string":return s;case"boolean":return s?"true":"false";case"number":return isFinite(s)?s:"";default:return""}},EA=function(s,t,e,i){return t=t||"&",e=e||"=",s===null&&(s=void 0),typeof s=="object"?Object.keys(s).map(function(r){var n=encodeURIComponent(mn(r))+e;return Array.isArray(s[r])?s[r].map(function(a){return n+encodeURIComponent(mn(a))}).join(t):n+encodeURIComponent(mn(s[r]))}).join(t):i?encodeURIComponent(mn(i))+e+encodeURIComponent(mn(s)):""};Kn.decode=Kn.parse=AA;Kn.encode=Kn.stringify=EA;var PA=wo,Pi=SA,MA=$o,kA=VA,RA=GA;function yi(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var BA=/^([a-z0-9.+-]+:)/i,IA=/:[0-9]*$/,FA=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,UA=["<",">",'"',"`"," ","\r",`
`,"	"],LA=["{","}","|","\\","^","`"].concat(UA),hc=["'"].concat(LA),_f=["%","/","?",";","#"].concat(hc),wf=["/","?","#"],OA=255,Tf=/^[+a-z0-9A-Z_-]{0,63}$/,NA=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,DA={javascript:!0,"javascript:":!0},lc={javascript:!0,"javascript:":!0},Hr={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},cc=Kn;function $o(s,t,e){if(s&&Pi.isObject(s)&&s instanceof yi)return s;var i=new yi;return i.parse(s,t,e),i}yi.prototype.parse=function(s,t,e){if(!Pi.isString(s))throw new TypeError("Parameter 'url' must be a string, not "+typeof s);var i=s.indexOf("?"),r=i!==-1&&i<s.indexOf("#")?"?":"#",n=s.split(r),a=/\\/g;n[0]=n[0].replace(a,"/"),s=n.join(r);var o=s;if(o=o.trim(),!e&&s.split("#").length===1){var h=FA.exec(o);if(h)return this.path=o,this.href=o,this.pathname=h[1],h[2]?(this.search=h[2],t?this.query=cc.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var l=BA.exec(o);if(l){l=l[0];var c=l.toLowerCase();this.protocol=c,o=o.substr(l.length)}if(e||l||o.match(/^\/\/[^@\/]+@[^@\/]+/)){var u=o.substr(0,2)==="//";u&&!(l&&lc[l])&&(o=o.substr(2),this.slashes=!0)}if(!lc[l]&&(u||l&&!Hr[l])){for(var d=-1,f=0;f<wf.length;f++){var p=o.indexOf(wf[f]);p!==-1&&(d===-1||p<d)&&(d=p)}var m,g;d===-1?g=o.lastIndexOf("@"):g=o.lastIndexOf("@",d),g!==-1&&(m=o.slice(0,g),o=o.slice(g+1),this.auth=decodeURIComponent(m)),d=-1;for(var f=0;f<_f.length;f++){var p=o.indexOf(_f[f]);p!==-1&&(d===-1||p<d)&&(d=p)}d===-1&&(d=o.length),this.host=o.slice(0,d),o=o.slice(d),this.parseHost(),this.hostname=this.hostname||"";var x=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!x)for(var y=this.hostname.split(/\./),f=0,b=y.length;f<b;f++){var v=y[f];if(v&&!v.match(Tf)){for(var _="",w=0,T=v.length;w<T;w++)v.charCodeAt(w)>127?_+="x":_+=v[w];if(!_.match(Tf)){var S=y.slice(0,f),C=y.slice(f+1),E=v.match(NA);E&&(S.push(E[1]),C.unshift(E[2])),C.length&&(o="/"+C.join(".")+o),this.hostname=S.join(".");break}}}this.hostname.length>OA?this.hostname="":this.hostname=this.hostname.toLowerCase(),x||(this.hostname=PA.toASCII(this.hostname));var M=this.port?":"+this.port:"",N=this.hostname||"";this.host=N+M,this.href+=this.host,x&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),o[0]!=="/"&&(o="/"+o))}if(!DA[c])for(var f=0,b=hc.length;f<b;f++){var R=hc[f];if(o.indexOf(R)!==-1){var I=encodeURIComponent(R);I===R&&(I=escape(R)),o=o.split(R).join(I)}}var k=o.indexOf("#");k!==-1&&(this.hash=o.substr(k),o=o.slice(0,k));var B=o.indexOf("?");if(B!==-1?(this.search=o.substr(B),this.query=o.substr(B+1),t&&(this.query=cc.parse(this.query)),o=o.slice(0,B)):t&&(this.search="",this.query={}),o&&(this.pathname=o),Hr[c]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var M=this.pathname||"",z=this.search||"";this.path=M+z}return this.href=this.format(),this};function GA(s){return Pi.isString(s)&&(s=$o(s)),s instanceof yi?s.format():yi.prototype.format.call(s)}yi.prototype.format=function(){var s=this.auth||"";s&&(s=encodeURIComponent(s),s=s.replace(/%3A/i,":"),s+="@");var t=this.protocol||"",e=this.pathname||"",i=this.hash||"",r=!1,n="";this.host?r=s+this.host:this.hostname&&(r=s+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(r+=":"+this.port)),this.query&&Pi.isObject(this.query)&&Object.keys(this.query).length&&(n=cc.stringify(this.query));var a=this.search||n&&"?"+n||"";return t&&t.substr(-1)!==":"&&(t+=":"),this.slashes||(!t||Hr[t])&&r!==!1?(r="//"+(r||""),e&&e.charAt(0)!=="/"&&(e="/"+e)):r||(r=""),i&&i.charAt(0)!=="#"&&(i="#"+i),a&&a.charAt(0)!=="?"&&(a="?"+a),e=e.replace(/[?#]/g,function(o){return encodeURIComponent(o)}),a=a.replace("#","%23"),t+r+e+a+i};function VA(s,t){return $o(s,!1,!0).resolve(t)}yi.prototype.resolve=function(s){return this.resolveObject($o(s,!1,!0)).format()};yi.prototype.resolveObject=function(s){if(Pi.isString(s)){var t=new yi;t.parse(s,!1,!0),s=t}for(var e=new yi,i=Object.keys(this),r=0;r<i.length;r++){var n=i[r];e[n]=this[n]}if(e.hash=s.hash,s.href==="")return e.href=e.format(),e;if(s.slashes&&!s.protocol){for(var a=Object.keys(s),o=0;o<a.length;o++){var h=a[o];h!=="protocol"&&(e[h]=s[h])}return Hr[e.protocol]&&e.hostname&&!e.pathname&&(e.path=e.pathname="/"),e.href=e.format(),e}if(s.protocol&&s.protocol!==e.protocol){if(!Hr[s.protocol]){for(var l=Object.keys(s),c=0;c<l.length;c++){var u=l[c];e[u]=s[u]}return e.href=e.format(),e}if(e.protocol=s.protocol,!s.host&&!lc[s.protocol]){for(var b=(s.pathname||"").split("/");b.length&&!(s.host=b.shift()););s.host||(s.host=""),s.hostname||(s.hostname=""),b[0]!==""&&b.unshift(""),b.length<2&&b.unshift(""),e.pathname=b.join("/")}else e.pathname=s.pathname;if(e.search=s.search,e.query=s.query,e.host=s.host||"",e.auth=s.auth,e.hostname=s.hostname||s.host,e.port=s.port,e.pathname||e.search){var d=e.pathname||"",f=e.search||"";e.path=d+f}return e.slashes=e.slashes||s.slashes,e.href=e.format(),e}var p=e.pathname&&e.pathname.charAt(0)==="/",m=s.host||s.pathname&&s.pathname.charAt(0)==="/",g=m||p||e.host&&s.pathname,x=g,y=e.pathname&&e.pathname.split("/")||[],b=s.pathname&&s.pathname.split("/")||[],v=e.protocol&&!Hr[e.protocol];if(v&&(e.hostname="",e.port=null,e.host&&(y[0]===""?y[0]=e.host:y.unshift(e.host)),e.host="",s.protocol&&(s.hostname=null,s.port=null,s.host&&(b[0]===""?b[0]=s.host:b.unshift(s.host)),s.host=null),g=g&&(b[0]===""||y[0]==="")),m)e.host=s.host||s.host===""?s.host:e.host,e.hostname=s.hostname||s.hostname===""?s.hostname:e.hostname,e.search=s.search,e.query=s.query,y=b;else if(b.length)y||(y=[]),y.pop(),y=y.concat(b),e.search=s.search,e.query=s.query;else if(!Pi.isNullOrUndefined(s.search)){if(v){e.hostname=e.host=y.shift();var _=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;_&&(e.auth=_.shift(),e.host=e.hostname=_.shift())}return e.search=s.search,e.query=s.query,(!Pi.isNull(e.pathname)||!Pi.isNull(e.search))&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.href=e.format(),e}if(!y.length)return e.pathname=null,e.search?e.path="/"+e.search:e.path=null,e.href=e.format(),e;for(var w=y.slice(-1)[0],T=(e.host||s.host||y.length>1)&&(w==="."||w==="..")||w==="",S=0,C=y.length;C>=0;C--)w=y[C],w==="."?y.splice(C,1):w===".."?(y.splice(C,1),S++):S&&(y.splice(C,1),S--);if(!g&&!x)for(;S--;S)y.unshift("..");g&&y[0]!==""&&(!y[0]||y[0].charAt(0)!=="/")&&y.unshift(""),T&&y.join("/").substr(-1)!=="/"&&y.push("");var E=y[0]===""||y[0]&&y[0].charAt(0)==="/";if(v){e.hostname=e.host=E?"":y.length?y.shift():"";var _=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;_&&(e.auth=_.shift(),e.host=e.hostname=_.shift())}return g=g||e.host&&y.length,g&&!E&&y.unshift(""),y.length?e.pathname=y.join("/"):(e.pathname=null,e.path=null),(!Pi.isNull(e.pathname)||!Pi.isNull(e.search))&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.auth=s.auth||e.auth,e.slashes=e.slashes||s.slashes,e.href=e.format(),e};yi.prototype.parseHost=function(){var s=this.host,t=IA.exec(s);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),s=s.substr(0,s.length-t.length)),s&&(this.hostname=s)};const zA={parse:MA,format:RA,resolve:kA};function si(s){if(typeof s!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(s)}`)}function gn(s){return s.split("?")[0].split("#")[0]}function HA(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function XA(s,t,e){return s.replace(new RegExp(HA(t),"g"),e)}function $A(s,t){let e="",i=0,r=-1,n=0,a=-1;for(let o=0;o<=s.length;++o){if(o<s.length)a=s.charCodeAt(o);else{if(a===47)break;a=47}if(a===47){if(!(r===o-1||n===1))if(r!==o-1&&n===2){if(e.length<2||i!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){const h=e.lastIndexOf("/");if(h!==e.length-1){h===-1?(e="",i=0):(e=e.slice(0,h),i=e.length-1-e.lastIndexOf("/")),r=o,n=0;continue}}else if(e.length===2||e.length===1){e="",i=0,r=o,n=0;continue}}t&&(e.length>0?e+="/..":e="..",i=2)}else e.length>0?e+=`/${s.slice(r+1,o)}`:e=s.slice(r+1,o),i=o-r-1;r=o,n=0}else a===46&&n!==-1?++n:n=-1}return e}const Ie={toPosix(s){return XA(s,"\\","/")},isUrl(s){return/^https?:/.test(this.toPosix(s))},isDataUrl(s){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(s)},hasProtocol(s){return/^[^/:]+:\//.test(this.toPosix(s))},getProtocol(s){si(s),s=this.toPosix(s);let t="";const e=/^file:\/\/\//.exec(s),i=/^[^/:]+:\/\//.exec(s),r=/^[^/:]+:\//.exec(s);if(e||i||r){const n=(e==null?void 0:e[0])||(i==null?void 0:i[0])||(r==null?void 0:r[0]);t=n,s=s.slice(n.length)}return t},toAbsolute(s,t,e){if(this.isDataUrl(s))return s;const i=gn(this.toPosix(t??ot.ADAPTER.getBaseUrl())),r=gn(this.toPosix(e??this.rootname(i)));return si(s),s=this.toPosix(s),s.startsWith("/")?Ie.join(r,s.slice(1)):this.isAbsolute(s)?s:this.join(i,s)},normalize(s){if(s=this.toPosix(s),si(s),s.length===0)return".";let t="";const e=s.startsWith("/");this.hasProtocol(s)&&(t=this.rootname(s),s=s.slice(t.length));const i=s.endsWith("/");return s=$A(s,!1),s.length>0&&i&&(s+="/"),e?`/${s}`:t+s},isAbsolute(s){return si(s),s=this.toPosix(s),this.hasProtocol(s)?!0:s.startsWith("/")},join(...s){if(s.length===0)return".";let t;for(let e=0;e<s.length;++e){const i=s[e];if(si(i),i.length>0)if(t===void 0)t=i;else{const r=s[e-1]??"";this.extname(r)?t+=`/../${i}`:t+=`/${i}`}}return t===void 0?".":this.normalize(t)},dirname(s){if(si(s),s.length===0)return".";s=this.toPosix(s);let t=s.charCodeAt(0);const e=t===47;let i=-1,r=!0;const n=this.getProtocol(s),a=s;s=s.slice(n.length);for(let o=s.length-1;o>=1;--o)if(t=s.charCodeAt(o),t===47){if(!r){i=o;break}}else r=!1;return i===-1?e?"/":this.isUrl(a)?n+s:n:e&&i===1?"//":n+s.slice(0,i)},rootname(s){si(s),s=this.toPosix(s);let t="";if(s.startsWith("/")?t="/":t=this.getProtocol(s),this.isUrl(s)){const e=s.indexOf("/",t.length);e!==-1?t=s.slice(0,e):t=s,t.endsWith("/")||(t+="/")}return t},basename(s,t){si(s),t&&si(t),s=gn(this.toPosix(s));let e=0,i=-1,r=!0,n;if(t!==void 0&&t.length>0&&t.length<=s.length){if(t.length===s.length&&t===s)return"";let a=t.length-1,o=-1;for(n=s.length-1;n>=0;--n){const h=s.charCodeAt(n);if(h===47){if(!r){e=n+1;break}}else o===-1&&(r=!1,o=n+1),a>=0&&(h===t.charCodeAt(a)?--a===-1&&(i=n):(a=-1,i=o))}return e===i?i=o:i===-1&&(i=s.length),s.slice(e,i)}for(n=s.length-1;n>=0;--n)if(s.charCodeAt(n)===47){if(!r){e=n+1;break}}else i===-1&&(r=!1,i=n+1);return i===-1?"":s.slice(e,i)},extname(s){si(s),s=gn(this.toPosix(s));let t=-1,e=0,i=-1,r=!0,n=0;for(let a=s.length-1;a>=0;--a){const o=s.charCodeAt(a);if(o===47){if(!r){e=a+1;break}continue}i===-1&&(r=!1,i=a+1),o===46?t===-1?t=a:n!==1&&(n=1):t!==-1&&(n=-1)}return t===-1||i===-1||n===0||n===1&&t===i-1&&t===e+1?"":s.slice(t,i)},parse(s){si(s);const t={root:"",dir:"",base:"",ext:"",name:""};if(s.length===0)return t;s=gn(this.toPosix(s));let e=s.charCodeAt(0);const i=this.isAbsolute(s);let r;t.root=this.rootname(s),i||this.hasProtocol(s)?r=1:r=0;let n=-1,a=0,o=-1,h=!0,l=s.length-1,c=0;for(;l>=r;--l){if(e=s.charCodeAt(l),e===47){if(!h){a=l+1;break}continue}o===-1&&(h=!1,o=l+1),e===46?n===-1?n=l:c!==1&&(c=1):n!==-1&&(c=-1)}return n===-1||o===-1||c===0||c===1&&n===o-1&&n===a+1?o!==-1&&(a===0&&i?t.base=t.name=s.slice(1,o):t.base=t.name=s.slice(a,o)):(a===0&&i?(t.name=s.slice(1,n),t.base=s.slice(1,o)):(t.name=s.slice(a,n),t.base=s.slice(a,o)),t.ext=s.slice(n,o)),t.dir=this.dirname(s),t},sep:"/",delimiter:":"},Sf={};function Et(s,t,e=3){if(Sf[t])return;let i=new Error().stack;typeof i>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${s}`):(i=i.split(`
`).splice(e).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${s}`),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${s}`),console.warn(i))),Sf[t]=!0}let il;function WA(){return typeof il>"u"&&(il=function(){var e;const t={stencil:!0,failIfMajorPerformanceCaveat:ot.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!ot.ADAPTER.getWebGLRenderingContext())return!1;const i=ot.ADAPTER.createCanvas();let r=i.getContext("webgl",t)||i.getContext("experimental-webgl",t);const n=!!((e=r==null?void 0:r.getContextAttributes())!=null&&e.stencil);if(r){const a=r.getExtension("WEBGL_lose_context");a&&a.loseContext()}return r=null,n}catch{return!1}}()),il}var YA="#f0f8ff",jA="#faebd7",qA="#00ffff",KA="#7fffd4",ZA="#f0ffff",JA="#f5f5dc",QA="#ffe4c4",t2="#000000",e2="#ffebcd",i2="#0000ff",s2="#8a2be2",r2="#a52a2a",n2="#deb887",a2="#5f9ea0",o2="#7fff00",h2="#d2691e",l2="#ff7f50",c2="#6495ed",u2="#fff8dc",d2="#dc143c",f2="#00ffff",p2="#00008b",m2="#008b8b",g2="#b8860b",b2="#a9a9a9",y2="#006400",x2="#a9a9a9",v2="#bdb76b",_2="#8b008b",w2="#556b2f",T2="#ff8c00",S2="#9932cc",C2="#8b0000",A2="#e9967a",E2="#8fbc8f",P2="#483d8b",M2="#2f4f4f",k2="#2f4f4f",R2="#00ced1",B2="#9400d3",I2="#ff1493",F2="#00bfff",U2="#696969",L2="#696969",O2="#1e90ff",N2="#b22222",D2="#fffaf0",G2="#228b22",V2="#ff00ff",z2="#dcdcdc",H2="#f8f8ff",X2="#daa520",$2="#ffd700",W2="#808080",Y2="#008000",j2="#adff2f",q2="#808080",K2="#f0fff0",Z2="#ff69b4",J2="#cd5c5c",Q2="#4b0082",tE="#fffff0",eE="#f0e68c",iE="#fff0f5",sE="#e6e6fa",rE="#7cfc00",nE="#fffacd",aE="#add8e6",oE="#f08080",hE="#e0ffff",lE="#fafad2",cE="#d3d3d3",uE="#90ee90",dE="#d3d3d3",fE="#ffb6c1",pE="#ffa07a",mE="#20b2aa",gE="#87cefa",bE="#778899",yE="#778899",xE="#b0c4de",vE="#ffffe0",_E="#00ff00",wE="#32cd32",TE="#faf0e6",SE="#ff00ff",CE="#800000",AE="#66cdaa",EE="#0000cd",PE="#ba55d3",ME="#9370db",kE="#3cb371",RE="#7b68ee",BE="#00fa9a",IE="#48d1cc",FE="#c71585",UE="#191970",LE="#f5fffa",OE="#ffe4e1",NE="#ffe4b5",DE="#ffdead",GE="#000080",VE="#fdf5e6",zE="#808000",HE="#6b8e23",XE="#ffa500",$E="#ff4500",WE="#da70d6",YE="#eee8aa",jE="#98fb98",qE="#afeeee",KE="#db7093",ZE="#ffefd5",JE="#ffdab9",QE="#cd853f",tP="#ffc0cb",eP="#dda0dd",iP="#b0e0e6",sP="#800080",rP="#663399",nP="#ff0000",aP="#bc8f8f",oP="#4169e1",hP="#8b4513",lP="#fa8072",cP="#f4a460",uP="#2e8b57",dP="#fff5ee",fP="#a0522d",pP="#c0c0c0",mP="#87ceeb",gP="#6a5acd",bP="#708090",yP="#708090",xP="#fffafa",vP="#00ff7f",_P="#4682b4",wP="#d2b48c",TP="#008080",SP="#d8bfd8",CP="#ff6347",AP="#40e0d0",EP="#ee82ee",PP="#f5deb3",MP="#ffffff",kP="#f5f5f5",RP="#ffff00",BP="#9acd32",IP={aliceblue:YA,antiquewhite:jA,aqua:qA,aquamarine:KA,azure:ZA,beige:JA,bisque:QA,black:t2,blanchedalmond:e2,blue:i2,blueviolet:s2,brown:r2,burlywood:n2,cadetblue:a2,chartreuse:o2,chocolate:h2,coral:l2,cornflowerblue:c2,cornsilk:u2,crimson:d2,cyan:f2,darkblue:p2,darkcyan:m2,darkgoldenrod:g2,darkgray:b2,darkgreen:y2,darkgrey:x2,darkkhaki:v2,darkmagenta:_2,darkolivegreen:w2,darkorange:T2,darkorchid:S2,darkred:C2,darksalmon:A2,darkseagreen:E2,darkslateblue:P2,darkslategray:M2,darkslategrey:k2,darkturquoise:R2,darkviolet:B2,deeppink:I2,deepskyblue:F2,dimgray:U2,dimgrey:L2,dodgerblue:O2,firebrick:N2,floralwhite:D2,forestgreen:G2,fuchsia:V2,gainsboro:z2,ghostwhite:H2,goldenrod:X2,gold:$2,gray:W2,green:Y2,greenyellow:j2,grey:q2,honeydew:K2,hotpink:Z2,indianred:J2,indigo:Q2,ivory:tE,khaki:eE,lavenderblush:iE,lavender:sE,lawngreen:rE,lemonchiffon:nE,lightblue:aE,lightcoral:oE,lightcyan:hE,lightgoldenrodyellow:lE,lightgray:cE,lightgreen:uE,lightgrey:dE,lightpink:fE,lightsalmon:pE,lightseagreen:mE,lightskyblue:gE,lightslategray:bE,lightslategrey:yE,lightsteelblue:xE,lightyellow:vE,lime:_E,limegreen:wE,linen:TE,magenta:SE,maroon:CE,mediumaquamarine:AE,mediumblue:EE,mediumorchid:PE,mediumpurple:ME,mediumseagreen:kE,mediumslateblue:RE,mediumspringgreen:BE,mediumturquoise:IE,mediumvioletred:FE,midnightblue:UE,mintcream:LE,mistyrose:OE,moccasin:NE,navajowhite:DE,navy:GE,oldlace:VE,olive:zE,olivedrab:HE,orange:XE,orangered:$E,orchid:WE,palegoldenrod:YE,palegreen:jE,paleturquoise:qE,palevioletred:KE,papayawhip:ZE,peachpuff:JE,peru:QE,pink:tP,plum:eP,powderblue:iP,purple:sP,rebeccapurple:rP,red:nP,rosybrown:aP,royalblue:oP,saddlebrown:hP,salmon:lP,sandybrown:cP,seagreen:uP,seashell:dP,sienna:fP,silver:pP,skyblue:mP,slateblue:gP,slategray:bP,slategrey:yP,snow:xP,springgreen:vP,steelblue:_P,tan:wP,teal:TP,thistle:SP,tomato:CP,turquoise:AP,violet:EP,wheat:PP,white:MP,whitesmoke:kP,yellow:RP,yellowgreen:BP};function FP(s,t=[]){return t[0]=(s>>16&255)/255,t[1]=(s>>8&255)/255,t[2]=(s&255)/255,t}function UP(s){let t=s.toString(16);return t="000000".substring(0,6-t.length)+t,`#${t}`}function LP(s){if(typeof s=="string"&&(s=IP[s.toLowerCase()]||s,s[0]==="#"&&(s=s.slice(1)),s.length===3)){const[t,e,i]=s;s=t+t+e+e+i+i}return parseInt(s,16)}function OP(){const s=[],t=[];for(let i=0;i<32;i++)s[i]=i,t[i]=i;s[st.NORMAL_NPM]=st.NORMAL,s[st.ADD_NPM]=st.ADD,s[st.SCREEN_NPM]=st.SCREEN,t[st.NORMAL]=st.NORMAL_NPM,t[st.ADD]=st.ADD_NPM,t[st.SCREEN]=st.SCREEN_NPM;const e=[];return e.push(t),e.push(s),e}const NP=OP();function DP(s,t){if(t===1)return(t*255<<24)+s;if(t===0)return 0;let e=s>>16&255,i=s>>8&255,r=s&255;return e=e*t+.5|0,i=i*t+.5|0,r=r*t+.5|0,(t*255<<24)+(e<<16)+(i<<8)+r}function fb(s){if(s.BYTES_PER_ELEMENT===4)return s instanceof Float32Array?"Float32Array":s instanceof Uint32Array?"Uint32Array":"Int32Array";if(s.BYTES_PER_ELEMENT===2){if(s instanceof Uint16Array)return"Uint16Array"}else if(s.BYTES_PER_ELEMENT===1&&s instanceof Uint8Array)return"Uint8Array";return null}function To(s){return s+=s===0?1:0,--s,s|=s>>>1,s|=s>>>2,s|=s>>>4,s|=s>>>8,s|=s>>>16,s+1}function Cf(s){return!(s&s-1)&&!!s}function Af(s){let t=(s>65535?1:0)<<4;s>>>=t;let e=(s>255?1:0)<<3;return s>>>=e,t|=e,e=(s>15?1:0)<<2,s>>>=e,t|=e,e=(s>3?1:0)<<1,s>>>=e,t|=e,t|s>>1}function GP(s,t,e){const i=s.length;let r;if(t>=i||e===0)return;e=t+e>i?i-t:e;const n=i-e;for(r=t;r<n;++r)s[r]=s[r+e];s.length=n}let VP=0;function Zn(){return++VP}const Ef={},Ai=Object.create(null),ds=Object.create(null);let ka;function zP(s,t=globalThis.location){if(s.startsWith("data:"))return"";t=t||globalThis.location,ka||(ka=document.createElement("a")),ka.href=s;const e=zA.parse(ka.href),i=!e.port&&t.port===""||e.port===t.port;return e.hostname!==t.hostname||!i||e.protocol!==t.protocol?"anonymous":""}function So(s,t=1){var i;const e=(i=ot.RETINA_PREFIX)==null?void 0:i.exec(s);return e?parseFloat(e[1]):t}var Q=(s=>(s.Renderer="renderer",s.Application="application",s.RendererSystem="renderer-webgl-system",s.RendererPlugin="renderer-webgl-plugin",s.CanvasRendererSystem="renderer-canvas-system",s.CanvasRendererPlugin="renderer-canvas-plugin",s.Asset="asset",s.LoadParser="load-parser",s.ResolveParser="resolve-parser",s.CacheParser="cache-parser",s.DetectionParser="detection-parser",s))(Q||{});const uc=s=>{if(typeof s=="function"||typeof s=="object"&&s.extension){if(!s.extension)throw new Error("Extension class must have an extension object");s={...typeof s.extension!="object"?{type:s.extension}:s.extension,ref:s}}if(typeof s=="object")s={...s};else throw new Error("Invalid extension type");return typeof s.type=="string"&&(s.type=[s.type]),s},Pf=(s,t)=>uc(s).priority??t,rt={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...s){return s.map(uc).forEach(t=>{t.type.forEach(e=>{var i,r;return(r=(i=this._removeHandlers)[e])==null?void 0:r.call(i,t)})}),this},add(...s){return s.map(uc).forEach(t=>{t.type.forEach(e=>{const i=this._addHandlers,r=this._queue;i[e]?i[e](t):(r[e]=r[e]||[],r[e].push(t))})}),this},handle(s,t,e){const i=this._addHandlers,r=this._removeHandlers;if(i[s]||r[s])throw new Error(`Extension type ${s} already has a handler`);i[s]=t,r[s]=e;const n=this._queue;return n[s]&&(n[s].forEach(a=>t(a)),delete n[s]),this},handleByMap(s,t){return this.handle(s,e=>{t[e.name]=e.ref},e=>{delete t[e.name]})},handleByList(s,t,e=-1){return this.handle(s,i=>{t.includes(i.ref)||(t.push(i.ref),t.sort((r,n)=>Pf(n,e)-Pf(r,e)))},i=>{const r=t.indexOf(i.ref);r!==-1&&t.splice(r,1)})}};class HP{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const XP=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function $P(s){let t="";for(let e=0;e<s;++e)e>0&&(t+=`
else `),e<s-1&&(t+=`if(test == ${e}.0){}`);return t}function WP(s,t){if(s===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);for(;;){const i=XP.replace(/%forloop%/gi,$P(s));if(t.shaderSource(e,i),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))s=s/2|0;else break}return s}const sl=0,rl=1,nl=2,al=3,ol=4,hl=5;class ca{constructor(){this.data=0,this.blendMode=st.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<sl)}set blend(t){!!(this.data&1<<sl)!==t&&(this.data^=1<<sl)}get offsets(){return!!(this.data&1<<rl)}set offsets(t){!!(this.data&1<<rl)!==t&&(this.data^=1<<rl)}get culling(){return!!(this.data&1<<nl)}set culling(t){!!(this.data&1<<nl)!==t&&(this.data^=1<<nl)}get depthTest(){return!!(this.data&1<<al)}set depthTest(t){!!(this.data&1<<al)!==t&&(this.data^=1<<al)}get depthMask(){return!!(this.data&1<<hl)}set depthMask(t){!!(this.data&1<<hl)!==t&&(this.data^=1<<hl)}get clockwiseFrontFace(){return!!(this.data&1<<ol)}set clockwiseFrontFace(t){!!(this.data&1<<ol)!==t&&(this.data^=1<<ol)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==st.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const t=new ca;return t.depthTest=!1,t.blend=!0,t}}const dc=[];function pb(s,t){if(!s)return null;let e="";if(typeof s=="string"){const i=/\.(\w{3,4})(?:$|\?|#)/i.exec(s);i&&(e=i[1].toLowerCase())}for(let i=dc.length-1;i>=0;--i){const r=dc[i];if(r.test&&r.test(s,e))return new r(s,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class xi{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,i,r,n,a,o,h){if(arguments.length>8)throw new Error("max arguments reached");const{name:l,items:c}=this;this._aliasCount++;for(let u=0,d=c.length;u<d;u++)c[u][l](t,e,i,r,n,a,o,h);return c===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return e!==-1&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(xi.prototype,{dispatch:{value:xi.prototype.emit},run:{value:xi.prototype.emit}});class Jn{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new xi("setRealSize"),this.onUpdate=new xi("update"),this.onError=new xi("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,i){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class yu extends Jn{constructor(t,e){const{width:i,height:r}=e||{};if(!i||!r)throw new Error("BufferResource width or height invalid");super(i,r),this.data=t}upload(t,e,i){const r=t.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===Ms.UNPACK);const n=e.realWidth,a=e.realHeight;return i.width===n&&i.height===a?r.texSubImage2D(e.target,0,0,0,n,a,e.format,i.type,this.data):(i.width=n,i.height=a,r.texImage2D(e.target,0,i.internalFormat,n,a,0,e.format,i.type,this.data)),!0}dispose(){this.data=null}static test(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array}}const YP={scaleMode:Zi.NEAREST,format:q.RGBA,alphaMode:Ms.NPM},_r=class extends Rt{constructor(s=null,t=null){super(),t=Object.assign({},_r.defaultOptions,t);const{alphaMode:e,mipmap:i,anisotropicLevel:r,scaleMode:n,width:a,height:o,wrapMode:h,format:l,type:c,target:u,resolution:d,resourceOptions:f}=t;s&&!(s instanceof Jn)&&(s=pb(s,f),s.internal=!0),this.resolution=d||ot.RESOLUTION,this.width=Math.round((a||0)*this.resolution)/this.resolution,this.height=Math.round((o||0)*this.resolution)/this.resolution,this._mipmap=i,this.anisotropicLevel=r,this._wrapMode=h,this._scaleMode=n,this.format=l,this.type=c,this.target=u,this.alphaMode=e,this.uid=Zn(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=a>0&&o>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(s)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(s){this._mipmap!==s&&(this._mipmap=s,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(s){this._scaleMode!==s&&(this._scaleMode=s,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(s){this._wrapMode!==s&&(this._wrapMode=s,this.dirtyStyleId++)}setStyle(s,t){let e;return s!==void 0&&s!==this.scaleMode&&(this.scaleMode=s,e=!0),t!==void 0&&t!==this.mipmap&&(this.mipmap=t,e=!0),e&&this.dirtyStyleId++,this}setSize(s,t,e){return e=e||this.resolution,this.setRealSize(s*e,t*e,e)}setRealSize(s,t,e){return this.resolution=e||this.resolution,this.width=Math.round(s)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Cf(this.realWidth)&&Cf(this.realHeight)}setResolution(s){const t=this.resolution;return t===s?this:(this.resolution=s,this.valid&&(this.width=Math.round(this.width*t)/s,this.height=Math.round(this.height*t)/s,this.emit("update",this)),this._refreshPOT(),this)}setResource(s){if(this.resource===s)return this;if(this.resource)throw new Error("Resource can be set only once");return s.bind(this),this.resource=s,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(s){this.emit("error",this,s)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete ds[this.cacheId],delete Ai[this.cacheId],this.cacheId=null),this.dispose(),_r.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(s,t,e=ot.STRICT_TEXTURE_CACHE){const i=typeof s=="string";let r=null;if(i)r=s;else{if(!s._pixiId){const a=(t==null?void 0:t.pixiIdPrefix)||"pixiid";s._pixiId=`${a}_${Zn()}`}r=s._pixiId}let n=ds[r];if(i&&e&&!n)throw new Error(`The cacheId "${r}" does not exist in BaseTextureCache.`);return n||(n=new _r(s,t),n.cacheId=r,_r.addToCache(n,r)),n}static fromBuffer(s,t,e,i){s=s||new Float32Array(t*e*4);const r=new yu(s,{width:t,height:e}),n=s instanceof Float32Array?xt.FLOAT:xt.UNSIGNED_BYTE;return new _r(r,Object.assign({},YP,i||{width:t,height:e,type:n}))}static addToCache(s,t){t&&(s.textureCacheIds.includes(t)||s.textureCacheIds.push(t),ds[t]&&ds[t]!==s&&console.warn(`BaseTexture added to the cache with an id [${t}] that already had an entry`),ds[t]=s)}static removeFromCache(s){if(typeof s=="string"){const t=ds[s];if(t){const e=t.textureCacheIds.indexOf(s);return e>-1&&t.textureCacheIds.splice(e,1),delete ds[s],t}}else if(s!=null&&s.textureCacheIds){for(let t=0;t<s.textureCacheIds.length;++t)delete ds[s.textureCacheIds[t]];return s.textureCacheIds.length=0,s}return null}};let gt=_r;gt.defaultOptions={mipmap:rr.POW2,anisotropicLevel:0,scaleMode:Zi.LINEAR,wrapMode:gu.CLAMP,alphaMode:Ms.UNPACK,target:zr.TEXTURE_2D,format:q.RGBA,type:xt.UNSIGNED_BYTE};gt._globalBatch=0;class jP{constructor(){this.texArray=null,this.blend=0,this.type=_o.TRIANGLES,this.start=0,this.size=0,this.data=null}}let qP=0;class _e{constructor(t,e=!0,i=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=e,this.id=qP++,this.disposeRunner=new xi("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?Li.ELEMENT_ARRAY_BUFFER:Li.ARRAY_BUFFER}get index(){return this.type===Li.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new _e(t)}}class Co{constructor(t,e=0,i=!1,r=xt.FLOAT,n,a,o,h=1){this.buffer=t,this.size=e,this.normalized=i,this.type=r,this.stride=n,this.start=a,this.instance=o,this.divisor=h}destroy(){this.buffer=null}static from(t,e,i,r,n){return new Co(t,e,i,r,n)}}const KP={Float32Array,Uint32Array,Int32Array,Uint8Array};function ZP(s,t){let e=0,i=0;const r={};for(let h=0;h<s.length;h++)i+=t[h],e+=s[h].length;const n=new ArrayBuffer(e*4);let a=null,o=0;for(let h=0;h<s.length;h++){const l=t[h],c=s[h],u=fb(c);r[u]||(r[u]=new KP[u](n)),a=r[u];for(let d=0;d<c.length;d++){const f=(d/l|0)*i+o,p=d%l;a[f+p]=c[d]}o+=l}return new Float32Array(n)}const Mf={5126:4,5123:2,5121:1};let JP=0;const QP={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class nn{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=JP++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new xi("disposeGeometry"),this.refCount=0}addAttribute(t,e,i=0,r=!1,n,a,o,h=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof _e||(e instanceof Array&&(e=new Float32Array(e)),e=new _e(e));const l=t.split("|");if(l.length>1){for(let u=0;u<l.length;u++)this.addAttribute(l[u],e,i,r,n);return this}let c=this.buffers.indexOf(e);return c===-1&&(this.buffers.push(e),c=this.buffers.length-1),this.attributes[t]=new Co(c,i,r,n,a,o,h),this.instanced=this.instanced||h,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof _e||(t instanceof Array&&(t=new Uint16Array(t)),t=new _e(t)),t.type=Li.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const t=[],e=[],i=new _e;let r;for(r in this.attributes){const n=this.attributes[r],a=this.buffers[n.buffer];t.push(a.data),e.push(n.size*Mf[n.type]/4),n.buffer=0}for(i.data=ZP(t,e),r=0;r<this.buffers.length;r++)this.buffers[r]!==this.indexBuffer&&this.buffers[r].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new nn;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new _e(this.buffers[e].data.slice(0));for(const e in this.attributes){const i=this.attributes[e];t.attributes[e]=new Co(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=Li.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new nn,i=[],r=[],n=[];let a;for(let o=0;o<t.length;o++){a=t[o];for(let h=0;h<a.buffers.length;h++)r[h]=r[h]||0,r[h]+=a.buffers[h].data.length,n[h]=0}for(let o=0;o<a.buffers.length;o++)i[o]=new QP[fb(a.buffers[o].data)](r[o]),e.buffers[o]=new _e(i[o]);for(let o=0;o<t.length;o++){a=t[o];for(let h=0;h<a.buffers.length;h++)i[h].set(a.buffers[h].data,n[h]),n[h]+=a.buffers[h].data.length}if(e.attributes=a.attributes,a.indexBuffer){e.indexBuffer=e.buffers[a.buffers.indexOf(a.indexBuffer)],e.indexBuffer.type=Li.ELEMENT_ARRAY_BUFFER;let o=0,h=0,l=0,c=0;for(let u=0;u<a.buffers.length;u++)if(a.buffers[u]!==a.indexBuffer){c=u;break}for(const u in a.attributes){const d=a.attributes[u];(d.buffer|0)===c&&(h+=d.size*Mf[d.type]/4)}for(let u=0;u<t.length;u++){const d=t[u].indexBuffer.data;for(let f=0;f<d.length;f++)e.indexBuffer.data[f+l]+=o;o+=t[u].buffers[c].data.length/h,l+=d.length}}return e}}class tM extends nn{constructor(t=!1){super(),this._buffer=new _e(null,t,!1),this._indexBuffer=new _e(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,xt.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,xt.FLOAT).addAttribute("aColor",this._buffer,4,!0,xt.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,xt.FLOAT).addIndex(this._indexBuffer)}}const eM=Math.PI*2;var mb=(s=>(s[s.POLY=0]="POLY",s[s.RECT=1]="RECT",s[s.CIRC=2]="CIRC",s[s.ELIP=3]="ELIP",s[s.RREC=4]="RREC",s))(mb||{});class Me{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new Me(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}toString(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`}}const Ra=[new Me,new Me,new Me,new Me];class Jt{constructor(t=0,e=0,i=0,r=0){this.x=Number(t),this.y=Number(e),this.width=Number(i),this.height=Number(r),this.type=mb.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Jt(0,0,0,0)}clone(){return new Jt(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e){const S=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=S)return!1;const E=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>E}const i=this.left,r=this.right,n=this.top,a=this.bottom;if(r<=i||a<=n)return!1;const o=Ra[0].set(t.left,t.top),h=Ra[1].set(t.left,t.bottom),l=Ra[2].set(t.right,t.top),c=Ra[3].set(t.right,t.bottom);if(l.x<=o.x||h.y<=o.y)return!1;const u=Math.sign(e.a*e.d-e.b*e.c);if(u===0||(e.apply(o,o),e.apply(h,h),e.apply(l,l),e.apply(c,c),Math.max(o.x,h.x,l.x,c.x)<=i||Math.min(o.x,h.x,l.x,c.x)>=r||Math.max(o.y,h.y,l.y,c.y)<=n||Math.min(o.y,h.y,l.y,c.y)>=a))return!1;const d=u*(h.y-o.y),f=u*(o.x-h.x),p=d*i+f*n,m=d*r+f*n,g=d*i+f*a,x=d*r+f*a;if(Math.max(p,m,g,x)<=d*o.x+f*o.y||Math.min(p,m,g,x)>=d*c.x+f*c.y)return!1;const y=u*(o.y-l.y),b=u*(l.x-o.x),v=y*i+b*n,_=y*r+b*n,w=y*i+b*a,T=y*r+b*a;return!(Math.max(v,_,w,T)<=y*o.x+b*o.y||Math.min(v,_,w,T)>=y*c.x+b*c.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){const e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),r=Math.max(this.y,t.y),n=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=r,this.height=Math.max(n-r,0),this}ceil(t=1,e=.001){const i=Math.ceil((this.x+this.width-e)*t)/t,r=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=r-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),r=Math.min(this.y,t.y),n=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=r,this.height=n-r,this}toString(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class fe{constructor(t=1,e=0,i=0,r=1,n=0,a=0){this.array=null,this.a=t,this.b=e,this.c=i,this.d=r,this.tx=n,this.ty=a}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,i,r,n,a){return this.a=t,this.b=e,this.c=i,this.d=r,this.tx=n,this.ty=a,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(t,e){e=e||new Me;const i=t.x,r=t.y;return e.x=this.a*i+this.c*r+this.tx,e.y=this.b*i+this.d*r+this.ty,e}applyInverse(t,e){e=e||new Me;const i=1/(this.a*this.d+this.c*-this.b),r=t.x,n=t.y;return e.x=this.d*i*r+-this.c*i*n+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*n+-this.b*i*r+(-this.ty*this.a+this.tx*this.b)*i,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),r=this.a,n=this.c,a=this.tx;return this.a=r*e-this.b*i,this.b=r*i+this.b*e,this.c=n*e-this.d*i,this.d=n*i+this.d*e,this.tx=a*e-this.ty*i,this.ty=a*i+this.ty*e,this}append(t){const e=this.a,i=this.b,r=this.c,n=this.d;return this.a=t.a*e+t.b*r,this.b=t.a*i+t.b*n,this.c=t.c*e+t.d*r,this.d=t.c*i+t.d*n,this.tx=t.tx*e+t.ty*r+this.tx,this.ty=t.tx*i+t.ty*n+this.ty,this}setTransform(t,e,i,r,n,a,o,h,l){return this.a=Math.cos(o+l)*n,this.b=Math.sin(o+l)*n,this.c=-Math.sin(o-h)*a,this.d=Math.cos(o-h)*a,this.tx=t-(i*this.a+r*this.c),this.ty=e-(i*this.b+r*this.d),this}prepend(t){const e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const i=this.a,r=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=r*t.a+this.d*t.c,this.d=r*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,i=this.b,r=this.c,n=this.d,a=t.pivot,o=-Math.atan2(-r,n),h=Math.atan2(i,e),l=Math.abs(o+h);return l<1e-5||Math.abs(eM-l)<1e-5?(t.rotation=h,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=h),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(r*r+n*n),t.position.x=this.tx+(a.x*e+a.y*r),t.position.y=this.ty+(a.x*i+a.y*n),t}invert(){const t=this.a,e=this.b,i=this.c,r=this.d,n=this.tx,a=t*r-e*i;return this.a=r/a,this.b=-e/a,this.c=-i/a,this.d=t/a,this.tx=(i*this.ty-r*n)/a,this.ty=-(t*this.ty-e*n)/a,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new fe;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}toString(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return new fe}static get TEMP_MATRIX(){return new fe}}const Hs=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Xs=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],$s=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Ws=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],fc=[],gb=[],Ba=Math.sign;function iM(){for(let s=0;s<16;s++){const t=[];fc.push(t);for(let e=0;e<16;e++){const i=Ba(Hs[s]*Hs[e]+$s[s]*Xs[e]),r=Ba(Xs[s]*Hs[e]+Ws[s]*Xs[e]),n=Ba(Hs[s]*$s[e]+$s[s]*Ws[e]),a=Ba(Xs[s]*$s[e]+Ws[s]*Ws[e]);for(let o=0;o<16;o++)if(Hs[o]===i&&Xs[o]===r&&$s[o]===n&&Ws[o]===a){t.push(o);break}}}for(let s=0;s<16;s++){const t=new fe;t.set(Hs[s],Xs[s],$s[s],Ws[s],0,0),gb.push(t)}}iM();const Dt={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:s=>Hs[s],uY:s=>Xs[s],vX:s=>$s[s],vY:s=>Ws[s],inv:s=>s&8?s&15:-s&7,add:(s,t)=>fc[s][t],sub:(s,t)=>fc[s][Dt.inv(t)],rotate180:s=>s^4,isVertical:s=>(s&3)===2,byDirection:(s,t)=>Math.abs(s)*2<=Math.abs(t)?t>=0?Dt.S:Dt.N:Math.abs(t)*2<=Math.abs(s)?s>0?Dt.E:Dt.W:t>0?s>0?Dt.SE:Dt.SW:s>0?Dt.NE:Dt.NW,matrixAppendRotationInv:(s,t,e=0,i=0)=>{const r=gb[Dt.inv(t)];r.tx=e,r.ty=i,s.append(r)}};class Mr{constructor(t,e,i=0,r=0){this._x=i,this._y=r,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new Mr(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[@pixi/math:ObservablePoint x=${0} y=${0} scope=${this.scope}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}const bb=class{constructor(){this.worldTransform=new fe,this.localTransform=new fe,this.position=new Mr(this.onChange,this,0,0),this.scale=new Mr(this.onChange,this,1,1),this.pivot=new Mr(this.onChange,this,0,0),this.skew=new Mr(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}toString(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}updateLocalTransform(){const s=this.localTransform;this._localID!==this._currentLocalID&&(s.a=this._cx*this.scale.x,s.b=this._sx*this.scale.x,s.c=this._cy*this.scale.y,s.d=this._sy*this.scale.y,s.tx=this.position.x-(this.pivot.x*s.a+this.pivot.y*s.c),s.ty=this.position.y-(this.pivot.x*s.b+this.pivot.y*s.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(s){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==s._worldID){const e=s.worldTransform,i=this.worldTransform;i.a=t.a*e.a+t.b*e.c,i.b=t.a*e.b+t.b*e.d,i.c=t.c*e.a+t.d*e.c,i.d=t.c*e.b+t.d*e.d,i.tx=t.tx*e.a+t.ty*e.c+e.tx,i.ty=t.tx*e.b+t.ty*e.d+e.ty,this._parentID=s._worldID,this._worldID++}}setFromMatrix(s){s.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(s){this._rotation!==s&&(this._rotation=s,this.updateSkew())}};let yb=bb;yb.IDENTITY=new bb;var sM=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,rM=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function kf(s,t,e){const i=s.createShader(t);return s.shaderSource(i,e),s.compileShader(i),i}function ll(s){const t=new Array(s);for(let e=0;e<t.length;e++)t[e]=!1;return t}function xb(s,t){switch(s){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return ll(2*t);case"bvec3":return ll(3*t);case"bvec4":return ll(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const Xr=[{test:s=>s.type==="float"&&s.size===1&&!s.isArray,code:s=>`
            if(uv["${s}"] !== ud["${s}"].value)
            {
                ud["${s}"].value = uv["${s}"]
                gl.uniform1f(ud["${s}"].location, uv["${s}"])
            }
            `},{test:(s,t)=>(s.type==="sampler2D"||s.type==="samplerCube"||s.type==="sampler2DArray")&&s.size===1&&!s.isArray&&(t==null||t.castToBaseTexture!==void 0),code:s=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${s}"], t);

            if(ud["${s}"].value !== t)
            {
                ud["${s}"].value = t;
                gl.uniform1i(ud["${s}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(s,t)=>s.type==="mat3"&&s.size===1&&!s.isArray&&t.a!==void 0,code:s=>`
            gl.uniformMatrix3fv(ud["${s}"].location, false, uv["${s}"].toArray(true));
            `,codeUbo:s=>`
                var ${s}_matrix = uv.${s}.toArray(true);

                data[offset] = ${s}_matrix[0];
                data[offset+1] = ${s}_matrix[1];
                data[offset+2] = ${s}_matrix[2];
        
                data[offset + 4] = ${s}_matrix[3];
                data[offset + 5] = ${s}_matrix[4];
                data[offset + 6] = ${s}_matrix[5];
        
                data[offset + 8] = ${s}_matrix[6];
                data[offset + 9] = ${s}_matrix[7];
                data[offset + 10] = ${s}_matrix[8];
            `},{test:(s,t)=>s.type==="vec2"&&s.size===1&&!s.isArray&&t.x!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${s}"].location, v.x, v.y);
                }`,codeUbo:s=>`
                v = uv.${s};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:s=>s.type==="vec2"&&s.size===1&&!s.isArray,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${s}"].location, v[0], v[1]);
                }
            `},{test:(s,t)=>s.type==="vec4"&&s.size===1&&!s.isArray&&t.width!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${s}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:s=>`
                    v = uv.${s};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:s=>s.type==="vec4"&&s.size===1&&!s.isArray,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${s}"].location, v[0], v[1], v[2], v[3])
                }`}],nM={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},aM={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function oM(s,t){var i;const e=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const r in s.uniforms){const n=t[r];if(!n){(i=s.uniforms[r])!=null&&i.group&&(s.uniforms[r].ubo?e.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${r}, '${r}');
                    `):e.push(`
                        renderer.shader.syncUniformGroup(uv.${r}, syncData);
                    `));continue}const a=s.uniforms[r];let o=!1;for(let h=0;h<Xr.length;h++)if(Xr[h].test(n,a)){e.push(Xr[h].code(r,a)),o=!0;break}if(!o){const l=(n.size===1&&!n.isArray?nM:aM)[n.type].replace("location",`ud["${r}"].location`);e.push(`
            cu = ud["${r}"];
            cv = cu.value;
            v = uv["${r}"];
            ${l};`)}}return new Function("ud","uv","renderer","syncData",e.join(`
`))}const vb={};let br=vb;function hM(){if(br===vb||br!=null&&br.isContextLost()){const s=ot.ADAPTER.createCanvas();let t;ot.PREFER_ENV>=hr.WEBGL2&&(t=s.getContext("webgl2",{})),t||(t=s.getContext("webgl",{})||s.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),br=t}return br}let Ia;function lM(){if(!Ia){Ia=Je.MEDIUM;const s=hM();s&&s.getShaderPrecisionFormat&&(Ia=s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT).precision?Je.HIGH:Je.MEDIUM)}return Ia}function Rf(s,t){const e=s.getShaderSource(t).split(`
`).map((l,c)=>`${c}: ${l}`),i=s.getShaderInfoLog(t),r=i.split(`
`),n={},a=r.map(l=>parseFloat(l.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(l=>l&&!n[l]?(n[l]=!0,!0):!1),o=[""];a.forEach(l=>{e[l-1]=`%c${e[l-1]}%c`,o.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const h=e.join(`
`);o[0]=h,console.error(i),console.groupCollapsed("click to view full shader code"),console.warn(...o),console.groupEnd()}function cM(s,t,e,i){s.getProgramParameter(t,s.LINK_STATUS)||(s.getShaderParameter(e,s.COMPILE_STATUS)||Rf(s,e),s.getShaderParameter(i,s.COMPILE_STATUS)||Rf(s,i),console.error("PixiJS Error: Could not initialize shader."),s.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",s.getProgramInfoLog(t)))}const uM={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function _b(s){return uM[s]}let Fa=null;const Bf={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function wb(s,t){if(!Fa){const e=Object.keys(Bf);Fa={};for(let i=0;i<e.length;++i){const r=e[i];Fa[s[r]]=Bf[r]}}return Fa[t]}function If(s,t,e){if(s.substring(0,9)!=="precision"){let i=t;return t===Je.HIGH&&e!==Je.HIGH&&(i=Je.MEDIUM),`precision ${i} float;
${s}`}else if(e!==Je.HIGH&&s.substring(0,15)==="precision highp")return s.replace("precision highp","precision mediump");return s}let bn;function dM(){if(typeof bn=="boolean")return bn;try{bn=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{bn=!1}return bn}let fM=0;const Ua={},wr=class{constructor(s,t,e="pixi-shader",i={}){this.extra={},this.id=fM++,this.vertexSrc=s||wr.defaultVertexSrc,this.fragmentSrc=t||wr.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=i,this.vertexSrc.substring(0,8)!=="#version"&&(e=e.replace(/\s+/g,"-"),Ua[e]?(Ua[e]++,e+=`-${Ua[e]}`):Ua[e]=1,this.vertexSrc=`#define SHADER_NAME ${e}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${e}
${this.fragmentSrc}`,this.vertexSrc=If(this.vertexSrc,wr.defaultVertexPrecision,Je.HIGH),this.fragmentSrc=If(this.fragmentSrc,wr.defaultFragmentPrecision,lM())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return rM}static get defaultFragmentSrc(){return sM}static from(s,t,e){const i=s+t;let r=Ef[i];return r||(Ef[i]=r=new wr(s,t,e)),r}};let Ji=wr;Ji.defaultVertexPrecision=Je.HIGH;Ji.defaultFragmentPrecision=Pr.apple.device?Je.HIGH:Je.MEDIUM;let pM=0;class Oi{constructor(t,e,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=pM++,this.static=!!e,this.ubo=!!i,t instanceof _e?(this.buffer=t,this.buffer.type=Li.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new _e(new Float32Array(1)),this.buffer.type=Li.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,i){if(!this.ubo)this.uniforms[t]=new Oi(e,i);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,e,i){return new Oi(t,e,i)}static uboFrom(t,e){return new Oi(t,e??!0,!0)}}class Wo{constructor(t,e){this.uniformBindCount=0,this.program=t,e?e instanceof Oi?this.uniformGroup=e:this.uniformGroup=new Oi(e):this.uniformGroup=new Oi({}),this.disposeRunner=new xi("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const i in e.uniforms){const r=e.uniforms[i];if(r.group&&this.checkUniformExists(t,r))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,i){const r=Ji.from(t,e);return new Wo(r,i)}}class mM{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const i=new Int32Array(t);for(let n=0;n<t;n++)i[n]=n;this.defaultGroupCache[t]=Oi.from({uSamplers:i},!0);let r=this.fragTemplate;r=r.replace(/%count%/gi,`${t}`),r=r.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new Ji(this.vertexSrc,r)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new fe,default:this.defaultGroupCache[t]};return new Wo(this.programCache[t],e)}generateSampleSrc(t){let e="";e+=`
`,e+=`
`;for(let i=0;i<t;i++)i>0&&(e+=`
else `),i<t-1&&(e+=`if(vTextureId < ${i}.5)`),e+=`
{`,e+=`
	color = texture2D(uSamplers[${i}], vTextureCoord);`,e+=`
}`;return e+=`
`,e+=`
`,e}}class gM{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}function bM(){return!Pr.apple.device}function yM(s){let t=!0;const e=ot.ADAPTER.getNavigator();if(Pr.tablet||Pr.phone){if(Pr.apple.device){const i=e.userAgent.match(/OS (\d+)_(\d+)?/);i&&parseInt(i[1],10)<11&&(t=!1)}if(Pr.android.device){const i=e.userAgent.match(/Android\s([0-9.]*)/);i&&parseInt(i[1],10)<7&&(t=!1)}}return t?s:4}class Tb{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}var xM=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,vM=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const ni=class extends Tb{constructor(s){super(s),this.setShaderGenerator(),this.geometryClass=tM,this.vertexSize=6,this.state=ca.for2d(),this.size=ni.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),s.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??yM(32),this._defaultMaxTextures}static set defaultMaxTextures(s){this._defaultMaxTextures=s}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??bM(),this._canUploadSameBuffer}static set canUploadSameBuffer(s){this._canUploadSameBuffer=s}get MAX_TEXTURES(){return Et("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return vM}static get defaultFragmentTemplate(){return xM}setShaderGenerator({vertex:s=ni.defaultVertexSrc,fragment:t=ni.defaultFragmentTemplate}={}){this.shaderGenerator=new mM(s,t)}contextChange(){const s=this.renderer.gl;ot.PREFER_ENV===hr.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(s.getParameter(s.MAX_TEXTURE_IMAGE_UNITS),ni.defaultMaxTextures),this.maxTextures=WP(this.maxTextures,s)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:s,_textureArrayPool:t}=ni,e=this.size/4,i=Math.floor(e/this.maxTextures)+1;for(;s.length<e;)s.push(new jP);for(;t.length<i;)t.push(new gM);for(let r=0;r<this.maxTextures;r++)this._tempBoundTextures[r]=null}onPrerender(){this._flushId=0}render(s){s._texture.valid&&(this._vertexCount+s.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=s.vertexData.length/2,this._indexCount+=s.indices.length,this._bufferedTextures[this._bufferSize]=s._texture.baseTexture,this._bufferedElements[this._bufferSize++]=s)}buildTexturesAndDrawCalls(){const{_bufferedTextures:s,maxTextures:t}=this,e=ni._textureArrayPool,i=this.renderer.batch,r=this._tempBoundTextures,n=this.renderer.textureGC.count;let a=++gt._globalBatch,o=0,h=e[0],l=0;i.copyBoundTextures(r,t);for(let c=0;c<this._bufferSize;++c){const u=s[c];s[c]=null,u._batchEnabled!==a&&(h.count>=t&&(i.boundArray(h,r,a,t),this.buildDrawCalls(h,l,c),l=c,h=e[++o],++a),u._batchEnabled=a,u.touched=n,h.elements[h.count++]=u)}h.count>0&&(i.boundArray(h,r,a,t),this.buildDrawCalls(h,l,this._bufferSize),++o,++a);for(let c=0;c<r.length;c++)r[c]=null;gt._globalBatch=a}buildDrawCalls(s,t,e){const{_bufferedElements:i,_attributeBuffer:r,_indexBuffer:n,vertexSize:a}=this,o=ni._drawCallPool;let h=this._dcIndex,l=this._aIndex,c=this._iIndex,u=o[h];u.start=this._iIndex,u.texArray=s;for(let d=t;d<e;++d){const f=i[d],p=f._texture.baseTexture,m=NP[p.alphaMode?1:0][f.blendMode];i[d]=null,t<d&&u.blend!==m&&(u.size=c-u.start,t=d,u=o[++h],u.texArray=s,u.start=c),this.packInterleavedGeometry(f,r,n,l,c),l+=f.vertexData.length/2*a,c+=f.indices.length,u.blend=m}t<e&&(u.size=c-u.start,++h),this._dcIndex=h,this._aIndex=l,this._iIndex=c}bindAndClearTexArray(s){const t=this.renderer.texture;for(let e=0;e<s.count;e++)t.bind(s.elements[e],s.ids[e]),s.elements[e]=null;s.count=0}updateGeometry(){const{_packedGeometries:s,_attributeBuffer:t,_indexBuffer:e}=this;ni.canUploadSameBuffer?(s[this._flushId]._buffer.update(t.rawBinaryData),s[this._flushId]._indexBuffer.update(e),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,s[this._flushId]=new this.geometryClass),s[this._flushId]._buffer.update(t.rawBinaryData),s[this._flushId]._indexBuffer.update(e),this.renderer.geometry.bind(s[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const s=this._dcIndex,{gl:t,state:e}=this.renderer,i=ni._drawCallPool;let r=null;for(let n=0;n<s;n++){const{texArray:a,type:o,size:h,start:l,blend:c}=i[n];r!==a&&(r=a,this.bindAndClearTexArray(a)),this.state.blendMode=c,e.set(this.state),t.drawElements(o,h,t.UNSIGNED_SHORT,l*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),ni.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let s=0;s<this._packedGeometryPoolSize;s++)this._packedGeometries[s]&&this._packedGeometries[s].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(s){const t=To(Math.ceil(s/8)),e=Af(t),i=t*8;this._aBuffers.length<=e&&(this._iBuffers.length=e+1);let r=this._aBuffers[i];return r||(this._aBuffers[i]=r=new HP(i*this.vertexSize*4)),r}getIndexBuffer(s){const t=To(Math.ceil(s/12)),e=Af(t),i=t*12;this._iBuffers.length<=e&&(this._iBuffers.length=e+1);let r=this._iBuffers[e];return r||(this._iBuffers[e]=r=new Uint16Array(i)),r}packInterleavedGeometry(s,t,e,i,r){const{uint32View:n,float32View:a}=t,o=i/this.vertexSize,h=s.uvs,l=s.indices,c=s.vertexData,u=s._texture.baseTexture._batchLocation,d=Math.min(s.worldAlpha,1),f=d<1&&s._texture.baseTexture.alphaMode?DP(s._tintRGB,d):s._tintRGB+(d*255<<24);for(let p=0;p<c.length;p+=2)a[i++]=c[p],a[i++]=c[p+1],a[i++]=h[p],a[i++]=h[p+1],n[i++]=f,a[i++]=u;for(let p=0;p<l.length;p++)e[r++]=o+l[p]}};let ui=ni;ui.defaultBatchSize=4096;ui.extension={name:"batch",type:Q.RendererPlugin};ui._drawCallPool=[];ui._textureArrayPool=[];rt.add(ui);var _M=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,wM=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const An=class extends Wo{constructor(s,t,e){const i=Ji.from(s||An.defaultVertexSrc,t||An.defaultFragmentSrc);super(i,e),this.padding=0,this.resolution=An.defaultResolution,this.multisample=An.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new ca}apply(s,t,e,i,r){s.applyFilter(this,t,e,i)}get blendMode(){return this.state.blendMode}set blendMode(s){this.state.blendMode=s}get resolution(){return this._resolution}set resolution(s){this._resolution=s}static get defaultVertexSrc(){return wM}static get defaultFragmentSrc(){return _M}};let xs=An;xs.defaultResolution=1;xs.defaultMultisample=qt.NONE;class Sb{constructor(){this.clearBeforeRender=!0,this._backgroundColor=0,this._backgroundColorRgba=[0,0,0,1],this._backgroundColorString="#000000",this.color=this._backgroundColor,this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender,t.color&&(this.color=typeof t.color=="string"?LP(t.color):t.color),this.alpha=t.alpha}get color(){return this._backgroundColor}set color(t){this._backgroundColor=t,this._backgroundColorString=UP(t),FP(t,this._backgroundColorRgba)}get alpha(){return this._backgroundColorRgba[3]}set alpha(t){this._backgroundColorRgba[3]=t}get colorRgba(){return this._backgroundColorRgba}get colorString(){return this._backgroundColorString}destroy(){}}Sb.extension={type:[Q.RendererSystem,Q.CanvasRendererSystem],name:"background"};rt.add(Sb);class Cb{constructor(t){this.renderer=t,this.emptyRenderer=new Tb(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:i}=this.renderer.texture;for(let r=e-1;r>=0;--r)t[r]=i[r]||null,t[r]&&(t[r]._batchLocation=r)}boundArray(t,e,i,r){const{elements:n,ids:a,count:o}=t;let h=0;for(let l=0;l<o;l++){const c=n[l],u=c._batchLocation;if(u>=0&&u<r&&e[u]===c){a[l]=u;continue}for(;h<r;){const d=e[h];if(d&&d._batchEnabled===i&&d._batchLocation===h){h++;continue}a[l]=h,c._batchLocation=h,e[h]=c;break}}}destroy(){this.renderer=null}}Cb.extension={type:Q.RendererSystem,name:"batch"};rt.add(Cb);let Ff=0;class Ab{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=Ff++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,i=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:i,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=Ff++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;e.addEventListener!==void 0&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let i;if(ot.PREFER_ENV>=hr.WEBGL2&&(i=t.getContext("webgl2",e)),i)this.webGLVersion=2;else if(this.webGLVersion=1,i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!i)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),i="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;i&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const r=i||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=r,r||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}Ab.extension={type:Q.RendererSystem,name:"context"};rt.add(Ab);class TM extends yu{upload(t,e,i){const r=t.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===Ms.UNPACK);const n=e.realWidth,a=e.realHeight;return i.width===n&&i.height===a?r.texSubImage2D(e.target,0,0,0,n,a,e.format,i.type,this.data):(i.width=n,i.height=a,r.texImage2D(e.target,0,i.internalFormat,n,a,0,e.format,i.type,this.data)),!0}}class pc{constructor(t,e){this.width=Math.round(t||100),this.height=Math.round(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new xi("disposeFramebuffer"),this.multisample=qt.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new gt(null,{scaleMode:Zi.NEAREST,resolution:1,mipmap:rr.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new gt(new TM(null,{width:this.width,height:this.height}),{scaleMode:Zi.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:rr.OFF,format:q.DEPTH_COMPONENT,type:xt.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),!(t===this.width&&e===this.height)){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let i=0;i<this.colorTextures.length;i++){const r=this.colorTextures[i],n=r.resolution;r.setSize(t/n,e/n)}if(this.depthTexture){const i=this.depthTexture.resolution;this.depthTexture.setSize(t/i,e/i)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class Eb extends gt{constructor(t={}){if(typeof t=="number"){const e=arguments[0],i=arguments[1],r=arguments[2],n=arguments[3];t={width:e,height:i,scaleMode:r,resolution:n}}t.width=t.width||100,t.height=t.height||100,t.multisample??(t.multisample=qt.NONE),super(null,t),this.mipmap=rr.OFF,this.valid=!0,this.clearColor=[0,0,0,0],this.framebuffer=new pc(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class Cs extends Jn{constructor(t){const e=t,i=e.naturalWidth||e.videoWidth||e.width,r=e.naturalHeight||e.videoHeight||e.height;super(i,r),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,i){i===void 0&&!e.startsWith("data:")?t.crossOrigin=zP(e):i!==!1&&(t.crossOrigin=typeof i=="string"?i:"anonymous")}upload(t,e,i,r){const n=t.gl,a=e.realWidth,o=e.realHeight;if(r=r||this.source,typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement){if(!r.complete||r.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement&&r.readyState<=1&&r.buffered.length===0)return!1;return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===Ms.UNPACK),!this.noSubImage&&e.target===n.TEXTURE_2D&&i.width===a&&i.height===o?n.texSubImage2D(n.TEXTURE_2D,0,0,0,e.format,i.type,r):(i.width=a,i.height=o,n.texImage2D(e.target,0,i.internalFormat,e.format,i.type,r)),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,i=t.naturalHeight||t.videoHeight||t.height;this.resize(e,i),super.update()}dispose(){this.source=null}}class Pb extends Cs{constructor(t,e){if(e=e||{},typeof t=="string"){const i=new Image;Cs.crossOrigin(i,t,e.crossorigin),i.src=t,t=i}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??ot.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.bitmap=null,this._load=null,e.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((e,i)=>{const r=this.source;this.url=r.src;const n=()=>{this.destroyed||(r.onload=null,r.onerror=null,this.resize(r.width,r.height),this._load=null,this.createBitmap?e(this.process()):e(this))};r.complete&&r.src?n():(r.onload=n,r.onerror=a=>{i(a),this.onError.emit(a)})}),this._load)}process(){const t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,i=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:i?"cors":"no-cors"}).then(r=>r.blob()).then(r=>e(r,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Ms.UNPACK?"premultiply":"none"})).then(r=>this.destroyed?Promise.reject():(this.bitmap=r,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,e,i){if(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,i);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,i,this.bitmap),!this.preserveBitmap){let r=!0;const n=e._glTextures;for(const a in n){const o=n[a];if(o!==i&&o.dirtyId!==e.dirtyId){r=!1;break}}r&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}}class Mb{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,i){const r=e.width,n=e.height;if(i){const a=t.width/2/r,o=t.height/2/n,h=t.x/r+a,l=t.y/n+o;i=Dt.add(i,Dt.NW),this.x0=h+a*Dt.uX(i),this.y0=l+o*Dt.uY(i),i=Dt.add(i,2),this.x1=h+a*Dt.uX(i),this.y1=l+o*Dt.uY(i),i=Dt.add(i,2),this.x2=h+a*Dt.uX(i),this.y2=l+o*Dt.uY(i),i=Dt.add(i,2),this.x3=h+a*Dt.uX(i),this.y3=l+o*Dt.uY(i)}else this.x0=t.x/r,this.y0=t.y/n,this.x1=(t.x+t.width)/r,this.y1=t.y/n,this.x2=(t.x+t.width)/r,this.y2=(t.y+t.height)/n,this.x3=t.x/r,this.y3=(t.y+t.height)/n;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}toString(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`}}const Uf=new Mb;function La(s){s.destroy=function(){},s.on=function(){},s.once=function(){},s.emit=function(){}}class yt extends Rt{constructor(t,e,i,r,n,a){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new Jt(0,0,1,1)),t instanceof yt&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=r,this.valid=!1,this._uvs=Uf,this.uvMatrix=null,this.orig=i||e,this._rotate=Number(n||0),n===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=a?new Me(a.x,a.y):new Me(0,0),this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:e}=this.baseTexture;e!=null&&e.url&&Ai[e.url]&&yt.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,yt.removeFromCache(this),this.textureCacheIds=null}clone(){var r;const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),i=new yt(this.baseTexture,!this.noFrame&&t,e,(r=this.trim)==null?void 0:r.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(i._frame=t),i}updateUvs(){this._uvs===Uf&&(this._uvs=new Mb),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},i=ot.STRICT_TEXTURE_CACHE){const r=typeof t=="string";let n=null;if(r)n=t;else if(t instanceof gt){if(!t.cacheId){const o=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t.cacheId=`${o}-${Zn()}`,gt.addToCache(t,t.cacheId)}n=t.cacheId}else{if(!t._pixiId){const o=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${o}_${Zn()}`}n=t._pixiId}let a=Ai[n];if(r&&i&&!a)throw new Error(`The cacheId "${n}" does not exist in TextureCache.`);return!a&&!(t instanceof gt)?(e.resolution||(e.resolution=So(t)),a=new yt(new gt(t,e)),a.baseTexture.cacheId=n,gt.addToCache(a.baseTexture,n),yt.addToCache(a,n)):!a&&t instanceof gt&&(a=new yt(t),yt.addToCache(a,n)),a}static fromURL(t,e){const i=Object.assign({autoLoad:!1},e==null?void 0:e.resourceOptions),r=yt.from(t,Object.assign({resourceOptions:i},e),!1),n=r.baseTexture.resource;return r.baseTexture.valid?Promise.resolve(r):n.load().then(()=>Promise.resolve(r))}static fromBuffer(t,e,i,r){return new yt(gt.fromBuffer(t,e,i,r))}static fromLoader(t,e,i,r){const n=new gt(t,Object.assign({scaleMode:gt.defaultOptions.scaleMode,resolution:So(e)},r)),{resource:a}=n;a instanceof Pb&&(a.url=e);const o=new yt(n);return i||(i=e),gt.addToCache(o.baseTexture,i),yt.addToCache(o,i),i!==e&&(gt.addToCache(o.baseTexture,e),yt.addToCache(o,e)),o.baseTexture.valid?Promise.resolve(o):new Promise(h=>{o.baseTexture.once("loaded",()=>h(o))})}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Ai[e]&&Ai[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),Ai[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=Ai[t];if(e){const i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete Ai[t],e}}else if(t!=null&&t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)Ai[t.textureCacheIds[e]]===t&&delete Ai[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:i,width:r,height:n}=t,a=e+r>this.baseTexture.width,o=i+n>this.baseTexture.height;if(a||o){const h=a&&o?"and":"or",l=`X: ${e} + ${r} = ${e+r} > ${this.baseTexture.width}`,c=`Y: ${i} + ${n} = ${i+n} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${l} ${h} ${c}`)}this.valid=r&&n&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return yt._EMPTY||(yt._EMPTY=new yt(new gt),La(yt._EMPTY),La(yt._EMPTY.baseTexture)),yt._EMPTY}static get WHITE(){if(!yt._WHITE){const t=ot.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),yt._WHITE=new yt(gt.from(t)),La(yt._WHITE),La(yt._WHITE.baseTexture)}return yt._WHITE}}class Yo extends yt{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,i=!0){const r=this.baseTexture.resolution,n=Math.round(t*r)/r,a=Math.round(e*r)/r;this.valid=n>0&&a>0,this._frame.width=this.orig.width=n,this._frame.height=this.orig.height=a,i&&this.baseTexture.resize(n,a),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new Yo(new Eb(t))}}class kb{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,i=qt.NONE){const r=new Eb(Object.assign({width:t,height:e,resolution:1,multisample:i},this.textureOptions));return new Yo(r)}getOptimalTexture(t,e,i=1,r=qt.NONE){let n;t=Math.ceil(t*i-1e-6),e=Math.ceil(e*i-1e-6),!this.enableFullScreen||t!==this._pixelsWidth||e!==this._pixelsHeight?(t=To(t),e=To(e),n=((t&65535)<<16|e&65535)>>>0,r>1&&(n+=r*4294967296)):n=r>1?-r:-1,this.texturePool[n]||(this.texturePool[n]=[]);let a=this.texturePool[n].pop();return a||(a=this.createTexture(t,e,r)),a.filterPoolKey=n,a.setResolution(i),a}getFilterTexture(t,e,i){const r=this.getOptimalTexture(t.width,t.height,e||t.resolution,i||qt.NONE);return r.filterFrame=t.filterFrame,r}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(const e in this.texturePool){const i=this.texturePool[e];if(i)for(let r=0;r<i.length;r++)i[r].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(const e in this.texturePool){if(!(Number(e)<0))continue;const i=this.texturePool[e];if(i)for(let r=0;r<i.length;r++)i[r].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}kb.SCREEN_KEY=-1;class SM extends nn{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class CM extends nn{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new _e(this.vertices),this.uvBuffer=new _e(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let i=0,r=0;return this.uvs[0]=i,this.uvs[1]=r,this.uvs[2]=i+e.width/t.width,this.uvs[3]=r,this.uvs[4]=i+e.width/t.width,this.uvs[5]=r+e.height/t.height,this.uvs[6]=i,this.uvs[7]=r+e.height/t.height,i=e.x,r=e.y,this.vertices[0]=i,this.vertices[1]=r,this.vertices[2]=i+e.width,this.vertices[3]=r,this.vertices[4]=i+e.width,this.vertices[5]=r+e.height,this.vertices[6]=i,this.vertices[7]=r+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class AM{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=qt.NONE,this.sourceFrame=new Jt,this.destinationFrame=new Jt,this.bindingSourceFrame=new Jt,this.bindingDestinationFrame=new Jt,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const Oa=[new Me,new Me,new Me,new Me],cl=new fe;class Rb{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new kb,this.statePool=[],this.quad=new SM,this.quadUv=new CM,this.tempRect=new Jt,this.activeState={},this.globalUniforms=new Oi({outputFrame:new Jt,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const i=this.renderer,r=this.defaultFilterStack,n=this.statePool.pop()||new AM,a=this.renderer.renderTexture;let o=e[0].resolution,h=e[0].multisample,l=e[0].padding,c=e[0].autoFit,u=e[0].legacy??!0;for(let p=1;p<e.length;p++){const m=e[p];o=Math.min(o,m.resolution),h=Math.min(h,m.multisample),l=this.useMaxPadding?Math.max(l,m.padding):l+m.padding,c=c&&m.autoFit,u=u||(m.legacy??!0)}r.length===1&&(this.defaultFilterStack[0].renderTexture=a.current),r.push(n),n.resolution=o,n.multisample=h,n.legacy=u,n.target=t,n.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),n.sourceFrame.pad(l);const d=this.tempRect.copyFrom(a.sourceFrame);i.projection.transform&&this.transformAABB(cl.copyFrom(i.projection.transform).invert(),d),c?(n.sourceFrame.fit(d),(n.sourceFrame.width<=0||n.sourceFrame.height<=0)&&(n.sourceFrame.width=0,n.sourceFrame.height=0)):n.sourceFrame.intersects(d)||(n.sourceFrame.width=0,n.sourceFrame.height=0),this.roundFrame(n.sourceFrame,a.current?a.current.resolution:i.resolution,a.sourceFrame,a.destinationFrame,i.projection.transform),n.renderTexture=this.getOptimalFilterTexture(n.sourceFrame.width,n.sourceFrame.height,o,h),n.filters=e,n.destinationFrame.width=n.renderTexture.width,n.destinationFrame.height=n.renderTexture.height;const f=this.tempRect;f.x=0,f.y=0,f.width=n.sourceFrame.width,f.height=n.sourceFrame.height,n.renderTexture.filterFrame=n.sourceFrame,n.bindingSourceFrame.copyFrom(a.sourceFrame),n.bindingDestinationFrame.copyFrom(a.destinationFrame),n.transform=i.projection.transform,i.projection.transform=null,a.bind(n.renderTexture,n.sourceFrame,f),i.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),i=e.filters;this.activeState=e;const r=this.globalUniforms.uniforms;r.outputFrame=e.sourceFrame,r.resolution=e.resolution;const n=r.inputSize,a=r.inputPixel,o=r.inputClamp;if(n[0]=e.destinationFrame.width,n[1]=e.destinationFrame.height,n[2]=1/n[0],n[3]=1/n[1],a[0]=Math.round(n[0]*e.resolution),a[1]=Math.round(n[1]*e.resolution),a[2]=1/a[0],a[3]=1/a[1],o[0]=.5*a[2],o[1]=.5*a[3],o[2]=e.sourceFrame.width*n[2]-.5*a[2],o[3]=e.sourceFrame.height*n[3]-.5*a[3],e.legacy){const l=r.filterArea;l[0]=e.destinationFrame.width,l[1]=e.destinationFrame.height,l[2]=e.sourceFrame.x,l[3]=e.sourceFrame.y,r.filterClamp=r.inputClamp}this.globalUniforms.update();const h=t[t.length-1];if(this.renderer.framebuffer.blit(),i.length===1)i[0].apply(this,e.renderTexture,h.renderTexture,zs.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let l=e.renderTexture,c=this.getOptimalFilterTexture(l.width,l.height,e.resolution);c.filterFrame=l.filterFrame;let u=0;for(u=0;u<i.length-1;++u){u===1&&e.multisample>1&&(c=this.getOptimalFilterTexture(l.width,l.height,e.resolution),c.filterFrame=l.filterFrame),i[u].apply(this,l,c,zs.CLEAR,e);const d=l;l=c,c=d}i[u].apply(this,l,h.renderTexture,zs.BLEND,e),u>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(l),this.returnFilterTexture(c)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=zs.CLEAR){const{renderTexture:i,state:r}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t!=null&&t.filterFrame){const a=this.tempRect;a.x=0,a.y=0,a.width=t.filterFrame.width,a.height=t.filterFrame.height,i.bind(t,t.filterFrame,a)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?i.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const n=r.stateId&1||this.forceClear;(e===zs.CLEAR||e===zs.BLIT&&n)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,i,r){const n=this.renderer;n.state.set(t.state),this.bindAndClear(i,r),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,n.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),n.geometry.bind(this.quadUv),n.geometry.draw(_o.TRIANGLES)):(n.geometry.bind(this.quad),n.geometry.draw(_o.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:i,destinationFrame:r}=this.activeState,{orig:n}=e._texture,a=t.set(r.width,0,0,r.height,i.x,i.y),o=e.worldTransform.copyTo(fe.TEMP_MATRIX);return o.invert(),a.prepend(o),a.scale(1/n.width,1/n.height),a.translate(e.anchor.x,e.anchor.y),a}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,i=1,r=qt.NONE){return this.texturePool.getOptimalTexture(t,e,i,r)}getFilterTexture(t,e,i){if(typeof t=="number"){const n=t;t=e,e=n}t=t||this.activeState.renderTexture;const r=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,i||qt.NONE);return r.filterFrame=t.filterFrame,r}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const i=Oa[0],r=Oa[1],n=Oa[2],a=Oa[3];i.set(e.left,e.top),r.set(e.left,e.bottom),n.set(e.right,e.top),a.set(e.right,e.bottom),t.apply(i,i),t.apply(r,r),t.apply(n,n),t.apply(a,a);const o=Math.min(i.x,r.x,n.x,a.x),h=Math.min(i.y,r.y,n.y,a.y),l=Math.max(i.x,r.x,n.x,a.x),c=Math.max(i.y,r.y,n.y,a.y);e.x=o,e.y=h,e.width=l-o,e.height=c-h}roundFrame(t,e,i,r,n){if(!(t.width<=0||t.height<=0||i.width<=0||i.height<=0)){if(n){const{a,b:o,c:h,d:l}=n;if((Math.abs(o)>1e-4||Math.abs(h)>1e-4)&&(Math.abs(a)>1e-4||Math.abs(l)>1e-4))return}n=n?cl.copyFrom(n):cl.identity(),n.translate(-i.x,-i.y).scale(r.width/i.width,r.height/i.height).translate(r.x,r.y),this.transformAABB(n,t),t.ceil(e),this.transformAABB(n.invert(),t)}}}Rb.extension={type:Q.RendererSystem,name:"filter"};rt.add(Rb);class EM{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=qt.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const PM=new Jt;class Bb{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new pc(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Jt,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let e=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;ot.PREFER_ENV===hr.WEBGL_LEGACY&&(e=null,i=null),e?t.drawBuffers=r=>e.drawBuffersWEBGL(r):(this.hasMRT=!1,t.drawBuffers=()=>{}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,i=0){const{gl:r}=this;if(t){const n=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,r.bindFramebuffer(r.FRAMEBUFFER,n.framebuffer)),n.mipLevel!==i&&(t.dirtyId++,t.dirtyFormat++,n.mipLevel=i),n.dirtyId!==t.dirtyId&&(n.dirtyId=t.dirtyId,n.dirtyFormat!==t.dirtyFormat?(n.dirtyFormat=t.dirtyFormat,n.dirtySize=t.dirtySize,this.updateFramebuffer(t,i)):n.dirtySize!==t.dirtySize&&(n.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let a=0;a<t.colorTextures.length;a++){const o=t.colorTextures[a];this.renderer.texture.unbind(o.parentTextureArray||o)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const a=e.width>>i,o=e.height>>i,h=a/e.width;this.setViewport(e.x*h,e.y*h,a,o)}else{const a=t.width>>i,o=t.height>>i;this.setViewport(0,0,a,o)}}else this.current&&(this.current=null,r.bindFramebuffer(r.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,i,r){const n=this.viewport;t=Math.round(t),e=Math.round(e),i=Math.round(i),r=Math.round(r),(n.width!==i||n.height!==r||n.x!==t||n.y!==e)&&(n.x=t,n.y=e,n.width=i,n.height=r,this.gl.viewport(t,e,i,r))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,i,r,n=ac.COLOR|ac.DEPTH){const{gl:a}=this;a.clearColor(t,e,i,r),a.clear(n)}initFramebuffer(t){const{gl:e}=this,i=new EM(e.createFramebuffer());return i.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(t),t.disposeRunner.add(this),i}resizeFramebuffer(t){const{gl:e}=this,i=t.glFramebuffers[this.CONTEXT_UID];i.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,i.stencil),i.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,e.DEPTH24_STENCIL8,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));const r=t.colorTextures;let n=r.length;e.drawBuffers||(n=Math.min(n,1));for(let a=0;a<n;a++){const o=r[a],h=o.parentTextureArray||o;this.renderer.texture.bind(h,0),a===0&&i.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,i.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,h._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:i}=this,r=t.glFramebuffers[this.CONTEXT_UID],n=t.colorTextures;let a=n.length;i.drawBuffers||(a=Math.min(a,1)),r.multisample>1&&this.canMultisampleFramebuffer(t)?r.msaaBuffer=r.msaaBuffer||i.createRenderbuffer():r.msaaBuffer&&(i.deleteRenderbuffer(r.msaaBuffer),r.msaaBuffer=null,r.blitFramebuffer&&(r.blitFramebuffer.dispose(),r.blitFramebuffer=null));const o=[];for(let h=0;h<a;h++){const l=n[h],c=l.parentTextureArray||l;this.renderer.texture.bind(c,0),h===0&&r.msaaBuffer?(i.bindRenderbuffer(i.RENDERBUFFER,r.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,r.multisample,c._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,r.msaaBuffer)):(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+h,l.target,c._glTextures[this.CONTEXT_UID].texture,e),o.push(i.COLOR_ATTACHMENT0+h))}if(o.length>1&&i.drawBuffers(o),t.depthTexture&&this.writeDepthTexture){const l=t.depthTexture;this.renderer.texture.bind(l,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,l._glTextures[this.CONTEXT_UID].texture,e)}(t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)?(r.stencil=r.stencil||i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,r.stencil),r.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,r.multisample,i.DEPTH24_STENCIL8,t.width,t.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,r.stencil)):r.stencil&&(i.deleteRenderbuffer(r.stencil),r.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let i=qt.NONE;if(t<=1||e===null)return i;for(let r=0;r<e.length;r++)if(e[r]<=t){i=e[r];break}return i===1&&(i=qt.NONE),i}blit(t,e,i){const{current:r,renderer:n,gl:a,CONTEXT_UID:o}=this;if(n.context.webGLVersion!==2||!r)return;const h=r.glFramebuffers[o];if(!h)return;if(!t){if(!h.msaaBuffer)return;const c=r.colorTextures[0];if(!c)return;h.blitFramebuffer||(h.blitFramebuffer=new pc(r.width,r.height),h.blitFramebuffer.addColorTexture(0,c)),t=h.blitFramebuffer,t.colorTextures[0]!==c&&(t.colorTextures[0]=c,t.dirtyId++,t.dirtyFormat++),(t.width!==r.width||t.height!==r.height)&&(t.width=r.width,t.height=r.height,t.dirtyId++,t.dirtySize++)}e||(e=PM,e.width=r.width,e.height=r.height),i||(i=e);const l=e.width===i.width&&e.height===i.height;this.bind(t),a.bindFramebuffer(a.READ_FRAMEBUFFER,h.framebuffer),a.blitFramebuffer(e.left,e.top,e.right,e.bottom,i.left,i.top,i.right,i.bottom,a.COLOR_BUFFER_BIT,l?a.NEAREST:a.LINEAR)}disposeFramebuffer(t,e){const i=t.glFramebuffers[this.CONTEXT_UID],r=this.gl;if(!i)return;delete t.glFramebuffers[this.CONTEXT_UID];const n=this.managedFramebuffers.indexOf(t);n>=0&&this.managedFramebuffers.splice(n,1),t.disposeRunner.remove(this),e||(r.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&r.deleteRenderbuffer(i.msaaBuffer),i.stencil&&r.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&i.blitFramebuffer.dispose()}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let i=0;i<e.length;i++)this.disposeFramebuffer(e[i],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil)return;t.stencil=!0;const i=t.width,r=t.height,n=this.gl,a=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,a),e.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,e.multisample,n.DEPTH24_STENCIL8,i,r):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,i,r),e.stencil=a,n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,a)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Jt}destroy(){this.renderer=null}}Bb.extension={type:Q.RendererSystem,name:"framebuffer"};rt.add(Bb);const ul={5126:4,5123:2,5121:1};class Ib{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,e.webGLVersion!==2){let i=this.renderer.context.extensions.vertexArrayObject;ot.PREFER_ENV===hr.WEBGL_LEGACY&&(i=null),i?(t.createVertexArray=()=>i.createVertexArrayOES(),t.bindVertexArray=r=>i.bindVertexArrayOES(r),t.deleteVertexArray=r=>i.deleteVertexArrayOES(r)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(e.webGLVersion!==2){const i=t.getExtension("ANGLE_instanced_arrays");i?(t.vertexAttribDivisor=(r,n)=>i.vertexAttribDivisorANGLE(r,n),t.drawElementsInstanced=(r,n,a,o,h)=>i.drawElementsInstancedANGLE(r,n,a,o,h),t.drawArraysInstanced=(r,n,a,o)=>i.drawArraysInstancedANGLE(r,n,a,o)):this.hasInstance=!1}this.canUseUInt32ElementIndex=e.webGLVersion===2||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:i}=this;let r=t.glVertexArrayObjects[this.CONTEXT_UID],n=!1;r||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=r={},n=!0);const a=r[e.program.id]||this.initGeometryVao(t,e,n);this._activeGeometry=t,this._activeVao!==a&&(this._activeVao=a,this.hasVao?i.bindVertexArray(a):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let i=0;i<t.buffers.length;i++){const r=t.buffers[i];e.update(r)}}checkCompatibility(t,e){const i=t.attributes,r=e.attributeData;for(const n in r)if(!i[n])throw new Error(`shader and geometry incompatible, geometry missing the "${n}" attribute`)}getSignature(t,e){const i=t.attributes,r=e.attributeData,n=["g",t.id];for(const a in i)r[a]&&n.push(a,r[a].location);return n.join("-")}initGeometryVao(t,e,i=!0){const r=this.gl,n=this.CONTEXT_UID,a=this.renderer.buffer,o=e.program;o.glPrograms[n]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,o);const h=this.getSignature(t,o),l=t.glVertexArrayObjects[this.CONTEXT_UID];let c=l[h];if(c)return l[o.id]=c,c;const u=t.buffers,d=t.attributes,f={},p={};for(const m in u)f[m]=0,p[m]=0;for(const m in d)!d[m].size&&o.attributeData[m]?d[m].size=o.attributeData[m].size:d[m].size||console.warn(`PIXI Geometry attribute '${m}' size cannot be determined (likely the bound shader does not have the attribute)`),f[d[m].buffer]+=d[m].size*ul[d[m].type];for(const m in d){const g=d[m],x=g.size;g.stride===void 0&&(f[g.buffer]===x*ul[g.type]?g.stride=0:g.stride=f[g.buffer]),g.start===void 0&&(g.start=p[g.buffer],p[g.buffer]+=x*ul[g.type])}c=r.createVertexArray(),r.bindVertexArray(c);for(let m=0;m<u.length;m++){const g=u[m];a.bind(g),i&&g._glBuffers[n].refCount++}return this.activateVao(t,o),l[o.id]=c,l[h]=c,r.bindVertexArray(null),a.unbind(Li.ARRAY_BUFFER),c}disposeGeometry(t,e){var o;if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const i=t.glVertexArrayObjects[this.CONTEXT_UID],r=this.gl,n=t.buffers,a=(o=this.renderer)==null?void 0:o.buffer;if(t.disposeRunner.remove(this),!!i){if(a)for(let h=0;h<n.length;h++){const l=n[h]._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,l.refCount===0&&!e&&a.dispose(n[h],e))}if(!e){for(const h in i)if(h[0]==="g"){const l=i[h];this._activeVao===l&&this.unbind(),r.deleteVertexArray(l)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let i=0;i<e.length;i++)this.disposeGeometry(this.managedGeometries[e[i]],t)}activateVao(t,e){const i=this.gl,r=this.CONTEXT_UID,n=this.renderer.buffer,a=t.buffers,o=t.attributes;t.indexBuffer&&n.bind(t.indexBuffer);let h=null;for(const l in o){const c=o[l],u=a[c.buffer],d=u._glBuffers[r];if(e.attributeData[l]){h!==d&&(n.bind(u),h=d);const f=e.attributeData[l].location;if(i.enableVertexAttribArray(f),i.vertexAttribPointer(f,c.size,c.type||i.FLOAT,c.normalized,c.stride,c.start),c.instance)if(this.hasInstance)i.vertexAttribDivisor(f,c.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,e,i,r){const{gl:n}=this,a=this._activeGeometry;if(a.indexBuffer){const o=a.indexBuffer.data.BYTES_PER_ELEMENT,h=o===2?n.UNSIGNED_SHORT:n.UNSIGNED_INT;o===2||o===4&&this.canUseUInt32ElementIndex?a.instanced?n.drawElementsInstanced(t,e||a.indexBuffer.data.length,h,(i||0)*o,r||1):n.drawElements(t,e||a.indexBuffer.data.length,h,(i||0)*o):console.warn("unsupported index buffer type: uint32")}else a.instanced?n.drawArraysInstanced(t,i,e||a.getSize(),r||1):n.drawArrays(t,i,e||a.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}Ib.extension={type:Q.RendererSystem,name:"geometry"};rt.add(Ib);const Lf=new fe;class MM{constructor(t,e){this._texture=t,this.mapCoord=new fe,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){e===void 0&&(e=t);const i=this.mapCoord;for(let r=0;r<t.length;r+=2){const n=t[r],a=t[r+1];e[r]=n*i.a+a*i.c+i.tx,e[r+1]=n*i.b+a*i.d+i.ty}return e}update(t){const e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const i=e._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);const r=e.orig,n=e.trim;n&&(Lf.set(r.width/n.width,0,0,r.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(Lf));const a=e.baseTexture,o=this.uClampFrame,h=this.clampMargin/a.resolution,l=this.clampOffset;return o[0]=(e._frame.x+h+l)/a.width,o[1]=(e._frame.y+h+l)/a.height,o[2]=(e._frame.x+e._frame.width-h+l)/a.width,o[3]=(e._frame.y+e._frame.height-h+l)/a.height,this.uClampOffset[0]=l/a.realWidth,this.uClampOffset[1]=l/a.realHeight,this.isSimple=e._frame.width===a.width&&e._frame.height===a.height&&e.rotate===0,!0}}var kM=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,RM=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class BM extends xs{constructor(t,e,i){let r=null;typeof t!="string"&&e===void 0&&i===void 0&&(r=t,t=void 0,e=void 0,i=void 0),super(t||RM,e||kM,i),this.maskSprite=r,this.maskMatrix=new fe}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,i,r){const n=this._maskSprite,a=n._texture;a.valid&&(a.uvMatrix||(a.uvMatrix=new MM(a,0)),a.uvMatrix.update(),this.uniforms.npmAlpha=a.baseTexture.alphaMode?0:1,this.uniforms.mask=a,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,n).prepend(a.uvMatrix.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=a.uvMatrix.uClampFrame,t.applyFilter(this,e,i,r))}}class IM{constructor(t=null){this.type=ae.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=xs.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=ae.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class Fb{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let i=e;if(!i.isMaskData){const n=this.maskDataPool.pop()||new IM;n.pooled=!0,n.maskObject=e,i=n}const r=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(i.copyCountersOrReset(r),i._colorMask=r?r._colorMask:15,i.autoDetect&&this.detect(i),i._target=t,i.type!==ae.SPRITE&&this.maskStack.push(i),i.enabled)switch(i.type){case ae.SCISSOR:this.renderer.scissor.push(i);break;case ae.STENCIL:this.renderer.stencil.push(i);break;case ae.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i);break;case ae.COLOR:this.pushColorMask(i);break}i.type===ae.SPRITE&&this.maskStack.push(i)}pop(t){const e=this.maskStack.pop();if(!(!e||e._target!==t)){if(e.enabled)switch(e.type){case ae.SCISSOR:this.renderer.scissor.pop(e);break;case ae.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case ae.SPRITE:this.popSpriteMask(e);break;case ae.COLOR:this.popColorMask(e);break}if(e.reset(),e.pooled&&this.maskDataPool.push(e),this.maskStack.length!==0){const i=this.maskStack[this.maskStack.length-1];i.type===ae.SPRITE&&i._filters&&(i._filters[0].maskSprite=i.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=ae.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=ae.SCISSOR:t.type=ae.STENCIL:t.type=ae.COLOR}pushSpriteMask(t){const{maskObject:e}=t,i=t._target;let r=t._filters;r||(r=this.alphaMaskPool[this.alphaMaskIndex],r||(r=this.alphaMaskPool[this.alphaMaskIndex]=[new BM]));const n=this.renderer,a=n.renderTexture;let o,h;if(a.current){const c=a.current;o=t.resolution||c.resolution,h=t.multisample??c.multisample}else o=t.resolution||n.resolution,h=t.multisample??n.multisample;r[0].resolution=o,r[0].multisample=h,r[0].maskSprite=e;const l=i.filterArea;i.filterArea=e.getBounds(!0),n.filter.push(i,r),i.filterArea=l,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,i=t._colorMask=e&t.colorMask;i!==e&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}popColorMask(t){const e=t._colorMask,i=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;i!==e&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}destroy(){this.renderer=null}}Fb.extension={type:Q.RendererSystem,name:"mask"};rt.add(Fb);class Ub{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,i=this.getStackLength();this.maskStack=t;const r=this.getStackLength();r!==i&&(r===0?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const Of=new fe,Nf=[],ja=class extends Ub{constructor(s){super(s),this.glConst=ot.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const s=this.maskStack[this.maskStack.length-1];return s?s._scissorCounter:0}calcScissorRect(s){if(s._scissorRectLocal)return;const t=s._scissorRect,{maskObject:e}=s,{renderer:i}=this,r=i.renderTexture,n=e.getBounds(!0,Nf.pop()??new Jt);this.roundFrameToPixels(n,r.current?r.current.resolution:i.resolution,r.sourceFrame,r.destinationFrame,i.projection.transform),t&&n.fit(t),s._scissorRectLocal=n}static isMatrixRotated(s){if(!s)return!1;const{a:t,b:e,c:i,d:r}=s;return(Math.abs(e)>1e-4||Math.abs(i)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(r)>1e-4)}testScissor(s){const{maskObject:t}=s;if(!t.isFastRect||!t.isFastRect()||ja.isMatrixRotated(t.worldTransform)||ja.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(s);const e=s._scissorRectLocal;return e.width>0&&e.height>0}roundFrameToPixels(s,t,e,i,r){ja.isMatrixRotated(r)||(r=r?Of.copyFrom(r):Of.identity(),r.translate(-e.x,-e.y).scale(i.width/e.width,i.height/e.height).translate(i.x,i.y),this.renderer.filter.transformAABB(r,s),s.fit(i),s.x=Math.round(s.x*t),s.y=Math.round(s.y*t),s.width=Math.round(s.width*t),s.height=Math.round(s.height*t))}push(s){s._scissorRectLocal||this.calcScissorRect(s);const{gl:t}=this.renderer;s._scissorRect||t.enable(t.SCISSOR_TEST),s._scissorCounter++,s._scissorRect=s._scissorRectLocal,this._useCurrent()}pop(s){const{gl:t}=this.renderer;s&&Nf.push(s._scissorRectLocal),this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)}_useCurrent(){const s=this.maskStack[this.maskStack.length-1]._scissorRect;let t;this.renderer.renderTexture.current?t=s.y:t=this.renderer.height-s.height-s.y,this.renderer.gl.scissor(s.x,t,s.width,s.height)}};let Lb=ja;Lb.extension={type:Q.RendererSystem,name:"scissor"};rt.add(Lb);class Ob extends Ub{constructor(t){super(t),this.glConst=ot.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:i}=this.renderer,r=t._stencilCounter;r===0&&(this.renderer.framebuffer.forceStencil(),i.clearStencil(0),i.clear(i.STENCIL_BUFFER_BIT),i.enable(i.STENCIL_TEST)),t._stencilCounter++;const n=t._colorMask;n!==0&&(t._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilFunc(i.EQUAL,r,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,n!==0&&(t._colorMask=n,i.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}pop(t){const e=this.renderer.gl;if(this.getStackLength()===0)e.disable(e.STENCIL_TEST);else{const i=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,r=i?i._colorMask:15;r!==0&&(i._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,r!==0&&(i._colorMask=r,e.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}Ob.extension={type:Q.RendererSystem,name:"stencil"};rt.add(Ob);class Nb{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return Et("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract}},prepare:{enumerable:!1,get(){return Et("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare}},interaction:{enumerable:!1,get(){return Et("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events}}})}init(t){for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}Nb.extension={type:[Q.RendererSystem,Q.CanvasRendererSystem],name:"_plugin"};rt.add(Nb);class Db{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new fe,this.transform=null}update(t,e,i,r){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,r),this.transform&&this.projectionMatrix.append(this.transform);const n=this.renderer;n.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,n.globalUniforms.update(),n.shader.shader&&n.shader.syncUniformGroup(n.shader.shader.uniforms.globals)}calculateProjection(t,e,i,r){const n=this.projectionMatrix,a=r?-1:1;n.identity(),n.a=1/e.width*2,n.d=a*(1/e.height*2),n.tx=-1-e.x*n.a,n.ty=-a-e.y*n.d}setTransform(t){}destroy(){this.renderer=null}}Db.extension={type:Q.RendererSystem,name:"projection"};rt.add(Db);const FM=new yb;class Gb{constructor(t){this.renderer=t,this._tempMatrix=new fe}generateTexture(t,e){const{region:i,...r}=e||{},n=i||t.getLocalBounds(null,!0);n.width===0&&(n.width=1),n.height===0&&(n.height=1);const a=Yo.create({width:n.width,height:n.height,...r});this._tempMatrix.tx=-n.x,this._tempMatrix.ty=-n.y;const o=t.transform;return t.transform=FM,this.renderer.render(t,{renderTexture:a,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=o,a}destroy(){}}Gb.extension={type:[Q.RendererSystem,Q.CanvasRendererSystem],name:"textureGenerator"};rt.add(Gb);const Us=new Jt,yn=new Jt;class Vb{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Jt,this.destinationFrame=new Jt,this.viewportFrame=new Jt}bind(t=null,e,i){const r=this.renderer;this.current=t;let n,a,o;t?(n=t.baseTexture,o=n.resolution,e||(Us.width=t.frame.width,Us.height=t.frame.height,e=Us),i||(yn.x=t.frame.x,yn.y=t.frame.y,yn.width=e.width,yn.height=e.height,i=yn),a=n.framebuffer):(o=r.resolution,e||(Us.width=r._view.screen.width,Us.height=r._view.screen.height,e=Us),i||(i=Us,i.width=e.width,i.height=e.height));const h=this.viewportFrame;h.x=i.x*o,h.y=i.y*o,h.width=i.width*o,h.height=i.height*o,t||(h.y=r.view.height-(h.y+h.height)),h.ceil(),this.renderer.framebuffer.bind(a,h),this.renderer.projection.update(i,e,o,!a),t?this.renderer.mask.setMaskStack(n.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(i)}clear(t,e){this.current?t=t||this.current.baseTexture.clearColor:t=t||this.renderer.background.colorRgba;const i=this.destinationFrame,r=this.current?this.current.baseTexture:this.renderer._view.screen,n=i.width!==r.width||i.height!==r.height;if(n){let{x:a,y:o,width:h,height:l}=this.viewportFrame;a=Math.round(a),o=Math.round(o),h=Math.round(h),l=Math.round(l),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(a,o,h,l)}this.renderer.framebuffer.clear(t[0],t[1],t[2],t[3],e),n&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}Vb.extension={type:Q.RendererSystem,name:"renderTexture"};rt.add(Vb);class UM{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function LM(s,t){const e={},i=t.getProgramParameter(s,t.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const n=t.getActiveAttrib(s,r);if(n.name.startsWith("gl_"))continue;const a=wb(t,n.type),o={type:a,name:n.name,size:_b(a),location:t.getAttribLocation(s,n.name)};e[n.name]=o}return e}function OM(s,t){const e={},i=t.getProgramParameter(s,t.ACTIVE_UNIFORMS);for(let r=0;r<i;r++){const n=t.getActiveUniform(s,r),a=n.name.replace(/\[.*?\]$/,""),o=!!n.name.match(/\[.*?\]$/),h=wb(t,n.type);e[a]={name:a,index:r,type:h,size:n.size,isArray:o,value:xb(h,n.size)}}return e}function NM(s,t){var h;const e=kf(s,s.VERTEX_SHADER,t.vertexSrc),i=kf(s,s.FRAGMENT_SHADER,t.fragmentSrc),r=s.createProgram();s.attachShader(r,e),s.attachShader(r,i);const n=(h=t.extra)==null?void 0:h.transformFeedbackVaryings;if(n&&(typeof s.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):s.transformFeedbackVaryings(r,n.names,n.bufferMode==="separate"?s.SEPARATE_ATTRIBS:s.INTERLEAVED_ATTRIBS)),s.linkProgram(r),s.getProgramParameter(r,s.LINK_STATUS)||cM(s,r,e,i),t.attributeData=LM(r,s),t.uniformData=OM(r,s),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const l=Object.keys(t.attributeData);l.sort((c,u)=>c>u?1:-1);for(let c=0;c<l.length;c++)t.attributeData[l[c]].location=c,s.bindAttribLocation(r,c,l[c]);s.linkProgram(r)}s.deleteShader(e),s.deleteShader(i);const a={};for(const l in t.uniformData){const c=t.uniformData[l];a[l]={location:s.getUniformLocation(r,l),value:xb(c.type,c.size)}}return new UM(r,a)}function DM(s,t,e,i,r){e.buffer.update(r)}const GM={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},zb={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function VM(s){const t=s.map(n=>({data:n,offset:0,dataLen:0,dirty:0}));let e=0,i=0,r=0;for(let n=0;n<t.length;n++){const a=t[n];if(e=zb[a.data.type],a.data.size>1&&(e=Math.max(e,16)*a.data.size),a.dataLen=e,i%e!==0&&i<16){const o=i%e%16;i+=o,r+=o}i+e>16?(r=Math.ceil(r/16)*16,a.offset=r,r+=e,i=e):(a.offset=r,i+=e,r+=e)}return r=Math.ceil(r/16)*16,{uboElements:t,size:r}}function zM(s,t){const e=[];for(const i in s)t[i]&&e.push(t[i]);return e.sort((i,r)=>i.index-r.index),e}function HM(s,t){if(!s.autoManage)return{size:0,syncFunc:DM};const e=zM(s.uniforms,t),{uboElements:i,size:r}=VM(e),n=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let a=0;a<i.length;a++){const o=i[a],h=s.uniforms[o.data.name],l=o.data.name;let c=!1;for(let u=0;u<Xr.length;u++){const d=Xr[u];if(d.codeUbo&&d.test(o.data,h)){n.push(`offset = ${o.offset/4};`,Xr[u].codeUbo(o.data.name,h)),c=!0;break}}if(!c)if(o.data.size>1){const u=_b(o.data.type),d=Math.max(zb[o.data.type]/16,1),f=u/d,p=(4-f%4)%4;n.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${o.offset/4};

                t = 0;

                for(var i=0; i < ${o.data.size*d}; i++)
                {
                    for(var j = 0; j < ${f}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${p};
                }

                `)}else{const u=GM[o.data.type];n.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${o.offset/4};
                ${u};
                `)}}return n.push(`
       renderer.buffer.update(buffer);
    `),{size:r,syncFunc:new Function("ud","uv","renderer","syncData","buffer",n.join(`
`))}}let XM=0;const Na={textureCount:0,uboCount:0};class Hb{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=XM++}systemCheck(){if(!dM())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const i=t.program,r=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==i&&(this.program=i,this.gl.useProgram(r.program)),e||(Na.textureCount=0,Na.uboCount=0,this.syncUniformGroup(t.uniformGroup,Na)),r}setUniforms(t){const e=this.shader.program,i=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(i.uniformData,t,this.renderer)}syncUniformGroup(t,e){const i=this.getGlProgram();(!t.static||t.dirtyId!==i.uniformDirtyGroups[t.id])&&(i.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,i,e))}syncUniforms(t,e,i){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,i)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=oM(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const i=this.getGlProgram();if(!t.static||t.dirtyId!==0||!i.uniformGroups[t.id]){t.dirtyId=0;const r=i.uniformGroups[t.id]||this.createSyncBufferGroup(t,i,e);t.buffer.update(),r(i.uniformData,t.uniforms,this.renderer,Na,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,i.uniformBufferBindings[e])}createSyncBufferGroup(t,e,i){const{gl:r}=this.renderer;this.renderer.buffer.bind(t.buffer);const n=this.gl.getUniformBlockIndex(e.program,i);e.uniformBufferBindings[i]=this.shader.uniformBindCount,r.uniformBlockBinding(e.program,n,this.shader.uniformBindCount),this.shader.uniformBindCount++;const a=this.getSignature(t,this.shader.program.uniformData,"ubo");let o=this._uboCache[a];if(o||(o=this._uboCache[a]=HM(t,this.shader.program.uniformData)),t.autoManage){const h=new Float32Array(o.size/4);t.buffer.update(h)}return e.uniformGroups[t.id]=o.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,i){const r=t.uniforms,n=[`${i}-`];for(const a in r)n.push(a),e[a]&&n.push(e[a].type);return n.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,i=t.program,r=NM(e,i);return i.glPrograms[this.renderer.CONTEXT_UID]=r,r}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}Hb.extension={type:Q.RendererSystem,name:"shader"};rt.add(Hb);class Xb{constructor(t){this.renderer=t}run(t){const e=this.renderer;e.emitWithCustomOptions(e.runners.init,t),t.hello&&console.log(`PixiJS 7.1.1 - ${e.rendererLogId} - https://pixijs.com`),e.resize(this.renderer.screen.width,this.renderer.screen.height)}destroy(){}}Xb.extension={type:[Q.RendererSystem,Q.CanvasRendererSystem],name:"startup"};rt.add(Xb);function $M(s,t=[]){return t[st.NORMAL]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[st.ADD]=[s.ONE,s.ONE],t[st.MULTIPLY]=[s.DST_COLOR,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA],t[st.SCREEN]=[s.ONE,s.ONE_MINUS_SRC_COLOR,s.ONE,s.ONE_MINUS_SRC_ALPHA],t[st.OVERLAY]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[st.DARKEN]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[st.LIGHTEN]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[st.COLOR_DODGE]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[st.COLOR_BURN]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[st.HARD_LIGHT]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[st.SOFT_LIGHT]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[st.DIFFERENCE]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[st.EXCLUSION]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[st.HUE]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[st.SATURATION]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[st.COLOR]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[st.LUMINOSITY]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[st.NONE]=[0,0],t[st.NORMAL_NPM]=[s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA],t[st.ADD_NPM]=[s.SRC_ALPHA,s.ONE,s.ONE,s.ONE],t[st.SCREEN_NPM]=[s.SRC_ALPHA,s.ONE_MINUS_SRC_COLOR,s.ONE,s.ONE_MINUS_SRC_ALPHA],t[st.SRC_IN]=[s.DST_ALPHA,s.ZERO],t[st.SRC_OUT]=[s.ONE_MINUS_DST_ALPHA,s.ZERO],t[st.SRC_ATOP]=[s.DST_ALPHA,s.ONE_MINUS_SRC_ALPHA],t[st.DST_OVER]=[s.ONE_MINUS_DST_ALPHA,s.ONE],t[st.DST_IN]=[s.ZERO,s.SRC_ALPHA],t[st.DST_OUT]=[s.ZERO,s.ONE_MINUS_SRC_ALPHA],t[st.DST_ATOP]=[s.ONE_MINUS_DST_ALPHA,s.SRC_ALPHA],t[st.XOR]=[s.ONE_MINUS_DST_ALPHA,s.ONE_MINUS_SRC_ALPHA],t[st.SUBTRACT]=[s.ONE,s.ONE,s.ONE,s.ONE,s.FUNC_REVERSE_SUBTRACT,s.FUNC_ADD],t}const WM=0,YM=1,jM=2,qM=3,KM=4,ZM=5,mc=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=st.NONE,this._blendEq=!1,this.map=[],this.map[WM]=this.setBlend,this.map[YM]=this.setOffset,this.map[jM]=this.setCullFace,this.map[qM]=this.setDepthTest,this.map[KM]=this.setFrontFace,this.map[ZM]=this.setDepthMask,this.checks=[],this.defaultState=new ca,this.defaultState.blend=!0}contextChange(s){this.gl=s,this.blendModes=$M(s),this.set(this.defaultState),this.reset()}set(s){if(s=s||this.defaultState,this.stateId!==s.data){let t=this.stateId^s.data,e=0;for(;t;)t&1&&this.map[e].call(this,!!(s.data&1<<e)),t=t>>1,e++;this.stateId=s.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,s)}forceState(s){s=s||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(s.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,s);this.stateId=s.data}setBlend(s){this.updateCheck(mc.checkBlendMode,s),this.gl[s?"enable":"disable"](this.gl.BLEND)}setOffset(s){this.updateCheck(mc.checkPolygonOffset,s),this.gl[s?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(s){this.gl[s?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(s){this.gl.depthMask(s)}setCullFace(s){this.gl[s?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(s){this.gl.frontFace(this.gl[s?"CW":"CCW"])}setBlendMode(s){if(s===this.blendMode)return;this.blendMode=s;const t=this.blendModes[s],e=this.gl;t.length===2?e.blendFunc(t[0],t[1]):e.blendFuncSeparate(t[0],t[1],t[2],t[3]),t.length===6?(this._blendEq=!0,e.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD))}setPolygonOffset(s,t){this.gl.polygonOffset(s,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(s,t){const e=this.checks.indexOf(s);t&&e===-1?this.checks.push(s):!t&&e!==-1&&this.checks.splice(e,1)}static checkBlendMode(s,t){s.setBlendMode(t.blendMode)}static checkPolygonOffset(s,t){s.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}};let $b=mc;$b.extension={type:Q.RendererSystem,name:"state"};rt.add($b);class JM extends Rt{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter(r=>t.systems[r]),i=[...e,...Object.keys(t.systems).filter(r=>!e.includes(r))];for(const r of i)this.addSystem(t.systems[r],r)}addRunners(...t){t.forEach(e=>{this.runners[e]=new xi(e)})}addSystem(t,e){const i=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=i,this._systemsHash[e]=i;for(const r in this.runners)this.runners[r].add(i);return this}emitWithCustomOptions(t,e){const i=Object.keys(this._systemsHash);t.items.forEach(r=>{const n=i.find(a=>this._systemsHash[a]===r);r[t.name](e[n])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}}const qa=class{constructor(s){this.renderer=s,this.count=0,this.checkCount=0,this.maxIdle=qa.defaultMaxIdle,this.checkCountMax=qa.defaultCheckCountMax,this.mode=qa.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==bu.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const s=this.renderer.texture,t=s.managedTextures;let e=!1;for(let i=0;i<t.length;i++){const r=t[i];!r.framebuffer&&this.count-r.touched>this.maxIdle&&(s.destroyTexture(r,!0),t[i]=null,e=!0)}if(e){let i=0;for(let r=0;r<t.length;r++)t[r]!==null&&(t[i++]=t[r]);t.length=i}}unload(s){const t=this.renderer.texture,e=s._texture;e&&!e.framebuffer&&t.destroyTexture(e);for(let i=s.children.length-1;i>=0;i--)this.unload(s.children[i])}destroy(){this.renderer=null}};let di=qa;di.defaultMode=bu.AUTO;di.defaultMaxIdle=60*60;di.defaultCheckCountMax=60*10;di.extension={type:Q.RendererSystem,name:"textureGC"};rt.add(di);class dl{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=xt.UNSIGNED_BYTE,this.internalFormat=q.RGBA,this.samplerType=0}}function QM(s){let t;return"WebGL2RenderingContext"in globalThis&&s instanceof globalThis.WebGL2RenderingContext?t={[xt.UNSIGNED_BYTE]:{[q.RGBA]:s.RGBA8,[q.RGB]:s.RGB8,[q.RG]:s.RG8,[q.RED]:s.R8,[q.RGBA_INTEGER]:s.RGBA8UI,[q.RGB_INTEGER]:s.RGB8UI,[q.RG_INTEGER]:s.RG8UI,[q.RED_INTEGER]:s.R8UI,[q.ALPHA]:s.ALPHA,[q.LUMINANCE]:s.LUMINANCE,[q.LUMINANCE_ALPHA]:s.LUMINANCE_ALPHA},[xt.BYTE]:{[q.RGBA]:s.RGBA8_SNORM,[q.RGB]:s.RGB8_SNORM,[q.RG]:s.RG8_SNORM,[q.RED]:s.R8_SNORM,[q.RGBA_INTEGER]:s.RGBA8I,[q.RGB_INTEGER]:s.RGB8I,[q.RG_INTEGER]:s.RG8I,[q.RED_INTEGER]:s.R8I},[xt.UNSIGNED_SHORT]:{[q.RGBA_INTEGER]:s.RGBA16UI,[q.RGB_INTEGER]:s.RGB16UI,[q.RG_INTEGER]:s.RG16UI,[q.RED_INTEGER]:s.R16UI,[q.DEPTH_COMPONENT]:s.DEPTH_COMPONENT16},[xt.SHORT]:{[q.RGBA_INTEGER]:s.RGBA16I,[q.RGB_INTEGER]:s.RGB16I,[q.RG_INTEGER]:s.RG16I,[q.RED_INTEGER]:s.R16I},[xt.UNSIGNED_INT]:{[q.RGBA_INTEGER]:s.RGBA32UI,[q.RGB_INTEGER]:s.RGB32UI,[q.RG_INTEGER]:s.RG32UI,[q.RED_INTEGER]:s.R32UI,[q.DEPTH_COMPONENT]:s.DEPTH_COMPONENT24},[xt.INT]:{[q.RGBA_INTEGER]:s.RGBA32I,[q.RGB_INTEGER]:s.RGB32I,[q.RG_INTEGER]:s.RG32I,[q.RED_INTEGER]:s.R32I},[xt.FLOAT]:{[q.RGBA]:s.RGBA32F,[q.RGB]:s.RGB32F,[q.RG]:s.RG32F,[q.RED]:s.R32F,[q.DEPTH_COMPONENT]:s.DEPTH_COMPONENT32F},[xt.HALF_FLOAT]:{[q.RGBA]:s.RGBA16F,[q.RGB]:s.RGB16F,[q.RG]:s.RG16F,[q.RED]:s.R16F},[xt.UNSIGNED_SHORT_5_6_5]:{[q.RGB]:s.RGB565},[xt.UNSIGNED_SHORT_4_4_4_4]:{[q.RGBA]:s.RGBA4},[xt.UNSIGNED_SHORT_5_5_5_1]:{[q.RGBA]:s.RGB5_A1},[xt.UNSIGNED_INT_2_10_10_10_REV]:{[q.RGBA]:s.RGB10_A2,[q.RGBA_INTEGER]:s.RGB10_A2UI},[xt.UNSIGNED_INT_10F_11F_11F_REV]:{[q.RGB]:s.R11F_G11F_B10F},[xt.UNSIGNED_INT_5_9_9_9_REV]:{[q.RGB]:s.RGB9_E5},[xt.UNSIGNED_INT_24_8]:{[q.DEPTH_STENCIL]:s.DEPTH24_STENCIL8},[xt.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[q.DEPTH_STENCIL]:s.DEPTH32F_STENCIL8}}:t={[xt.UNSIGNED_BYTE]:{[q.RGBA]:s.RGBA,[q.RGB]:s.RGB,[q.ALPHA]:s.ALPHA,[q.LUMINANCE]:s.LUMINANCE,[q.LUMINANCE_ALPHA]:s.LUMINANCE_ALPHA},[xt.UNSIGNED_SHORT_5_6_5]:{[q.RGB]:s.RGB},[xt.UNSIGNED_SHORT_4_4_4_4]:{[q.RGBA]:s.RGBA},[xt.UNSIGNED_SHORT_5_5_5_1]:{[q.RGBA]:s.RGBA}},t}class Wb{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new gt,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=QM(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let r=0;r<e;r++)this.boundTextures[r]=null;this.emptyTextures={};const i=new dl(t.createTexture());t.bindTexture(t.TEXTURE_2D,i.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=i,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new dl(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let r=0;r<6;r++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let r=0;r<this.boundTextures.length;r++)this.bind(null,r)}bind(t,e=0){const{gl:i}=this;if(t=t==null?void 0:t.castToBaseTexture(),t!=null&&t.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const r=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(t.target,r.texture)),r.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),this.updateTexture(t)):r.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:i}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let r=0;r<i.length;r++)i[r]===this.unknownTexture&&this.bind(null,r)}for(let r=0;r<i.length;r++)i[r]===t&&(this.currentLocation!==r&&(e.activeTexture(e.TEXTURE0+r),this.currentLocation=r),e.bindTexture(t.target,this.emptyTextures[t.target].texture),i[r]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:i,CONTEXT_UID:r}=this;if(i)for(let n=t-1;n>=0;--n){const a=e[n];a&&a._glTextures[r].samplerType!==oc.FLOAT&&this.renderer.texture.unbind(a)}}initTexture(t){const e=new dl(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){var i;e.internalFormat=((i=this.internalFormats[t.type])==null?void 0:i[t.format])??t.format,this.webGLVersion===2&&t.type===xt.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){var r;const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const i=this.renderer;if(this.initTextureType(t,e),(r=t.resource)!=null&&r.upload(i,t,e))e.samplerType!==oc.FLOAT&&(this.hasIntegerTextures=!0);else{const n=t.realWidth,a=t.realHeight,o=i.gl;(e.width!==n||e.height!==a||e.dirtyId<0)&&(e.width=n,e.height=a,o.texImage2D(t.target,0,e.internalFormat,n,a,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:i}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),i.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const r=this.managedTextures.indexOf(t);r!==-1&&GP(this.managedTextures,r,1)}}updateTextureStyle(t){var i;const e=t._glTextures[this.CONTEXT_UID];e&&((t.mipmap===rr.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?e.mipmap=!1:e.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?e.wrapMode=gu.CLAMP:e.wrapMode=t.wrapMode,(i=t.resource)!=null&&i.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const i=this.gl;if(e.mipmap&&t.mipmap!==rr.ON_MANUAL&&i.generateMipmap(t.target),i.texParameteri(t.target,i.TEXTURE_WRAP_S,e.wrapMode),i.texParameteri(t.target,i.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===Zi.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);const r=this.renderer.context.extensions.anisotropicFiltering;if(r&&t.anisotropicLevel>0&&t.scaleMode===Zi.LINEAR){const n=Math.min(t.anisotropicLevel,i.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(t.target,r.TEXTURE_MAX_ANISOTROPY_EXT,n)}}else i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===Zi.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(t.target,i.TEXTURE_MAG_FILTER,t.scaleMode===Zi.LINEAR?i.LINEAR:i.NEAREST)}destroy(){this.renderer=null}}Wb.extension={type:Q.RendererSystem,name:"texture"};rt.add(Wb);class Yb{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:i}=this,r=t._glTransformFeedbacks[i]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,r)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:i,renderer:r}=this;e&&r.shader.bind(e),i.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:i,CONTEXT_UID:r}=this,n=e.createTransformFeedback();t._glTransformFeedbacks[r]=n,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,n);for(let a=0;a<t.buffers.length;a++){const o=t.buffers[a];o&&(i.buffer.update(o),o._glBuffers[r].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,a,o._glBuffers[r].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),n}disposeTransformFeedback(t,e){const i=t._glTransformFeedbacks[this.CONTEXT_UID],r=this.gl;t.disposeRunner.remove(this);const n=this.renderer.buffer;if(n)for(let a=0;a<t.buffers.length;a++){const o=t.buffers[a];if(!o)continue;const h=o._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!e&&n.dispose(o,e))}i&&(e||r.deleteTransformFeedback(i),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}Yb.extension={type:Q.RendererSystem,name:"transformFeedback"};rt.add(Yb);class jb{constructor(t){this.renderer=t}init(t){this.screen=new Jt(0,0,t.width,t.height),this.element=t.view||ot.ADAPTER.createCanvas(),this.resolution=t.resolution||ot.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const i=this.element.width/this.resolution,r=this.element.height/this.resolution;this.screen.width=i,this.screen.height=r,this.autoDensity&&(this.element.style.width=`${i}px`,this.element.style.height=`${r}px`),this.renderer.emit("resize",i,r),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){var e;t&&((e=this.element.parentNode)==null||e.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}jb.extension={type:[Q.RendererSystem,Q.CanvasRendererSystem],name:"_view"};rt.add(jb);ot.PREFER_ENV=hr.WEBGL2;ot.STRICT_TEXTURE_CACHE=!1;Object.defineProperties(ot,{WRAP_MODE:{get(){return gt.defaultOptions.wrapMode},set(s){Et("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),gt.defaultOptions.wrapMode=s}},SCALE_MODE:{get(){return gt.defaultOptions.scaleMode},set(s){Et("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),gt.defaultOptions.scaleMode=s}},MIPMAP_TEXTURES:{get(){return gt.defaultOptions.mipmap},set(s){Et("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),gt.defaultOptions.mipmap=s}},ANISOTROPIC_LEVEL:{get(){return gt.defaultOptions.anisotropicLevel},set(s){Et("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),gt.defaultOptions.anisotropicLevel=s}},FILTER_RESOLUTION:{get(){return Et("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),xs.defaultResolution},set(s){xs.defaultResolution=s}},FILTER_MULTISAMPLE:{get(){return Et("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),xs.defaultMultisample},set(s){xs.defaultMultisample=s}},SPRITE_MAX_TEXTURES:{get(){return ui.defaultMaxTextures},set(s){Et("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),ui.defaultMaxTextures=s}},SPRITE_BATCH_SIZE:{get(){return ui.defaultBatchSize},set(s){Et("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),ui.defaultBatchSize=s}},CAN_UPLOAD_SAME_BUFFER:{get(){return ui.canUploadSameBuffer},set(s){Et("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),ui.canUploadSameBuffer=s}},GC_MODE:{get(){return di.defaultMode},set(s){Et("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),di.defaultMode=s}},GC_MAX_IDLE:{get(){return di.defaultMaxIdle},set(s){Et("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),di.defaultMaxIdle=s}},GC_MAX_CHECK_COUNT:{get(){return di.defaultCheckCountMax},set(s){Et("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),di.defaultCheckCountMax=s}},PRECISION_VERTEX:{get(){return Ji.defaultVertexPrecision},set(s){Et("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),Ji.defaultVertexPrecision=s}},PRECISION_FRAGMENT:{get(){return Ji.defaultFragmentPrecision},set(s){Et("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),Ji.defaultFragmentPrecision=s}}});var Ao=(s=>(s[s.HIGH=25]="HIGH",s[s.NORMAL=0]="NORMAL",s[s.LOW=-25]="LOW",s[s.UTILITY=-50]="UTILITY",s))(Ao||{});class fl{constructor(t,e=null,i=0,r=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=i,this.once=r}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const Ue=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new fl(null,null,1/0),this.deltaMS=1/Ue.targetFPMS,this.elapsedMS=1/Ue.targetFPMS,this._tick=s=>{this._requestId=null,this.started&&(this.update(s),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(s,t,e=Ao.NORMAL){return this._addListener(new fl(s,t,e))}addOnce(s,t,e=Ao.NORMAL){return this._addListener(new fl(s,t,e,!0))}_addListener(s){let t=this._head.next,e=this._head;if(!t)s.connect(e);else{for(;t;){if(s.priority>t.priority){s.connect(e);break}e=t,t=t.next}s.previous||s.connect(e)}return this._startIfPossible(),this}remove(s,t){let e=this._head.next;for(;e;)e.match(s,t)?e=e.destroy():e=e.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let s=0,t=this._head;for(;t=t.next;)s++;return s}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let s=this._head.next;for(;s;)s=s.destroy(!0);this._head.destroy(),this._head=null}}update(s=performance.now()){let t;if(s>this.lastTime){if(t=this.elapsedMS=s-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){const r=s-this._lastFrame|0;if(r<this._minElapsedMS)return;this._lastFrame=s-r%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*Ue.targetFPMS;const e=this._head;let i=e.next;for(;i;)i=i.emit(this.deltaTime);e.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=s}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(s){const t=Math.min(this.maxFPS,s),e=Math.min(Math.max(0,t)/1e3,Ue.targetFPMS);this._maxElapsedMS=1/e}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(s){if(s===0)this._minElapsedMS=0;else{const t=Math.max(this.minFPS,s);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!Ue._shared){const s=Ue._shared=new Ue;s.autoStart=!0,s._protected=!0}return Ue._shared}static get system(){if(!Ue._system){const s=Ue._system=new Ue;s.autoStart=!0,s._protected=!0}return Ue._system}};let me=Ue;me.targetFPMS=.06;Object.defineProperties(ot,{TARGET_FPMS:{get(){return me.targetFPMS},set(s){Et("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),me.targetFPMS=s}}});class qb{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,Ao.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?me.shared:new me,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}qb.extension=Q.Application;rt.add(qb);const t3=[];rt.handleByList(Q.Renderer,t3);class Kb{constructor(t){this.renderer=t}contextChange(t){let e;if(this.renderer.context.webGLVersion===1){const i=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,i)}else{const i=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,i)}e>=qt.HIGH?this.multisample=qt.HIGH:e>=qt.MEDIUM?this.multisample=qt.MEDIUM:e>=qt.LOW?this.multisample=qt.LOW:this.multisample=qt.NONE}destroy(){}}Kb.extension={type:Q.RendererSystem,name:"_multisample"};rt.add(Kb);class e3{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class Zb{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:i}=this,r=t._glBuffers[i]||this.createGLBuffer(t);e.bindBuffer(t.type,r.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:i,CONTEXT_UID:r}=this;if(this.boundBufferBases[e]!==t){const n=t._glBuffers[r]||this.createGLBuffer(t);this.boundBufferBases[e]=t,i.bindBufferBase(i.UNIFORM_BUFFER,e,n.buffer)}}bindBufferRange(t,e,i){const{gl:r,CONTEXT_UID:n}=this;i=i||0;const a=t._glBuffers[n]||this.createGLBuffer(t);r.bindBufferRange(r.UNIFORM_BUFFER,e||0,a.buffer,i*256,256)}update(t){const{gl:e,CONTEXT_UID:i}=this,r=t._glBuffers[i]||this.createGLBuffer(t);if(t._updateID!==r.updateID)if(r.updateID=t._updateID,e.bindBuffer(t.type,r.buffer),r.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const n=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;r.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,n)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const i=t._glBuffers[this.CONTEXT_UID],r=this.gl;t.disposeRunner.remove(this),i&&(e||r.deleteBuffer(i.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let i=0;i<e.length;i++)this.dispose(this.managedBuffers[e[i]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:i}=this;return t._glBuffers[e]=new e3(i.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}Zb.extension={type:Q.RendererSystem,name:"buffer"};rt.add(Zb);class Jb{constructor(t){this.renderer=t}render(t,e){const i=this.renderer;let r,n,a,o;if(e&&(r=e.renderTexture,n=e.clear,a=e.transform,o=e.skipUpdateTransform),this.renderingToScreen=!r,i.runners.prerender.emit(),i.emit("prerender"),i.projection.transform=a,!i.context.isLost){if(r||(this.lastObjectRendered=t),!o){const h=t.enableTempParent();t.updateTransform(),t.disableTempParent(h)}i.renderTexture.bind(r),i.batch.currentRenderer.start(),(n??i.background.clearBeforeRender)&&i.renderTexture.clear(),t.render(i),i.batch.currentRenderer.flush(),r&&(e.blit&&i.framebuffer.blit(),r.baseTexture.update()),i.runners.postrender.emit(),i.projection.transform=null,i.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}Jb.extension={type:Q.RendererSystem,name:"objectRenderer"};rt.add(Jb);const gc=class extends JM{constructor(s){super(),s=Object.assign({},ot.RENDER_OPTIONS,s),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new Oi({projectionMatrix:new fe},!0);const t={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:gc.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(t),"useContextAlpha"in s&&(Et("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),s.premultipliedAlpha=s.useContextAlpha&&s.useContextAlpha!=="notMultiplied",s.backgroundAlpha=s.useContextAlpha===!1?1:s.backgroundAlpha);const e={hello:s.hello,_plugin:gc.__plugins,background:{alpha:s.backgroundAlpha,color:s.background??s.backgroundColor,clearBeforeRender:s.clearBeforeRender},_view:{height:s.height,width:s.width,autoDensity:s.autoDensity,resolution:s.resolution,view:s.view},context:{antialias:s.antialias,context:s.context,powerPreference:s.powerPreference,premultipliedAlpha:s.premultipliedAlpha,preserveDrawingBuffer:s.preserveDrawingBuffer}};this.startup.run(e),this.options=s}static test(s){return s!=null&&s.forceCanvas?!1:WA()}render(s,t){this.objectRenderer.render(s,t)}resize(s,t){this._view.resizeView(s,t)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(s=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:s}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(s){this._view.resolution=s,this.runners.resolutionChange.emit(s)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return Et("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return Et("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return Et("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return Et("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(s){Et("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=s}get backgroundAlpha(){return Et("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.color}set backgroundAlpha(s){Et("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=s}get powerPreference(){return Et("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(s,t){return this.textureGenerator.generateTexture(s,t)}};let on=gc;on.extension={type:Q.Renderer,priority:1};on.__plugins={};on.__systems={};rt.handleByMap(Q.RendererPlugin,on.__plugins);rt.handleByMap(Q.RendererSystem,on.__systems);rt.add(on);class Qb extends Jn{constructor(t,e){const{width:i,height:r}=e||{};super(i,r),this.items=[],this.itemDirtyIds=[];for(let n=0;n<t;n++){const a=new gt;this.items.push(a),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let i=0;i<this.length;i++)t[i]&&(t[i].castToBaseTexture?this.addBaseTextureAt(t[i].castToBaseTexture(),i):t[i]instanceof Jn?this.addResourceAt(t[i],i):this.addResourceAt(pb(t[i],e),i))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const e=this.items.map(i=>i.resource).filter(i=>i).map(i=>i.load());return this._load=Promise.all(e).then(()=>{const{realWidth:i,realHeight:r}=this.items[0];return this.resize(i,r),Promise.resolve(this)}),this._load}}class i3 extends Qb{constructor(t,e){const{width:i,height:r}=e||{};let n,a;Array.isArray(t)?(n=t,a=t.length):a=t,super(a,{width:i,height:r}),n&&this.initFromArray(n,e)}addBaseTextureAt(t,e){if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=zr.TEXTURE_2D_ARRAY}upload(t,e,i){const{length:r,itemDirtyIds:n,items:a}=this,{gl:o}=t;i.dirtyId<0&&o.texImage3D(o.TEXTURE_2D_ARRAY,0,i.internalFormat,this._width,this._height,r,0,e.format,i.type,null);for(let h=0;h<r;h++){const l=a[h];n[h]<l.dirtyId&&(n[h]=l.dirtyId,l.valid&&o.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,h,l.resource.width,l.resource.height,1,e.format,i.type,l.resource.source))}return!0}}class s3 extends Cs{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return e&&t instanceof e?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const En=class extends Qb{constructor(s,t){const{width:e,height:i,autoLoad:r,linkBaseTexture:n}=t||{};if(s&&s.length!==En.SIDES)throw new Error(`Invalid length. Got ${s.length}, expected 6`);super(6,{width:e,height:i});for(let a=0;a<En.SIDES;a++)this.items[a].target=zr.TEXTURE_CUBE_MAP_POSITIVE_X+a;this.linkBaseTexture=n!==!1,s&&this.initFromArray(s,t),r!==!1&&this.load()}bind(s){super.bind(s),s.target=zr.TEXTURE_CUBE_MAP}addBaseTextureAt(s,t,e){if(e===void 0&&(e=this.linkBaseTexture),!this.items[t])throw new Error(`Index ${t} is out of bounds`);if(!this.linkBaseTexture||s.parentTextureArray||Object.keys(s._glTextures).length>0)if(s.resource)this.addResourceAt(s.resource,t);else throw new Error("CubeResource does not support copying of renderTexture.");else s.target=zr.TEXTURE_CUBE_MAP_POSITIVE_X+t,s.parentTextureArray=this.baseTexture,this.items[t]=s;return s.valid&&!this.valid&&this.resize(s.realWidth,s.realHeight),this.items[t]=s,this}upload(s,t,e){const i=this.itemDirtyIds;for(let r=0;r<En.SIDES;r++){const n=this.items[r];(i[r]<n.dirtyId||e.dirtyId<t.dirtyId)&&(n.valid&&n.resource?(n.resource.upload(s,n,e),i[r]=n.dirtyId):i[r]<-1&&(s.gl.texImage2D(n.target,0,e.internalFormat,t.realWidth,t.realHeight,0,t.format,e.type,null),i[r]=-1))}return!0}static test(s){return Array.isArray(s)&&s.length===En.SIDES}};let ty=En;ty.SIDES=6;class kr extends Cs{constructor(t,e){e=e||{};let i,r;typeof t=="string"?(i=kr.EMPTY,r=t):(i=t,r=null),super(i),this.url=r,this.crossOrigin=e.crossOrigin??!0,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,e)=>{if(this.url===null){t(this);return}try{const i=await ot.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const r=await i.blob();if(this.destroyed)return;const n=await createImageBitmap(r,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Ms.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=n,this.update(),t(this)}catch(i){if(this.destroyed)return;e(i),this.onError.emit(i)}}),this._load)}upload(t,e,i){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),super.upload(t,e,i)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){return kr._EMPTY=kr._EMPTY??ot.ADAPTER.createCanvas(0,0),kr._EMPTY}}const Ka=class extends Cs{constructor(s,t){t=t||{},super(ot.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=s,this.scale=t.scale||1,this._overrideWidth=t.width,this._overrideHeight=t.height,this._resolve=null,this._crossorigin=t.crossorigin,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(s=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),s(this)},Ka.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const s=new Image;Cs.crossOrigin(s,this.svg,this._crossorigin),s.src=this.svg,s.onerror=t=>{this._resolve&&(s.onerror=null,this.onError.emit(t))},s.onload=()=>{if(!this._resolve)return;const t=s.width,e=s.height;if(!t||!e)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let i=t*this.scale,r=e*this.scale;(this._overrideWidth||this._overrideHeight)&&(i=this._overrideWidth||this._overrideHeight/e*t,r=this._overrideHeight||this._overrideWidth/t*e),i=Math.round(i),r=Math.round(r);const n=this.source;n.width=i,n.height=r,n._pixiId=`canvas_${Zn()}`,n.getContext("2d").drawImage(s,0,0,t,e,0,0,i,r),this._resolve(),this._resolve=null}}static getSize(s){const t=Ka.SVG_SIZE.exec(s),e={};return t&&(e[t[1]]=Math.round(parseFloat(t[3])),e[t[5]]=Math.round(parseFloat(t[7]))),e}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(s,t){return t==="svg"||typeof s=="string"&&s.startsWith("data:image/svg+xml")||typeof s=="string"&&Ka.SVG_XML.test(s)}};let Qn=Ka;Qn.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m;Qn.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;const bc=class extends Cs{constructor(s,t){if(t=t||{},!(s instanceof HTMLVideoElement)){const e=document.createElement("video");e.setAttribute("preload","auto"),e.setAttribute("webkit-playsinline",""),e.setAttribute("playsinline",""),typeof s=="string"&&(s=[s]);const i=s[0].src||s[0];Cs.crossOrigin(e,i,t.crossorigin);for(let r=0;r<s.length;++r){const n=document.createElement("source");let{src:a,mime:o}=s[r];a=a||s[r];const h=a.split("?").shift().toLowerCase(),l=h.slice(h.lastIndexOf(".")+1);o=o||bc.MIME_TYPES[l]||`video/${l}`,n.src=a,n.type=o,e.appendChild(n)}s=e}super(s),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),t.autoLoad!==!1&&this.load()}update(s=0){if(!this.destroyed){const t=me.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}load(){if(this._load)return this._load;const s=this.source;return(s.readyState===s.HAVE_ENOUGH_DATA||s.readyState===s.HAVE_FUTURE_DATA)&&s.width&&s.height&&(s.complete=!0),s.addEventListener("play",this._onPlayStart.bind(this)),s.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(s.addEventListener("canplay",this._onCanPlay),s.addEventListener("canplaythrough",this._onCanPlay),s.addEventListener("error",this._onError,!0)),this._load=new Promise(t=>{this.valid?t(this):(this._resolve=t,s.load())}),this._load}_onError(s){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(s)}_isSourcePlaying(){const s=this.source;return!s.paused&&!s.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(me.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(me.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){const s=this.source;s.removeEventListener("canplay",this._onCanPlay),s.removeEventListener("canplaythrough",this._onCanPlay);const t=this.valid;this.resize(s.videoWidth,s.videoHeight),!t&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&s.play()}dispose(){this._isConnectedToTicker&&(me.shared.remove(this.update,this),this._isConnectedToTicker=!1);const s=this.source;s&&(s.removeEventListener("error",this._onError,!0),s.pause(),s.src="",s.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(s){s!==this._autoUpdate&&(this._autoUpdate=s,!this._autoUpdate&&this._isConnectedToTicker?(me.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(me.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(s){s!==this._updateFPS&&(this._updateFPS=s)}static test(s,t){return globalThis.HTMLVideoElement&&s instanceof HTMLVideoElement||bc.TYPES.includes(t)}};let xu=bc;xu.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"];xu.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};dc.push(kr,Pb,s3,xu,Qn,yu,ty,i3);const Df={loader:Q.LoadParser,resolver:Q.ResolveParser,cache:Q.CacheParser,detection:Q.DetectionParser};rt.handle(Q.Asset,s=>{const t=s.ref;Object.entries(Df).filter(([e])=>!!t[e]).forEach(([e,i])=>rt.add(Object.assign(t[e],{extension:t[e].extension??i})))},s=>{const t=s.ref;Object.keys(Df).filter(e=>!!t[e]).forEach(e=>rt.remove(t[e]))});class r3{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let i=0;i<e;i++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function ey(s,t){if(Array.isArray(t)){for(const e of t)if(s.startsWith(`data:${e}`))return!0;return!1}return s.startsWith(`data:${t}`)}function iy(s,t){const e=s.split("?")[0],i=Ie.extname(e).toLowerCase();return Array.isArray(t)?t.includes(i):i===t}const es=(s,t)=>(Array.isArray(s)||(s=[s]),t?s.map(e=>typeof e=="string"?t(e):e):s);function sy(s,t,e,i,r){const n=t[e];for(let a=0;a<n.length;a++){const o=n[a];e<t.length-1?sy(s.replace(i[e],o),t,e+1,i,r):r.push(s.replace(i[e],o))}}function n3(s){const t=/\{(.*?)\}/g,e=s.match(t),i=[];if(e){const r=[];e.forEach(n=>{const a=n.substring(1,n.length-1).split(",");r.push(a)}),sy(s,r,0,e,i)}else i.push(s);return i}const Eo=s=>!Array.isArray(s);class a3{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const i=es(t);let r;for(let o=0;o<this.parsers.length;o++){const h=this.parsers[o];if(h.test(e)){r=h.getCacheableAssets(i,e);break}}r||(r={},i.forEach(o=>{r[o]=e}));const n=Object.keys(r),a={cacheKeys:n,keys:i};if(i.forEach(o=>{this._cacheMap.set(o,a)}),n.forEach(o=>{this._cache.has(o)&&this._cache.get(o)!==e&&console.warn("[Cache] already has key:",o),this._cache.set(o,r[o])}),e instanceof yt){const o=e;i.forEach(h=>{o.baseTexture!==yt.EMPTY.baseTexture&&gt.addToCache(o.baseTexture,h),yt.addToCache(o,h)})}}remove(t){if(this._cacheMap.get(t),!this._cacheMap.has(t)){console.warn(`[Assets] Asset id ${t} was not found in the Cache`);return}const e=this._cacheMap.get(t);e.cacheKeys.forEach(r=>{this._cache.delete(r)}),e.keys.forEach(r=>{this._cacheMap.delete(r)})}get parsers(){return this._parsers}}const xn=new a3;class o3{constructor(){this._parsers=[],this.promiseCache={}}reset(){this.promiseCache={}}_getLoadPromiseAndParser(t,e){const i={promise:null,parser:null};return i.promise=(async()=>{var n,a;let r=null;for(let o=0;o<this.parsers.length;o++){const h=this.parsers[o];if(h.load&&((n=h.test)!=null&&n.call(h,t,e,this))){r=await h.load(t,e,this),i.parser=h;break}}if(!i.parser)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has being added`),null;for(let o=0;o<this.parsers.length;o++){const h=this.parsers[o];h.parse&&h.parse&&await((a=h.testParse)==null?void 0:a.call(h,r,e,this))&&(r=await h.parse(r,e,this)||r,i.parser=h)}return r})(),i}async load(t,e){let i=0;const r={},n=Eo(t),a=es(t,l=>({src:l})),o=a.length,h=a.map(async l=>{const c=Ie.toAbsolute(l.src);if(!r[l.src])try{this.promiseCache[c]||(this.promiseCache[c]=this._getLoadPromiseAndParser(c,l)),r[l.src]=await this.promiseCache[c].promise,e&&e(++i/o)}catch(u){throw delete this.promiseCache[c],delete r[l.src],new Error(`[Loader.load] Failed to load ${c}.
${u}`)}});return await Promise.all(h),n?r[a[0].src]:r}async unload(t){const i=es(t,r=>({src:r})).map(async r=>{var o,h;const n=Ie.toAbsolute(r.src),a=this.promiseCache[n];if(a){const l=await a.promise;(h=(o=a.parser)==null?void 0:o.unload)==null||h.call(o,l,r,this),delete this.promiseCache[n]}});await Promise.all(i)}get parsers(){return this._parsers}}var lr=(s=>(s[s.Low=0]="Low",s[s.Normal=1]="Normal",s[s.High=2]="High",s))(lr||{});const h3={extension:{type:Q.LoadParser,priority:lr.Low},test(s){return Ie.extname(s).toLowerCase()===".json"},async load(s){return await(await ot.ADAPTER.fetch(s)).json()}};rt.add(h3);const l3={extension:{type:Q.LoadParser,priority:lr.Low},test(s){return Ie.extname(s).toLowerCase()===".txt"},async load(s){return await(await ot.ADAPTER.fetch(s)).text()}};rt.add(l3);const c3=["normal","bold","100","200","300","400","500","600","700","800","900"],u3=[".ttf",".otf",".woff",".woff2"],d3=["font/ttf","font/otf","font/woff","font/woff2"];function f3(s){const t=Ie.extname(s);return Ie.basename(s,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(n=>n.charAt(0).toUpperCase()+n.slice(1)).join(" ")}const p3={extension:{type:Q.LoadParser,priority:lr.Low},test(s){return ey(s,d3)||iy(s,u3)},async load(s,t){var i,r,n;if(!globalThis.navigator.onLine)throw new Error("[loadWebFont] Cannot load font - navigator is offline");const e=ot.ADAPTER.getFontFaceSet();if(e){const a=[],o=((i=t.data)==null?void 0:i.family)??f3(s),h=((n=(r=t.data)==null?void 0:r.weights)==null?void 0:n.filter(c=>c3.includes(c)))??["normal"],l=t.data??{};for(let c=0;c<h.length;c++){const u=h[c],d=new FontFace(o,`url(${encodeURI(s)})`,{...l,weight:u});await d.load(),e.add(d),a.push(d)}return a.length===1?a[0]:a}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(s){(Array.isArray(s)?s:[s]).forEach(t=>ot.ADAPTER.getFontFaceSet().delete(t))}};rt.add(p3);let Gf=0,pl;const m3="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",g3={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${m3}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},b3={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`};let ml;class y3{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const e=URL.createObjectURL(new Blob([g3.code],{type:"application/javascript"})),i=new Worker(e);i.addEventListener("message",r=>{i.terminate(),URL.revokeObjectURL(e),t(r.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){pl===void 0&&(pl=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<pl&&(ml||(ml=URL.createObjectURL(new Blob([b3.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(ml),t.addEventListener("message",e=>{this.complete(e.data),this.returnWorker(e.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const i=new Promise((r,n)=>{this.queue.push({id:t,arguments:e,resolve:r,reject:n})});return this.next(),i}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),i=e.id;this.resolveHash[Gf]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:Gf++,id:i})}}const Vf=new y3;function ry(s,t,e){const i=new yt(s);return i.baseTexture.on("dispose",()=>{delete t.promiseCache[e]}),i}const x3=[".jpeg",".jpg",".png",".webp",".avif"],v3=["image/jpeg","image/png","image/webp","image/avif"];async function _3(s){const t=await ot.ADAPTER.fetch(s);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${s}: ${t.status} ${t.statusText}`);const e=await t.blob();return await createImageBitmap(e)}const ta={extension:{type:Q.LoadParser,priority:lr.High},config:{preferWorkers:!0},test(s){return ey(s,v3)||iy(s,x3)},async load(s,t,e){let i=null;globalThis.createImageBitmap?this.config.preferWorkers&&await Vf.isImageBitmapSupported()?i=await Vf.loadImageBitmap(s):i=await _3(s):i=await new Promise(n=>{i=new Image,i.crossOrigin="anonymous",i.src=s,i.complete?n(i):i.onload=()=>{n(i)}});const r=new gt(i,{resolution:So(s),...t.data});return r.resource.src=s,ry(r,e,s)},unload(s){s.destroy(!0)}};rt.add(ta);const w3={extension:{type:Q.LoadParser,priority:lr.High},test(s){return Ie.extname(s).toLowerCase()===".svg"},async testParse(s){return Qn.test(s)},async parse(s,t,e){var a,o,h;const i=new Qn(s,(a=t==null?void 0:t.data)==null?void 0:a.resourceOptions),r=new gt(i,{resolution:So(s),...t==null?void 0:t.data});r.resource.src=s;const n=ry(r,e,s);return(h=(o=t==null?void 0:t.data)==null?void 0:o.resourceOptions)!=null&&h.autoLoad||await i.load(),n},async load(s,t){return(await ot.ADAPTER.fetch(s)).text()},unload:ta.unload};rt.add(w3);class T3{constructor(){this._bundleIdConnector="-",this._createBundleAssetId=(t,e)=>`${t}${this._bundleIdConnector}${e}`,this._extractAssetIdFromBundle=(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,""),this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this._preferredOrder=[],this._resolverHash={},this._assetMap={},this._rootPath=null,this._basePath=null,this._manifest=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map(i=>`${encodeURIComponent(i)}=${encodeURIComponent(e[i])}`).join("&")}}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){const i=[];Array.isArray(e)?e.forEach(r=>{if(typeof r.name=="string"){const n=this._createBundleAssetId(t,r.name);i.push(n),this.add([r.name,n],r.srcs,r.data)}else{const n=r.name.map(a=>this._createBundleAssetId(t,a));n.forEach(a=>{i.push(a)}),this.add([...r.name,...n],r.srcs)}}):Object.keys(e).forEach(r=>{i.push(this._createBundleAssetId(t,r)),this.add([r,this._createBundleAssetId(t,r)],e[r])}),this._bundles[t]=i}add(t,e,i){const r=es(t);r.forEach(a=>{this._assetMap[a]&&console.warn(`[Resolver] already has key: ${a} overwriting`)}),Array.isArray(e)||(typeof e=="string"?e=n3(e):e=[e]);const n=e.map(a=>{let o=a;if(typeof a=="string"){let h=!1;for(let l=0;l<this._parsers.length;l++){const c=this._parsers[l];if(c.test(a)){o=c.parse(a),h=!0;break}}h||(o={src:a})}return o.format||(o.format=o.src.split(".").pop()),o.alias||(o.alias=r),(this._basePath||this._rootPath)&&(o.src=Ie.toAbsolute(o.src,this._basePath,this._rootPath)),o.src=this._appendDefaultSearchParams(o.src),o.data=o.data??i,o});r.forEach(a=>{this._assetMap[a]=n})}resolveBundle(t){const e=Eo(t);t=es(t);const i={};return t.forEach(r=>{const n=this._bundles[r];if(n){const a=this.resolve(n),o={};for(const h in a){const l=a[h];o[this._extractAssetIdFromBundle(r,h)]=l}i[r]=o}}),e?i[t[0]]:i}resolveUrl(t){const e=this.resolve(t);if(typeof t!="string"){const i={};for(const r in e)i[r]=e[r].src;return i}return e.src}resolve(t){const e=Eo(t);t=es(t);const i={};return t.forEach(r=>{if(!this._resolverHash[r])if(this._assetMap[r]){let n=this._assetMap[r];const a=this._getPreferredOrder(n),o=n[0];a==null||a.priority.forEach(h=>{a.params[h].forEach(l=>{const c=n.filter(u=>u[h]?u[h]===l:!1);c.length&&(n=c)})}),this._resolverHash[r]=n[0]??o}else{let n=r;(this._basePath||this._rootPath)&&(n=Ie.toAbsolute(n,this._basePath,this._rootPath)),n=this._appendDefaultSearchParams(n),this._resolverHash[r]={src:n}}i[r]=this._resolverHash[r]}),e?i[t[0]]:i}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const i=t[0],r=this._preferredOrder.find(n=>n.params.format.includes(i.format));if(r)return r}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const e=/\?/.test(t)?"&":"?";return`${t}${e}${this._defaultSearchParams}`}}class S3{constructor(){this._detections=[],this._initialized=!1,this.resolver=new T3,this.loader=new o3,this.cache=xn,this._backgroundLoader=new r3(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){var n,a,o;if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let h=t.manifest;typeof h=="string"&&(h=await this.load(h)),this.resolver.addManifest(h)}const e=((n=t.texturePreference)==null?void 0:n.resolution)??1,i=typeof e=="number"?[e]:e;let r=[];if((a=t.texturePreference)!=null&&a.format){const h=(o=t.texturePreference)==null?void 0:o.format;r=typeof h=="string"?[h]:h;for(const l of this._detections)await l.test()||(r=await l.remove(r))}else for(const h of this._detections)await h.test()&&(r=await h.add(r));this.resolver.prefer({params:{format:r,resolution:i}})}add(t,e,i){this.resolver.add(t,e,i)}async load(t,e){this._initialized||await this.init();const i=Eo(t),r=es(t).map(o=>typeof o!="string"?(this.resolver.add(o.src,o),o.src):o),n=this.resolver.resolve(r),a=await this._mapLoadToResolve(n,e);return i?a[r[0]]:a}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let i=!1;typeof t=="string"&&(i=!0,t=[t]);const r=this.resolver.resolveBundle(t),n={},a=Object.keys(r);let o=0,h=0;const l=()=>{e==null||e(++o/h)},c=a.map(u=>{const d=r[u];return h+=Object.keys(d).length,this._mapLoadToResolve(d,l).then(f=>{n[u]=f})});return await Promise.all(c),i?n[t[0]]:n}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach(i=>{this._backgroundLoader.add(Object.values(i))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return xn.get(t);const e={};for(let i=0;i<t.length;i++)e[i]=xn.get(t[i]);return e}async _mapLoadToResolve(t,e){const i=Object.values(t),r=Object.keys(t);this._backgroundLoader.active=!1;const n=await this.loader.load(i,e);this._backgroundLoader.active=!0;const a={};return i.forEach((o,h)=>{const l=n[o.src],c=[o.src];o.alias&&c.push(...o.alias),a[r[h]]=l,xn.set(c,l)}),a}async unload(t){this._initialized||await this.init();const e=es(t).map(r=>typeof r!="string"?r.src:r),i=this.resolver.resolve(e);await this._unloadFromResolved(i)}async unloadBundle(t){this._initialized||await this.init(),t=es(t);const e=this.resolver.resolveBundle(t),i=Object.keys(e).map(r=>this._unloadFromResolved(e[r]));await Promise.all(i)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach(i=>{xn.remove(i.src)}),await this.loader.unload(e)}get detections(){return this._detections}get preferWorkers(){return ta.config.preferWorkers}set preferWorkers(t){ta.config.preferWorkers=t}}const Da=new S3;rt.handleByList(Q.LoadParser,Da.loader.parsers).handleByList(Q.ResolveParser,Da.resolver.parsers).handleByList(Q.CacheParser,Da.cache.parsers).handleByList(Q.DetectionParser,Da.detections);const C3={extension:Q.CacheParser,test:s=>Array.isArray(s)&&s.every(t=>t instanceof yt),getCacheableAssets:(s,t)=>{const e={};return s.forEach(i=>{t.forEach((r,n)=>{e[i+(n===0?"":n+1)]=r})}),e}};rt.add(C3);const A3={extension:{type:Q.DetectionParser,priority:1},test:async()=>{if(!globalThis.createImageBitmap)return!1;const s="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=",t=await ot.ADAPTER.fetch(s).then(e=>e.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async s=>[...s,"avif"],remove:async s=>s.filter(t=>t!=="avif")};rt.add(A3);const E3={extension:{type:Q.DetectionParser,priority:0},test:async()=>{if(!globalThis.createImageBitmap)return!1;const s="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",t=await ot.ADAPTER.fetch(s).then(e=>e.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async s=>[...s,"webp"],remove:async s=>s.filter(t=>t!=="webp")};rt.add(E3);const zf=["png","jpg","jpeg"],P3={extension:{type:Q.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async s=>[...s,...zf],remove:async s=>s.filter(t=>!zf.includes(t))};rt.add(P3);const M3={extension:Q.ResolveParser,test:ta.test,parse:s=>{var t;return{resolution:parseFloat(((t=ot.RETINA_PREFIX.exec(s))==null?void 0:t[1])??"1"),format:s.split(".").pop(),src:s}}};rt.add(M3);let ny;function k3(s){return ny=s,s}function ea(){return ny}let R3=0;const yc=class extends Rt{constructor(s){super(),this.id=R3++,this.init(s)}set(s,t){if(this[s]===void 0)throw new Error(`Property with name ${s} does not exist.`);switch(s){case"speed":this.speed=t;break;case"volume":this.volume=t;break;case"paused":this.paused=t;break;case"loop":this.loop=t;break;case"muted":this.muted=t;break}return this}get progress(){const{currentTime:s}=this._source;return s/this._duration}get paused(){return this._paused}set paused(s){this._paused=s,this.refreshPaused()}_onPlay(){this._playing=!0}_onPause(){this._playing=!1}init(s){this._playing=!1,this._duration=s.source.duration;const t=this._source=s.source.cloneNode(!1);t.src=s.parent.url,t.onplay=this._onPlay.bind(this),t.onpause=this._onPause.bind(this),s.context.on("refresh",this.refresh,this),s.context.on("refreshPaused",this.refreshPaused,this),this._media=s}_internalStop(){this._source&&this._playing&&(this._source.onended=null,this._source.pause())}stop(){this._internalStop(),this._source&&this.emit("stop")}get speed(){return this._speed}set speed(s){this._speed=s,this.refresh()}get volume(){return this._volume}set volume(s){this._volume=s,this.refresh()}get loop(){return this._loop}set loop(s){this._loop=s,this.refresh()}get muted(){return this._muted}set muted(s){this._muted=s,this.refresh()}get filters(){return console.warn("HTML Audio does not support filters"),null}set filters(s){console.warn("HTML Audio does not support filters")}refresh(){const s=this._media.context,t=this._media.parent;this._source.loop=this._loop||t.loop;const e=s.volume*(s.muted?0:1),i=t.volume*(t.muted?0:1),r=this._volume*(this._muted?0:1);this._source.volume=r*e*i,this._source.playbackRate=this._speed*s.speed*t.speed}refreshPaused(){const s=this._media.context,t=this._media.parent,e=this._paused||t.paused||s.paused;e!==this._pausedReal&&(this._pausedReal=e,e?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._source.currentTime,end:this._end,volume:this._volume,speed:this._speed,loop:this._loop})),this.emit("pause",e))}play(s){const{start:t,end:e,speed:i,loop:r,volume:n,muted:a}=s;e&&console.assert(e>t,"End time is before start time"),this._speed=i,this._volume=n,this._loop=!!r,this._muted=a,this.refresh(),this.loop&&e!==null&&(console.warn('Looping not support when specifying an "end" time'),this.loop=!1),this._start=t,this._end=e||this._duration,this._start=Math.max(0,this._start-yc.PADDING),this._end=Math.min(this._end+yc.PADDING,this._duration),this._source.onloadedmetadata=()=>{this._source&&(this._source.currentTime=t,this._source.onloadedmetadata=null,this.emit("progress",t,this._duration),me.shared.add(this._onUpdate,this))},this._source.onended=this._onComplete.bind(this),this._source.play(),this.emit("start")}_onUpdate(){this.emit("progress",this.progress,this._duration),this._source.currentTime>=this._end&&!this._source.loop&&this._onComplete()}_onComplete(){me.shared.remove(this._onUpdate,this),this._internalStop(),this.emit("progress",1,this._duration),this.emit("end",this)}destroy(){me.shared.remove(this._onUpdate,this),this.removeAllListeners();const s=this._source;s&&(s.onended=null,s.onplay=null,s.onpause=null,this._internalStop()),this._source=null,this._speed=1,this._volume=1,this._loop=!1,this._end=null,this._start=0,this._duration=0,this._playing=!1,this._pausedReal=!1,this._paused=!1,this._muted=!1,this._media&&(this._media.context.off("refresh",this.refresh,this),this._media.context.off("refreshPaused",this.refreshPaused,this),this._media=null)}toString(){return`[HTMLAudioInstance id=${this.id}]`}};let ay=yc;ay.PADDING=.1;class B3 extends Rt{init(t){this.parent=t,this._source=t.options.source||new Audio,t.url&&(this._source.src=t.url)}create(){return new ay(this)}get isPlayable(){return!!this._source&&this._source.readyState===4}get duration(){return this._source.duration}get context(){return this.parent.context}get filters(){return null}set filters(t){console.warn("HTML Audio does not support filters")}destroy(){this.removeAllListeners(),this.parent=null,this._source&&(this._source.src="",this._source.load(),this._source=null)}get source(){return this._source}load(t){const e=this._source,i=this.parent;if(e.readyState===4){i.isLoaded=!0;const h=i.autoPlayStart();t&&setTimeout(()=>{t(null,i,h)},0);return}if(!i.url){t(new Error("sound.url or sound.source must be set"));return}e.src=i.url;const r=()=>{o(),i.isLoaded=!0;const h=i.autoPlayStart();t&&t(null,i,h)},n=()=>{o(),t&&t(new Error("Sound loading has been aborted"))},a=()=>{o();const h=`Failed to load audio element (code: ${e.error.code})`;t?t(new Error(h)):console.error(h)},o=()=>{e.removeEventListener("canplaythrough",r),e.removeEventListener("load",r),e.removeEventListener("abort",n),e.removeEventListener("error",a)};e.addEventListener("canplaythrough",r,!1),e.addEventListener("load",r,!1),e.addEventListener("abort",n,!1),e.addEventListener("error",a,!1),e.load()}}class I3{constructor(t,e){this.parent=t,Object.assign(this,e),this.duration=this.end-this.start,console.assert(this.duration>0,"End time must be after start time")}play(t){return this.parent.play({complete:t,speed:this.speed||this.parent.speed,end:this.end,start:this.start,loop:this.loop})}destroy(){this.parent=null}}class xc{static setParamValue(t,e){if(t.setValueAtTime){const i=ea().context;t.setValueAtTime(e,i.audioContext.currentTime)}else t.value=e;return e}}let F3=0;class U3 extends Rt{constructor(t){super(),this.id=F3++,this._media=null,this._paused=!1,this._muted=!1,this._elapsed=0,this.init(t)}set(t,e){if(this[t]===void 0)throw new Error(`Property with name ${t} does not exist.`);switch(t){case"speed":this.speed=e;break;case"volume":this.volume=e;break;case"muted":this.muted=e;break;case"loop":this.loop=e;break;case"paused":this.paused=e;break}return this}stop(){this._source&&(this._internalStop(),this.emit("stop"))}get speed(){return this._speed}set speed(t){this._speed=t,this.refresh(),this._update(!0)}get volume(){return this._volume}set volume(t){this._volume=t,this.refresh()}get muted(){return this._muted}set muted(t){this._muted=t,this.refresh()}get loop(){return this._loop}set loop(t){this._loop=t,this.refresh()}get filters(){return this._filters}set filters(t){var e;this._filters&&((e=this._filters)==null||e.filter(i=>i).forEach(i=>i.disconnect()),this._filters=null,this._source.connect(this._gain)),this._filters=t!=null&&t.length?t.slice(0):null,this.refresh()}refresh(){if(!this._source)return;const t=this._media.context,e=this._media.parent;this._source.loop=this._loop||e.loop;const i=t.volume*(t.muted?0:1),r=e.volume*(e.muted?0:1),n=this._volume*(this._muted?0:1);xc.setParamValue(this._gain.gain,n*r*i),xc.setParamValue(this._source.playbackRate,this._speed*e.speed*t.speed),this.applyFilters()}applyFilters(){var t;if((t=this._filters)!=null&&t.length){this._source.disconnect();let e=this._source;this._filters.forEach(i=>{e.connect(i.destination),e=i}),e.connect(this._gain)}}refreshPaused(){const t=this._media.context,e=this._media.parent,i=this._paused||e.paused||t.paused;i!==this._pausedReal&&(this._pausedReal=i,i?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._elapsed%this._duration,end:this._end,speed:this._speed,loop:this._loop,volume:this._volume})),this.emit("pause",i))}play(t){const{start:e,end:i,speed:r,loop:n,volume:a,muted:o,filters:h}=t;i&&console.assert(i>e,"End time is before start time"),this._paused=!1;const{source:l,gain:c}=this._media.nodes.cloneBufferSource();this._source=l,this._gain=c,this._speed=r,this._volume=a,this._loop=!!n,this._muted=o,this._filters=h,this.refresh();const u=this._source.buffer.duration;this._duration=u,this._end=i,this._lastUpdate=this._now(),this._elapsed=e,this._source.onended=this._onComplete.bind(this),this._loop?(this._source.loopEnd=i,this._source.loopStart=e,this._source.start(0,e)):i?this._source.start(0,e,i-e):this._source.start(0,e),this.emit("start"),this._update(!0),this.enableTicker(!0)}enableTicker(t){me.shared.remove(this._updateListener,this),t&&me.shared.add(this._updateListener,this)}get progress(){return this._progress}get paused(){return this._paused}set paused(t){this._paused=t,this.refreshPaused()}destroy(){var t;this.removeAllListeners(),this._internalStop(),this._gain&&(this._gain.disconnect(),this._gain=null),this._media&&(this._media.context.events.off("refresh",this.refresh,this),this._media.context.events.off("refreshPaused",this.refreshPaused,this),this._media=null),(t=this._filters)==null||t.forEach(e=>e.disconnect()),this._filters=null,this._end=null,this._speed=1,this._volume=1,this._loop=!1,this._elapsed=0,this._duration=0,this._paused=!1,this._muted=!1,this._pausedReal=!1}toString(){return`[WebAudioInstance id=${this.id}]`}_now(){return this._media.context.audioContext.currentTime}_updateListener(){this._update()}_update(t=!1){if(this._source){const e=this._now(),i=e-this._lastUpdate;if(i>0||t){const r=this._source.playbackRate.value;this._elapsed+=i*r,this._lastUpdate=e;const n=this._duration;let a;if(this._source.loopStart){const o=this._source.loopEnd-this._source.loopStart;a=(this._source.loopStart+this._elapsed%o)/n}else a=this._elapsed%n/n;this._progress=a,this.emit("progress",this._progress,n)}}}init(t){this._media=t,t.context.events.on("refresh",this.refresh,this),t.context.events.on("refreshPaused",this.refreshPaused,this)}_internalStop(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.stop(0),this._source.disconnect();try{this._source.buffer=null}catch(t){console.warn("Failed to set AudioBufferSourceNode.buffer to null:",t)}this._source=null}}_onComplete(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.disconnect();try{this._source.buffer=null}catch(t){console.warn("Failed to set AudioBufferSourceNode.buffer to null:",t)}}this._source=null,this._progress=1,this.emit("progress",1,this._duration),this.emit("end",this)}}class oy{constructor(t,e){this._output=e,this._input=t}get destination(){return this._input}get filters(){return this._filters}set filters(t){if(this._filters&&(this._filters.forEach(e=>{e&&e.disconnect()}),this._filters=null,this._input.connect(this._output)),t&&t.length){this._filters=t.slice(0),this._input.disconnect();let e=null;t.forEach(i=>{e===null?this._input.connect(i.destination):e.connect(i.destination),e=i}),e.connect(this._output)}}destroy(){this.filters=null,this._input=null,this._output=null}}const hy=class extends oy{constructor(s){const t=s.audioContext,e=t.createBufferSource(),i=t.createGain(),r=t.createAnalyser();e.connect(r),r.connect(i),i.connect(s.destination),super(r,i),this.context=s,this.bufferSource=e,this.gain=i,this.analyser=r}get script(){return this._script||(this._script=this.context.audioContext.createScriptProcessor(hy.BUFFER_SIZE),this._script.connect(this.context.destination)),this._script}destroy(){super.destroy(),this.bufferSource.disconnect(),this._script&&this._script.disconnect(),this.gain.disconnect(),this.analyser.disconnect(),this.bufferSource=null,this._script=null,this.gain=null,this.analyser=null,this.context=null}cloneBufferSource(){const s=this.bufferSource,t=this.context.audioContext.createBufferSource();t.buffer=s.buffer,xc.setParamValue(t.playbackRate,s.playbackRate.value),t.loop=s.loop;const e=this.context.audioContext.createGain();return t.connect(e),e.connect(this.destination),{source:t,gain:e}}get bufferSize(){return this.script.bufferSize}};let ly=hy;ly.BUFFER_SIZE=0;class L3{init(t){this.parent=t,this._nodes=new ly(this.context),this._source=this._nodes.bufferSource,this.source=t.options.source}destroy(){this.parent=null,this._nodes.destroy(),this._nodes=null;try{this._source.buffer=null}catch(t){console.warn("Failed to set AudioBufferSourceNode.buffer to null:",t)}this._source=null,this.source=null}create(){return new U3(this)}get context(){return this.parent.context}get isPlayable(){return!!this._source&&!!this._source.buffer}get filters(){return this._nodes.filters}set filters(t){this._nodes.filters=t}get duration(){return console.assert(this.isPlayable,"Sound not yet playable, no duration"),this._source.buffer.duration}get buffer(){return this._source.buffer}set buffer(t){this._source.buffer=t}get nodes(){return this._nodes}load(t){this.source?this._decode(this.source,t):this.parent.url?this._loadUrl(t):t?t(new Error("sound.url or sound.source must be set")):console.error("sound.url or sound.source must be set")}async _loadUrl(t){const e=this.parent.url,i=await ot.ADAPTER.fetch(e);this._decode(await i.arrayBuffer(),t)}_decode(t,e){const i=(r,n)=>{if(r)e&&e(r);else{this.parent.isLoaded=!0,this.buffer=n;const a=this.parent.autoPlayStart();e&&e(null,this.parent,a)}};t instanceof AudioBuffer?i(null,t):this.parent.context.decode(t,i)}}var O3=Object.defineProperty,Hf=Object.getOwnPropertySymbols,N3=Object.prototype.hasOwnProperty,D3=Object.prototype.propertyIsEnumerable,Xf=(s,t,e)=>t in s?O3(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,$f=(s,t)=>{for(var e in t||(t={}))N3.call(t,e)&&Xf(s,e,t[e]);if(Hf)for(var e of Hf(t))D3.call(t,e)&&Xf(s,e,t[e]);return s};const Tr=class{static from(s){let t={};typeof s=="string"?t.url=s:s instanceof ArrayBuffer||s instanceof AudioBuffer||s instanceof HTMLAudioElement?t.source=s:t=s,t=$f({autoPlay:!1,singleInstance:!1,url:null,source:null,preload:!1,volume:1,speed:1,complete:null,loaded:null,loop:!1},t),Object.freeze(t);const e=ea().useLegacy?new B3:new L3;return new Tr(e,t)}constructor(s,t){this.media=s,this.options=t,this._instances=[],this._sprites={},this.media.init(this);const e=t.complete;this._autoPlayOptions=e?{complete:e}:null,this.isLoaded=!1,this.isPlaying=!1,this.autoPlay=t.autoPlay,this.singleInstance=t.singleInstance,this.preload=t.preload||this.autoPlay,this.url=t.url,this.speed=t.speed,this.volume=t.volume,this.loop=t.loop,t.sprites&&this.addSprites(t.sprites),this.preload&&this._preload(t.loaded)}get context(){return ea().context}pause(){return this.isPlaying=!1,this.paused=!0,this}resume(){return this.isPlaying=this._instances.length>0,this.paused=!1,this}get paused(){return this._paused}set paused(s){this._paused=s,this.refreshPaused()}get speed(){return this._speed}set speed(s){this._speed=s,this.refresh()}get filters(){return this.media.filters}set filters(s){this.media.filters=s}addSprites(s,t){if(typeof s=="object"){const i={};for(const r in s)i[r]=this.addSprites(r,s[r]);return i}console.assert(!this._sprites[s],`Alias ${s} is already taken`);const e=new I3(this,t);return this._sprites[s]=e,e}destroy(){this._removeInstances(),this.removeSprites(),this.media.destroy(),this.media=null,this._sprites=null,this._instances=null}removeSprites(s){if(s){const t=this._sprites[s];t!==void 0&&(t.destroy(),delete this._sprites[s])}else for(const t in this._sprites)this.removeSprites(t);return this}get isPlayable(){return this.isLoaded&&this.media&&this.media.isPlayable}stop(){if(!this.isPlayable)return this.autoPlay=!1,this._autoPlayOptions=null,this;this.isPlaying=!1;for(let s=this._instances.length-1;s>=0;s--)this._instances[s].stop();return this}play(s,t){let e;if(typeof s=="string"?e={sprite:s,loop:this.loop,complete:t}:typeof s=="function"?(e={},e.complete=s):e=s,e=$f({complete:null,loaded:null,sprite:null,end:null,start:0,volume:1,speed:1,muted:!1,loop:!1},e||{}),e.sprite){const r=e.sprite;console.assert(!!this._sprites[r],`Alias ${r} is not available`);const n=this._sprites[r];e.start=n.start+(e.start||0),e.end=n.end,e.speed=n.speed||1,e.loop=n.loop||e.loop,delete e.sprite}if(e.offset&&(e.start=e.offset),!this.isLoaded)return new Promise((r,n)=>{this.autoPlay=!0,this._autoPlayOptions=e,this._preload((a,o,h)=>{a?n(a):(e.loaded&&e.loaded(a,o,h),r(h))})});(this.singleInstance||e.singleInstance)&&this._removeInstances();const i=this._createInstance();return this._instances.push(i),this.isPlaying=!0,i.once("end",()=>{e.complete&&e.complete(this),this._onComplete(i)}),i.once("stop",()=>{this._onComplete(i)}),i.play(e),i}refresh(){const s=this._instances.length;for(let t=0;t<s;t++)this._instances[t].refresh()}refreshPaused(){const s=this._instances.length;for(let t=0;t<s;t++)this._instances[t].refreshPaused()}get volume(){return this._volume}set volume(s){this._volume=s,this.refresh()}get muted(){return this._muted}set muted(s){this._muted=s,this.refresh()}get loop(){return this._loop}set loop(s){this._loop=s,this.refresh()}_preload(s){this.media.load(s)}get instances(){return this._instances}get sprites(){return this._sprites}get duration(){return this.media.duration}autoPlayStart(){let s;return this.autoPlay&&(s=this.play(this._autoPlayOptions)),s}_removeInstances(){for(let s=this._instances.length-1;s>=0;s--)this._poolInstance(this._instances[s]);this._instances.length=0}_onComplete(s){if(this._instances){const t=this._instances.indexOf(s);t>-1&&this._instances.splice(t,1),this.isPlaying=this._instances.length>0}this._poolInstance(s)}_createInstance(){if(Tr._pool.length>0){const s=Tr._pool.pop();return s.init(this.media),s}return this.media.create()}_poolInstance(s){s.destroy(),Tr._pool.indexOf(s)<0&&Tr._pool.push(s)}};let Po=Tr;Po._pool=[];class G3 extends Rt{constructor(){super(...arguments),this.speed=1,this.muted=!1,this.volume=1,this.paused=!1}refresh(){this.emit("refresh")}refreshPaused(){this.emit("refreshPaused")}get filters(){return console.warn("HTML Audio does not support filters"),null}set filters(t){console.warn("HTML Audio does not support filters")}get audioContext(){return console.warn("HTML Audio does not support audioContext"),null}toggleMute(){return this.muted=!this.muted,this.refresh(),this.muted}togglePause(){return this.paused=!this.paused,this.refreshPaused(),this.paused}destroy(){this.removeAllListeners()}}class ia extends oy{constructor(){const t=window,e=new ia.AudioContext,i=e.createDynamicsCompressor(),r=e.createAnalyser();r.connect(i),i.connect(e.destination),super(r,i),this._ctx=e,this._offlineCtx=new ia.OfflineAudioContext(1,2,t.OfflineAudioContext?Math.max(8e3,Math.min(96e3,e.sampleRate)):44100),this._unlocked=!1,this.compressor=i,this.analyser=r,this.events=new Rt,this.volume=1,this.speed=1,this.muted=!1,this.paused=!1,e.state!=="running"&&(this._unlock(),this._unlock=this._unlock.bind(this),document.addEventListener("mousedown",this._unlock,!0),document.addEventListener("touchstart",this._unlock,!0),document.addEventListener("touchend",this._unlock,!0))}_unlock(){this._unlocked||(this.playEmptySound(),this._ctx.state==="running"&&(document.removeEventListener("mousedown",this._unlock,!0),document.removeEventListener("touchend",this._unlock,!0),document.removeEventListener("touchstart",this._unlock,!0),this._unlocked=!0))}playEmptySound(){const t=this._ctx.createBufferSource();t.buffer=this._ctx.createBuffer(1,1,22050),t.connect(this._ctx.destination),t.start(0,0,0),t.context.state==="suspended"&&t.context.resume()}static get AudioContext(){const t=window;return t.AudioContext||t.webkitAudioContext||null}static get OfflineAudioContext(){const t=window;return t.OfflineAudioContext||t.webkitOfflineAudioContext||null}destroy(){super.destroy();const t=this._ctx;typeof t.close<"u"&&t.close(),this.events.removeAllListeners(),this.analyser.disconnect(),this.compressor.disconnect(),this.analyser=null,this.compressor=null,this.events=null,this._offlineCtx=null,this._ctx=null}get audioContext(){return this._ctx}get offlineContext(){return this._offlineCtx}set paused(t){t&&this._ctx.state==="running"?this._ctx.suspend():!t&&this._ctx.state==="suspended"&&this._ctx.resume(),this._paused=t}get paused(){return this._paused}refresh(){this.events.emit("refresh")}refreshPaused(){this.events.emit("refreshPaused")}toggleMute(){return this.muted=!this.muted,this.refresh(),this.muted}togglePause(){return this.paused=!this.paused,this.refreshPaused(),this._paused}decode(t,e){const i=n=>{e(new Error((n==null?void 0:n.message)||"Unable to decode file"))},r=this._offlineCtx.decodeAudioData(t,n=>{e(null,n)},i);r&&r.catch(i)}}var V3=Object.defineProperty,Wf=Object.getOwnPropertySymbols,z3=Object.prototype.hasOwnProperty,H3=Object.prototype.propertyIsEnumerable,Yf=(s,t,e)=>t in s?V3(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,jf=(s,t)=>{for(var e in t||(t={}))z3.call(t,e)&&Yf(s,e,t[e]);if(Wf)for(var e of Wf(t))H3.call(t,e)&&Yf(s,e,t[e]);return s};class X3{constructor(){this.init()}init(){return this.supported&&(this._webAudioContext=new ia),this._htmlAudioContext=new G3,this._sounds={},this.useLegacy=!this.supported,this}get context(){return this._context}get filtersAll(){return this.useLegacy?[]:this._context.filters}set filtersAll(t){this.useLegacy||(this._context.filters=t)}get supported(){return ia.AudioContext!==null}add(t,e){if(typeof t=="object"){const n={};for(const a in t){const o=this._getOptions(t[a],e);n[a]=this.add(a,o)}return n}if(console.assert(!this._sounds[t],`Sound with alias ${t} already exists.`),e instanceof Po)return this._sounds[t]=e,e;const i=this._getOptions(e),r=Po.from(i);return this._sounds[t]=r,r}_getOptions(t,e){let i;return typeof t=="string"?i={url:t}:t instanceof ArrayBuffer||t instanceof AudioBuffer||t instanceof HTMLAudioElement?i={source:t}:i=t,i=jf(jf({},i),e||{}),i}get useLegacy(){return this._useLegacy}set useLegacy(t){this._useLegacy=t,this._context=!t&&this.supported?this._webAudioContext:this._htmlAudioContext}remove(t){return this.exists(t,!0),this._sounds[t].destroy(),delete this._sounds[t],this}get volumeAll(){return this._context.volume}set volumeAll(t){this._context.volume=t,this._context.refresh()}get speedAll(){return this._context.speed}set speedAll(t){this._context.speed=t,this._context.refresh()}togglePauseAll(){return this._context.togglePause()}pauseAll(){return this._context.paused=!0,this._context.refreshPaused(),this}resumeAll(){return this._context.paused=!1,this._context.refreshPaused(),this}toggleMuteAll(){return this._context.toggleMute()}muteAll(){return this._context.muted=!0,this._context.refresh(),this}unmuteAll(){return this._context.muted=!1,this._context.refresh(),this}removeAll(){for(const t in this._sounds)this._sounds[t].destroy(),delete this._sounds[t];return this}stopAll(){for(const t in this._sounds)this._sounds[t].stop();return this}exists(t,e=!1){const i=!!this._sounds[t];return e&&console.assert(i,`No sound matching alias '${t}'.`),i}find(t){return this.exists(t,!0),this._sounds[t]}play(t,e){return this.find(t).play(e)}stop(t){return this.find(t).stop()}pause(t){return this.find(t).pause()}resume(t){return this.find(t).resume()}volume(t,e){const i=this.find(t);return e!==void 0&&(i.volume=e),i.volume}speed(t,e){const i=this.find(t);return e!==void 0&&(i.speed=e),i.speed}duration(t){return this.find(t).duration}close(){return this.removeAll(),this._sounds=null,this._webAudioContext&&(this._webAudioContext.destroy(),this._webAudioContext=null),this._htmlAudioContext&&(this._htmlAudioContext.destroy(),this._htmlAudioContext=null),this._context=null,this}}var $3=Object.defineProperty,qf=Object.getOwnPropertySymbols,W3=Object.prototype.hasOwnProperty,Y3=Object.prototype.propertyIsEnumerable,Kf=(s,t,e)=>t in s?$3(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,j3=(s,t)=>{for(var e in t||(t={}))W3.call(t,e)&&Kf(s,e,t[e]);if(qf)for(var e of qf(t))Y3.call(t,e)&&Kf(s,e,t[e]);return s};const cy=["mp3","ogg","oga","opus","mpeg","wav","m4a","aiff","wma","mid","caf"],vc={};function q3(s){const t=j3({m4a:"audio/mp4",oga:"audio/ogg",opus:'audio/ogg; codecs="opus"',caf:'audio/x-caf; codecs="opus"'},s||{}),e=document.createElement("audio"),i={},r=/^no$/;cy.forEach(n=>{const a=e.canPlayType(`audio/${n}`).replace(r,""),o=t[n]?e.canPlayType(t[n]).replace(r,""):"";i[n]=!!a||!!o}),Object.assign(vc,i)}q3();var K3=Object.defineProperty,Z3=Object.defineProperties,J3=Object.getOwnPropertyDescriptors,Zf=Object.getOwnPropertySymbols,Q3=Object.prototype.hasOwnProperty,tk=Object.prototype.propertyIsEnumerable,Jf=(s,t,e)=>t in s?K3(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,ek=(s,t)=>{for(var e in t||(t={}))Q3.call(t,e)&&Jf(s,e,t[e]);if(Zf)for(var e of Zf(t))tk.call(t,e)&&Jf(s,e,t[e]);return s},ik=(s,t)=>Z3(s,J3(t));const Qf=s=>{var t,e;const i=s.src;return(e=(t=s==null?void 0:s.alias)==null?void 0:t[0])!=null?e:Ie.basename(i,Ie.extname(i))},sk={extension:Q.Asset,detection:{test:async()=>!0,add:async s=>[...s,...cy.filter(t=>vc[t])],remove:async s=>s.filter(t=>s.includes(t))},loader:{extension:{type:[Q.LoadParser],priority:lr.High},test(s){const t=Ie.extname(s).slice(1);return!!vc[t]},async load(s,t){const e=await new Promise((i,r)=>Po.from(ik(ek({},t.data),{url:s,preload:!0,loaded(n,a){var o,h;n?r(n):i(a),(h=(o=t.data)==null?void 0:o.loaded)==null||h.call(o,n,a)}})));return ea().add(Qf(t),e),e},async unload(s,t){ea().remove(Qf(t))}}};rt.add(sk);const Ln=k3(new X3);class rk{constructor(){A(this,"currentAlias");A(this,"current");A(this,"volume",1)}async play(t,e){}getVolume(){return this.volume}setVolume(t){this.volume=t,this.current&&(this.current.volume=this.volume)}}class nk{constructor(){A(this,"volume",1)}play(t,e){}getVolume(){return this.volume}setVolume(t){this.volume=t}}function tp(s){Ln.volumeAll=s,s?Ln.unmuteAll():Ln.muteAll()}const Mo=new rk,Pt=new nk;class yr extends W{constructor(){super();A(this,"image");this.image=lt.from("star"),this.image.anchor.set(.5),this.addChild(this.image)}async show(e=!0){P.killTweensOf(this.image.scale),this.visible=!0,e?(this.image.scale.set(0),await P.to(this.image.scale,{x:1,y:1,duration:.3,ease:"back.out"})):this.image.scale.set(1)}async hide(e=!0){P.killTweensOf(this.image.scale),e?await P.to(this.image.scale,{x:0,y:0,duration:.3,ease:"back.in"}):this.image.scale.set(0),this.visible=!1}async playStamp(){P.killTweensOf(this.image),P.killTweensOf(this.image.scale),this.visible=!0,this.image.visible=!0,this.image.alpha=0,this.image.rotation=3,this.image.scale.set(5),P.to(this.image,{alpha:1,duration:.2,ease:"linear"}),P.to(this.image,{rotation:0,duration:.5,ease:"back.out"}),await P.to(this.image.scale,{x:1,y:1,duration:.5,ease:"expo.in"})}}class ak extends W{constructor(){super();A(this,"star1");A(this,"star2");A(this,"star3");A(this,"starSlot1");A(this,"starSlot2");A(this,"starSlot3");const e=-80,i=80,r=0,n=.7,a=.7,o=1,h=.15;this.starSlot1=new yr,this.starSlot1.x=e,this.starSlot1.scale.set(n),this.starSlot1.alpha=h,this.addChild(this.starSlot1),this.starSlot2=new yr,this.starSlot2.x=i,this.starSlot2.scale.set(a),this.starSlot2.alpha=h,this.addChild(this.starSlot2),this.starSlot3=new yr,this.starSlot3.x=r,this.starSlot3.alpha=h,this.starSlot3.scale.set(o),this.addChild(this.starSlot3),this.star1=new yr,this.star1.x=e,this.star1.scale.set(a),this.addChild(this.star1),this.star2=new yr,this.star2.x=i,this.star2.scale.set(a),this.addChild(this.star2),this.star3=new yr,this.star3.x=r,this.star3.scale.set(o),this.addChild(this.star3)}async show(e=!0){this.star1.hide(),this.star2.hide(),this.star3.hide(),await this.showSlots(e)}async hide(e=!0){this.star1.hide(e),this.star2.hide(e),this.star3.hide(e),await this.hideSlots(e)}async showSlots(e=!0){this.starSlot1.show(e),this.starSlot2.show(e),await this.starSlot3.show(e)}async hideSlots(e=!0){this.starSlot1.hide(e),this.starSlot2.hide(e),await this.starSlot3.hide(e)}async playGrade(e){e>=1&&(await this.star1.playStamp(),Gr(Ct.stage.pivot,4),Pt.play("common/sfx-correct.wav",{speed:.9})),e>=2&&(await this.star2.playStamp(),Gr(Ct.stage.pivot,8),Pt.play("common/sfx-correct.wav",{speed:1})),e>=3&&(await this.star3.playStamp(),Gr(Ct.stage.pivot,16),Pt.play("common/sfx-correct.wav",{speed:1.5}))}}var ge={},ks={};Object.defineProperty(ks,"__esModule",{value:!0});ks.Collector=void 0;class ok{constructor(t){this.emit=(...e)=>{t.emitCollecting(this,e)}}}ks.Collector=ok;var jo={};Object.defineProperty(jo,"__esModule",{value:!0});jo.CollectorArray=void 0;const hk=ks;class lk extends hk.Collector{constructor(){super(...arguments),this.result=[]}handleResult(t){return this.result.push(t),!0}getResult(){return this.result}reset(){this.result.length=0}}jo.CollectorArray=lk;var qo={};Object.defineProperty(qo,"__esModule",{value:!0});qo.CollectorLast=void 0;const ck=ks;class uk extends ck.Collector{handleResult(t){return this.result=t,!0}getResult(){return this.result}reset(){delete this.result}}qo.CollectorLast=uk;var Ko={};Object.defineProperty(Ko,"__esModule",{value:!0});Ko.CollectorUntil0=void 0;const dk=ks;class fk extends dk.Collector{constructor(){super(...arguments),this.result=!1}handleResult(t){return this.result=t,this.result}getResult(){return this.result}reset(){this.result=!1}}Ko.CollectorUntil0=fk;var Zo={};Object.defineProperty(Zo,"__esModule",{value:!0});Zo.CollectorWhile0=void 0;const pk=ks;class mk extends pk.Collector{constructor(){super(...arguments),this.result=!1}handleResult(t){return this.result=t,!this.result}getResult(){return this.result}reset(){this.result=!1}}Zo.CollectorWhile0=mk;var Jo={},Qo={};Object.defineProperty(Qo,"__esModule",{value:!0});Qo.SignalConnectionImpl=void 0;class gk{constructor(t,e){this.link=t,this.parentCleanup=e}disconnect(){return this.link!==null?(this.link.unlink(),this.link=null,this.parentCleanup(),this.parentCleanup=null,!0):!1}set enabled(t){this.link&&this.link.setEnabled(t)}get enabled(){return this.link!==null&&this.link.isEnabled()}}Qo.SignalConnectionImpl=gk;var th={};Object.defineProperty(th,"__esModule",{value:!0});th.SignalLink=void 0;class vu{constructor(t=null,e=null,i=0){this.enabled=!0,this.newLink=!1,this.callback=null,this.prev=t??this,this.next=e??this,this.order=i}isEnabled(){return this.enabled&&!this.newLink}setEnabled(t){this.enabled=t}unlink(){this.callback=null,this.next.prev=this.prev,this.prev.next=this.next}insert(t,e){let i=this.prev;for(;i!==this&&!(i.order<=e);)i=i.prev;const r=new vu(i,i.next,e);return r.callback=t,i.next=r,r.next.prev=r,r}}th.SignalLink=vu;Object.defineProperty(Jo,"__esModule",{value:!0});Jo.Signal=void 0;const bk=Qo,yk=th;class xk{constructor(){this.head=new yk.SignalLink,this.hasNewLinks=!1,this.emitDepth=0,this.connectionsCount=0}getConnectionsCount(){return this.connectionsCount}hasConnections(){return this.connectionsCount>0}connect(t,e=0){this.connectionsCount++;const i=this.head.insert(t,e);return this.emitDepth>0&&(this.hasNewLinks=!0,i.newLink=!0),new bk.SignalConnectionImpl(i,()=>this.decrementConnectionCount())}decrementConnectionCount(){this.connectionsCount--}disconnect(t){for(let e=this.head.next;e!==this.head;e=e.next)if(e.callback===t)return this.decrementConnectionCount(),e.unlink(),!0;return!1}disconnectAll(){for(;this.head.next!==this.head;)this.head.next.unlink();this.connectionsCount=0}emit(...t){this.emitDepth++;for(let e=this.head.next;e!==this.head;e=e.next)e.isEnabled()&&e.callback&&e.callback.apply(null,t);this.emitDepth--,this.unsetNewLink()}emitCollecting(t,e){this.emitDepth++;for(let i=this.head.next;i!==this.head;i=i.next)if(i.isEnabled()&&i.callback){const r=i.callback.apply(null,e);if(!t.handleResult(r))break}this.emitDepth--,this.unsetNewLink()}unsetNewLink(){if(this.hasNewLinks&&this.emitDepth===0){for(let t=this.head.next;t!==this.head;t=t.next)t.newLink=!1;this.hasNewLinks=!1}}}Jo.Signal=xk;var eh={};Object.defineProperty(eh,"__esModule",{value:!0});eh.SignalConnections=void 0;class vk{constructor(){this.list=[]}add(t){this.list.push(t)}disconnectAll(){for(const t of this.list)t.disconnect();this.list=[]}getCount(){return this.list.length}isEmpty(){return this.list.length===0}}eh.SignalConnections=vk;(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.SignalConnections=s.Signal=s.CollectorWhile0=s.CollectorUntil0=s.CollectorLast=s.CollectorArray=s.Collector=void 0;var t=ks;Object.defineProperty(s,"Collector",{enumerable:!0,get:function(){return t.Collector}});var e=jo;Object.defineProperty(s,"CollectorArray",{enumerable:!0,get:function(){return e.CollectorArray}});var i=qo;Object.defineProperty(s,"CollectorLast",{enumerable:!0,get:function(){return i.CollectorLast}});var r=Ko;Object.defineProperty(s,"CollectorUntil0",{enumerable:!0,get:function(){return r.CollectorUntil0}});var n=Zo;Object.defineProperty(s,"CollectorWhile0",{enumerable:!0,get:function(){return n.CollectorWhile0}});var a=Jo;Object.defineProperty(s,"Signal",{enumerable:!0,get:function(){return a.Signal}});var o=eh;Object.defineProperty(s,"SignalConnections",{enumerable:!0,get:function(){return o.SignalConnections}})})(ge);class _k{constructor(){A(this,"_isMouseIn");A(this,"_isDown");A(this,"onDown");A(this,"onUp");A(this,"onUpOut");A(this,"onOut");A(this,"onPress");A(this,"onHover");this.onPress=new ge.Signal,this.onDown=new ge.Signal,this.onUp=new ge.Signal,this.onHover=new ge.Signal,this.onOut=new ge.Signal,this.onUpOut=new ge.Signal}connectEvents(t){t.on("pointerdown",this.processDown,this),t.on("pointerup",this.processUp,this),t.on("pointerupoutside",this.processUpOut,this),t.on("pointerout",this.processOut,this),t.on("pointertap",this.processPress,this),t.on("pointerover",this.processOver,this)}disconnectEvents(t){t.off("pointerdown",this.processDown,this),t.off("pointerup",this.processUp,this),t.off("pointerupoutside",this.processUpOut,this),t.off("pointerout",this.processOut,this),t.off("pointertap",this.processPress,this),t.off("pointerover",this.processOver,this)}processDown(t){this._isDown=!0,console.log("processDown"),this.onDown.emit(this,t),this.down(t)}processUp(t){this._isDown&&(this.onUp.emit(this,t),this.up(t)),this._isDown=!1}processUpOut(t){this._isDown&&(this.onUp.emit(this,t),this.onUpOut.emit(this,t),this.up(t),this.upOut(t)),this._isDown=!1}processOut(t){this._isMouseIn&&(this._isMouseIn=!1,this.onOut.emit(this,t),this.out(t))}processPress(t){this._isDown=!1,this.onPress.emit(this,t),this.press(t)}processOver(t){za.any||(this._isMouseIn=!0,this.onHover.emit(this,t),this.hover(t))}down(t){}up(t){}upOut(t){}out(t){}press(t){}hover(t){}get isDown(){return this._isDown}}const uy=(s,t,e=[])=>{const i=Object.getOwnPropertyDescriptors(t);for(let r of e)delete i[r];Object.defineProperties(s,i)},sa=(s,t=[s])=>{const e=Object.getPrototypeOf(s);return e===null?t:sa(e,[...t,e])},wk=(...s)=>{if(s.length===0)return;let t;const e=s.map(i=>sa(i));for(;e.every(i=>i.length>0);){const i=e.map(n=>n.pop()),r=i[0];if(i.every(n=>n===r))t=r;else break}return t},ep=(s,t,e=[])=>{var i;const r=(i=wk(...s))!==null&&i!==void 0?i:Object.prototype,n=Object.create(r),a=sa(r);for(let o of s){let h=sa(o);for(let l=h.length-1;l>=0;l--){let c=h[l];a.indexOf(c)===-1&&(uy(n,c,["constructor",...e]),a.push(c))}}return n.constructor=t,n},_c=s=>s.filter((t,e)=>s.indexOf(t)==e),dy=new Map,Tk=s=>dy.get(s),Sk=(s,t)=>dy.set(s,t),ip=(s,t)=>{var e,i;const r=_c([...Object.getOwnPropertyNames(s),...Object.getOwnPropertyNames(t)]),n={};for(let a of r)n[a]=_c([...(e=s==null?void 0:s[a])!==null&&e!==void 0?e:[],...(i=t==null?void 0:t[a])!==null&&i!==void 0?i:[]]);return n},sp=(s,t)=>{var e,i,r,n;return{property:ip((e=s==null?void 0:s.property)!==null&&e!==void 0?e:{},(i=t==null?void 0:t.property)!==null&&i!==void 0?i:{}),method:ip((r=s==null?void 0:s.method)!==null&&r!==void 0?r:{},(n=t==null?void 0:t.method)!==null&&n!==void 0?n:{})}},Ck=(s,t)=>{var e,i,r,n,a,o;return{class:_c([...(e=s==null?void 0:s.class)!==null&&e!==void 0?e:[],...(i=t==null?void 0:t.class)!==null&&i!==void 0?i:[]]),static:sp((r=s==null?void 0:s.static)!==null&&r!==void 0?r:{},(n=t==null?void 0:t.static)!==null&&n!==void 0?n:{}),instance:sp((a=s==null?void 0:s.instance)!==null&&a!==void 0?a:{},(o=t==null?void 0:t.instance)!==null&&o!==void 0?o:{})}},Ak=new Map,Ek=(...s)=>{var t;const e=new Set,i=new Set([...s]);for(;i.size>0;)for(let r of i){const n=sa(r.prototype).map(l=>l.constructor),a=(t=Tk(r))!==null&&t!==void 0?t:[],h=[...n,...a].filter(l=>!e.has(l));for(let l of h)i.add(l);e.add(r),i.delete(r)}return[...e]},Pk=(...s)=>{const t=Ek(...s).map(e=>Ak.get(e)).filter(e=>!!e);return t.length==0?{}:t.length==1?t[0]:t.reduce((e,i)=>Ck(e,i))};function Mk(...s){var t,e,i;const r=s.map(o=>o.prototype);function n(...o){for(const h of s)uy(this,new h(...o))}n.prototype=ep(r,n),Object.setPrototypeOf(n,ep(s,null,["prototype"]));let a=n;{const o=Pk(...s);for(let h of(t=o==null?void 0:o.class)!==null&&t!==void 0?t:[]){const l=h(a);l&&(a=l)}rp((e=o==null?void 0:o.static)!==null&&e!==void 0?e:{},a),rp((i=o==null?void 0:o.instance)!==null&&i!==void 0?i:{},a.prototype)}return Sk(a,s),a}const rp=(s,t)=>{const e=s.property,i=s.method;if(e)for(let r in e)for(let n of e[r])n(t,r);if(i)for(let r in i)for(let n of i[r])n(t,r,Object.getOwnPropertyDescriptor(t,r))};class fy extends _k{constructor(e){super();A(this,"_view");e&&this.init(e)}init(e){this.view=e,this.enabled=!0}set view(e){const i=!!this._view;i&&this.disconnectEvents(e),this._view=e,this.connectEvents(e),i||(this.enabled=!0)}get view(){return this._view}set enabled(e){if(!this.view){console.error("Button view is not set. Please set it before enabling the button.");return}this.view.eventMode=e?"static":"auto",this.view.cursor=e?"pointer":"default",!e&&this.isDown&&this.processUp()}get enabled(){return this.view.eventMode==="static"}}class iB extends Mk(W,fy){constructor(t){super(),t&&this.init(t)}init(t){this.addChild(t),this.view=t,this.enabled=!0}}function ps(s){return typeof s=="string"?lt.from(s):s}class kk extends W{constructor(e){super();A(this,"bg");A(this,"fill");A(this,"fillMask");A(this,"progressStart",0);A(this,"_progress",0);A(this,"innerView");this.innerView=new W,this.addChild(this.innerView),e!=null&&e.bg&&(e!=null&&e.fill)&&this.init(e)}init({bg:e,fill:i,fillOffset:r,progress:n}){this.setBackground(e),this.setFill(i,r),this.progress=n}setBackground(e){this.bg&&this.innerView.removeChild(this.bg),this.bg=ps(e),this.innerView.addChildAt(this.bg,0)}setFill(e,i){this.fill&&(this.innerView.removeChild(this.fill),this.fill.destroy()),this.bg instanceof lt&&e===this.bg&&(e=lt.from(this.bg.texture)),this.fill=ps(e),this.innerView.addChildAt(this.fill,1);const r=(i==null?void 0:i.x)??0,n=(i==null?void 0:i.y)??0;this.fill.x=(this.bg.width-this.fill.width)/2+r,this.fill.y=(this.bg.height-this.fill.height)/2+n,this.fillMask||(this.fillMask=new kn),this.fill.addChild(this.fillMask),this.fill.mask=this.fillMask}validate(e){return e=Math.round(e),e<0?0:e>100?100:e}set progress(e){if(this._progress=this.validate(e),!this.fill)return;const i=this.fill.width/100*this.progressStart,r=this.fill.width/100*this._progress-i;this.fillMask&&this.fillMask.context.clear().rect(i,0,r,this.fill.height).fill(16777215)}get progress(){return this._progress}}class Rk extends kk{constructor(e){super();A(this,"_slider1");A(this,"_slider2");A(this,"value1Text");A(this,"value2Text");A(this,"_value1");A(this,"_value2");A(this,"dragging",0);A(this,"min",0);A(this,"max",100);A(this,"startUpdateValue1");A(this,"startUpdateValue2");A(this,"settings");this.setBackground(e.bg),e.fill&&this.setFill(e.fill,e.fillOffset),this.settings=e,this.slider1=e.slider1,this.slider2=e.slider2,this.min=e.min??0,this.max=e.max??100,this.activate()}set slider1(e){e&&(this._slider1&&(this.slider1.removeAllListeners(),this.removeChild(this._slider1),this.slider1.destroy()),this._slider1=this.createSlider(e),this._slider1.eventMode="static",this._slider1.on("pointerdown",this.startUpdate,this).on("globalpointermove",this.update,this).on("pointerup",this.endUpdate,this).on("pointerupoutside",this.endUpdate,this),this.settings.showValue&&!this.value1Text&&(this.value1Text=new qr("",this.settings.valueTextStyle||{fill:16777215}),this.value1Text.anchor.set(.5),this.addChild(this.value1Text)))}get slider1(){return this._slider1}set slider2(e){e&&(this._slider2&&(this.slider2.removeAllListeners(),this.removeChild(this._slider2),this.slider2.destroy()),this._slider2=this.createSlider(e),this._slider2.eventMode="static",this._slider2.on("pointerdown",this.startUpdate,this).on("globalpointermove",this.update,this).on("pointerup",this.endUpdate,this).on("pointerupoutside",this.endUpdate,this),this.settings.showValue&&!this.value2Text&&(this.value2Text=new qr("",this.settings.valueTextStyle||{fill:16777215}),this.value2Text.anchor.set(.5),this.addChild(this.value2Text)))}get slider2(){return this._slider2}setBackground(e){this.bg&&this.bg.removeAllListeners(),super.setBackground(e),this.activate()}activate(){this.bg.eventMode="static",this.bg.on("pointerdown",this.startUpdate,this).on("globalpointermove",this.update,this).on("pointerup",this.endUpdate,this).on("pointerupoutside",this.endUpdate,this),this.fill&&(this.fill.eventMode="none"),this.value1Text&&(this.value1Text.eventMode="none"),this.value2Text&&(this.value2Text.eventMode="none")}createSlider(e){const i=ps(e);i.x=i.width/2;const r=new W;return r.addChild(i),i instanceof lt&&i.anchor.set(.5),r.y=this.bg.height/2,this.addChild(r),r}startUpdate(e){this.dragging=1,this.startUpdateValue1=this._value1,this.startUpdateValue2=this._value2,this.update(e)}endUpdate(){this.dragging&&(this.dragging=0,(this.startUpdateValue1!==this._value1||this.startUpdateValue2!==this._value2)&&this.change(),this.startUpdateValue1=null,this.startUpdateValue2=null)}update(e){}change(){}}function Bk(s){return s instanceof qr?s:new qr({text:String(s)})}function np(s,t,e=0){let i=t.scale.x,r=t.scale.y;const n=s.width-e*2,a=s.height-e*2,o=n-Math.round(t.width),h=a-Math.round(t.height);o<0&&(i=n/(t.width*i)),h<0&&(r=a/(t.height*r)),(i<=0||r<=0)&&(t.visible=!1),t.scale.set(Math.min(i,r))}/*!
 * tweedle.js - v2.0.1
 * Compiled Tue, 20 Dec 2022 14:21:53 UTC
 *
 * tweedle.js is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 * 
 * Copyright 2019-2021, Milton Candelero <miltoncandelero@gmail.com>, All Rights Reserved
 */let Pn;typeof self>"u"&&typeof process<"u"&&process.hrtime?Pn=function(){const s=process.hrtime();return s[0]*1e3+s[1]/1e6}:typeof self<"u"&&self.performance!==void 0&&self.performance.now!==void 0?Pn=self.performance.now.bind(self.performance):Date.now!==void 0?Pn=Date.now:Pn=function(){return new Date().getTime()};class hi{constructor(){hi.prototype.__init.call(this),hi.prototype.__init2.call(this),hi.prototype.__init3.call(this),hi.prototype.__init4.call(this)}__init(){this._tweens={}}static get shared(){return hi._shared||(hi._shared=new hi),hi._shared}__init2(){this._paused=!1}isPaused(){return this._paused}pause(){this._paused=!0}resume(){this._paused=!1}__init3(){this._lastUpdateTime=void 0}__init4(){this.now=Pn}getAll(){return Object.keys(this._tweens).map(t=>this._tweens[t])}removeAll(){this._tweens={}}add(t){this._tweens[t.getId()]=t}remove(t){delete this._tweens[t.getId()]}update(t,e=!1){if(t==null&&(this._lastUpdateTime==null?(this._lastUpdateTime=this.now(),t=0):t=this.now()-this._lastUpdateTime),this._lastUpdateTime=this.now(),this._paused)return!1;const i=Object.keys(this._tweens);if(i.length==0)return!1;for(let r=0;r<i.length;r++){const n=this._tweens[i[r]];n&&n.update(t,!0)==!1&&!e&&delete this._tweens[i[r]]}return!0}}const Za={Step:{None(s){return s<.5?0:1}},Linear:{None(s){return s}},Quadratic:{In(s){return s*s},Out(s){return s*(2-s)},InOut(s){return(s*=2)<1?.5*s*s:-.5*(--s*(s-2)-1)}},Cubic:{In(s){return s*s*s},Out(s){return--s*s*s+1},InOut(s){return(s*=2)<1?.5*s*s*s:.5*((s-=2)*s*s+2)}},Quartic:{In(s){return s*s*s*s},Out(s){return 1- --s*s*s*s},InOut(s){return(s*=2)<1?.5*s*s*s*s:-.5*((s-=2)*s*s*s-2)}},Quintic:{In(s){return s*s*s*s*s},Out(s){return--s*s*s*s*s+1},InOut(s){return(s*=2)<1?.5*s*s*s*s*s:.5*((s-=2)*s*s*s*s+2)}},Sinusoidal:{In(s){return 1-Math.cos(s*Math.PI/2)},Out(s){return Math.sin(s*Math.PI/2)},InOut(s){return .5*(1-Math.cos(Math.PI*s))}},Exponential:{In(s){return s==0?0:Math.pow(1024,s-1)},Out(s){return s==1?1:1-Math.pow(2,-10*s)},InOut(s){return s==0?0:s==1?1:(s*=2)<1?.5*Math.pow(1024,s-1):.5*(-Math.pow(2,-10*(s-1))+2)}},Circular:{In(s){return 1-Math.sqrt(1-s*s)},Out(s){return Math.sqrt(1- --s*s)},InOut(s){return(s*=2)<1?-.5*(Math.sqrt(1-s*s)-1):.5*(Math.sqrt(1-(s-=2)*s)+1)}},Elastic:{In(s){return s==0?0:s==1?1:-Math.pow(2,10*(s-1))*Math.sin((s-1.1)*5*Math.PI)},Out(s){return s==0?0:s==1?1:Math.pow(2,-10*s)*Math.sin((s-.1)*5*Math.PI)+1},InOut(s){return s==0?0:s==1?1:(s*=2,s<1?-.5*Math.pow(2,10*(s-1))*Math.sin((s-1.1)*5*Math.PI):.5*Math.pow(2,-10*(s-1))*Math.sin((s-1.1)*5*Math.PI)+1)}},Back:{In(s){return s*s*((1.70158+1)*s-1.70158)},Out(s){return--s*s*((1.70158+1)*s+1.70158)+1},InOut(s){const t=2.5949095;return(s*=2)<1?.5*(s*s*((t+1)*s-t)):.5*((s-=2)*s*((t+1)*s+t)+2)}},Bounce:{In(s){return 1-Za.Bounce.Out(1-s)},Out(s){return s<1/2.75?7.5625*s*s:s<2/2.75?7.5625*(s-=1.5/2.75)*s+.75:s<2.5/2.75?7.5625*(s-=2.25/2.75)*s+.9375:7.5625*(s-=2.625/2.75)*s+.984375},InOut(s){return s<.5?Za.Bounce.In(s*2)*.5:Za.Bounce.Out(s*2-1)*.5+.5}}},at={Geom:{Linear(s,t){const e=s.length-1,i=e*t,r=Math.floor(i),n=at.Utils.Linear;return t<0?n(s[0],s[1],i):t>1?n(s[e],s[e-1],e-i):n(s[r],s[r+1>e?e:r+1],i-r)},Bezier(s,t){let e=0;const i=s.length-1,r=Math.pow,n=at.Utils.Bernstein;for(let a=0;a<=i;a++)e+=n(i,a)*r(1-t,i-a)*r(t,a)*s[a];return e},QuadraticBezier(s,t){let e=0;const i=s.length-1;if(t==1)return s[i];const r=Math.pow,n=at.Utils.Bernstein,a=i*t,o=Math.floor(a),h=(a-o)*.5+.5*(o%2),l=o-o%2,c=l+1,u=l+2;return e+=n(2,0)*r(1-h,2-0)*r(h,0)*s[l],e+=n(2,1)*r(1-h,2-1)*r(h,1)*s[c],e+=n(2,2)*r(1-h,2-2)*r(h,2)*s[u],e},CubicBezier(s,t){let e=0;const i=s.length-1;if(t==1)return s[i];const r=Math.pow,n=at.Utils.Bernstein,a=i*t,o=Math.floor(a),h=(a-o)*(1/3)+1/3*(o%3),l=o-o%3,c=l+1,u=l+2,d=l+3;return e+=n(3,0)*r(1-h,3-0)*r(h,0)*s[l],e+=n(3,1)*r(1-h,3-1)*r(h,1)*s[c],e+=n(3,2)*r(1-h,3-2)*r(h,2)*s[u],e+=n(3,3)*r(1-h,3-3)*r(h,3)*s[d],e},CatmullRom(s,t){const e=s.length-1;let i=e*t,r=Math.floor(i);const n=at.Utils.CatmullRom;return s[0]==s[e]?(t<0&&(r=Math.floor(i=e*(1+t))),n(s[(r-1+e)%e],s[r],s[(r+1)%e],s[(r+2)%e],i-r)):t<0?s[0]-(n(s[0],s[0],s[1],s[1],-i)-s[0]):t>1?s[e]-(n(s[e],s[e],s[e-1],s[e-1],i-e)-s[e]):n(s[r?r-1:0],s[r],s[e<r+1?e:r+1],s[e<r+2?e:r+2],i-r)}},Angle:{Radians(s,t){const e=s.length-1,i=e*t,r=Math.floor(i),n=at.Utils.WrapLinear;return t<0?n(s[0],s[1],i,2*Math.PI):t>1?n(s[e],s[e-1],e-i,2*Math.PI):n(s[r],s[r+1>e?e:r+1],i-r,2*Math.PI)},Degrees(s,t){const e=s.length-1,i=e*t,r=Math.floor(i),n=at.Utils.WrapLinear;return t<0?n(s[0],s[1],i,360):t>1?n(s[e],s[e-1],e-i,360):n(s[r],s[r+1>e?e:r+1],i-r,360)}},Color:{RGB(s,t){const e=s.length-1,i=e*t,r=Math.floor(i),n=at.Utils.RGBLinear;return t<0?n(s[0],s[1],i):t>1?n(s[e],s[e-1],e-i):n(s[r],s[r+1>e?e:r+1],i-r)},HSV(s,t){const e=s.length-1,i=e*t,r=Math.floor(i),n=at.Utils.HSVLinear;return t<0?n(s[0],s[1],i):t>1?n(s[e],s[e-1],e-i):n(s[r],s[r+1>e?e:r+1],i-r)},HCL(s,t){const e=s.length-1,i=e*t,r=Math.floor(i),n=at.Utils.HCLLinear;return t<0?n(s[0],s[1],i):t>1?n(s[e],s[e-1],e-i):n(s[r],s[r+1>e?e:r+1],i-r)}},Utils:{RGBsplit(s){const t=s>>24&255,e=s>>16&255,i=s>>8&255,r=s&255;return{a:t,r:e,g:i,b:r}},HSVsplit(s){const t=at.Utils.RGBsplit(s);t.r/=255,t.g/=255,t.b/=255;const e=Math.max(t.r,t.g,t.b),i=Math.min(t.r,t.g,t.b);let r;const n=e,a=e-i,o=e==0?0:a/e;if(e==i)r=0;else{switch(e){case t.r:r=(t.g-t.b)/a+(t.g<t.b?6:0);break;case t.g:r=(t.b-t.r)/a+2;break;case t.b:r=(t.r-t.g)/a+4;break}r/=6}return{a:t.a,h:r,s:o,v:n}},HSVJoin(s){let t,e,i;const r=Math.floor(s.h*6),n=s.h*6-r,a=s.v*(1-s.s),o=s.v*(1-n*s.s),h=s.v*(1-(1-n)*s.s);switch(r%6){case 0:t=s.v,e=h,i=a;break;case 1:t=o,e=s.v,i=a;break;case 2:t=a,e=s.v,i=h;break;case 3:t=a,e=o,i=s.v;break;case 4:t=h,e=a,i=s.v;break;case 5:t=s.v,e=a,i=o;break}return s.a<<24|t<<16|e<<8|i},HCLSplit(s){const i=.530454533953517,r=at.Utils.RGBsplit(s),n={a:r.a,h:0,c:0,l:0};let a=0;const o=Math.min(r.r,Math.min(r.g,r.b)),h=Math.max(r.r,Math.max(r.g,r.b));let l=3/100;return n.c=h-o,n.c!=0&&(a=Math.atan2(r.g-r.b,r.r-r.g)/Math.PI,l*=o/h),l=Math.exp(l),n.h=(a/2-Math.min(a%1,-a%1)/6)%1,n.c*=l,n.l=at.Utils.Linear(-o,h,l)/(i*2),n},HCLJoin(s){const i=.530454533953517,r={a:s.a,r:0,g:0,b:0};if(s.l!=0){let n=s.h;const a=s.c,o=s.l*i,h=Math.exp((1-a/(2*o))*(3/100)),l=(2*o-a)/(2*h-1),c=a/h,u=(n+Math.min(2*n%1/4,-2*n%1/8))*Math.PI*2;let d;n*=6,n<=.999?(d=Math.tan(u),r.r=1,r.g=d/(1+d)):n<=1.001?(r.r=1,r.g=1):n<=2?(d=Math.tan(u),r.r=(1+d)/d,r.g=1):n<=3?(d=Math.tan(u),r.g=1,r.b=1+d):n<=3.999?(d=Math.tan(u),r.g=1/(1+d),r.b=1):n<=4.001?(r.g=0,r.b=1):n<=5?(d=Math.tan(u),r.r=-1/d,r.b=1):(d=Math.tan(u),r.r=1,r.b=-d),r.r=r.r*c+l,r.g=r.g*c+l,r.b=r.b*c+l}return r.a<<24|r.r<<16|r.g<<8|r.b},WrapLinear(s,t,e,i){let r;return s=(s+i*Math.trunc(Math.abs(s/i)))%i,t=(t+i*Math.trunc(Math.abs(t/i)))%i,Math.abs(s-t)<=.5*i?r=at.Utils.Linear(s,t,e):(s<t?r=at.Utils.Linear(s+i,t,e):r=at.Utils.Linear(s,t+i,e),r=r%i),r},RGBLinear(s,t,e){const i=at.Utils.RGBsplit(s),r=at.Utils.RGBsplit(t),n=at.Utils.Linear(i.a,r.a,e),a=at.Utils.Linear(i.r,r.r,e),o=at.Utils.Linear(i.g,r.g,e),h=at.Utils.Linear(i.b,r.b,e);return n<<24|a<<16|o<<8|h},HSVLinear(s,t,e){const i=at.Utils.HSVsplit(s),r=at.Utils.HSVsplit(t);let n;Math.abs(i.h-r.h)<=.5?n=at.Utils.Linear(i.h,r.h,e):(i.h<r.h?n=at.Utils.Linear(i.h+1,r.h,e):n=at.Utils.Linear(i.h,r.h+1,e),n=n%1);const a=at.Utils.Linear(i.s,r.s,e),o=at.Utils.Linear(i.v,r.v,e),h=at.Utils.Linear(i.a,r.a,e);return at.Utils.HSVJoin({a:h,h:n,s:a,v:o})},HCLLinear(s,t,e){const i=at.Utils.HCLSplit(s),r=at.Utils.HCLSplit(t);let n;Math.abs(i.h-r.h)<=.5?n=at.Utils.Linear(i.h,r.h,e):(i.h<r.h?n=at.Utils.Linear(i.h+1,r.h,e):n=at.Utils.Linear(i.h,r.h+1,e),n=n%1);const a=at.Utils.Linear(i.c,r.c,e),o=at.Utils.Linear(i.l,r.l,e),h=at.Utils.Linear(i.a,r.a,e);return at.Utils.HSVJoin({a:h,h:n,s:a,v:o})},Linear(s,t,e){return(t-s)*e+s},Bernstein(s,t){const e=at.Utils.Factorial;return e(s)/e(t)/e(s-t)},Factorial:function(){const s=[1];return function(t){let e=1;if(s[t])return s[t];for(let i=t;i>1;i--)e*=i;return s[t]=e,e}}(),CatmullRom(s,t,e,i,r){const n=(e-s)*.5,a=(i-t)*.5,o=r*r,h=r*o;return(2*t-2*e+n+a)*h+(-3*t+3*e-2*n-a)*o+n*r+t}}};class ih{static __initStatic(){this._nextId=0}static nextId(){return ih._nextId++}}ih.__initStatic();class Bt{__init(){this._isPaused=!1}__init2(){this._valuesStart={}}__init3(){this._valuesEnd={}}__init4(){this._valuesStartRepeat={}}__init5(){this._duration=0}__init6(){this._repeatCount=0}__init7(){this._repeat=0}__init8(){this._yoyo=!1}__init9(){this._isPlaying=!1}get _reversed(){return this.yoyo&&this._repeatCount%2!==0}__init10(){this._delayTime=0}__init11(){this._startTime=0}__init12(){this._elapsedTime=0}__init13(){this._timescale=1}__init14(){this._safetyCheckFunction=t=>!0}__init15(){this._easingFunction=Za.Linear.None}__init16(){this._yoyoEasingFunction=void 0}__init17(){this._interpolationFunction=at.Geom.Linear}__init18(){this._chainedTweens=[]}__init19(){this._onStartCallbackFired=!1}__init20(){this._onAfterDelayCallbackFired=!1}__init21(){this._id=ih.nextId()}__init22(){this._isChainStopped=!1}get _group(){return this._groupRef?this._groupRef:hi.shared}set _group(t){this._groupRef=t}constructor(t,e){Bt.prototype.__init.call(this),Bt.prototype.__init2.call(this),Bt.prototype.__init3.call(this),Bt.prototype.__init4.call(this),Bt.prototype.__init5.call(this),Bt.prototype.__init6.call(this),Bt.prototype.__init7.call(this),Bt.prototype.__init8.call(this),Bt.prototype.__init9.call(this),Bt.prototype.__init10.call(this),Bt.prototype.__init11.call(this),Bt.prototype.__init12.call(this),Bt.prototype.__init13.call(this),Bt.prototype.__init14.call(this),Bt.prototype.__init15.call(this),Bt.prototype.__init16.call(this),Bt.prototype.__init17.call(this),Bt.prototype.__init18.call(this),Bt.prototype.__init19.call(this),Bt.prototype.__init20.call(this),Bt.prototype.__init21.call(this),Bt.prototype.__init22.call(this),this._object=t,this._group=e}getId(){return this._id}getGroup(){return this._group}getTimescale(){return this._timescale}isPlaying(){return this._isPlaying}isPaused(){return this._isPaused}from(t){try{JSON.stringify(t)}catch{throw new Error("The object you provided to the from() method has a circular reference!")}return this._setupProperties(t,this._valuesStart,t,this._valuesStartRepeat,!0),this}to(t,e){try{this._valuesEnd=JSON.parse(JSON.stringify(t))}catch{return console.warn("The object you provided to the to() method has a circular reference!. It can't be cloned. Falling back to dynamic targeting"),this.dynamicTo(t,e)}return e!==void 0&&(this._duration=e),this}dynamicTo(t,e){return this._valuesEnd=t,e!==void 0&&(this._duration=e),this}duration(t){return this._duration=t,this}start(t){return this._isPlaying?this:(t!=null&&(this._delayTime=t),this._group.add(this),this._reversed&&(this._swapEndStartRepeatValues(this._valuesStartRepeat,this._valuesEnd),this._valuesStart=JSON.parse(JSON.stringify(this._valuesStartRepeat))),this._repeatCount=0,this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onAfterDelayCallbackFired=!1,this._isChainStopped=!1,this._startTime=-this._delayTime,this._elapsedTime=0,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,!1),this)}restart(t){return this.reset(),this.start(t)}reset(){return this._isPlaying&&this.stop(),this._valuesStart={},this._valuesStartRepeat={},this}rewind(){this._isPlaying&&this.stop(),this._reversed&&this._swapEndStartRepeatValues(this._valuesStartRepeat,this._valuesEnd);const t=this._easingFunction(0);return this._updateProperties(this._object,this._valuesStart,this._valuesEnd,t),this}_setupProperties(t,e,i,r,n){for(const a in i){const o=t[a],h=Array.isArray(o),l=!Number.isNaN(Number(o)),c=h?"array":typeof o,u=c=="object",d=typeof i[a]=="object",f=!h&&Array.isArray(i[a]);c=="undefined"||c=="function"||i[a]==null||!h&&!l&&!u||((u||h||d)&&o&&!f?(typeof e[a]>"u"&&(e[a]=h?[]:{}),typeof r[a]>"u"&&(r[a]=h?[]:{}),this._setupProperties(o,e[a],i[a],r[a],n)):((typeof e[a]>"u"||n)&&(e[a]=o),(typeof r[a]>"u"||n)&&(f?r[a]=i[a].slice().reverse()[0]:r[a]=e[a]||0)))}}stop(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object,this),this):this}end(t=!1){let e=[];if(t||(e=this._chainedTweens,this._chainedTweens=[]),this.resume(),this.update(1/0),!t){this._chainedTweens=e;for(let i=0,r=this._chainedTweens.length;i<r;i++)this._chainedTweens[i].start()}return this}skip(t,e=!1){return this.resume(),this.update(t*this._duration-(e?this._elapsedTime:0)),this}pause(){return this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._group.remove(this),this)}resume(){return!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._group.add(this),this)}stopChainedTweens(){for(let t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop();return this}startChainedTweens(t=!1){t&&this.stop();for(let e=0,i=this._chainedTweens.length;e<i;e++)this._chainedTweens[e].start();return this}group(t){return this._group=t,this}delay(t){return this._delayTime=t,this}timescale(t){return this._timescale=t,this}repeat(t=1/0){return this._repeat=t,this}repeatDelay(t){return this._repeatDelayTime=t,this}yoyo(t=!0){return this._yoyo=t,this}easing(t){return this._easingFunction=t,this}safetyCheck(t){return this._safetyCheckFunction=t,this}yoyoEasing(t){return this._yoyoEasingFunction=t,this}interpolation(t){return this._interpolationFunction=t,this}chain(...t){return this._chainedTweens=t,this}onStart(t){return this._onStartCallback=t,this}onAfterDelay(t){return this._onAfterDelayCallback=t,this}onUpdate(t){return this._onUpdateCallback=t,this}onRepeat(t){return this._onRepeatCallback=t,this}onComplete(t){return this._onCompleteCallback=t,this}onStop(t){return this._onStopCallback=t,this}update(t,e=!1){const i=this._internalUpdate(t);return!i&&!e&&this._group.remove(this),i}_internalUpdate(t){if(!this._safetyCheckFunction(this._object)||this._isPaused)return!1;t*=this._timescale;let e;this._elapsedTime+=t;const i=this._duration,r=this._startTime+this._elapsedTime;if(r>i&&!this._isPlaying)return!1;this.isPlaying||this.start(),this._onStartCallbackFired==!1&&(this._onStartCallback&&this._onStartCallback(this._object,this),this._onStartCallbackFired=!0),this._onAfterDelayCallbackFired==!1&&r>=0&&(this._onAfterDelayCallback&&this._onAfterDelayCallback(this._object,this),this._onAfterDelayCallbackFired=!0),e=r/this._duration,this._duration==0&&(r>=0?e=1:e=0),e=Math.min(1,e),e=Math.max(0,e);let n=Number.isFinite(r)?r%this._duration:r;Number.isNaN(n)&&(n=0);const a=Math.floor(r/this._duration);let o;if(this._reversed&&this._yoyoEasingFunction?o=this._yoyoEasingFunction(e):o=this._easingFunction(e),this._updateProperties(this._object,this._valuesStart,this._valuesEnd,o),this._onUpdateCallback&&(e!=1||this._repeat-this._repeatCount<=0)&&this._onUpdateCallback(this._object,e,this),e==1){if(this._repeat-this._repeatCount>0){const h=this._repeatCount;if(this._repeatCount=Math.min(this._repeat+1,this._repeatCount+a),this._onUpdateCallback&&(this._repeat-this._repeatCount<0||n<=0)&&this._onUpdateCallback(this._object,e,this),this._yoyo?this._swapEndStartRepeatValues(this._valuesStartRepeat,this._valuesEnd):this._moveForwardStartRepeatValues(this._valuesStartRepeat,this._valuesEnd),this._valuesStart=JSON.parse(JSON.stringify(this._valuesStartRepeat)),this._repeatDelayTime!==void 0?this._startTime=-this._repeatDelayTime:this._startTime=0,this._onRepeatCallback){let l=1;Number.isFinite(a)?l=this._repeatCount-h:Number.isFinite(this._repeat)&&(l=this._repeat-h);for(let c=0;c<l;c++)this._onRepeatCallback(this._object,h+1+c,this)}if(this._elapsedTime=0,this._repeat-this._repeatCount>=0)return n>0&&Number.isFinite(this._repeat)&&this._internalUpdate(n),!0}this._onCompleteCallback&&this._onCompleteCallback(this._object,this);for(let h=0,l=this._chainedTweens.length;h<l;h++)this._chainedTweens[h].start(),n>0&&this._chainedTweens[h].update(n);return this._isPlaying=!1,!1}return!0}_updateProperties(t,e,i,r){for(const n in i){if(e[n]==null)continue;const a=e[n];let o=i[n];const h=Array.isArray(t[n]),l=Array.isArray(o);!h&&l?this._reversed?t[n]=this._interpolationFunction(o.concat([a]),r):t[n]=this._interpolationFunction([a].concat(o),r):typeof o=="object"&&o?this._updateProperties(t[n],a,o,r):(o=this._handleRelativeValue(a,o),typeof o=="number"&&(typeof a=="number"||typeof a=="string")&&(t[n]=Number(a)+(o-Number(a))*r,typeof a=="string"&&(t[n]=String(t[n]))))}}_handleRelativeValue(t,e){return typeof e!="string"?e:e.charAt(0)=="+"||e.charAt(0)=="-"?t+Number(e):Number(e)}_swapEndStartRepeatValues(t,e){for(const i in t){const r=!Array.isArray(t[i])&&Array.isArray(e[i]);if(typeof t[i]=="object")this._swapEndStartRepeatValues(t[i],e[i]);else{const n=t[i];if(typeof e[i]=="string")t[i]=Number(t[i])+Number(e[i]),e[i]=n;else if(r){const a=e[i].slice().reverse();t[i]=a[0],e[i]=a}else t[i]=e[i],e[i]=n}}}_moveForwardStartRepeatValues(t,e){for(const i in t)typeof e[i]=="object"?this._moveForwardStartRepeatValues(t[i],e[i]):typeof e[i]=="string"&&(t[i]=Number(t[i])+Number(e[i]))}}class sh extends W{constructor({defaultView:e,hoverView:i,pressedView:r,disabledView:n,text:a,padding:o,offset:h,textOffset:l,iconOffset:c,scale:u,anchor:d,anchorX:f,anchorY:p,icon:m,animations:g}){super();A(this,"events");A(this,"animations");A(this,"originalInnerViewState");A(this,"defaultDuration",100);A(this,"padding");A(this,"offset");A(this,"textOffset");A(this,"iconOffset");A(this,"innerView");A(this,"_views",{});A(this,"state");A(this,"anchor");A(this,"onDown");A(this,"onUp");A(this,"onUpOut");A(this,"onOut");A(this,"onPress");A(this,"onHover");this.innerView=new W,this.addChild(this.innerView),this.anchor=new ye({onUpdate:()=>{this.updateAnchor()}}),this.anchor.set(f??d??0,p??d??0),this.padding=o??0,this.offset=h,this.textOffset=l,this.iconOffset=c,this.scale.set(u??1),g&&(this.animations=g,ts.shared.add(()=>hi.shared.update())),this.views={defaultView:e,hoverView:i,pressedView:r,disabledView:n,text:a,icon:m},this.setState("default"),this.addEvents()}set text(e){if(!e||e===0){this.innerView.removeChild(this._views.text),this._views.text=null;return}if(!this._views.text){this.createTextView(e);return}this._views.text.text=e.toString()}get text(){var e;return(e=this._views.text)==null?void 0:e.text}set enabled(e){this.events.enabled=e,this.setState(e?"default":"disabled")}get enabled(){return this.events.enabled}setState(e){if(this.state===e)return;const i=this.getStateView(this.state),r=this.getStateView(e);i&&(i.visible=!1),this.state=e,r&&(this.setOffset(r,e,this.offset),r.visible=!0),this.updateAnchor(),this.playAnimations(e)}createTextView(e){this._views.text||(this._views.text=Bk(e),this._views.text.anchor.set(0),this.innerView.addChild(this._views.text)),this.adjustTextView(this.state)}setOffset(e,i,r){const n=r?r[i]:{x:0,y:0},a=r==null?void 0:r.default;n?(e.x+=n.x??0,e.y+=n.y??0):a?(e.x+=a.x??0,e.y+=a.y??0):(r.x||r.y)&&(e.x+=r.x??0,e.y+=r.y??0)}getStateView(e){const{default:i,hover:r,pressed:n,disabled:a}=this._views;switch(e){case"hover":return r??i;case"pressed":return n??r??i;case"disabled":return a??i;case"default":return i;default:return}}adjustTextView(e){if(!this.text)return;const i=this.getStateView(this.state);i&&(np(i,this._views.text,this.padding),this._views.text.x=i.x+i.width/2,this._views.text.y=i.y+i.height/2),this._views.text.anchor.set(.5),this.setOffset(this._views.text,e,this.textOffset)}adjustIconView(e){var r;if(!this._views.icon)return;const i=this.getStateView(e);np(i,this._views.icon,this.padding),(r=this._views.icon.anchor)==null||r.set(0),this._views.icon.x=i.x+i.width/2-this._views.icon.width/2,this._views.icon.y=i.y+i.height/2-this._views.icon.height/2,this.setOffset(this._views.icon,e,this.iconOffset)}updateAnchor(){const e=this.anchor.x??0,i=this.anchor.y??0;if([this._views.default,this._views.hover,this._views.pressed,this._views.disabled].forEach(n=>{var a;n&&((a=n.anchor)==null||a.set(0),n.x=-n.width*e,n.y=-n.height*i)}),this._views.default){const{x:n,y:a,width:o,height:h}=this._views.default;this.hitArea=new Zt(n,a,o,h)}this.adjustIconView(this.state),this.adjustTextView(this.state)}set views(e){console.log("_________________________",e);const{defaultView:i,hoverView:r,pressedView:n,disabledView:a,text:o,icon:h}=e;if(i){if(console.log("defaultView",i),this._views.default=ps(i),console.log("this._views.default",this._views.default),this._views.default===void 0)throw new Error(`View ${i} not found`);this.setOffset(this._views.default,"default",this.offset),this._views.default.parent||this.innerView.addChild(this._views.default)}else i===null&&this._views.default&&(this.innerView.removeChild(this._views.default),this._views.default=null);r?(this._views.hover=ps(r),this._views.hover.parent||this.innerView.addChild(this._views.hover),this._views.hover.visible=!1):r===null&&this._views.hover&&(this.innerView.removeChild(this._views.hover),this._views.hover=null),n?(this._views.pressed=ps(n),this._views.pressed.parent||this.innerView.addChild(this._views.pressed),this._views.pressed.visible=!1):n===null&&this._views.pressed&&(this.innerView.removeChild(this._views.pressed),this._views.pressed=null),a?(this._views.disabled=ps(a),this._views.disabled.parent||this.innerView.addChild(this._views.disabled),this._views.disabled.visible=!1):a===null&&this._views.disabled&&(this.innerView.removeChild(this._views.disabled),this._views.disabled=null),h?(this._views.icon=ps(h),this._views.icon.parent||this.innerView.addChild(this._views.icon)):h===null&&this._views.icon&&(this.innerView.removeChild(this._views.icon),this._views.icon=null),o?this.createTextView(o):o===null&&this._views.text&&(this.innerView.removeChild(this._views.text),this._views.text=null)}addEvents(){this.events=new fy(this),this.onDown=new ge.Signal,this.onUp=new ge.Signal,this.onUpOut=new ge.Signal,this.onOut=new ge.Signal,this.onPress=new ge.Signal,this.onHover=new ge.Signal,this.events.onDown.connect((e,i)=>{this.onDown.emit(this,i),this.down(),this.setState("pressed")}),this.events.onUp.connect((e,i)=>{this.onUp.emit(this,i),this.up(),za.any?this.setState("default"):this.setState("hover")}),this.events.onUpOut.connect((e,i)=>{this.onUpOut.emit(this,i),this.upOut(),this.setState("default")}),this.events.onOut.connect((e,i)=>{this.onOut.emit(this,i),this.out(),this.events.isDown||this.setState("default")}),this.events.onPress.connect((e,i)=>{this.onPress.emit(this,i),this.press(),za.any?this.setState("default"):this.setState("hover")}),this.events.onHover.connect((e,i)=>{this.onHover.emit(this,i),this.hover(),this.events.isDown||(za.any?this.setState("default"):this.setState("hover"))})}playAnimations(e){var r;if(!this.animations)return;if(e==="default"&&!this.originalInnerViewState){this.originalInnerViewState={x:this.innerView.x,y:this.innerView.y,width:this.innerView.width,height:this.innerView.height,scale:{x:this.innerView.scale.x,y:this.innerView.scale.y}};const n=(r=this.animations)==null?void 0:r.default;if(n){this.innerView.x=n.props.x??this.originalInnerViewState.x,this.innerView.y=n.props.y??this.originalInnerViewState.y,this.innerView.width=n.props.width??this.originalInnerViewState.width,this.innerView.height=n.props.height??this.originalInnerViewState.height,this.innerView.scale.x=n.props.scale.x??this.originalInnerViewState.scale.x,this.innerView.scale.y=n.props.scale.y??this.originalInnerViewState.scale.y;return}}const i=this.animations[e]??this.animations.default;if(i){const n=i;this.defaultDuration=n.duration,new Bt(this.innerView).to(n.props,n.duration).start();return}new Bt(this.innerView).to(this.originalInnerViewState,this.defaultDuration).start()}down(e){}up(e){}upOut(e){}out(e){}press(e){}hover(e){}}class Ik extends W{constructor(e){super();A(this,"options");A(this,"view");A(this,"_type");A(this,"children",[]);e&&this.init(e),this.on("added",()=>this.arrangeChildren()),this.on("childAdded",()=>this.arrangeChildren())}init(e){this.options=e,e!=null&&e.type&&(this.type=e.type),e!=null&&e.children&&e.children.forEach(i=>this.addChild(i))}set type(e){this._type=e,this.arrangeChildren()}get type(){return this._type}set elementsMargin(e){this.options.elementsMargin=e,this.arrangeChildren()}get elementsMargin(){return this.options.elementsMargin}set vertPadding(e){this.options.vertPadding=e,this.arrangeChildren()}get vertPadding(){return this.options.vertPadding}set horPadding(e){this.options.horPadding=e,this.arrangeChildren()}get horPadding(){return this.options.horPadding}arrangeChildren(){var a,o,h,l,c;let e=((a=this.options)==null?void 0:a.horPadding)??0,i=((o=this.options)==null?void 0:o.vertPadding)??0;const r=((h=this.options)==null?void 0:h.elementsMargin)??0;let n=(l=this.parent)==null?void 0:l.width;(c=this.options)!=null&&c.horPadding&&(n-=this.options.horPadding),this.children.forEach((u,d)=>{var f;switch(this.type){case"vertical":u.y=i,u.x=e,i+=r+u.height;break;case"horizontal":u.x=e,u.y=i,e+=r+u.width;break;default:u.x=e,u.y=i,u.x+u.width>=n&&d>0&&(i+=r+u.height,e=((f=this.options)==null?void 0:f.horPadding)??0,u.x=e,u.y=i),e+=r+u.width;break}})}}class Fk extends W{constructor(e){super();A(this,"items",[]);A(this,"innerView");A(this,"value");A(this,"selected");A(this,"onChange");A(this,"options");e&&this.init(e),this.onChange=new ge.Signal}init(e){this.options=e,this.value=e.items[e.selectedItem||0].label.text,this.selected=e.selectedItem??0,this.innerView?(this.innerView.type=e.type,this.innerView.elementsMargin=e.elementsMargin):this.innerView=new Ik({type:e.type,elementsMargin:e.elementsMargin}),this.addItems(e.items),this.addChild(this.innerView),this.selectItem(this.selected)}addItems(e){e.forEach((i,r)=>{i.onChange.connect(()=>this.selectItem(r)),this.items.push(i),this.innerView.addChild(i)})}removeItems(e){e.forEach(i=>{const r=this.items[i];r&&(r.onChange.disconnectAll(),this.innerView.removeChild(r),this.items.splice(i,1))})}selectItem(e){this.items.forEach((i,r)=>{i.forceCheck(r===e)}),this.selected!==e&&this.onChange.emit(e,this.items[e].label.text),this.value=this.options.items[e].label.text,this.selected=e}}class Uk extends Rk{constructor(e){super({bg:e.bg,slider1:e.slider,fill:e.fill??"",min:e.min,max:e.max,value1:e.value,valueTextStyle:e.valueTextStyle,showValue:e.showValue,valueTextOffset:e.valueTextOffset,fillOffset:e.fillOffset});A(this,"options");A(this,"onUpdate",new ge.Signal);A(this,"onChange",new ge.Signal);this.options=e,this.progress=((e.value??this.min)-this.min)/(this.max-this.min)*100,this.value=e.value??this.min}get value(){return this._value1}set value(e){var i;e!==this._value1&&(e<this.min&&(e=this.min),e>this.max&&(e=this.max),this._value1=e,this.updateSlider(),(i=this.onUpdate)==null||i.emit(this.value))}set slider(e){this.slider1=e,this.updateSlider()}update(e){if(!this.dragging)return;const i=e.currentTarget,{x:r}=i.parent.worldTransform.applyInverse(e.global);this.progress=this.validate(r/this.bg.width*100),this.value=this.min+(this.max-this.min)/100*this.progress}change(){var e;(e=this.onChange)==null||e.emit(this.value)}updateSlider(){var e,i;if(this._slider1.x=(this.bg.width-this._slider1.width)/100*this.progress,this.options.showValue){this.value1Text.text=`${Math.round(this.value)}`;const r=this._slider1.x+this._slider1.width/2,n=this._slider1.y;this.value1Text.x=r+(((e=this.options.valueTextOffset)==null?void 0:e.x)??0),this.value1Text.y=n+(((i=this.options.valueTextOffset)==null?void 0:i.y)??0)}}}const Lk={text:"",width:301,height:112};class ua extends sh{constructor(e={}){const i={...Lk,...e},r=new pi({texture:j.from("button-large"),leftWidth:36,topHeight:42,rightWidth:36,bottomHeight:52});r.width=i.width,r.height=i.height;const n=new pi({texture:j.from("button-large-hover"),leftWidth:36,topHeight:42,rightWidth:36,bottomHeight:52});new pi(j.from("button-large-hover"),36,42,36,52),n.width=i.width,n.height=i.height;const a=new pi({texture:j.from("button-large-press"),leftWidth:36,topHeight:42,rightWidth:36,bottomHeight:52});a.width=i.width,a.height=i.height;super({defaultView:r,hoverView:n,pressedView:a,anchor:.5});A(this,"label");this.label=new pe(i.text,{fill:4868682,align:"center"}),this.label.y=-13,this.addChild(this.label),this.onDown.connect(this.handleDown.bind(this)),this.onUp.connect(this.handleUp.bind(this)),this.onHover.connect(this.handleHover.bind(this)),this.on("pointerupoutside",this.handleUp.bind(this)),this.on("pointerout",this.handleUp.bind(this))}handleHover(){Pt.play("common/sfx-hover.wav")}handleDown(){Pt.play("common/sfx-press.wav"),this.label.y=-5}handleUp(){this.label.y=-13}async show(e=!0){P.killTweensOf(this.pivot),this.visible=!0,e?(this.pivot.y=-200,await P.to(this.pivot,{y:0,duration:.5,ease:"back.out"})):this.pivot.y=0,this.interactiveChildren=!0}async hide(e=!0){this.interactiveChildren=!1,P.killTweensOf(this.pivot),e?await P.to(this.pivot,{y:-200,duration:.3,ease:"back.in"}):this.pivot.y=-200,this.visible=!1}}const Ok={width:130,height:10,color:16777215,circleSize:40};class rh extends W{constructor(e={}){super();A(this,"options");A(this,"base");A(this,"bottom");A(this,"top");A(this,"circlesPool",[]);A(this,"circles",[]);this.options={...Ok,...e},this.base=lt.from(j.WHITE),this.base.tint=this.options.color,this.base.anchor.set(.5),this.addChild(this.base),this.bottom=new W,this.addChild(this.bottom),this.top=new W,this.addChild(this.top),this.width=this.options.width,this.height=this.options.height,this.onRender=()=>{const i=Ct.ticker.deltaTime;for(const r of this.circles)r.update(i)}}get width(){return this.base.width}set width(e){this.base.width=e,this.rebuildCircles()}get height(){return this.base.height}set height(e){this.base.height=e,this.top.y=-e*.5,this.bottom.y=e*.5}getCircle(){let e=this.circlesPool.pop();return e||(e=new Nk,e.tint=this.options.color),e.step=Math.random()*100,e.speed=Math.random()*.5+.5,e}releaseCircle(e){this.circlesPool.includes(e)||this.circlesPool.push(e)}rebuildCircles(){for(const e of this.circles)this.bottom.removeChild(e),this.top.removeChild(e),this.releaseCircle(e);this.circles.length=0,this.fillCircles(this.bottom,this.base.width,this.options.circleSize),this.fillCircles(this.top,this.base.width,this.options.circleSize)}fillCircles(e,i,r){const n=r*.4,a=Math.ceil(i/n),o=(a-1)*n/2;for(let h=0;h<a;h++){const l=this.getCircle();l.x=n*h-o,l.size=r,e.addChild(l),this.circles.push(l)}}async playFormAnimation(e=1){const i="expo.out";this.alpha=0,P.to(this,{alpha:1,duration:.1,ease:"linear"});for(const a of this.circles)a.pivot.x=Lt(-200,200),a.pivot.y=Lt(-200,200),a.scale.set(0),a.alpha=1,P.to(a.scale,{x:1,y:1,duration:e,ease:i}),P.to(a.pivot,{x:0,y:0,duration:e,ease:i});this.top.pivot.y=this.top.y,P.to(this.top.pivot,{y:0,duration:e,ease:i}),this.bottom.pivot.y=this.bottom.y,P.to(this.bottom.pivot,{y:0,duration:e,ease:i});const r=this.base.width,n=this.base.height;this.base.width=0,this.base.height=0,this.base.alpha=0,P.to(this.base,{alpha:1,duration:e,ease:i}),await P.to(this.base,{width:r,height:n,duration:e,ease:i})}async playDismissAnimation(e=1){const i="expo.in";for(const r of this.circles)P.to(r.pivot,{x:Lt(-500,500),y:Lt(-500,500),duration:e,ease:i}),P.to(r.scale,{x:.2,y:.2,duration:e,ease:i}),P.to(r,{alpha:0,duration:e,ease:i});P.to(this.base,{alpha:0,duration:e*.5,ease:i}),await P.to(this.base,{duration:e})}}class Nk extends W{constructor(){super();A(this,"step",0);A(this,"size",100);A(this,"speed",1);A(this,"image");this.image=lt.from("circle"),this.image.anchor.set(.5),this.addChild(this.image)}update(e){this.step+=e*.1*this.speed;const i=this.size+Math.sin(this.step)*this.size*.25;this.image.width=i,this.image.height=i}get tint(){return this.image.tint}set tint(e){this.image.tint=e}}const Dk={color:2888556,labelColor:16777215};class wc extends W{constructor(e={}){super();A(this,"container");A(this,"cloud");A(this,"label");A(this,"showing",!0);const i={...Dk,...e};this.container=new W,this.addChild(this.container),this.cloud=new rh({color:i.color,width:120,height:10,circleSize:30}),this.container.addChild(this.cloud),this.label=new pe("",{fill:i.labelColor,fontSize:18}),this.container.addChild(this.label)}get text(){return this.label.text}set text(e){this.label.text=e}async show(e=!0){this.showing||(this.showing=!0,this.visible=!0,this.killTweens(),e?(this.cloud.playFormAnimation(1*.5),this.container.alpha=0,this.label.scale.set(3),this.container.scale.set(.5),P.to(this.container,{alpha:1,duration:1*.5,ease:"linear"}),P.to(this.label.scale,{x:1,y:1,duration:1,ease:"expo.out"}),await P.to(this.container.scale,{x:1,y:1,duration:1,ease:"expo.out"})):(this.container.alpha=1,this.label.alpha=1,this.label.scale.set(1)))}async hide(e=!0){this.showing&&(this.showing=!1,this.killTweens(),e&&(this.cloud.playDismissAnimation(.3),await P.to(this.container,{alpha:0,duration:.3,ease:"linear"})),this.visible=!1)}killTweens(){P.killTweensOf(this.container),P.killTweensOf(this.container.scale),P.killTweensOf(this.label),P.killTweensOf(this.label.scale)}}const gl={};function _u(s,t,e){gl[s]||(e(),gl[s]=setTimeout(()=>delete gl[s],t))}class ap extends W{constructor(e=16777215){super();A(this,"label");this.label=new pe("",{fill:e}),this.addChild(this.label)}async show(e=!0){P.killTweensOf(this.label),this.visible=!0,e?(this.label.scale.set(0),this.label.text=0+mt.pointsSuffix,await P.to(this.label.scale,{x:1,y:1,duration:.3,ease:"back.out"})):(this.label.text=0+mt.pointsSuffix,this.label.scale.set(1))}setText(e,i=1){this.label.text!==e&&(this.label.text=e,_u("score",100,()=>{Pt.play("common/sfx-points.wav",{speed:i,volume:.3})}))}async playScore(e){if(this.label.text=0+mt.pointsSuffix,e===0)return;const i={points:0};await P.to(i,{points:e,duration:2,ease:"linear",onUpdate:()=>{const r=Math.round(i.points),n=.9+Math.min(1,r*5e-4);this.setText(r+mt.pointsSuffix,n)}})}}const Gk={image:"",ripple:""};class ra extends sh{constructor(e={}){const i={...Gk,...e},r=lt.from(i.image);super({defaultView:r,anchor:.5});A(this,"image");A(this,"ripple");A(this,"ripplePool",[]);this.image=r,this.image.interactiveChildren=!1,this.ripple=i.ripple,this.onHover.connect(this.handleHover.bind(this)),this.onOut.connect(this.handleOut.bind(this)),this.onDown.connect(this.handleDown.bind(this))}handleHover(){Pt.play("common/sfx-hover.wav"),P.to(this.scale,{x:1.2,y:1.2,duration:.2,ease:"back.out"})}handleOut(){P.to(this.scale,{x:1,y:1,duration:.2,ease:"back.out"})}handleDown(){Pt.play("common/sfx-press.wav"),this.playRipples()}async show(e=!0){P.killTweensOf(this.scale),P.killTweensOf(this.image),this.visible=!0,this.interactive=!0,e?(this.image.alpha=0,this.scale.set(1.5),P.to(this.image,{alpha:1,duration:.3,ease:"linear"}),await P.to(this.scale,{x:1,y:1,duration:.3,ease:"sine.out"})):(this.image.alpha=1,this.scale.set(1))}async hide(e=!0){this.interactive=!1,P.killTweensOf(this.scale),P.killTweensOf(this.image),e?(P.to(this.image,{alpha:0,duration:.3,ease:"linear"}),await P.to(this.scale,{x:1.5,y:1.5,duration:.3,ease:"sine.out"})):(this.image.alpha=0,this.scale.set(0)),this.visible=!1}async playRipples(e=3){for(let i=0;i<e;i++)this.playRipple(),await gi(.2)}async playRipple(){const e=this.ripplePool.pop()??new lt;P.killTweensOf(e.scale),P.killTweensOf(e),e.texture=j.from(this.ripple),e.anchor.set(.5),e.scale.set(1),e.alpha=.5,this.addChild(e),P.to(e.scale,{x:3,y:3,duration:.6,ease:"linear"}),await P.to(e,{alpha:0,duration:.6,ease:"linear"}),this.removeChild(e),this.ripplePool.push(e)}}const Vk={color:2888556,width:350,height:600,shadow:!0,shadowColor:655397,shadowOffset:22};class wu extends W{constructor(e={}){super();A(this,"image");A(this,"shadow");const i={...Vk,...e},r={texture:j.from("rounded-rectangle"),leftWidth:34,topHeight:34,rightWidth:34,bottomHeight:34};this.image=new pi(r),this.image.width=i.width,this.image.height=i.height,this.image.tint=i.color,this.image.x=-this.image.width*.5,this.image.y=-this.image.height*.5,this.addChild(this.image),i.shadow&&(this.shadow=new pi(r),this.shadow.width=i.width,this.shadow.height=i.height,this.shadow.tint=i.shadowColor,this.shadow.x=-this.shadow.width*.5,this.shadow.y=-this.shadow.height*.5+i.shadowOffset,this.addChildAt(this.shadow,0))}get boxWidth(){return this.image.width}get boxHeight(){return this.image.height}}class zk{getString(t){return localStorage.getItem(t)??void 0}setString(t,e){localStorage.setItem(t,e)}getNumber(t){const e=this.getString(t)??void 0,i=Number(e);return isNaN(i)?null:i}setNumber(t,e){this.setString(t,String(e))}getBool(t){const e=localStorage.getItem(t);return e?Boolean(e.toLowerCase()):void 0}setBool(t,e){localStorage.setItem(t,String(e))}getObject(t){const e=this.getString(t);if(e)try{return JSON.parse(e)}catch(i){console.warn(i);return}}setObject(t,e){this.setString(t,JSON.stringify(e))}}const $e=new zk,op="volume-master",hp="volume-bgm",lp="volume-sfx",cp="game-mode";class Hk{constructor(){tp(this.getMasterVolume()),Mo.setVolume(this.getBgmVolume()),Pt.setVolume(this.getSfxVolume())}getGameMode(){const t=$e.getString(cp);return nf.includes(t)?t:"normal"}setGameMode(t){if(!nf.includes(t))throw new Error("Invalid game mode: "+t);return $e.setString(cp,t)}getMasterVolume(){return $e.getNumber(op)??.5}setMasterVolume(t){tp(t),$e.setNumber(op,t)}getBgmVolume(){return $e.getNumber(hp)??1}setBgmVolume(t){Mo.setVolume(t),$e.setNumber(hp,t)}getSfxVolume(){return $e.getNumber(lp)??1}setSfxVolume(t){Pt.setVolume(t),$e.setNumber(lp,t)}}const We=new Hk;class bl extends Uk{constructor(e,i=-.1,r=100,n=100){const g=new kn(new Fi().roundRect(0,0,280,20,10).fill(13585152).roundRect(4,4,272,12,10).fill(13585152)),x=new kn(new Fi().roundRect(0,0,280,20,10).fill(13585152).roundRect(4,4,280-4*2,20-4*2,10).fill(16744993)),y=new kn(new Fi().circle(0,0,14+4).fill(13585152).circle(0,0,14).fill(16766329));super({bg:g,fill:x,slider:y,min:i,max:r});A(this,"label");this.value=n,this.label=new pe(e,{align:"left",fill:16777215,fontSize:18}),this.label.anchor.x=0,this.label.x=10,this.label.y=-18,this.addChild(this.label)}}const yl=[{mode:"easy",text:mt.easyMode},{mode:"normal",text:mt.normalMode},{mode:"hard",text:mt.hardMode}];class Xk extends Fk{constructor(){super({selectedItem:0,items:yl.map(o=>o.text),type:"vertical",elementsMargin:10,style:{bg:{color:13585152,width:36,height:36,padding:4,radius:18},checked:{color:13585152,fillColor:16766329,width:36,height:36,padding:4,radius:18},textStyle:{fontFamily:"Arial Rounded MT Bold",fontSize:20,fill:16777215}}}),this.addChild(this.innerView),this.onChange.connect(()=>{Pt.play("common/sfx-press.wav")})}getSelectedMode(){return yl[this.selected].mode}setSelectedMode(t){const e=yl.findIndex(i=>i.mode===t);e>=0&&this.selectItem(e)}selectItem(t){this.items.forEach((i,r)=>{i.forceCheck(r===t)}),this.value=this.options.items[t];const e=this.selected!==t;this.selected=t,e&&this.onChange.emit(t,this.value)}}class Tu extends W{constructor(){super();A(this,"bg");A(this,"panel");A(this,"title");A(this,"doneButton");A(this,"panelBase");A(this,"versionLabel");A(this,"layout");A(this,"masterSlider");A(this,"bgmSlider");A(this,"sfxSlider");A(this,"mode");this.bg=lt.from(j.WHITE),this.bg.tint=655397,this.bg.interactive=!0,this.addChild(this.bg),this.panel=new W,this.addChild(this.panel),this.panelBase=new wu({height:600}),this.panel.addChild(this.panelBase),this.title=new pe(mt.settingsTitle,{fill:16766329,fontSize:50}),this.title.y=-this.panelBase.boxHeight*.5+60,this.panel.addChild(this.title),this.doneButton=new ua({text:mt.settingsDone}),this.doneButton.y=this.panelBase.boxHeight*.5-78,this.doneButton.onPress.connect(()=>et.dismissPopup()),this.panel.addChild(this.doneButton),this.versionLabel=new pe(`${mt.settingsVersion} 0.0.1`,{fill:16777215,fontSize:12}),this.versionLabel.alpha=.5,this.versionLabel.y=this.panelBase.boxHeight*.5-15,this.panel.addChild(this.versionLabel),this.layout=new W,this.layout.x=-140,this.layout.y=-160,this.panel.addChild(this.layout),this.masterSlider=new bl(mt.settingsMaster),this.masterSlider.onUpdate.connect(e=>{We.setMasterVolume(e/100)}),this.layout.addChild(this.masterSlider),this.bgmSlider=new bl(mt.settingsBgm),this.bgmSlider.onUpdate.connect(e=>{We.setBgmVolume(e/100)}),this.layout.addChild(this.bgmSlider),this.sfxSlider=new bl(mt.settingsSfx),this.sfxSlider.onUpdate.connect(e=>{We.setSfxVolume(e/100)}),this.layout.addChild(this.sfxSlider),this.mode=new Xk,this.mode.onChange.connect(()=>{We.setGameMode(this.mode.getSelectedMode())}),this.layout.addChild(this.mode),this.mode.y-=20}resize(e,i){this.bg.width=e,this.bg.height=i,this.panel.x=e*.5,this.panel.y=i*.5}prepare(){const e=!(et.currentScreen instanceof da);this.mode.alpha=e?1:.3,this.mode.interactiveChildren=e,this.masterSlider.value=We.getMasterVolume()*100,this.bgmSlider.value=We.getBgmVolume()*100,this.sfxSlider.value=We.getSfxVolume()*100,this.mode.setSelectedMode(We.getGameMode())}async show(){et.currentScreen&&(et.currentScreen.filters=[new No(5)]),P.killTweensOf(this.bg),P.killTweensOf(this.panel.pivot),this.bg.alpha=0,this.panel.pivot.y=-400,P.to(this.bg,{alpha:.8,duration:.2,ease:"linear"}),await P.to(this.panel.pivot,{y:0,duration:.3,ease:"back.out"})}async hide(){et.currentScreen&&(et.currentScreen.filters=null),P.killTweensOf(this.bg),P.killTweensOf(this.panel.pivot),P.to(this.bg,{alpha:0,duration:.2,ease:"linear"}),await P.to(this.panel.pivot,{y:-500,duration:.3,ease:"back.in"})}}class $k{constructor(){A(this,"base");A(this,"cauldron");this.base=lt.from(j.WHITE),this.base.tint=2888556,this.cauldron=lt.from("white-cauldron"),this.cauldron.anchor.set(.5)}resize(){this.base.width=et.width,this.base.height=et.height,this.cauldron.x=et.width*.5,this.cauldron.y=et.height*.5}async playTransitionOut(){this.resize(),this.cauldron.scale.set(20),this.cauldron.rotation=.5,this.cauldron.alpha=1,Ct.stage.addChildAt(this.base,0),Ct.stage.addChildAt(this.cauldron,0),et.container.mask=this.cauldron,et.container.interactiveChildren=!1,P.to(this.cauldron,{alpha:.5,rotation:-.5,duration:.7,ease:"sine.out"}),await P.to(this.cauldron.scale,{x:0,y:0,duration:.7,ease:"quint.out"}),et.container.interactiveChildren=!0,et.container.mask=null,Ct.stage.removeChild(this.base),Ct.stage.removeChild(this.cauldron)}async playTransitionIn(){this.resize(),this.cauldron.scale.set(.001),this.cauldron.rotation=-.5,this.cauldron.alpha=.5,Ct.stage.addChildAt(this.base,0),Ct.stage.addChildAt(this.cauldron,0),et.container.mask=this.cauldron,et.container.interactiveChildren=!1,P.to(this.cauldron,{alpha:1,rotation:.5,duration:.7,ease:"sine.in"}),await P.to(this.cauldron.scale,{x:30,y:30,duration:.7,ease:"quint.in"}),et.container.interactiveChildren=!0,et.container.mask=null,Ct.stage.removeChild(this.base),Ct.stage.removeChild(this.cauldron)}}const up="stats-",dp="stats-best-score-";class Wk{load(t){const e=$e.getObject(up+t);return e||{score:0,matches:0,pops:0,specials:0,grade:0}}save(t,e){e.score>this.loadBestScore(t)&&$e.setNumber(dp+t,e.score),$e.setObject(up+t,e)}loadBestScore(t){return $e.getNumber(dp+t)??0}}const Tc=new Wk;class py extends W{constructor(){super();A(this,"spine");A(this,"container");this.container=new W,this.addChild(this.container),console.log(Ri.cache),this.spine=Ei.from("common/dragon-skeleton.json","common/dragon-skeleton.atlas",{scale:1}),this.spine.autoUpdate=!0,this.spine.scale.set(.3),this.spine.x=-30,this.spine.y=130,this.container.addChild(this.spine),this.playIdle()}playIdle(){this.spine.state.setAnimation(0,"dragon-idle",!0)}playBubbles(){this.spine.state.setAnimation(0,"dragon-bubbles",!0)}playTransition(){this.spine.state.setAnimation(0,"dragon-transition",!0)}async show(e=!0){P.killTweensOf(this.container.scale),this.visible=!0,e?(this.container.scale.set(0),await P.to(this.container.scale,{x:1,y:1,duration:.3,ease:"back.out"})):this.container.scale.set(1)}async hide(e=!0){P.killTweensOf(this.container.scale),e?await P.to(this.container.scale,{x:0,y:0,duration:.3,ease:"back.in"}):this.container.scale.set(0),this.visible=!1}}class Su extends W{constructor(){super();A(this,"panel");A(this,"dragon");A(this,"panelBase");A(this,"title");A(this,"mode");A(this,"cauldron");A(this,"message");A(this,"score");A(this,"bestScore");A(this,"stars");A(this,"bottomBase");A(this,"continueButton");A(this,"settingsButton");A(this,"maskTransition");this.settingsButton=new ra({image:"icon-settings",ripple:"icon-settings-stroke"}),this.settingsButton.onPress.connect(()=>et.presentPopup(Tu)),this.dragon=new py,this.dragon.playTransition(),this.addChild(this.dragon),this.panel=new W,this.addChild(this.panel),this.panelBase=lt.from("result-base"),this.panelBase.anchor.set(.5),this.panel.addChild(this.panelBase),this.title=new pe("",{fill:16777215}),this.title.y=-160,this.panel.addChild(this.title),this.mode=new pe("",{fill:16777215,fontSize:12}),this.mode.y=-140,this.mode.alpha=.5,this.panel.addChild(this.mode),this.cauldron=lt.from("white-cauldron"),this.cauldron.anchor.set(.5),this.cauldron.y=145,this.panel.addChild(this.cauldron),this.message=new wc({color:16777215,labelColor:2888556}),this.message.y=-95,this.panel.addChild(this.message),this.score=new ap,this.score.y=60,this.panel.addChild(this.score),this.bestScore=new ap(16766329),this.bestScore.y=90,this.bestScore.scale.set(.7),this.panel.addChild(this.bestScore),this.stars=new ak,this.stars.y=-10,this.panel.addChild(this.stars);const e=j.from("rounded-rectangle");this.bottomBase=new pi({texture:e,leftWidth:32,topHeight:32,rightWidth:32,bottomHeight:32}),this.bottomBase.label="bottomBase",this.bottomBase.tint=2888556,this.bottomBase.height=200,this.addChild(this.bottomBase),this.continueButton=new ua({text:mt.resultPlay}),this.addChild(this.continueButton),this.continueButton.onPress.connect(()=>et.showScreen(da)),this.maskTransition=new $k}prepare(){this.bottomBase.visible=!1,this.continueButton.visible=!1,this.panel.visible=!1,this.dragon.visible=!1,this.score.visible=!1,this.bestScore.visible=!1,this.message.hide(!1),this.stars.hide(!1),this.title.text=`${mt.resultTitle}`;const e=We.getGameMode(),i=mt[e+"Mode"];this.mode.text=`${i}`}resize(e,i){this.dragon.x=e*.5+20,this.dragon.y=i*.5-210,this.panel.x=e*.5,this.panel.y=i*.5,this.continueButton.x=e*.5,this.continueButton.y=i-90,this.bottomBase.width=e,this.bottomBase.y=i-100,this.settingsButton.x=e-30,this.settingsButton.y=30}async show(){var r;Mo.play("common/bgm-main.mp3",{volume:.5}),(r=this.maskTransition)==null||r.playTransitionIn(),await gi(.5);const e=We.getGameMode(),i=Tc.load(e);this.showDragon(),await this.showPanel(),this.animateGradeStars(i.grade),await this.animatePoints(i.score),await this.animateGradeMessage(i.grade),this.showBottom()}async hide(){this.hideBottom(),await this.hideDragon(),await this.hidePanel()}async showDragon(){P.killTweensOf(this.dragon.scale),P.killTweensOf(this.dragon.pivot),this.dragon.visible=!0,this.dragon.scale.set(0),this.dragon.pivot.y=-300,P.to(this.dragon.pivot,{y:0,duration:.7,ease:"back.out",delay:.1}),await P.to(this.dragon.scale,{x:1,y:1,duration:.3,ease:"back.out",delay:.2})}async hideDragon(){P.killTweensOf(this.dragon.pivot),await P.to(this.dragon.pivot,{y:-100,duration:.2,ease:"back.in"}),this.dragon.scale.set(0)}async showPanel(){P.killTweensOf(this.panel.scale),this.panel.visible=!0,this.panel.scale.set(0),await P.to(this.panel.scale,{x:1,y:1,duration:.4,ease:"back.out"})}async hidePanel(){P.killTweensOf(this.panel.scale),await P.to(this.panel.scale,{x:0,y:0,duration:.3,ease:"back.in"})}async showBottom(){this.bottomBase.visible=!0,this.continueButton.visible=!0,P.killTweensOf(this.bottomBase),this.bottomBase.pivot.y=-200,P.killTweensOf(this.continueButton.pivot),this.continueButton.pivot.y=-200,P.to(this.bottomBase.pivot,{y:0,duration:.3,ease:"back.out",delay:.3}),await P.to(this.continueButton.pivot,{y:0,duration:.4,ease:"back.out",delay:.4})}async hideBottom(){P.killTweensOf(this.bottomBase),P.killTweensOf(this.continueButton.pivot),P.to(this.bottomBase.pivot,{y:-200,duration:.3,ease:"back.in"}),await P.to(this.continueButton.pivot,{y:-200,duration:.4,ease:"back.in"})}async animatePoints(e){if(await this.score.show(),await this.score.playScore(e),!e)return;const i=We.getGameMode(),r=Tc.loadBestScore(i);this.bestScore.show(),e>=r?this.bestScore.setText(mt.newBestScore):this.bestScore.setText(mt.bestScorePrefix+r)}async animateGradeStars(e){await this.stars.show(),await this.stars.playGrade(e)}async animateGradeMessage(e){await gi(.1);const i=mt,r="grade"+e;this.message.text=i[r],e<1?Pt.play("common/sfx-incorrect.wav"):Pt.play("common/sfx-special.wav"),await this.message.show()}}A(Su,"assetBundles",["result","common"]);class Yk extends W{constructor(){super();A(this,"container");A(this,"cloud");A(this,"label");A(this,"points",-1);A(this,"showing",!0);A(this,"animatedPoints",0);A(this,"intensity",0);this.container=new W,this.addChild(this.container),this.cloud=new rh({color:2888556,width:200,height:20,circleSize:50}),this.container.addChild(this.cloud),this.label=new pe("0",{fill:16777215,fontSize:30}),this.label.y=8,this.container.addChild(this.label),this.points=0}reset(){this.points=0,this.label.text="0"}setScore(e){this.points!==e&&(this.points=e,this.playPoints())}async show(e=!0){this.showing||(this.showing=!0,P.killTweensOf(this.container.scale),this.visible=!0,e?(this.container.scale.set(0),await P.to(this.container.scale,{x:1,y:1,duration:.3,ease:"back.out"})):this.container.scale.set(1))}async hide(e=!0){this.showing&&(this.showing=!1,P.killTweensOf(this.container.scale),e&&await P.to(this.container.scale,{x:0,y:0,duration:.3,ease:"back.in"}),this.visible=!1)}async playPoints(){P.killTweensOf(this);const e=this.points-this.animatedPoints;await P.to(this,{intensity:this.intensity+e,animatedPoints:this.points,duration:Math.min(e*.025,2),ease:"linear",onUpdate:()=>{this.printPoints()}}),P.to(this,{intensity:1,duration:1.5,ease:"expo.in"})}printPoints(){const e=Math.round(this.animatedPoints),i=String(e);if(this.label.text!==i){this.label.text=i;const r=Math.min(.8+this.intensity*.001,2);_u("score",100,()=>{Pt.play("common/sfx-points.wav",{speed:r,volume:.2})})}}}const jk=or("M0,0,C0,0,0.07,-0.63,0.402,-0.422,0.83,-0.152,1,1,1,1");class my extends W{constructor(e=!1){super();A(this,"container");A(this,"shadow");A(this,"content");this.container=new W,this.addChild(this.container),this.shadow=lt.from("circle"),this.shadow.anchor.set(.5),this.shadow.width=180,this.shadow.height=40,this.shadow.tint=2500134,this.shadow.alpha=.2,this.shadow.y=40,this.shadow.visible=e,this.container.addChild(this.shadow),this.spine=Ei.from("preload/cauldron-skeleton.json","preload/cauldron-skeleton.atlas",{scale:1}),this.spine.autoUpdate=!0,this.spine.y=50,this.spine.state.setAnimation(0,"animation",!0),this.container.addChild(this.spine)}async show(e=!0){P.killTweensOf(this.container.scale),this.visible=!0,e?(this.container.scale.set(0),await P.to(this.container.scale,{x:1,y:1,duration:.3,ease:"back.out"})):this.container.scale.set(1)}async hide(e=!0){P.killTweensOf(this.container.scale),e?await P.to(this.container.scale,{x:0,y:0,duration:.3,ease:"back.in"}):this.container.scale.set(0),this.visible=!1}async playSplash(e,i=6){this.playWobble();const r=[];for(let n=0;n<i;n++)r.push(this.playSplashDrop(e));await Promise.all(r)}async playSplashDrop(e){const i=Lt(.4,.6),r=ci.get(qk);r.x=e+Lt(-10,10),r.y=-45,this.addChild(r),await r.playSplashDrop({x:e+Lt(-100,100),y:Lt(30,70)},Lt(.03,.07),i),this.removeChild(r),ci.giveBack(r)}async playWobble(){Lt(1.1,1.2),Lt(.8,.9)}addContent(e){this.content||(this.content=new W),this.addChild(this.content),this.content.addChild(e)}}class qk extends lt{constructor(){super(),this.texture=j.from("circle"),this.anchor.set(.5),this.tint=2888556}async playSplashDrop(t,e,i){P.killTweensOf(this),P.killTweensOf(this.scale),this.scale.set(e),this.alpha=1,P.to(this.scale,{x:e*3,y:e*3,duration:i,ease:"linear"}),P.to(this,{alpha:0,duration:.1,ease:"linear",delay:i-.1}),P.to(this,{x:t.x,duration:i,ease:"linear"}),await P.to(this,{y:t.y,duration:i,ease:jk})}}class fp extends W{constructor(){super();A(this,"bg");A(this,"panel");A(this,"title");A(this,"doneButton");A(this,"panelBase");this.bg=lt.from(j.WHITE),this.bg.tint=655397,this.bg.interactive=!0,this.addChild(this.bg),this.panel=new W,this.addChild(this.panel),this.panelBase=new wu({height:300}),this.panel.addChild(this.panelBase),this.title=new pe(mt.pauseTitle,{fill:16766329,fontSize:50}),this.title.y=-80,this.panel.addChild(this.title),this.doneButton=new ua({text:mt.pauseDone}),this.doneButton.y=70,this.doneButton.onPress.connect(()=>et.dismissPopup()),this.panel.addChild(this.doneButton)}resize(e,i){this.bg.width=e,this.bg.height=i,this.panel.x=e*.5,this.panel.y=i*.5}async show(){et.currentScreen&&(et.currentScreen.filters=new No(5)),P.killTweensOf(this.bg),P.killTweensOf(this.panel.pivot),this.bg.alpha=0,this.panel.pivot.y=-400,P.to(this.bg,{alpha:.8,duration:.2,ease:"linear"}),await P.to(this.panel.pivot,{y:0,duration:.3,ease:"back.out"})}async hide(){et.currentScreen&&(et.currentScreen.filters=null),P.killTweensOf(this.bg),P.killTweensOf(this.panel.pivot),P.to(this.bg,{alpha:0,duration:.2,ease:"linear"}),await P.to(this.panel.pivot,{y:-500,duration:.3,ease:"back.in"})}}const Kk=or("M0,0 C0,0 0.023,0.173 0.045,0.276 0.05,0.301 0.058,0.319 0.07,0.34 0.077,0.355 0.085,0.37 0.1,0.375 0.352,0.46 0.586,0.52 0.875,0.612 0.891,0.617 0.904,0.623 0.915,0.634 0.928,0.648 0.936,0.664 0.945,0.683 0.955,0.707 0.96,0.725 0.965,0.751 0.981,0.846 1,1 1,1 ");class Zk extends W{constructor(){super();A(this,"container");A(this,"cloud");A(this,"label");this.container=new W,this.addChild(this.container),this.cloud=new rh({color:655397,width:400,height:70,circleSize:100}),this.container.addChild(this.cloud),this.label=new pe("",{fill:16777215,fontSize:70}),this.container.addChild(this.label),this.visible=!1}async playReadyAnimation(){Pt.play("common/sfx-countdown.wav",{speed:.8,volume:.5}),P.killTweensOf(this.label),P.killTweensOf(this.label.scale),this.label.text=mt.countdownReady,this.label.scale.set(0),this.label.y=-5,await P.to(this.label.scale,{x:1,y:1,duration:.7,ease:"back.out"})}async playGoAnimation(){P.killTweensOf(this.label),P.killTweensOf(this.label.scale),await P.to(this.label,{alpha:0,duration:.2,ease:"sine.in"}),await P.to(this.label.scale,{x:1.5,y:1.5,duration:.2,ease:"sine.in"}),Pt.play("common/sfx-countdown.wav",{speed:1.2,volume:.5}),this.label.y=0,this.label.text=mt.countdownGo,this.label.scale.set(.8),P.to(this.label,{alpha:1,duration:.2,ease:"linear"}),P.to(this.label,{alpha:0,duration:.2,ease:"linear",delay:.6}),await P.to(this.label.scale,{x:3,y:3,duration:.8,ease:Kk})}async show(){P.killTweensOf(this.container.scale),P.killTweensOf(this.container),this.visible=!0,this.playReadyAnimation(),await this.cloud.playFormAnimation(.7)}async hide(){this.playGoAnimation(),await gi(.6),await this.cloud.playDismissAnimation(.7),this.visible=!1}}function Jk(s,t,e=0,i=0){const r=e-s,n=i-t;return Math.sqrt(r*r+n*n)}class Qk extends W{constructor(){super();A(this,"particles",[]);for(let e=0;e<12;e++){const i=lt.from("circle");i.anchor.set(.5),i.visible=!1,this.particles.push(i),this.addChild(i)}}async play(){const e=[];for(const i of this.particles)e.push(this.playParticle(i));await Promise.all(e)}async playParticle(e){P.killTweensOf(e),P.killTweensOf(e.scale),e.visible=!0,e.scale.set(.1),e.alpha=1,e.x=Lt(-10,10),e.y=Lt(-10,10);const i=Lt(-50,50),r=Lt(-50,50),n=Lt(.4,.6),a=0,o=.5;P.to(e.scale,{x:n,y:n,duration:o,ease:"sine.out"}),await P.to(e,{x:i,y:r,alpha:a,duration:o,ease:"quad.out"}),e.visible=!1}}const tR=or("M0,0,C0,0,0.063,-0.304,0.374,-0.27,0.748,-0.228,1,1,1,1"),eR=or("M0,0 C0,0 0.326,1.247 0.662,1.29 0.898,1.32 1,1 1,1 "),iR=or("M0,0,C0,0,0.043,-1.694,0.356,-1.694,1.026,-1.694,1,1,1,1");class sR extends W{constructor(e){super();A(this,"game");this.game=e}async onMove(e){e.valid?Pt.play("common/sfx-correct.wav",{volume:.5}):Pt.play("common/sfx-incorrect.wav",{volume:.5})}async onPop(e){const i=this.toLocal(e.piece.getGlobalPosition());if(this.playPopExplosion(i),e.isSpecial)Pt.play("common/sfx-special.wav",{volume:.5}),Gr(this.game.pivot,15);else{const r=this.toLocal(e.piece.getGlobalPosition()),n=ci.get(nc);n.setup({name:e.piece.name,type:e.piece.type,size:this.game.match3.board.tileSize,interactive:!1}),n.position.copyFrom(r),this.addChild(n),await this.playFlyToCauldron(n),this.removeChild(n),ci.giveBack(n)}}async onMatch(e){Pt.play("common/sfx-match.wav",{speed:1-.04+e.combo*.04}),e.combo>1&&Gr(this.game.pivot,Math.min(1+e.combo*.5,20))}async playFlyToCauldron(e){const i=this.game.cauldron.x+Lt(-20,20),r=this.game.cauldron.y-55,n={x:i,y:r},a=Jk(e.x,e.y,i,r);P.killTweensOf(e),P.killTweensOf(e.scale);const o=a*.001+Lt(.2,.8);P.to(e,{x:n.x,duration:o,ease:tR}),P.to(e,{y:n.y,duration:o,ease:eR}),await P.to(e.scale,{x:.5,y:.5,duration:o,ease:iR}),Pt.play("common/sfx-bubble.wav"),this.game.cauldron.playSplash(n.x-this.game.cauldron.x)}async playPopExplosion(e){const i=ci.get(Qk);i.x=e.x,i.y=e.y,this.addChild(i),await i.play(),this.removeChild(i),ci.giveBack(i)}async playPieceExplosion(e){const i=this.toLocal(e.getGlobalPosition()),r=i.x+e.x*2+Lt(-100,100),n=i.y+Lt(-100,-200),a=n+600,o=ci.get(nc),h=Lt(.5,.8);P.killTweensOf(o),P.killTweensOf(o.scale),o.setup({name:e.name,type:e.type,size:this.game.match3.board.tileSize,interactive:!1}),o.position.copyFrom(i),o.alpha=1,this.addChild(o),await gi(Lt(0,.3)),_u("pieceExplosion",100,()=>Pt.play("common/sfx-incorrect.wav",{volume:.5})),this.playPopExplosion(i);const l=h*.4,c=h*.6;P.to(o,{y:n,duration:l,ease:"circ.out"}),P.to(o,{y:a,duration:c,ease:"circ.in",delay:l}),P.to(o,{alpha:0,duration:.2,ease:"linear",delay:h-.2}),P.to(o.scale,{x:2,y:2,duration:h,ease:"linear"}),await P.to(o,{x:r,duration:h,ease:"linear"}),this.removeChild(o),ci.giveBack(e)}async playGridExplosion(){Gr(this.game.pivot,10);const e=[];this.game.match3.board.pieces.forEach(i=>{e.push(this.playPieceExplosion(i))}),this.game.match3.board.piecesContainer.visible=!1,await Promise.all(e)}}class rR extends W{constructor(){super();A(this,"container");A(this,"cloud");A(this,"label");this.container=new W,this.addChild(this.container),this.cloud=new rh({color:655397,width:500,height:70,circleSize:100}),this.container.addChild(this.cloud),this.label=new pe(mt.timesUp,{fill:16777215,fontSize:70}),this.container.addChild(this.label),this.visible=!1}async playRevealAnimation(){P.killTweensOf(this.container.scale),P.killTweensOf(this.container),P.killTweensOf(this.label),this.visible=!0,this.label.scale.set(.5),this.label.alpha=0,P.to(this.label,{alpha:1,duration:2,ease:"linear"}),P.to(this.label.scale,{x:1,y:1,duration:2,ease:"expo.out"}),await this.cloud.playFormAnimation(2)}async playExpandAnimation(){P.killTweensOf(this.cloud),P.killTweensOf(this.cloud.scale),P.killTweensOf(this.label.scale),P.killTweensOf(this.label),P.to(this.label,{alpha:0,duration:.5,ease:"linear"}),P.to(this.label.scale,{x:5,y:5,duration:.5,ease:"expo.in"}),P.to(this.cloud,{height:1e3,duration:.5,ease:"expo.in"}),await P.to(this.cloud.scale,{x:9,y:9,duration:.5,ease:"expo.in"})}}class nR extends W{constructor(){super();A(this,"labelNum");A(this,"labelOver");A(this,"stroke");this.labelNum=new pe("",{fontSize:230,fill:16777215}),this.labelNum.y=-8,this.addChild(this.labelNum),this.labelOver=new pe(mt.overtime,{fontSize:70,fill:16777215,fontWeight:"bold"}),this.labelOver.y=-8,this.addChild(this.labelOver),this.stroke=new lt,this.stroke.anchor.set(.5),this.addChild(this.stroke),this.alpha=.4,this.visible=!1}async playNumber(e){this.labelOver.visible=!1,this.labelNum.visible=!0,this.stroke.visible=!0;const i=String(e);this.labelNum.text!==i&&(Pt.play("common/sfx-countdown.wav",{speed:2,volume:.5}),this.stroke.texture=j.from("num-stroke-"+i),this.labelNum.text=i,P.killTweensOf(this.stroke),P.killTweensOf(this.stroke.scale),P.killTweensOf(this.labelNum),P.killTweensOf(this.labelNum.scale),this.labelNum.scale.set(.5),P.to(this.labelNum,{alpha:1,duration:.4,ease:"linear"}),P.to(this.labelNum.scale,{x:1,y:1,duration:.4,ease:"back.out"}),this.stroke.alpha=1,this.stroke.scale.set(1),P.to(this.stroke,{alpha:0,duration:.4,ease:"linear"}),P.to(this.stroke.scale,{x:4,y:4,duration:.4,ease:"sine.in"}),P.to(this.labelNum,{alpha:0,duration:.2,ease:"linear",delay:.8}),P.to(this.labelNum.scale,{x:3,y:3,duration:.2,ease:"linear",delay:.8}))}playOvertime(){this.labelNum.visible=!1,this.stroke.visible=!1,this.labelOver.visible||(Pt.play("common/sfx-countdown.wav",{speed:.5,volume:.5}),P.killTweensOf(this.labelOver),P.killTweensOf(this.labelOver.scale),this.labelOver.visible=!0,this.labelOver.scale.set(0),P.to(this.labelOver.scale,{x:1,y:1,duration:.3,ease:"sine.out"})),this.labelOver.rotation=Math.sin(Ct.ticker.lastTime*.01)*.05,this.labelOver.alpha=.7+Math.sin(Ct.ticker.lastTime*.02)*.3}updateTime(e){if(e>=6e3){this.visible=!1;return}!this.visible&&e>0&&this.show();const i=Math.floor(e/1e3);i>0?this.playNumber(i):this.playOvertime()}async show(){this.alpha=0,this.visible=!0,P.to(this,{alpha:.5,duration:.3,ease:"linear"})}async hide(){await P.to(this,{alpha:0,duration:.4,ease:"linear"}),this.visible=!1}}class da extends W{constructor(){super();A(this,"match3");A(this,"cauldron");A(this,"gameContainer");A(this,"timer");A(this,"score");A(this,"comboMessage");A(this,"comboLevel");A(this,"pauseButton");A(this,"settingsButton");A(this,"countdown");A(this,"overtime");A(this,"timesUp");A(this,"shelf");A(this,"specialEffects");A(this,"finished",!1);this.pauseButton=new ra({image:"icon-pause",ripple:"icon-pause-stroke"}),this.pauseButton.onPress.connect(()=>et.presentPopup(fp)),this.addChild(this.pauseButton),this.settingsButton=new ra({image:"icon-settings",ripple:"icon-settings-stroke"}),this.settingsButton.onPress.connect(()=>et.presentPopup(Tu)),this.gameContainer=new W,this.addChild(this.gameContainer),this.shelf=new bA,this.gameContainer.addChild(this.shelf),this.match3=new gA,this.match3.onMove=this.onMove.bind(this),this.match3.onMatch=this.onMatch.bind(this),this.match3.onPop=this.onPop.bind(this),this.match3.onProcessComplete=this.onProcessComplete.bind(this),this.match3.onTimesUp=this.onTimesUp.bind(this),this.gameContainer.addChild(this.match3),this.score=new Yk,this.addChild(this.score),this.comboMessage=new wc({color:2888556,labelColor:16777215}),this.comboMessage.text=mt.comboMessage,this.comboMessage.hide(!1),this.addChild(this.comboMessage),this.comboLevel=new wc({color:2888556,labelColor:16777215}),this.comboLevel.text="x8",this.comboLevel.hide(!1),this.addChild(this.comboLevel),this.cauldron=new my(!0),this.addChild(this.cauldron),this.timer=new xA,this.cauldron.addContent(this.timer),this.specialEffects=new sR(this),this.addChild(this.specialEffects),this.countdown=new Zk,this.addChild(this.countdown),this.overtime=new nR,this.addChild(this.overtime),this.timesUp=new rR,this.addChild(this.timesUp)}prepare(){var i;const e=cb({rows:Pa("rows")??9,columns:Pa("columns")??7,tileSize:Pa("tileSize")??50,freeMoves:Vr("freeMoves")!==null,duration:Pa("duration")??60,mode:Vr("mode")??We.getGameMode()});this.finished=!1,(i=this.shelf)==null||i.setup(e),this.match3.setup(e),this.pauseButton.hide(!1),this.cauldron.hide(!1),this.score.hide(!1),P.killTweensOf(this.gameContainer.pivot),this.gameContainer.pivot.y=-et.height*.7,P.killTweensOf(this.timer.scale)}update(){this.match3.update(Ct.ticker.deltaMS),this.timer.updateTime(this.match3.timer.getTimeRemaining()),this.overtime.updateTime(this.match3.timer.getTimeRemaining()),this.score.setScore(this.match3.stats.getScore())}async pause(){this.gameContainer.interactiveChildren=!1,this.match3.pause()}async resume(){this.gameContainer.interactiveChildren=!0,this.match3.resume()}reset(){var e;(e=this.shelf)==null||e.reset(),this.match3.reset()}resize(e,i){const r=i*.3,n=e*.5,a=i*.5;this.gameContainer.x=n,this.gameContainer.y=r+this.match3.board.getHeight()*.5+20,this.score.x=n,this.score.y=10,this.comboMessage.x=n-150,this.comboMessage.y=r-50,this.comboLevel.x=n+150,this.comboLevel.y=r-50,this.cauldron.x=n,this.cauldron.y=r-60,this.pauseButton.x=30,this.pauseButton.y=30,this.settingsButton.x=e-30,this.settingsButton.y=30,this.countdown.x=n,this.countdown.y=a,this.timesUp.x=n,this.timesUp.y=a,this.overtime.x=this.gameContainer.x,this.overtime.y=this.gameContainer.y}async show(){Mo.play("common/bgm-game.mp3",{volume:.5}),await P.to(this.gameContainer.pivot,{y:0,duration:.5,ease:"back.out"}),await this.countdown.show(),await this.cauldron.show(),await this.countdown.hide(),this.score.show(),this.pauseButton.show(),this.match3.startPlaying()}async hide(){var e;this.overtime.hide(),(e=this.specialEffects)==null||e.playGridExplosion(),await gi(.3),await this.timesUp.playRevealAnimation(),await this.timesUp.playExpandAnimation()}onMove(e){var i;(i=this.specialEffects)==null||i.onMove(e)}onMatch(e){var i;e.combo>1&&(this.comboMessage.show(),this.comboLevel.show(),this.comboLevel.text="x"+e.combo),(i=this.specialEffects)==null||i.onMatch(e)}onPop(e){var i;(i=this.specialEffects)==null||i.onPop(e)}onProcessComplete(){this.comboMessage.hide(),this.comboLevel.hide(),this.match3.timer.isRunning()||this.finish()}onTimesUp(){this.pauseButton.hide(),this.match3.stopPlaying(),this.match3.process.isProcessing()||this.finish()}async finish(){if(this.finished)return;this.finished=!0,this.match3.stopPlaying();const e=this.match3.stats.getGameplayPerformance();Tc.save(this.match3.config.mode,e),et.showScreen(Su)}blur(){!et.currentPopup&&this.match3.isPlaying()&&et.presentPopup(fp)}}A(da,"assetBundles",["game","common"]);class aR extends W{constructor(){super();A(this,"image");this.scale.set(.5),this.image=lt.from("logo-game"),this.image.anchor.set(.5),this.addChild(this.image)}async show(e=!0){P.killTweensOf(this.image.scale),this.visible=!0,e?(this.image.scale.set(0),await P.to(this.image.scale,{x:1,y:1,duration:.3,ease:"back.out"})):this.image.scale.set(1)}async hide(e=!0){P.killTweensOf(this.image.scale),e?await P.to(this.image.scale,{x:0,y:0,duration:.3,ease:"back.in"}):this.image.scale.set(0),this.visible=!1}}const oR={text:"",width:67,height:53,labelColor:15471969,labelFontSize:8};class hR extends sh{constructor(e={}){const i={...oR,...e},r=new pi({texture:j.from("button-small"),leftWidth:16,topHeight:16,rightWidth:16,bottomHeight:20});r.width=i.width,r.height=i.height;const n=new pi({texture:j.from("button-small-hover"),leftWidth:16,topHeight:16,rightWidth:16,bottomHeight:20});n.width=i.width,n.height=i.height;const a=new pi({texture:j.from("button-small-press"),leftWidth:16,topHeight:16,rightWidth:16,bottomHeight:20});a.width=i.width,a.height=i.height;super({defaultView:r,hoverView:n,pressedView:a,anchor:.5});A(this,"label");A(this,"container");this.container=new W,this.addChild(this.container),this.defaultView&&this.container.addChild(this.defaultView),this.hoverView&&this.container.addChild(this.hoverView),this.pressedView&&this.container.addChild(this.pressedView),this.disabledView&&this.container.addChild(this.disabledView),this.label=new pe(i.text,{fill:i.labelColor,align:"center",fontSize:i.labelFontSize}),this.label.y=-8,this.container.addChild(this.label),this.onDown.connect(this.handleDown.bind(this)),this.onUp.connect(this.handleUp.bind(this)),this.onHover.connect(this.handleHover.bind(this)),this.on("pointerupoutside",this.handleUp.bind(this)),this.on("pointerout",this.handleUp.bind(this))}handleHover(){Pt.play("common/sfx-hover.wav")}handleDown(){Pt.play("common/sfx-press.wav"),this.label.y=-3}handleUp(){this.label.y=-8}async show(e=!0){P.killTweensOf(this.scale),this.visible=!0,e?(this.scale.set(0),await P.to(this.scale,{x:1,y:1,duration:.3,ease:"back.out"})):this.scale.set(1)}async hide(e=!0){P.killTweensOf(this.scale),e?await P.to(this.scale,{x:0,y:0,duration:.3,ease:"back.in"}):this.scale.set(0),this.visible=!1}}const lR={image:"",scaleOverride:1};class cR extends sh{constructor(e={}){const i={...lR,...e},r=lt.from(i.image);super({defaultView:r,anchor:.5});A(this,"image");A(this,"scaleOverride");this.image=r,this.scaleOverride=i.scaleOverride,this.onHover.connect(this.handleHover.bind(this)),this.onOut.connect(this.handleOut.bind(this)),this.onDown.connect(this.handleDown.bind(this)),this.onUp.connect(this.handleUp.bind(this)),this.on("pointerupoutside",this.handleUp.bind(this))}handleHover(){Pt.play("common/sfx-hover.wav"),this.image.blendMode="add"}handleOut(){this.image.blendMode="normal"}handleDown(){Pt.play("common/sfx-press.wav"),this.image.alpha=.5}handleUp(){this.image.alpha=1}async show(e=!0){P.killTweensOf(this.scale),this.visible=!0,e?(this.scale.set(.5),await P.to(this.scale,{x:this.scaleOverride,y:this.scaleOverride,duration:.3,ease:"back.out"})):this.scale.set(this.scaleOverride)}async hide(e=!0){P.killTweensOf(this.scale),e?await P.to(this.scale,{x:.5,y:.5,duration:.3,ease:"back.in"}):this.scale.set(0),this.visible=!1}}class uR extends W{constructor(){super();A(this,"bg");A(this,"panel");A(this,"title");A(this,"doneButton");A(this,"panelBase");this.bg=lt.from(j.WHITE),this.bg.tint=655397,this.bg.interactive=!0,this.addChild(this.bg),this.panel=new W,this.addChild(this.panel),this.panelBase=new wu,this.panel.addChild(this.panelBase),this.title=new pe(mt.infoTitle,{fill:16766329,fontSize:50}),this.title.y=-230,this.panel.addChild(this.title),this.doneButton=new ua({text:mt.infoDone}),this.doneButton.y=220,this.doneButton.onPress.connect(()=>et.dismissPopup()),this.panel.addChild(this.doneButton)}resize(e,i){this.bg.width=e,this.bg.height=i,this.panel.x=e*.5,this.panel.y=i*.5}async show(){et.currentScreen&&(et.currentScreen.filters=[new No(5)]),P.killTweensOf(this.bg),P.killTweensOf(this.panel.pivot),this.bg.alpha=0,this.panel.pivot.y=-400,P.to(this.bg,{alpha:.8,duration:.2,ease:"linear"}),await P.to(this.panel.pivot,{y:0,duration:.3,ease:"back.out"})}async hide(){et.currentScreen&&(et.currentScreen.filters=null),P.killTweensOf(this.bg),P.killTweensOf(this.panel.pivot),P.to(this.bg,{alpha:0,duration:.2,ease:"linear"}),await P.to(this.panel.pivot,{y:-500,duration:.3,ease:"back.in"})}}const dR=or("M0,0,C0,0,0.05,0.228,0.09,0.373,0.12,0.484,0.139,0.547,0.18,0.654,0.211,0.737,0.235,0.785,0.275,0.864,0.291,0.896,0.303,0.915,0.325,0.944,0.344,0.97,0.356,0.989,0.38,1.009,0.413,1.039,0.428,1.073,0.604,1.074,0.72,1.074,0.822,1.035,0.91,1.011,0.943,1.002,1,1,1,1");class gy extends W{constructor(){super();A(this,"logo");A(this,"dragon");A(this,"playButton");A(this,"githubButton");A(this,"pixiButton");A(this,"infoButton");A(this,"settingsButton");A(this,"base");this.logo=new aR,this.addChild(this.logo),this.dragon=new py,this.dragon.playIdle(),this.addChild(this.dragon),this.base=new pi({texture:j.from("rounded-rectangle"),leftWidth:32,topHeight:32,rightWidth:32,bottomHeight:32}),this.base.tint=2888556,this.addChild(this.base),this.infoButton=new ra({image:"icon-info",ripple:"icon-info-stroke"}),this.infoButton.onPress.connect(()=>et.presentPopup(uR)),this.addChild(this.infoButton),this.settingsButton=new ra({image:"icon-settings",ripple:"icon-settings-stroke"}),this.settingsButton.onPress.connect(()=>et.presentPopup(Tu)),this.githubButton=new hR({text:mt.githubButton}),this.githubButton.onPress.connect(()=>window.open(mt.urlGithub,"blank")),this.addChild(this.githubButton),this.pixiButton=new cR({image:"logo-pixi",scaleOverride:.75}),this.pixiButton.onPress.connect(()=>window.open(mt.urlPixi,"blank")),this.addChild(this.pixiButton),this.playButton=new ua({text:mt.playButton}),this.playButton.onPress.connect(()=>et.showScreen(da)),this.addChild(this.playButton)}resize(e,i){this.dragon.x=e*.5,this.dragon.y=i*.5,this.playButton.x=e*.5,this.playButton.y=i-130,this.base.width=e,this.base.y=i-140,this.logo.x=e*.5,this.logo.y=i*.2,this.githubButton.x=e-50,this.githubButton.y=i-40,this.pixiButton.x=50,this.pixiButton.y=i-40,this.infoButton.x=30,this.infoButton.y=30,this.settingsButton.x=e-30,this.settingsButton.y=30}async show(){this.playButton.hide(!1),this.pixiButton.hide(!1),this.infoButton.hide(!1),this.settingsButton.hide(!1),this.githubButton.hide(!1),this.dragon.show(!1),this.logo.show(!1),this.playRevealAnimation(),await gi(.5),await this.playButton.show(),this.interactiveChildren=!0,await this.settingsButton.show(),this.pixiButton.show(),await this.githubButton.show()}async hide(){this.playButton.hide(),this.pixiButton.hide(),this.githubButton.hide(),this.infoButton.hide(),await gi(.1),P.to(this.base.pivot,{y:-200,duration:.3,ease:"back.in"}),await gi(.1),this.logo.hide(),await gi(.1),await this.dragon.hide()}async playRevealAnimation(){const i=dR;P.killTweensOf(this.base),P.killTweensOf(this.base.pivot),this.base.height=et.height*1.25,this.base.pivot.y=et.height,P.to(this.base,{height:200,duration:1,ease:i}),await P.to(this.base.pivot,{y:0,duration:1,ease:i})}}A(gy,"assetBundles",["home","common"]);class fR extends W{constructor(){super();A(this,"image");this.image=lt.from("logo-pixi"),this.image.anchor.set(.5),this.addChild(this.image)}}class pR extends W{constructor(){super();A(this,"color",2888556);A(this,"base");A(this,"circlesContainer");A(this,"circlesPool",[]);A(this,"circles",[]);this.base=lt.from(j.WHITE),this.base.tint=this.color,this.addChild(this.base),this.circlesContainer=new W,this.addChild(this.circlesContainer),this.onRender=()=>{const e=Ct.ticker.deltaTime;for(const i of this.circles)i.update(e)}}get width(){return this.base.width}set width(e){this.base.width=e,this.rebuildCircles()}get height(){return this.base.height}set height(e){this.base.height=e,this.circlesContainer.y=e}getCircle(){let e=this.circlesPool.pop();return e||(e=new mR,e.tint=this.color),e.step=Math.random()*100,e.speed=Math.random()*.5+.5,e}releaseCircle(e){this.circlesPool.includes(e)||this.circlesPool.push(e)}rebuildCircles(){for(const r of this.circles)this.circlesContainer.removeChild(r),this.releaseCircle(r);this.circles.length=0;const e=60,i=Math.ceil(this.base.width/e)+1;for(let r=0;r<i;r++){const n=this.getCircle();n.x=e*r,n.scale.x=.5+Math.random()*.5,n.scale.y=n.scale.x,this.circlesContainer.addChild(n),this.circles.push(n)}}}class mR extends lt{constructor(){super();A(this,"step",0);A(this,"size",1);A(this,"speed",1);this.texture=j.from("circle"),this.anchor.set(.5)}update(e){this.step+=e*.1*this.speed,this.scale.set(Math.sin(this.step)*.4+this.size)}}class Sc extends W{constructor(){super();A(this,"cauldron");A(this,"pixiLogo");A(this,"cloud");A(this,"message");this.cauldron=new my,this.addChild(this.cauldron),this.message=new qr(mt.loadingMessage,{fill:6052956,fontFamily:"Verdana",align:"center"}),this.message.anchor.set(.5),this.addChild(this.message),this.pixiLogo=new fR,this.addChild(this.pixiLogo),this.cloud=new pR,this.cloud.height=100,this.addChild(this.cloud)}resize(e,i){this.cauldron.x=e*.5,this.cauldron.y=i*.5,this.message.x=e*.5,this.message.y=i*.75,this.pixiLogo.x=e*.5,this.pixiLogo.y=i-50,this.cloud.y=0,this.cloud.width=e}async show(){P.killTweensOf(this.message),this.message.alpha=1}async hide(){this.message.text=mt.loadingDone,P.killTweensOf(this.message),P.to(this.message,{alpha:0,duration:.3,ease:"linear",delay:.5}),P.killTweensOf(this.cloud),await P.to(this.cloud,{height:Ct.renderer.height,duration:1,ease:"quad.in",delay:.5})}}A(Sc,"assetBundles",["preload"]);class gR extends W{constructor(){super();A(this,"direction",-Math.PI*.15);A(this,"sprite");this.sprite=new nS({texture:j.from("background"),width:Ct.renderer.width,height:Ct.renderer.height}),this.sprite.tileTransform.rotation=this.direction,this.addChild(this.sprite),this.onRender=()=>{const e=Ct.ticker.deltaTime;this.sprite.tilePosition.x-=Math.sin(-this.direction)*e,this.sprite.tilePosition.y-=Math.cos(-this.direction)*e}}get width(){return this.sprite.width}set width(e){this.sprite.width=e}get height(){return this.sprite.height}set height(e){this.sprite.height=e}resize(e,i){this.width=e,this.height=i}}const Ct=new Lc;function pp(){const s=window.innerWidth,t=window.innerHeight,e=375,i=700,r=s<e?e/s:1,n=t<i?i/t:1,a=r>n?r:n,o=s*a,h=t*a;Ct.renderer.view.element.style.width=`${s}px`,Ct.renderer.view.element.style.height=`${t}px`,window.scrollTo(0,0),Ct.renderer.resize(o,h),et.resize(o,h)}function bR(){document.hidden?(Ln.pauseAll(),et.blur()):(Ln.resumeAll(),et.focus())}async function yR(){await Ct.init({resolution:Math.max(window.devicePixelRatio,2),preference:"webgl",backgroundColor:16777215}),document.body.appendChild(Ct.canvas),window.addEventListener("resize",pp),pp(),document.addEventListener("visibilitychange",bR),await fS(),et.setBackground(gR),await et.showScreen(Sc),Vr("game")!==null?await et.showScreen(da):Vr("load")!==null?await et.showScreen(Sc):Vr("result")!==null?await et.showScreen(Su):await et.showScreen(gy)}yR();

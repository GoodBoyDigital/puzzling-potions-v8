import{E as f,e as E,a as et,R as x,T as I,s as g,p as T,G as vt,I as yt,P as A,C as st,B as it,g as At,M as Et,b as Tt,u as bt,S as q}from"./index-27d48d88.js";var k=(e=>(e[e.INTERACTION=50]="INTERACTION",e[e.HIGH=25]="HIGH",e[e.NORMAL=0]="NORMAL",e[e.LOW=-25]="LOW",e[e.UTILITY=-50]="UTILITY",e))(k||{});class R{constructor(t,s=null,i=0,n=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=s,this.priority=i,this.once=n}match(t,s=null){return this.fn===t&&this.context===s}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const s=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),s}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const s=this.next;return this.next=t?null:s,this.previous=null,s}}const v=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new R(null,null,1/0),this.deltaMS=1/v.targetFPMS,this.elapsedMS=1/v.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,t,s=k.NORMAL){return this._addListener(new R(e,t,s))}addOnce(e,t,s=k.NORMAL){return this._addListener(new R(e,t,s,!0))}_addListener(e){let t=this._head.next,s=this._head;if(!t)e.connect(s);else{for(;t;){if(e.priority>t.priority){e.connect(s);break}s=t,t=t.next}e.previous||e.connect(s)}return this._startIfPossible(),this}remove(e,t){let s=this._head.next;for(;s;)s.match(e,t)?s=s.destroy():s=s.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,t=this._head;for(;t=t.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let t;if(e>this.lastTime){if(t=this.elapsedMS=e-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){const n=e-this._lastFrame|0;if(n<this._minElapsedMS)return;this._lastFrame=e-n%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*v.targetFPMS;const s=this._head;let i=s.next;for(;i;)i=i.emit(this);s.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){const t=Math.min(this.maxFPS,e),s=Math.min(Math.max(0,t)/1e3,v.targetFPMS);this._maxElapsedMS=1/s}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(e===0)this._minElapsedMS=0;else{const t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!v._shared){const e=v._shared=new v;e.autoStart=!0,e._protected=!0}return v._shared}static get system(){if(!v._system){const e=v._system=new v;e.autoStart=!0,e._protected=!0}return v._system}};let B=v;B.targetFPMS=.06;class nt{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(s){this._ticker&&this._ticker.remove(this.render,this),this._ticker=s,s&&s.add(this.render,this,k.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?B.shared:new B,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}nt.extension=f.Application;class rt{static init(t){Object.defineProperty(this,"resizeTo",{set(s){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=s,s&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let s,i;if(this._resizeTo===globalThis.window)s=globalThis.innerWidth,i=globalThis.innerHeight;else{const{clientWidth:n,clientHeight:r}=this._resizeTo;s=n,i=r}this.renderer.resize(s,i),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}rt.extension=f.Application;E.add(rt);E.add(nt);var P=(e=>(e[e.Low=0]="Low",e[e.Normal=1]="Normal",e[e.High=2]="High",e))(P||{});const W=(e,t)=>{const s=t.split("?")[1];return s&&(e+=`?${s}`),e};class ot extends et{constructor(t){super(),this.baseRenderedFontSize=100,this.baseMeasurementFontSize=100,this.pages=[],this.chars={},this.lineHeight=0,this.baseLineOffset=0,this.pages=[];const{textures:s,data:i}=t;Object.keys(i.pages).forEach(n=>{const r=i.pages[parseInt(n,10)],o=s[r.id];this.pages.push({texture:o})}),Object.keys(i.chars).forEach(n=>{const r=i.chars[n],o=s[r.page].source,a=new x(r.x/o.width,r.y/o.height,r.width/o.width,r.height/o.height),d=new I({source:o,layout:{frame:a}});this.chars[n]={id:n.codePointAt(0),xOffset:r.xOffset,yOffset:r.yOffset,xAdvance:r.xAdvance,kerning:r.kerning??{},texture:d}}),this.fontMetrics={ascent:0,descent:0,fontSize:i.fontSize},this.baseLineOffset=i.baseLineOffset,this.lineHeight=i.lineHeight,this.fontName=i.fontName,this.baseMeasurementFontSize=i.fontSize,this.baseRenderedFontSize=i.fontSize,this.distanceField=i.distanceField??{fieldType:"none",distanceRange:0}}destroy(){this.emit("destroy",this),this.removeAllListeners();for(const t in this.chars)this.chars[t].texture.destroy();this.chars=null;for(let t=0;t<this.pages.length;t++){const{texture:s}=this.pages[t];s.destroy(!0)}this.pages=null}}const C={test(e){return typeof e=="string"&&e.startsWith("info face=")},parse(e){const t=e.match(/^[a-z]+\s+.+$/gm),s={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const c in t){const h=t[c].match(/^[a-z]+/gm)[0],m=t[c].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),p={};for(const G in m){const H=m[G].split("="),mt=H[0],K=H[1].replace(/"/gm,""),Y=parseFloat(K),gt=isNaN(Y)?K:Y;p[mt]=gt}s[h].push(p)}const i={chars:{},pages:[],lineHeight:0,fontSize:0,fontName:"",distanceField:null,baseLineOffset:0},[n]=s.info,[r]=s.common,[o]=s.distanceField??[];o&&(i.distanceField={distanceRange:parseInt(o.distanceRange,10),fieldType:o.fieldType}),i.fontSize=parseInt(n.size,10),i.fontName=n.face,i.lineHeight=parseInt(r.lineHeight,10);const a=s.page;for(let c=0;c<a.length;c++)i.pages.push({id:parseInt(a[c].id,10)||0,file:a[c].file});const d={};i.baseLineOffset=i.lineHeight-parseInt(r.base,10);const u=s.char;for(let c=0;c<u.length;c++){const h=u[c],m=parseInt(h.id,10);let p=h.letter??h.char;p==="space"&&(p=" "),d[m]=p,i.chars[p]={id:m,page:parseInt(h.page,10)||0,x:parseInt(h.x,10),y:parseInt(h.y,10),width:parseInt(h.width,10),height:parseInt(h.height,10),xOffset:parseInt(h.xoffset,10),yOffset:parseInt(h.yoffset,10),xAdvance:parseInt(h.xadvance,10),kerning:{}}}const l=s.kerning||[];for(let c=0;c<l.length;c++){const h=parseInt(l[c].first,10),m=parseInt(l[c].second,10),p=parseInt(l[c].amount,10);i.chars[d[m]].kerning[d[h]]=p}return i}},$={test(e){const t=e;return"getElementsByTagName"in t&&t.getElementsByTagName("page").length&&t.getElementsByTagName("info")[0].getAttribute("face")!==null},parse(e){const t={chars:{},pages:[],lineHeight:0,fontSize:0,fontName:"",distanceField:null,baseLineOffset:0},s=e.getElementsByTagName("info")[0],i=e.getElementsByTagName("common")[0],n=e.getElementsByTagName("distanceField")[0];n&&(t.distanceField={fieldType:n.getAttribute("fieldType"),distanceRange:parseInt(n.getAttribute("distanceRange"),10)});const r=e.getElementsByTagName("page"),o=e.getElementsByTagName("char"),a=e.getElementsByTagName("kerning");t.fontSize=parseInt(s.getAttribute("size"),10),t.fontName=s.getAttribute("face"),t.lineHeight=parseInt(i.getAttribute("lineHeight"),10);for(let u=0;u<r.length;u++)t.pages.push({id:parseInt(r[u].getAttribute("id"),10)||0,file:r[u].getAttribute("file")});const d={};t.baseLineOffset=t.lineHeight-parseInt(i.getAttribute("base"),10);for(let u=0;u<o.length;u++){const l=o[u],c=parseInt(l.getAttribute("id"),10);let h=l.getAttribute("letter")??l.getAttribute("char");h==="space"&&(h=" "),d[c]=h,t.chars[h]={id:c,page:parseInt(l.getAttribute("page"),10)||0,x:parseInt(l.getAttribute("x"),10),y:parseInt(l.getAttribute("y"),10),width:parseInt(l.getAttribute("width"),10),height:parseInt(l.getAttribute("height"),10),xOffset:parseInt(l.getAttribute("xoffset"),10),yOffset:parseInt(l.getAttribute("yoffset"),10),xAdvance:parseInt(l.getAttribute("xadvance"),10),kerning:{}}}for(let u=0;u<a.length;u++){const l=parseInt(a[u].getAttribute("first"),10),c=parseInt(a[u].getAttribute("second"),10),h=parseInt(a[u].getAttribute("amount"),10);t.chars[d[c]].kerning[d[l]]=h}return t}},Z={test(e){return typeof e=="string"&&e.includes("<font>")?$.test(g.ADAPTER.parseXML(e)):!1},parse(e){return $.parse(g.ADAPTER.parseXML(e))}},Pt=[".xml",".fnt"],wt={extension:f.CacheParser,test:e=>e instanceof ot,getCacheableAssets(e,t){const s={};return e.forEach(i=>{s[i]=t}),s[t.fontName]=t,s}},_t={extension:{type:f.LoadParser,priority:P.Normal},test(e){return Pt.includes(T.extname(e).toLowerCase())},async testParse(e){return C.test(e)||Z.test(e)},async parse(e,t,s){const i=C.test(e)?C.parse(e):Z.parse(e),{src:n}=t,{pages:r}=i,o=[];for(let l=0;l<r.length;++l){const c=r[l].file;let h=T.join(T.dirname(n),c);h=W(h,n),o.push(h)}const a=await s.load(o),d=o.map(l=>a[l]);return new ot({data:i,textures:d})},async load(e,t){return await(await g.ADAPTER.fetch(e)).text()},unload(e){e.destroy()}},xt={extension:f.CacheParser,test:e=>Array.isArray(e)&&e.every(t=>t instanceof I),getCacheableAssets:(e,t)=>{const s={};return e.forEach(i=>{t.forEach((n,r)=>{s[i+(r===0?"":r+1)]=n})}),s}},Mt={extension:{type:f.DetectionParser,priority:1},test:async()=>{if(!globalThis.createImageBitmap)return!1;const e="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=",t=await g.ADAPTER.fetch(e).then(s=>s.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async e=>[...e,"avif"],remove:async e=>e.filter(t=>t!=="avif")},V=["png","jpg","jpeg"],It={extension:{type:f.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async e=>[...e,...V],remove:async e=>e.filter(t=>!V.includes(t))},kt="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function X(e){return kt?!1:document.createElement("video").canPlayType(e)!==""}const Bt={extension:{type:f.DetectionParser,priority:0},test:async()=>X("video/mp4"),add:async e=>[...e,"mp4","m4v"],remove:async e=>e.filter(t=>t!=="mp4"&&t!=="m4v")},St={extension:{type:f.DetectionParser,priority:0},test:async()=>X("video/ogg"),add:async e=>[...e,"ogv"],remove:async e=>e.filter(t=>t!=="ogv")},Lt={extension:{type:f.DetectionParser,priority:0},test:async()=>X("video/webm"),add:async e=>[...e,"webm"],remove:async e=>e.filter(t=>t!=="webm")},Ot={extension:{type:f.DetectionParser,priority:0},test:async()=>{if(!globalThis.createImageBitmap)return!1;const e="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",t=await g.ADAPTER.fetch(e).then(s=>s.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async e=>[...e,"webp"],remove:async e=>e.filter(t=>t!=="webp")};function S(e,t){if(Array.isArray(t)){for(const s of t)if(e.startsWith(`data:${s}`))return!0;return!1}return e.startsWith(`data:${t}`)}function L(e,t){const s=e.split("?")[0],i=T.extname(s).toLowerCase();return Array.isArray(t)?t.includes(i):i===t}const Ft=".json",Dt="application/json",Rt={extension:{type:f.LoadParser,priority:P.Low},name:"loadJson",test(e){return S(e,Dt)||L(e,Ft)},async load(e){return await(await g.ADAPTER.fetch(e)).json()}},Ct=".txt",Nt="text/plain",zt={name:"loadTxt",extension:{type:f.LoadParser,priority:P.Low},test(e){return S(e,Nt)||L(e,Ct)},async load(e){return await(await g.ADAPTER.fetch(e)).text()}},Wt=["normal","bold","100","200","300","400","500","600","700","800","900"],jt=[".ttf",".otf",".woff",".woff2"],Ut=["font/ttf","font/otf","font/woff","font/woff2"],Xt=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function Gt(e){const t=T.extname(e),n=T.basename(e,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1));let r=n.length>0;for(const a of n)if(!a.match(Xt)){r=!1;break}let o=n.join(" ");return r||(o=`"${o.replace(/[\\"]/g,"\\$&")}"`),o}const Ht={extension:{type:f.LoadParser,priority:P.Low},name:"loadWebFont",test(e){return S(e,Ut)||L(e,jt)},async load(e,t){var i,n,r;const s=g.ADAPTER.getFontFaceSet();if(s){const o=[],a=((i=t.data)==null?void 0:i.family)??Gt(e),d=((r=(n=t.data)==null?void 0:n.weights)==null?void 0:r.filter(l=>Wt.includes(l)))??["normal"],u=t.data??{};for(let l=0;l<d.length;l++){const c=d[l],h=new FontFace(a,`url(${encodeURI(e)})`,{...u,weight:c});await h.load(),s.add(h),o.push(h)}return o.length===1?o[0]:o}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(e){(Array.isArray(e)?e:[e]).forEach(t=>g.ADAPTER.getFontFaceSet().delete(t))}},Kt=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,Yt=".svg",qt="image/svg+xml",$t={extension:{type:f.LoadParser,priority:P.Low},name:"loadSVG",test(e){return S(e,qt)||L(e,Yt)},async testParse(e){return typeof e=="string"&&e.startsWith("data:image/svg+xml")||typeof e=="string"&&Kt.test(e)},async parse(e){const t=new vt;return t.svg(e),t},async load(e){return(await g.ADAPTER.fetch(e)).text()}};function Zt(e,t=1){var i;const s=(i=g.RETINA_PREFIX)==null?void 0:i.exec(e);return s?parseFloat(s[1]):t}let Q=0,N;const Vt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",Qt={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${Vt}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},Jt={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`};let z;class te{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const s=URL.createObjectURL(new Blob([Qt.code],{type:"application/javascript"})),i=new Worker(s);i.addEventListener("message",n=>{i.terminate(),URL.revokeObjectURL(s),t(n.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){N===void 0&&(N=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<N&&(z||(z=URL.createObjectURL(new Blob([Jt.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(z),t.addEventListener("message",s=>{this.complete(s.data),this.returnWorker(s.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,s){await this._initWorkers();const i=new Promise((n,r)=>{this.queue.push({id:t,arguments:s,resolve:n,reject:r})});return this.next(),i}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const s=this.queue.pop(),i=s.id;this.resolveHash[Q]={resolve:s.resolve,reject:s.reject},t.postMessage({data:s.arguments,uuid:Q++,id:i})}}const J=new te;function ee(e,t,s){return new I({source:e,label:s})}const se=[".jpeg",".jpg",".png",".webp",".avif"],ie=["image/jpeg","image/png","image/webp","image/avif"];async function ne(e){const t=await g.ADAPTER.fetch(e);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${e}: ${t.status} ${t.statusText}`);const s=await t.blob();return await createImageBitmap(s)}const at={name:"loadTextures",extension:{type:f.LoadParser,priority:P.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(e){return S(e,ie)||L(e,se)},async load(e,t,s){var r;let i=null;globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await J.isImageBitmapSupported()?i=await J.loadImageBitmap(e):i=await ne(e):i=await new Promise(o=>{i=new Image,i.crossOrigin=this.config.crossOrigin,i.src=e,i.complete?o(i):i.onload=()=>{o(i)}});const n=new yt({resource:i,resolution:((r=t.data)==null?void 0:r.resolution)||Zt(e),...t.data});return ee(n,s,e)},unload(e){e.destroy(!0)}},re={extension:f.ResolveParser,test:at.test,parse:e=>{var t;return{resolution:parseFloat(((t=g.RETINA_PREFIX.exec(e))==null?void 0:t[1])??"1"),format:e.split(".").pop(),src:e}}};E.add(xt,It,Mt,Ot,Bt,St,Lt,Rt,zt,Ht,$t,at,re,_t,wt);const tt={loader:f.LoadParser,resolver:f.ResolveParser,cache:f.CacheParser,detection:f.DetectionParser};E.handle(f.Asset,e=>{const t=e.ref;Object.entries(tt).filter(([s])=>!!t[s]).forEach(([s,i])=>E.add(Object.assign(t[s],{extension:t[s].extension??i})))},e=>{const t=e.ref;Object.keys(tt).filter(s=>!!t[s]).forEach(s=>E.remove(t[s]))});class oe{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){this.tickerAdded||!this.domElement||(B.system.add(this.tickerUpdate,this,k.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(B.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&t.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t.deltaTime,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}}const b=new oe;class F{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=F.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new A,this.page=new A,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,s,i){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,s,i,n,r){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class O extends F{constructor(){super(...arguments),this.client=new A,this.movement=new A,this.offset=new A,this.global=new A,this.screen=new A}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,s,i){return t.worldTransform.applyInverse(i||this.global,s)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,s,i,n,r,o,a,d,u,l,c,h,m,p,G){throw new Error("Method not implemented.")}}class y extends O{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class w extends O{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}w.DOM_DELTA_PIXEL=0;w.DOM_DELTA_LINE=1;w.DOM_DELTA_PAGE=2;const ae=2048,he=new A,_=new A;class le{constructor(t){this.dispatch=new et,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,s){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:s,priority:0}),this.mappingTable[t].sort((i,n)=>i.priority-n.priority)}dispatchEvent(t,s){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,s),this.dispatch.emit(s||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const s=this.mappingTable[t.type];if(s)for(let i=0,n=s.length;i<n;i++)s[i].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,s){b.pauseUpdate=!0;const n=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",r=this[n](this.rootTarget,this.rootTarget.eventMode,he.set(t,s),this.hitTestFn,this.hitPruneFn);return r&&r[0]}propagate(t,s){if(!t.target)return;const i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let n=0,r=i.length-1;n<r;n++)if(t.currentTarget=i[n],this.notifyTarget(t,s),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,s),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let n=i.length-2;n>=0;n--)if(t.currentTarget=i[n],this.notifyTarget(t,s),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,s,i=this._allInteractiveElements){if(i.length===0)return;t.eventPhase=t.BUBBLING_PHASE;const n=Array.isArray(s)?s:[s];for(let r=i.length-1;r>=0;r--)n.forEach(o=>{t.currentTarget=i[r],this.notifyTarget(t,o)})}propagationPath(t){const s=[t];for(let i=0;i<ae&&t!==this.rootTarget&&t.parent;i++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");s.push(t.parent),t=t.parent}return s.reverse(),s}hitTestMoveRecursive(t,s,i,n,r,o=!1){let a=!1;if(this._interactivePrune(t))return null;if((t.eventMode==="dynamic"||s==="dynamic")&&(b.pauseUpdate=!1),t.interactiveChildren&&t.children){const l=t.children;for(let c=l.length-1;c>=0;c--){const h=l[c],m=this.hitTestMoveRecursive(h,this._isInteractive(s)?s:h.eventMode,i,n,r,o||r(t,i));if(m){if(m.length>0&&!m[m.length-1].parent)continue;const p=t.isInteractive();(m.length>0||p)&&(p&&this._allInteractiveElements.push(t),m.push(t)),this._hitElements.length===0&&(this._hitElements=m),a=!0}}}const d=this._isInteractive(s),u=t.isInteractive();return u&&u&&this._allInteractiveElements.push(t),o||this._hitElements.length>0?null:a?this._hitElements:d&&!r(t,i)&&n(t,i)?u?[t]:[]:null}hitTestRecursive(t,s,i,n,r){if(this._interactivePrune(t)||r(t,i))return null;if((t.eventMode==="dynamic"||s==="dynamic")&&(b.pauseUpdate=!1),t.interactiveChildren&&t.children){const d=t.children,u=i;for(let l=d.length-1;l>=0;l--){const c=d[l],h=this.hitTestRecursive(c,this._isInteractive(s)?s:c.eventMode,u,n,r);if(h){if(h.length>0&&!h[h.length-1].parent)continue;const m=t.isInteractive();return(h.length>0||m)&&h.push(t),h}}}const o=this._isInteractive(s),a=t.isInteractive();return o&&n(t,i)?a?[t]:[]:null}_isInteractive(t){return t==="static"||t==="dynamic"}_interactivePrune(t){return!t||!t.visible||!t.renderable||t.eventMode==="none"||t.eventMode==="passive"&&!t.interactiveChildren}hitPruneFn(t,s){if(t.hitArea&&(t.worldTransform.applyInverse(s,_),!t.hitArea.contains(_.x,_.y)))return!0;if(t.effects&&t.effects.length){let i=!1;for(let n=0;n<t.effects.length;n++){const r=t.effects[n];if(r.containsPoint){if(!r.containsPoint(s))return!1;i=!0}}return i}return!1}hitTestFn(t,s){var i;return t.eventMode==="passive"?!1:t.hitArea?!0:(i=t.view)!=null&&i.containsPoint?(t.worldTransform.applyInverse(s,_),t.view.containsPoint(_)):!1}notifyTarget(t,s){var r,o;s=s??t.type;const i=`on${s}`;(o=(r=t.currentTarget)[i])==null||o.call(r,t);const n=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${s}capture`:s;this.notifyListeners(t,n),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,s)}mapPointerDown(t){if(!(t instanceof y)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const s=this.createPointerEvent(t);if(this.dispatchEvent(s,"pointerdown"),s.pointerType==="touch")this.dispatchEvent(s,"touchstart");else if(s.pointerType==="mouse"||s.pointerType==="pen"){const n=s.button===2;this.dispatchEvent(s,n?"rightdown":"mousedown")}const i=this.trackingData(t.pointerId);i.pressTargetsByButton[t.button]=s.composedPath(),this.freeEvent(s)}mapPointerMove(t){var d,u;if(!(t instanceof y)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const s=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const i=s.pointerType==="mouse"||s.pointerType==="pen",n=this.trackingData(t.pointerId),r=this.findMountedTarget(n.overTargets);if(((d=n.overTargets)==null?void 0:d.length)>0&&r!==s.target){const l=t.type==="mousemove"?"mouseout":"pointerout",c=this.createPointerEvent(t,l,r);if(this.dispatchEvent(c,"pointerout"),i&&this.dispatchEvent(c,"mouseout"),!s.composedPath().includes(r)){const h=this.createPointerEvent(t,"pointerleave",r);for(h.eventPhase=h.AT_TARGET;h.target&&!s.composedPath().includes(h.target);)h.currentTarget=h.target,this.notifyTarget(h),i&&this.notifyTarget(h,"mouseleave"),h.target=h.target.parent;this.freeEvent(h)}this.freeEvent(c)}if(r!==s.target){const l=t.type==="mousemove"?"mouseover":"pointerover",c=this.clonePointerEvent(s,l);this.dispatchEvent(c,"pointerover"),i&&this.dispatchEvent(c,"mouseover");let h=r==null?void 0:r.parent;for(;h&&h!==this.rootTarget.parent&&h!==s.target;)h=h.parent;if(!h||h===this.rootTarget.parent){const p=this.clonePointerEvent(s,"pointerenter");for(p.eventPhase=p.AT_TARGET;p.target&&p.target!==r&&p.target!==this.rootTarget.parent;)p.currentTarget=p.target,this.notifyTarget(p),i&&this.notifyTarget(p,"mouseenter"),p.target=p.target.parent;this.freeEvent(p)}this.freeEvent(c)}const o=[],a=this.enableGlobalMoveEvents??!0;this.moveOnAll?o.push("pointermove"):this.dispatchEvent(s,"pointermove"),a&&o.push("globalpointermove"),s.pointerType==="touch"&&(this.moveOnAll?o.splice(1,0,"touchmove"):this.dispatchEvent(s,"touchmove"),a&&o.push("globaltouchmove")),i&&(this.moveOnAll?o.splice(1,0,"mousemove"):this.dispatchEvent(s,"mousemove"),a&&o.push("globalmousemove"),this.cursor=(u=s.target)==null?void 0:u.cursor),o.length>0&&this.all(s,o),this._allInteractiveElements.length=0,this._hitElements.length=0,n.overTargets=s.composedPath(),this.freeEvent(s)}mapPointerOver(t){var o;if(!(t instanceof y)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const s=this.trackingData(t.pointerId),i=this.createPointerEvent(t),n=i.pointerType==="mouse"||i.pointerType==="pen";this.dispatchEvent(i,"pointerover"),n&&this.dispatchEvent(i,"mouseover"),i.pointerType==="mouse"&&(this.cursor=(o=i.target)==null?void 0:o.cursor);const r=this.clonePointerEvent(i,"pointerenter");for(r.eventPhase=r.AT_TARGET;r.target&&r.target!==this.rootTarget.parent;)r.currentTarget=r.target,this.notifyTarget(r),n&&this.notifyTarget(r,"mouseenter"),r.target=r.target.parent;s.overTargets=i.composedPath(),this.freeEvent(i),this.freeEvent(r)}mapPointerOut(t){if(!(t instanceof y)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const s=this.trackingData(t.pointerId);if(s.overTargets){const i=t.pointerType==="mouse"||t.pointerType==="pen",n=this.findMountedTarget(s.overTargets),r=this.createPointerEvent(t,"pointerout",n);this.dispatchEvent(r),i&&this.dispatchEvent(r,"mouseout");const o=this.createPointerEvent(t,"pointerleave",n);for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),i&&this.notifyTarget(o,"mouseleave"),o.target=o.target.parent;s.overTargets=null,this.freeEvent(r),this.freeEvent(o)}this.cursor=null}mapPointerUp(t){if(!(t instanceof y)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const s=performance.now(),i=this.createPointerEvent(t);if(this.dispatchEvent(i,"pointerup"),i.pointerType==="touch")this.dispatchEvent(i,"touchend");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const a=i.button===2;this.dispatchEvent(i,a?"rightup":"mouseup")}const n=this.trackingData(t.pointerId),r=this.findMountedTarget(n.pressTargetsByButton[t.button]);let o=r;if(r&&!i.composedPath().includes(r)){let a=r;for(;a&&!i.composedPath().includes(a);){if(i.currentTarget=a,this.notifyTarget(i,"pointerupoutside"),i.pointerType==="touch")this.notifyTarget(i,"touchendoutside");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const d=i.button===2;this.notifyTarget(i,d?"rightupoutside":"mouseupoutside")}a=a.parent}delete n.pressTargetsByButton[t.button],o=a}if(o){const a=this.clonePointerEvent(i,"click");a.target=o,a.path=null,n.clicksByButton[t.button]||(n.clicksByButton[t.button]={clickCount:0,target:a.target,timeStamp:s});const d=n.clicksByButton[t.button];if(d.target===a.target&&s-d.timeStamp<200?++d.clickCount:d.clickCount=1,d.target=a.target,d.timeStamp=s,a.detail=d.clickCount,a.pointerType==="mouse"){const u=a.button===2;this.dispatchEvent(a,u?"rightclick":"click")}else a.pointerType==="touch"&&this.dispatchEvent(a,"tap");this.dispatchEvent(a,"pointertap"),this.freeEvent(a)}this.freeEvent(i)}mapPointerUpOutside(t){if(!(t instanceof y)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const s=this.trackingData(t.pointerId),i=this.findMountedTarget(s.pressTargetsByButton[t.button]),n=this.createPointerEvent(t);if(i){let r=i;for(;r;)n.currentTarget=r,this.notifyTarget(n,"pointerupoutside"),n.pointerType==="touch"?this.notifyTarget(n,"touchendoutside"):(n.pointerType==="mouse"||n.pointerType==="pen")&&this.notifyTarget(n,n.button===2?"rightupoutside":"mouseupoutside"),r=r.parent;delete s.pressTargetsByButton[t.button]}this.freeEvent(n)}mapWheel(t){if(!(t instanceof w)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const s=this.createWheelEvent(t);this.dispatchEvent(s),this.freeEvent(s)}findMountedTarget(t){if(!t)return null;let s=t[0];for(let i=1;i<t.length&&t[i].parent===s;i++)s=t[i];return s}createPointerEvent(t,s,i){const n=this.allocateEvent(y);return this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.nativeEvent=t.nativeEvent,n.originalEvent=t,n.target=i??this.hitTest(n.global.x,n.global.y)??this._hitElements[0],typeof s=="string"&&(n.type=s),n}createWheelEvent(t){const s=this.allocateEvent(w);return this.copyWheelData(t,s),this.copyMouseData(t,s),this.copyData(t,s),s.nativeEvent=t.nativeEvent,s.originalEvent=t,s.target=this.hitTest(s.global.x,s.global.y),s}clonePointerEvent(t,s){const i=this.allocateEvent(y);return i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice(),i.type=s??i.type,i}copyWheelData(t,s){s.deltaMode=t.deltaMode,s.deltaX=t.deltaX,s.deltaY=t.deltaY,s.deltaZ=t.deltaZ}copyPointerData(t,s){t instanceof y&&s instanceof y&&(s.pointerId=t.pointerId,s.width=t.width,s.height=t.height,s.isPrimary=t.isPrimary,s.pointerType=t.pointerType,s.pressure=t.pressure,s.tangentialPressure=t.tangentialPressure,s.tiltX=t.tiltX,s.tiltY=t.tiltY,s.twist=t.twist)}copyMouseData(t,s){t instanceof O&&s instanceof O&&(s.altKey=t.altKey,s.button=t.button,s.buttons=t.buttons,s.client.copyFrom(t.client),s.ctrlKey=t.ctrlKey,s.metaKey=t.metaKey,s.movement.copyFrom(t.movement),s.screen.copyFrom(t.screen),s.shiftKey=t.shiftKey,s.global.copyFrom(t.global))}copyData(t,s){s.isTrusted=t.isTrusted,s.srcElement=t.srcElement,s.timeStamp=performance.now(),s.type=t.type,s.detail=t.detail,s.view=t.view,s.which=t.which,s.layer.copyFrom(t.layer),s.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const s=this.eventPool.get(t).pop()||new t(this);return s.eventPhase=s.NONE,s.currentTarget=null,s.path=null,s.target=null,s}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const s=t.constructor;this.eventPool.has(s)||this.eventPool.set(s,[]),this.eventPool.get(s).push(t)}notifyListeners(t,s){const i=t.currentTarget._events[s];if(i&&t.currentTarget.isInteractive())if("fn"in i)i.once&&t.currentTarget.removeListener(s,i.fn,void 0,!0),i.fn.call(i.context,t);else for(let n=0,r=i.length;n<r&&!t.propagationImmediatelyStopped;n++)i[n].once&&t.currentTarget.removeListener(s,i[n].fn,void 0,!0),i[n].fn.call(i[n].context,t)}}const ce=1,ue={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},j=class{constructor(e){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=e,this.rootBoundary=new le(null),b.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new y(null),this.rootWheelEvent=new w(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...j.defaultEventFeatures},{set:(t,s,i)=>(s==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=i),t[s]=i,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(e){const{canvas:t,resolution:s}=this.renderer;this.setTargetElement(t),this.resolution=s,j._defaultEventMode=e.eventMode??"passive",Object.assign(this.features,e.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(e){this.resolution=e}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(e){e=e||"default";let t=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(t=!1),this.currentCursor===e)return;this.currentCursor=e;const s=this.cursorStyles[e];if(s)switch(typeof s){case"string":t&&(this.domElement.style.cursor=s);break;case"function":s(e);break;case"object":t&&Object.assign(this.domElement.style,s);break}else t&&typeof e=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,e)&&(this.domElement.style.cursor=e)}get pointer(){return this.rootPointerEvent}onPointerDown(e){if(!this.features.click||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&e.pointerType==="touch"))return;const t=this.normalizeToPointerData(e);this.autoPreventDefault&&t[0].isNormalized&&(e.cancelable||!("cancelable"in e))&&e.preventDefault();for(let s=0,i=t.length;s<i;s++){const n=t[s],r=this.bootstrapEvent(this.rootPointerEvent,n);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(e){if(!this.features.move||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&e.pointerType==="touch"))return;b.pointerMoved();const t=this.normalizeToPointerData(e);for(let s=0,i=t.length;s<i;s++){const n=this.bootstrapEvent(this.rootPointerEvent,t[s]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(e){if(!this.features.click||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&e.pointerType==="touch"))return;let t=e.target;e.composedPath&&e.composedPath().length>0&&(t=e.composedPath()[0]);const s=t!==this.domElement?"outside":"",i=this.normalizeToPointerData(e);for(let n=0,r=i.length;n<r;n++){const o=this.bootstrapEvent(this.rootPointerEvent,i[n]);o.type+=s,this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(e){if(!this.features.click||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&e.pointerType==="touch"))return;const t=this.normalizeToPointerData(e);for(let s=0,i=t.length;s<i;s++){const n=this.bootstrapEvent(this.rootPointerEvent,t[s]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onWheel(e){if(!this.features.wheel)return;const t=this.normalizeWheelEvent(e);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(t)}setTargetElement(e){this.removeEvents(),this.domElement=e,b.domElement=e,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;b.addTickerListener();const e=this.domElement.style;e&&(globalThis.navigator.msPointerEnabled?(e.msContentZooming="none",e.msTouchAction="none"):this.supportsPointerEvents&&(e.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;b.removeTickerListener();const e=this.domElement.style;globalThis.navigator.msPointerEnabled?(e.msContentZooming="",e.msTouchAction=""):this.supportsPointerEvents&&(e.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(e,t,s){const i=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},n=1/this.resolution;e.x=(t-i.left)*(this.domElement.width/i.width)*n,e.y=(s-i.top)*(this.domElement.height/i.height)*n}normalizeToPointerData(e){const t=[];if(this.supportsTouchEvents&&e instanceof TouchEvent)for(let s=0,i=e.changedTouches.length;s<i;s++){const n=e.changedTouches[s];typeof n.button>"u"&&(n.button=0),typeof n.buttons>"u"&&(n.buttons=1),typeof n.isPrimary>"u"&&(n.isPrimary=e.touches.length===1&&e.type==="touchstart"),typeof n.width>"u"&&(n.width=n.radiusX||1),typeof n.height>"u"&&(n.height=n.radiusY||1),typeof n.tiltX>"u"&&(n.tiltX=0),typeof n.tiltY>"u"&&(n.tiltY=0),typeof n.pointerType>"u"&&(n.pointerType="touch"),typeof n.pointerId>"u"&&(n.pointerId=n.identifier||0),typeof n.pressure>"u"&&(n.pressure=n.force||.5),typeof n.twist>"u"&&(n.twist=0),typeof n.tangentialPressure>"u"&&(n.tangentialPressure=0),typeof n.layerX>"u"&&(n.layerX=n.offsetX=n.clientX),typeof n.layerY>"u"&&(n.layerY=n.offsetY=n.clientY),n.isNormalized=!0,n.type=e.type,t.push(n)}else if(!globalThis.MouseEvent||e instanceof MouseEvent&&(!this.supportsPointerEvents||!(e instanceof globalThis.PointerEvent))){const s=e;typeof s.isPrimary>"u"&&(s.isPrimary=!0),typeof s.width>"u"&&(s.width=1),typeof s.height>"u"&&(s.height=1),typeof s.tiltX>"u"&&(s.tiltX=0),typeof s.tiltY>"u"&&(s.tiltY=0),typeof s.pointerType>"u"&&(s.pointerType="mouse"),typeof s.pointerId>"u"&&(s.pointerId=ce),typeof s.pressure>"u"&&(s.pressure=.5),typeof s.twist>"u"&&(s.twist=0),typeof s.tangentialPressure>"u"&&(s.tangentialPressure=0),s.isNormalized=!0,t.push(s)}else t.push(e);return t}normalizeWheelEvent(e){const t=this.rootWheelEvent;return this.transferMouseData(t,e),t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ,t.deltaMode=e.deltaMode,this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.nativeEvent=e,t.type=e.type,t}bootstrapEvent(e,t){return e.originalEvent=null,e.nativeEvent=t,e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist,this.transferMouseData(e,t),this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.isTrusted=t.isTrusted,e.type==="pointerleave"&&(e.type="pointerout"),e.type.startsWith("mouse")&&(e.type=e.type.replace("mouse","pointer")),e.type.startsWith("touch")&&(e.type=ue[e.type]||e.type),e}transferMouseData(e,t){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.x=t.clientX,e.client.y=t.clientY,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.x=t.movementX,e.movement.y=t.movementY,e.page.x=t.pageX,e.page.y=t.pageY,e.relatedTarget=null,e.shiftKey=t.shiftKey}};let D=j;D.extension={name:"events",type:[f.WebGLRendererSystem,f.CanvasRendererSystem,f.WebGPURendererSystem],priority:-1};D.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};const de={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,get interactive(){return this.eventMode==="dynamic"||this.eventMode==="static"},set interactive(e){this.eventMode=e?"static":"passive"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??D.defaultEventMode},set eventMode(e){this._internalEventMode=e},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(e,t,s){const i=typeof s=="boolean"&&s||typeof s=="object"&&s.capture,n=typeof t=="function"?void 0:t;e=i?`${e}capture`:e,t=typeof t=="function"?t:t.handleEvent,this.on(e,t,n)},removeEventListener(e,t,s){const i=typeof s=="boolean"&&s||typeof s=="object"&&s.capture,n=typeof t=="function"?void 0:t;e=i?`${e}capture`:e,t=typeof t=="function"?t:t.handleEvent,this.off(e,t,n)},dispatchEvent(e){if(!(e instanceof F))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return e.defaultPrevented=!1,e.path=null,e.target=this,e.manager.dispatchEvent(e),!e.defaultPrevented}};E.add(D);st.mixin(de);const M=class{constructor(e,t){this.linkedSheets=[],this._texture=e instanceof I?e:null,this.textureSource=e.source,this.textures={},this.animations={},this.data=t;const s=parseFloat(t.meta.scale);s?(this.resolution=s,e.source.resolution=this.resolution):this.resolution=e.source._resolution,this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}parse(){return new Promise(e=>{this._callback=e,this._batchIndex=0,this._frameKeys.length<=M.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(e){let t=e;const s=M.BATCH_SIZE;for(;t-e<s&&t<this._frameKeys.length;){const i=this._frameKeys[t],n=this._frames[i],r=n.frame;if(r){let o=null,a=null;const d=n.trimmed!==!1&&n.sourceSize?n.sourceSize:n.frame,u=new x(0,0,Math.floor(d.w)/this.resolution,Math.floor(d.h)/this.resolution);n.rotated?o=new x(Math.floor(r.x)/this.resolution,Math.floor(r.y)/this.resolution,Math.floor(r.h)/this.resolution,Math.floor(r.w)/this.resolution):o=new x(Math.floor(r.x)/this.resolution,Math.floor(r.y)/this.resolution,Math.floor(r.w)/this.resolution,Math.floor(r.h)/this.resolution),n.trimmed!==!1&&n.spriteSourceSize&&(a=new x(Math.floor(n.spriteSourceSize.x)/this.resolution,Math.floor(n.spriteSourceSize.y)/this.resolution,Math.floor(r.w)/this.resolution,Math.floor(r.h)/this.resolution),a.x/=this.textureSource.width,a.y/=this.textureSource.height,a.width/=this.textureSource.width,a.height/=this.textureSource.height),o.x/=this.textureSource.width,o.y/=this.textureSource.height,o.width/=this.textureSource.width,o.height/=this.textureSource.height,u.x/=this.textureSource.width,u.y/=this.textureSource.height,u.width/=this.textureSource.width,u.height/=this.textureSource.height,this.textures[i]=new I({source:this.textureSource,layout:{frame:o,orig:u,trim:a,rotate:n.rotated?2:0,defaultAnchor:n.anchor},label:i})}t++}}_processAnimations(){const e=this.data.animations||{};for(const t in e){this.animations[t]=[];for(let s=0;s<e[t].length;s++){const i=e[t][s];this.animations[t].push(this.textures[i])}}}_parseComplete(){const e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*M.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*M.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(e=!1){var t;for(const s in this.textures)this.textures[s].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&((t=this._texture)==null||t.destroy(),this.textureSource.destroy()),this._texture=null,this.textureSource=null,this.linkedSheets=[]}};let U=M;U.BATCH_SIZE=1e3;const pe=["jpg","png","jpeg","avif","webp"];function ht(e,t,s){const i={};if(e.forEach(n=>{i[n]=t}),Object.keys(t.textures).forEach(n=>{i[n]=t.textures[n]}),!s){const n=T.dirname(e[0]);t.linkedSheets.forEach((r,o)=>{const a=ht([`${n}/${t.data.meta.related_multi_packs[o]}`],r,!0);Object.assign(i,a)})}return i}const fe={extension:f.Asset,cache:{test:e=>e instanceof U,getCacheableAssets:(e,t)=>ht(e,t,!1)},resolver:{test:e=>{const s=e.split("?")[0].split("."),i=s.pop(),n=s.pop();return i==="json"&&pe.includes(n)},parse:e=>{var s;const t=e.split(".");return{resolution:parseFloat(((s=g.RETINA_PREFIX.exec(e))==null?void 0:s[1])??"1"),format:t[t.length-2],src:e}}},loader:{name:"spritesheetLoader",extension:{type:f.LoadParser,priority:P.Normal},async testParse(e,t){return T.extname(t.src).toLowerCase()===".json"&&!!e.frames},async parse(e,t,s){var u,l;let i=T.dirname(t.src);i&&i.lastIndexOf("/")!==i.length-1&&(i+="/");let n=i+e.meta.image;n=W(n,t.src);const o=(await s.load([n]))[n],a=new U(o.source,e);await a.parse();const d=(u=e==null?void 0:e.meta)==null?void 0:u.related_multi_packs;if(Array.isArray(d)){const c=[];for(const m of d){if(typeof m!="string")continue;let p=i+m;(l=t.data)!=null&&l.ignoreMultiPack||(p=W(p,t.src),c.push(s.load({src:p,data:{ignoreMultiPack:!0}})))}const h=await Promise.all(c);a.linkedSheets=h,h.forEach(m=>{m.linkedSheets=[a].concat(a.linkedSheets.filter(p=>p!==m))})}return a},unload(e){e.destroy(!0)}}};E.add(fe);const me=new it;function lt(e,t,s){const i=me;e.measurable=!0,At(e,s,i),t.addBoundsMask(i),e.measurable=!1}function ct(e,t,s){const i=new it;e.measurable=!0;const n=ut(e,s,new Et);Tt(e,i,n),e.measurable=!1,t.addBoundsMask(i)}function ut(e,t,s){return e?(e!==t&&(ut(e.parent,t,s),e.didChange&&bt(e.localTransform,e),s.append(e.localTransform)),s):(console.warn("Item is not inside the root container"),s)}class dt{constructor(t){this.priority=0,this.pipe="alphaMask",t!=null&&t.mask&&this.init(t.mask)}init(t){this.mask=t,this.renderMaskToTexture=!(t instanceof q),this.mask.renderable=this.renderMaskToTexture,this.mask.includeInBuild=!this.renderMaskToTexture,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask=null}addBounds(t,s){lt(this.mask,t,s)}addLocalBounds(t,s){ct(this.mask,t,s)}containsPoint(t){const s=this.mask;return s.containsPoint?s.containsPoint(t):!1}destroy(){this.reset()}static test(t){return t instanceof q}}dt.extension=f.MaskEffect;class pt{constructor(t){this.priority=0,this.pipe="colorMask",t!=null&&t.mask&&this.init(t.mask)}init(t){this.mask=t}destroy(){}static test(t){return typeof t=="number"}}pt.extension=f.MaskEffect;class ft{constructor(t){this.priority=0,this.pipe="stencilMask",t!=null&&t.mask&&this.init(t.mask)}init(t){this.mask=t,this.mask.includeInBuild=!1,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask.includeInBuild=!0,this.mask=null}addBounds(t,s){lt(this.mask,t,s)}addLocalBounds(t,s){ct(this.mask,t,s)}containsPoint(t){const s=this.mask;return s.containsPoint?s.containsPoint(t):!1}destroy(){this.reset()}static test(t){return t instanceof st}}ft.extension=f.MaskEffect;E.add(dt,pt,ft);
